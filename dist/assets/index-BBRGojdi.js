(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const l of n)if(l.type==="childList")for(const o of l.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(n){const l={};return n.integrity&&(l.integrity=n.integrity),n.referrerPolicy&&(l.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?l.credentials="include":n.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(n){if(n.ep)return;n.ep=!0;const l=t(n);fetch(n.href,l)}})();function Ud(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Rf={exports:{}},Sa={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ap;function FS(){if(ap)return Sa;ap=1;var r=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(i,n,l){var o=null;if(l!==void 0&&(o=""+l),n.key!==void 0&&(o=""+n.key),"key"in n){l={};for(var u in n)u!=="key"&&(l[u]=n[u])}else l=n;return n=l.ref,{$$typeof:r,type:i,key:o,ref:n!==void 0?n:null,props:l}}return Sa.Fragment=e,Sa.jsx=t,Sa.jsxs=t,Sa}var lp;function jS(){return lp||(lp=1,Rf.exports=FS()),Rf.exports}var b=jS(),Lf={exports:{}},_e={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var op;function $S(){if(op)return _e;op=1;var r=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),n=Symbol.for("react.profiler"),l=Symbol.for("react.consumer"),o=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),g=Symbol.iterator;function v(w){return w===null||typeof w!="object"?null:(w=g&&w[g]||w["@@iterator"],typeof w=="function"?w:null)}var E={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},y=Object.assign,S={};function T(w,k,K){this.props=w,this.context=k,this.refs=S,this.updater=K||E}T.prototype.isReactComponent={},T.prototype.setState=function(w,k){if(typeof w!="object"&&typeof w!="function"&&w!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,w,k,"setState")},T.prototype.forceUpdate=function(w){this.updater.enqueueForceUpdate(this,w,"forceUpdate")};function R(){}R.prototype=T.prototype;function D(w,k,K){this.props=w,this.context=k,this.refs=S,this.updater=K||E}var _=D.prototype=new R;_.constructor=D,y(_,T.prototype),_.isPureReactComponent=!0;var O=Array.isArray,C={H:null,A:null,T:null,S:null,V:null},B=Object.prototype.hasOwnProperty;function N(w,k,K,G,oe,fe){return K=fe.ref,{$$typeof:r,type:w,key:k,ref:K!==void 0?K:null,props:fe}}function F(w,k){return N(w.type,k,void 0,void 0,void 0,w.props)}function z(w){return typeof w=="object"&&w!==null&&w.$$typeof===r}function $(w){var k={"=":"=0",":":"=2"};return"$"+w.replace(/[=:]/g,function(K){return k[K]})}var ae=/\/+/g;function ce(w,k){return typeof w=="object"&&w!==null&&w.key!=null?$(""+w.key):k.toString(36)}function ve(){}function he(w){switch(w.status){case"fulfilled":return w.value;case"rejected":throw w.reason;default:switch(typeof w.status=="string"?w.then(ve,ve):(w.status="pending",w.then(function(k){w.status==="pending"&&(w.status="fulfilled",w.value=k)},function(k){w.status==="pending"&&(w.status="rejected",w.reason=k)})),w.status){case"fulfilled":return w.value;case"rejected":throw w.reason}}throw w}function J(w,k,K,G,oe){var fe=typeof w;(fe==="undefined"||fe==="boolean")&&(w=null);var ue=!1;if(w===null)ue=!0;else switch(fe){case"bigint":case"string":case"number":ue=!0;break;case"object":switch(w.$$typeof){case r:case e:ue=!0;break;case m:return ue=w._init,J(ue(w._payload),k,K,G,oe)}}if(ue)return oe=oe(w),ue=G===""?"."+ce(w,0):G,O(oe)?(K="",ue!=null&&(K=ue.replace(ae,"$&/")+"/"),J(oe,k,K,"",function(ct){return ct})):oe!=null&&(z(oe)&&(oe=F(oe,K+(oe.key==null||w&&w.key===oe.key?"":(""+oe.key).replace(ae,"$&/")+"/")+ue)),k.push(oe)),1;ue=0;var ke=G===""?".":G+":";if(O(w))for(var Le=0;Le<w.length;Le++)G=w[Le],fe=ke+ce(G,Le),ue+=J(G,k,K,fe,oe);else if(Le=v(w),typeof Le=="function")for(w=Le.call(w),Le=0;!(G=w.next()).done;)G=G.value,fe=ke+ce(G,Le++),ue+=J(G,k,K,fe,oe);else if(fe==="object"){if(typeof w.then=="function")return J(he(w),k,K,G,oe);throw k=String(w),Error("Objects are not valid as a React child (found: "+(k==="[object Object]"?"object with keys {"+Object.keys(w).join(", ")+"}":k)+"). If you meant to render a collection of children, use an array instead.")}return ue}function P(w,k,K){if(w==null)return w;var G=[],oe=0;return J(w,G,"","",function(fe){return k.call(K,fe,oe++)}),G}function W(w){if(w._status===-1){var k=w._result;k=k(),k.then(function(K){(w._status===0||w._status===-1)&&(w._status=1,w._result=K)},function(K){(w._status===0||w._status===-1)&&(w._status=2,w._result=K)}),w._status===-1&&(w._status=0,w._result=k)}if(w._status===1)return w._result.default;throw w._result}var se=typeof reportError=="function"?reportError:function(w){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var k=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof w=="object"&&w!==null&&typeof w.message=="string"?String(w.message):String(w),error:w});if(!window.dispatchEvent(k))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",w);return}console.error(w)};function ee(){}return _e.Children={map:P,forEach:function(w,k,K){P(w,function(){k.apply(this,arguments)},K)},count:function(w){var k=0;return P(w,function(){k++}),k},toArray:function(w){return P(w,function(k){return k})||[]},only:function(w){if(!z(w))throw Error("React.Children.only expected to receive a single React element child.");return w}},_e.Component=T,_e.Fragment=t,_e.Profiler=n,_e.PureComponent=D,_e.StrictMode=i,_e.Suspense=d,_e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=C,_e.__COMPILER_RUNTIME={__proto__:null,c:function(w){return C.H.useMemoCache(w)}},_e.cache=function(w){return function(){return w.apply(null,arguments)}},_e.cloneElement=function(w,k,K){if(w==null)throw Error("The argument must be a React element, but you passed "+w+".");var G=y({},w.props),oe=w.key,fe=void 0;if(k!=null)for(ue in k.ref!==void 0&&(fe=void 0),k.key!==void 0&&(oe=""+k.key),k)!B.call(k,ue)||ue==="key"||ue==="__self"||ue==="__source"||ue==="ref"&&k.ref===void 0||(G[ue]=k[ue]);var ue=arguments.length-2;if(ue===1)G.children=K;else if(1<ue){for(var ke=Array(ue),Le=0;Le<ue;Le++)ke[Le]=arguments[Le+2];G.children=ke}return N(w.type,oe,void 0,void 0,fe,G)},_e.createContext=function(w){return w={$$typeof:o,_currentValue:w,_currentValue2:w,_threadCount:0,Provider:null,Consumer:null},w.Provider=w,w.Consumer={$$typeof:l,_context:w},w},_e.createElement=function(w,k,K){var G,oe={},fe=null;if(k!=null)for(G in k.key!==void 0&&(fe=""+k.key),k)B.call(k,G)&&G!=="key"&&G!=="__self"&&G!=="__source"&&(oe[G]=k[G]);var ue=arguments.length-2;if(ue===1)oe.children=K;else if(1<ue){for(var ke=Array(ue),Le=0;Le<ue;Le++)ke[Le]=arguments[Le+2];oe.children=ke}if(w&&w.defaultProps)for(G in ue=w.defaultProps,ue)oe[G]===void 0&&(oe[G]=ue[G]);return N(w,fe,void 0,void 0,null,oe)},_e.createRef=function(){return{current:null}},_e.forwardRef=function(w){return{$$typeof:u,render:w}},_e.isValidElement=z,_e.lazy=function(w){return{$$typeof:m,_payload:{_status:-1,_result:w},_init:W}},_e.memo=function(w,k){return{$$typeof:f,type:w,compare:k===void 0?null:k}},_e.startTransition=function(w){var k=C.T,K={};C.T=K;try{var G=w(),oe=C.S;oe!==null&&oe(K,G),typeof G=="object"&&G!==null&&typeof G.then=="function"&&G.then(ee,se)}catch(fe){se(fe)}finally{C.T=k}},_e.unstable_useCacheRefresh=function(){return C.H.useCacheRefresh()},_e.use=function(w){return C.H.use(w)},_e.useActionState=function(w,k,K){return C.H.useActionState(w,k,K)},_e.useCallback=function(w,k){return C.H.useCallback(w,k)},_e.useContext=function(w){return C.H.useContext(w)},_e.useDebugValue=function(){},_e.useDeferredValue=function(w,k){return C.H.useDeferredValue(w,k)},_e.useEffect=function(w,k,K){var G=C.H;if(typeof K=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return G.useEffect(w,k)},_e.useId=function(){return C.H.useId()},_e.useImperativeHandle=function(w,k,K){return C.H.useImperativeHandle(w,k,K)},_e.useInsertionEffect=function(w,k){return C.H.useInsertionEffect(w,k)},_e.useLayoutEffect=function(w,k){return C.H.useLayoutEffect(w,k)},_e.useMemo=function(w,k){return C.H.useMemo(w,k)},_e.useOptimistic=function(w,k){return C.H.useOptimistic(w,k)},_e.useReducer=function(w,k,K){return C.H.useReducer(w,k,K)},_e.useRef=function(w){return C.H.useRef(w)},_e.useState=function(w){return C.H.useState(w)},_e.useSyncExternalStore=function(w,k,K){return C.H.useSyncExternalStore(w,k,K)},_e.useTransition=function(){return C.H.useTransition()},_e.version="19.1.0",_e}var cp;function Bd(){return cp||(cp=1,Lf.exports=$S()),Lf.exports}var U=Bd();const Si=Ud(U);var _f={exports:{}},Ta={},Df={exports:{}},wf={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var up;function GS(){return up||(up=1,function(r){function e(P,W){var se=P.length;P.push(W);e:for(;0<se;){var ee=se-1>>>1,w=P[ee];if(0<n(w,W))P[ee]=W,P[se]=w,se=ee;else break e}}function t(P){return P.length===0?null:P[0]}function i(P){if(P.length===0)return null;var W=P[0],se=P.pop();if(se!==W){P[0]=se;e:for(var ee=0,w=P.length,k=w>>>1;ee<k;){var K=2*(ee+1)-1,G=P[K],oe=K+1,fe=P[oe];if(0>n(G,se))oe<w&&0>n(fe,G)?(P[ee]=fe,P[oe]=se,ee=oe):(P[ee]=G,P[K]=se,ee=K);else if(oe<w&&0>n(fe,se))P[ee]=fe,P[oe]=se,ee=oe;else break e}}return W}function n(P,W){var se=P.sortIndex-W.sortIndex;return se!==0?se:P.id-W.id}if(r.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var l=performance;r.unstable_now=function(){return l.now()}}else{var o=Date,u=o.now();r.unstable_now=function(){return o.now()-u}}var d=[],f=[],m=1,g=null,v=3,E=!1,y=!1,S=!1,T=!1,R=typeof setTimeout=="function"?setTimeout:null,D=typeof clearTimeout=="function"?clearTimeout:null,_=typeof setImmediate<"u"?setImmediate:null;function O(P){for(var W=t(f);W!==null;){if(W.callback===null)i(f);else if(W.startTime<=P)i(f),W.sortIndex=W.expirationTime,e(d,W);else break;W=t(f)}}function C(P){if(S=!1,O(P),!y)if(t(d)!==null)y=!0,B||(B=!0,ce());else{var W=t(f);W!==null&&J(C,W.startTime-P)}}var B=!1,N=-1,F=5,z=-1;function $(){return T?!0:!(r.unstable_now()-z<F)}function ae(){if(T=!1,B){var P=r.unstable_now();z=P;var W=!0;try{e:{y=!1,S&&(S=!1,D(N),N=-1),E=!0;var se=v;try{t:{for(O(P),g=t(d);g!==null&&!(g.expirationTime>P&&$());){var ee=g.callback;if(typeof ee=="function"){g.callback=null,v=g.priorityLevel;var w=ee(g.expirationTime<=P);if(P=r.unstable_now(),typeof w=="function"){g.callback=w,O(P),W=!0;break t}g===t(d)&&i(d),O(P)}else i(d);g=t(d)}if(g!==null)W=!0;else{var k=t(f);k!==null&&J(C,k.startTime-P),W=!1}}break e}finally{g=null,v=se,E=!1}W=void 0}}finally{W?ce():B=!1}}}var ce;if(typeof _=="function")ce=function(){_(ae)};else if(typeof MessageChannel<"u"){var ve=new MessageChannel,he=ve.port2;ve.port1.onmessage=ae,ce=function(){he.postMessage(null)}}else ce=function(){R(ae,0)};function J(P,W){N=R(function(){P(r.unstable_now())},W)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(P){P.callback=null},r.unstable_forceFrameRate=function(P){0>P||125<P?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):F=0<P?Math.floor(1e3/P):5},r.unstable_getCurrentPriorityLevel=function(){return v},r.unstable_next=function(P){switch(v){case 1:case 2:case 3:var W=3;break;default:W=v}var se=v;v=W;try{return P()}finally{v=se}},r.unstable_requestPaint=function(){T=!0},r.unstable_runWithPriority=function(P,W){switch(P){case 1:case 2:case 3:case 4:case 5:break;default:P=3}var se=v;v=P;try{return W()}finally{v=se}},r.unstable_scheduleCallback=function(P,W,se){var ee=r.unstable_now();switch(typeof se=="object"&&se!==null?(se=se.delay,se=typeof se=="number"&&0<se?ee+se:ee):se=ee,P){case 1:var w=-1;break;case 2:w=250;break;case 5:w=1073741823;break;case 4:w=1e4;break;default:w=5e3}return w=se+w,P={id:m++,callback:W,priorityLevel:P,startTime:se,expirationTime:w,sortIndex:-1},se>ee?(P.sortIndex=se,e(f,P),t(d)===null&&P===t(f)&&(S?(D(N),N=-1):S=!0,J(C,se-ee))):(P.sortIndex=w,e(d,P),y||E||(y=!0,B||(B=!0,ce()))),P},r.unstable_shouldYield=$,r.unstable_wrapCallback=function(P){var W=v;return function(){var se=v;v=W;try{return P.apply(this,arguments)}finally{v=se}}}}(wf)),wf}var fp;function HS(){return fp||(fp=1,Df.exports=GS()),Df.exports}var If={exports:{}},wt={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var dp;function VS(){if(dp)return wt;dp=1;var r=Bd();function e(d){var f="https://react.dev/errors/"+d;if(1<arguments.length){f+="?args[]="+encodeURIComponent(arguments[1]);for(var m=2;m<arguments.length;m++)f+="&args[]="+encodeURIComponent(arguments[m])}return"Minified React error #"+d+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var i={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},n=Symbol.for("react.portal");function l(d,f,m){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:n,key:g==null?null:""+g,children:d,containerInfo:f,implementation:m}}var o=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function u(d,f){if(d==="font")return"";if(typeof f=="string")return f==="use-credentials"?f:""}return wt.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,wt.createPortal=function(d,f){var m=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)throw Error(e(299));return l(d,f,null,m)},wt.flushSync=function(d){var f=o.T,m=i.p;try{if(o.T=null,i.p=2,d)return d()}finally{o.T=f,i.p=m,i.d.f()}},wt.preconnect=function(d,f){typeof d=="string"&&(f?(f=f.crossOrigin,f=typeof f=="string"?f==="use-credentials"?f:"":void 0):f=null,i.d.C(d,f))},wt.prefetchDNS=function(d){typeof d=="string"&&i.d.D(d)},wt.preinit=function(d,f){if(typeof d=="string"&&f&&typeof f.as=="string"){var m=f.as,g=u(m,f.crossOrigin),v=typeof f.integrity=="string"?f.integrity:void 0,E=typeof f.fetchPriority=="string"?f.fetchPriority:void 0;m==="style"?i.d.S(d,typeof f.precedence=="string"?f.precedence:void 0,{crossOrigin:g,integrity:v,fetchPriority:E}):m==="script"&&i.d.X(d,{crossOrigin:g,integrity:v,fetchPriority:E,nonce:typeof f.nonce=="string"?f.nonce:void 0})}},wt.preinitModule=function(d,f){if(typeof d=="string")if(typeof f=="object"&&f!==null){if(f.as==null||f.as==="script"){var m=u(f.as,f.crossOrigin);i.d.M(d,{crossOrigin:m,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0})}}else f==null&&i.d.M(d)},wt.preload=function(d,f){if(typeof d=="string"&&typeof f=="object"&&f!==null&&typeof f.as=="string"){var m=f.as,g=u(m,f.crossOrigin);i.d.L(d,m,{crossOrigin:g,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0,type:typeof f.type=="string"?f.type:void 0,fetchPriority:typeof f.fetchPriority=="string"?f.fetchPriority:void 0,referrerPolicy:typeof f.referrerPolicy=="string"?f.referrerPolicy:void 0,imageSrcSet:typeof f.imageSrcSet=="string"?f.imageSrcSet:void 0,imageSizes:typeof f.imageSizes=="string"?f.imageSizes:void 0,media:typeof f.media=="string"?f.media:void 0})}},wt.preloadModule=function(d,f){if(typeof d=="string")if(f){var m=u(f.as,f.crossOrigin);i.d.m(d,{as:typeof f.as=="string"&&f.as!=="script"?f.as:void 0,crossOrigin:m,integrity:typeof f.integrity=="string"?f.integrity:void 0})}else i.d.m(d)},wt.requestFormReset=function(d){i.d.r(d)},wt.unstable_batchedUpdates=function(d,f){return d(f)},wt.useFormState=function(d,f,m){return o.H.useFormState(d,f,m)},wt.useFormStatus=function(){return o.H.useHostTransitionStatus()},wt.version="19.1.0",wt}var hp;function zS(){if(hp)return If.exports;hp=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(e){console.error(e)}}return r(),If.exports=VS(),If.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mp;function KS(){if(mp)return Ta;mp=1;var r=HS(),e=Bd(),t=zS();function i(s){var a="https://react.dev/errors/"+s;if(1<arguments.length){a+="?args[]="+encodeURIComponent(arguments[1]);for(var c=2;c<arguments.length;c++)a+="&args[]="+encodeURIComponent(arguments[c])}return"Minified React error #"+s+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function l(s){var a=s,c=s;if(s.alternate)for(;a.return;)a=a.return;else{s=a;do a=s,(a.flags&4098)!==0&&(c=a.return),s=a.return;while(s)}return a.tag===3?c:null}function o(s){if(s.tag===13){var a=s.memoizedState;if(a===null&&(s=s.alternate,s!==null&&(a=s.memoizedState)),a!==null)return a.dehydrated}return null}function u(s){if(l(s)!==s)throw Error(i(188))}function d(s){var a=s.alternate;if(!a){if(a=l(s),a===null)throw Error(i(188));return a!==s?null:s}for(var c=s,h=a;;){var p=c.return;if(p===null)break;var x=p.alternate;if(x===null){if(h=p.return,h!==null){c=h;continue}break}if(p.child===x.child){for(x=p.child;x;){if(x===c)return u(p),s;if(x===h)return u(p),a;x=x.sibling}throw Error(i(188))}if(c.return!==h.return)c=p,h=x;else{for(var L=!1,I=p.child;I;){if(I===c){L=!0,c=p,h=x;break}if(I===h){L=!0,h=p,c=x;break}I=I.sibling}if(!L){for(I=x.child;I;){if(I===c){L=!0,c=x,h=p;break}if(I===h){L=!0,h=x,c=p;break}I=I.sibling}if(!L)throw Error(i(189))}}if(c.alternate!==h)throw Error(i(190))}if(c.tag!==3)throw Error(i(188));return c.stateNode.current===c?s:a}function f(s){var a=s.tag;if(a===5||a===26||a===27||a===6)return s;for(s=s.child;s!==null;){if(a=f(s),a!==null)return a;s=s.sibling}return null}var m=Object.assign,g=Symbol.for("react.element"),v=Symbol.for("react.transitional.element"),E=Symbol.for("react.portal"),y=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),T=Symbol.for("react.profiler"),R=Symbol.for("react.provider"),D=Symbol.for("react.consumer"),_=Symbol.for("react.context"),O=Symbol.for("react.forward_ref"),C=Symbol.for("react.suspense"),B=Symbol.for("react.suspense_list"),N=Symbol.for("react.memo"),F=Symbol.for("react.lazy"),z=Symbol.for("react.activity"),$=Symbol.for("react.memo_cache_sentinel"),ae=Symbol.iterator;function ce(s){return s===null||typeof s!="object"?null:(s=ae&&s[ae]||s["@@iterator"],typeof s=="function"?s:null)}var ve=Symbol.for("react.client.reference");function he(s){if(s==null)return null;if(typeof s=="function")return s.$$typeof===ve?null:s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case y:return"Fragment";case T:return"Profiler";case S:return"StrictMode";case C:return"Suspense";case B:return"SuspenseList";case z:return"Activity"}if(typeof s=="object")switch(s.$$typeof){case E:return"Portal";case _:return(s.displayName||"Context")+".Provider";case D:return(s._context.displayName||"Context")+".Consumer";case O:var a=s.render;return s=s.displayName,s||(s=a.displayName||a.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case N:return a=s.displayName||null,a!==null?a:he(s.type)||"Memo";case F:a=s._payload,s=s._init;try{return he(s(a))}catch{}}return null}var J=Array.isArray,P=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,W=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,se={pending:!1,data:null,method:null,action:null},ee=[],w=-1;function k(s){return{current:s}}function K(s){0>w||(s.current=ee[w],ee[w]=null,w--)}function G(s,a){w++,ee[w]=s.current,s.current=a}var oe=k(null),fe=k(null),ue=k(null),ke=k(null);function Le(s,a){switch(G(ue,a),G(fe,s),G(oe,null),a.nodeType){case 9:case 11:s=(s=a.documentElement)&&(s=s.namespaceURI)?kg(s):0;break;default:if(s=a.tagName,a=a.namespaceURI)a=kg(a),s=Mg(a,s);else switch(s){case"svg":s=1;break;case"math":s=2;break;default:s=0}}K(oe),G(oe,s)}function ct(){K(oe),K(fe),K(ue)}function Vi(s){s.memoizedState!==null&&G(ke,s);var a=oe.current,c=Mg(a,s.type);a!==c&&(G(fe,s),G(oe,c))}function Sn(s){fe.current===s&&(K(oe),K(fe)),ke.current===s&&(K(ke),pa._currentValue=se)}var br=Object.prototype.hasOwnProperty,Ks=r.unstable_scheduleCallback,Ys=r.unstable_cancelCallback,ph=r.unstable_shouldYield,Ue=r.unstable_requestPaint,Qe=r.unstable_now,Pt=r.unstable_getCurrentPriorityLevel,Ri=r.unstable_ImmediatePriority,Ut=r.unstable_UserBlockingPriority,mi=r.unstable_NormalPriority,zi=r.unstable_LowPriority,Ar=r.unstable_IdlePriority,Tn=r.log,Ya=r.unstable_setDisableYieldValue,gi=null,Rt=null;function Li(s){if(typeof Tn=="function"&&Ya(s),Rt&&typeof Rt.setStrictMode=="function")try{Rt.setStrictMode(gi,s)}catch{}}var Lt=Math.clz32?Math.clz32:R1,qa=Math.log,qs=Math.LN2;function R1(s){return s>>>=0,s===0?32:31-(qa(s)/qs|0)|0}var Xa=256,Qa=4194304;function Xs(s){var a=s&42;if(a!==0)return a;switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return s&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return s}}function Wa(s,a,c){var h=s.pendingLanes;if(h===0)return 0;var p=0,x=s.suspendedLanes,L=s.pingedLanes;s=s.warmLanes;var I=h&134217727;return I!==0?(h=I&~x,h!==0?p=Xs(h):(L&=I,L!==0?p=Xs(L):c||(c=I&~s,c!==0&&(p=Xs(c))))):(I=h&~x,I!==0?p=Xs(I):L!==0?p=Xs(L):c||(c=h&~s,c!==0&&(p=Xs(c)))),p===0?0:a!==0&&a!==p&&(a&x)===0&&(x=p&-p,c=a&-a,x>=c||x===32&&(c&4194048)!==0)?a:p}function Rr(s,a){return(s.pendingLanes&~(s.suspendedLanes&~s.pingedLanes)&a)===0}function L1(s,a){switch(s){case 1:case 2:case 4:case 8:case 64:return a+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function yh(){var s=Xa;return Xa<<=1,(Xa&4194048)===0&&(Xa=256),s}function vh(){var s=Qa;return Qa<<=1,(Qa&62914560)===0&&(Qa=4194304),s}function hc(s){for(var a=[],c=0;31>c;c++)a.push(s);return a}function Lr(s,a){s.pendingLanes|=a,a!==268435456&&(s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0)}function _1(s,a,c,h,p,x){var L=s.pendingLanes;s.pendingLanes=c,s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0,s.expiredLanes&=c,s.entangledLanes&=c,s.errorRecoveryDisabledLanes&=c,s.shellSuspendCounter=0;var I=s.entanglements,M=s.expirationTimes,X=s.hiddenUpdates;for(c=L&~c;0<c;){var ie=31-Lt(c),le=1<<ie;I[ie]=0,M[ie]=-1;var Q=X[ie];if(Q!==null)for(X[ie]=null,ie=0;ie<Q.length;ie++){var Z=Q[ie];Z!==null&&(Z.lane&=-536870913)}c&=~le}h!==0&&xh(s,h,0),x!==0&&p===0&&s.tag!==0&&(s.suspendedLanes|=x&~(L&~a))}function xh(s,a,c){s.pendingLanes|=a,s.suspendedLanes&=~a;var h=31-Lt(a);s.entangledLanes|=a,s.entanglements[h]=s.entanglements[h]|1073741824|c&4194090}function Eh(s,a){var c=s.entangledLanes|=a;for(s=s.entanglements;c;){var h=31-Lt(c),p=1<<h;p&a|s[h]&a&&(s[h]|=a),c&=~p}}function mc(s){switch(s){case 2:s=1;break;case 8:s=4;break;case 32:s=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:s=128;break;case 268435456:s=134217728;break;default:s=0}return s}function gc(s){return s&=-s,2<s?8<s?(s&134217727)!==0?32:268435456:8:2}function Sh(){var s=W.p;return s!==0?s:(s=window.event,s===void 0?32:ep(s.type))}function D1(s,a){var c=W.p;try{return W.p=s,a()}finally{W.p=c}}var gs=Math.random().toString(36).slice(2),_t="__reactFiber$"+gs,Bt="__reactProps$"+gs,bn="__reactContainer$"+gs,pc="__reactEvents$"+gs,w1="__reactListeners$"+gs,I1="__reactHandles$"+gs,Th="__reactResources$"+gs,_r="__reactMarker$"+gs;function yc(s){delete s[_t],delete s[Bt],delete s[pc],delete s[w1],delete s[I1]}function An(s){var a=s[_t];if(a)return a;for(var c=s.parentNode;c;){if(a=c[bn]||c[_t]){if(c=a.alternate,a.child!==null||c!==null&&c.child!==null)for(s=Fg(s);s!==null;){if(c=s[_t])return c;s=Fg(s)}return a}s=c,c=s.parentNode}return null}function Rn(s){if(s=s[_t]||s[bn]){var a=s.tag;if(a===5||a===6||a===13||a===26||a===27||a===3)return s}return null}function Dr(s){var a=s.tag;if(a===5||a===26||a===27||a===6)return s.stateNode;throw Error(i(33))}function Ln(s){var a=s[Th];return a||(a=s[Th]={hoistableStyles:new Map,hoistableScripts:new Map}),a}function pt(s){s[_r]=!0}var bh=new Set,Ah={};function Qs(s,a){_n(s,a),_n(s+"Capture",a)}function _n(s,a){for(Ah[s]=a,s=0;s<a.length;s++)bh.add(a[s])}var C1=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Rh={},Lh={};function O1(s){return br.call(Lh,s)?!0:br.call(Rh,s)?!1:C1.test(s)?Lh[s]=!0:(Rh[s]=!0,!1)}function Za(s,a,c){if(O1(a))if(c===null)s.removeAttribute(a);else{switch(typeof c){case"undefined":case"function":case"symbol":s.removeAttribute(a);return;case"boolean":var h=a.toLowerCase().slice(0,5);if(h!=="data-"&&h!=="aria-"){s.removeAttribute(a);return}}s.setAttribute(a,""+c)}}function Ja(s,a,c){if(c===null)s.removeAttribute(a);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(a);return}s.setAttribute(a,""+c)}}function Ki(s,a,c,h){if(h===null)s.removeAttribute(c);else{switch(typeof h){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(c);return}s.setAttributeNS(a,c,""+h)}}var vc,_h;function Dn(s){if(vc===void 0)try{throw Error()}catch(c){var a=c.stack.trim().match(/\n( *(at )?)/);vc=a&&a[1]||"",_h=-1<c.stack.indexOf(`
    at`)?" (<anonymous>)":-1<c.stack.indexOf("@")?"@unknown:0:0":""}return`
`+vc+s+_h}var xc=!1;function Ec(s,a){if(!s||xc)return"";xc=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var h={DetermineComponentFrameRoot:function(){try{if(a){var le=function(){throw Error()};if(Object.defineProperty(le.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(le,[])}catch(Z){var Q=Z}Reflect.construct(s,[],le)}else{try{le.call()}catch(Z){Q=Z}s.call(le.prototype)}}else{try{throw Error()}catch(Z){Q=Z}(le=s())&&typeof le.catch=="function"&&le.catch(function(){})}}catch(Z){if(Z&&Q&&typeof Z.stack=="string")return[Z.stack,Q.stack]}return[null,null]}};h.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var p=Object.getOwnPropertyDescriptor(h.DetermineComponentFrameRoot,"name");p&&p.configurable&&Object.defineProperty(h.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var x=h.DetermineComponentFrameRoot(),L=x[0],I=x[1];if(L&&I){var M=L.split(`
`),X=I.split(`
`);for(p=h=0;h<M.length&&!M[h].includes("DetermineComponentFrameRoot");)h++;for(;p<X.length&&!X[p].includes("DetermineComponentFrameRoot");)p++;if(h===M.length||p===X.length)for(h=M.length-1,p=X.length-1;1<=h&&0<=p&&M[h]!==X[p];)p--;for(;1<=h&&0<=p;h--,p--)if(M[h]!==X[p]){if(h!==1||p!==1)do if(h--,p--,0>p||M[h]!==X[p]){var ie=`
`+M[h].replace(" at new "," at ");return s.displayName&&ie.includes("<anonymous>")&&(ie=ie.replace("<anonymous>",s.displayName)),ie}while(1<=h&&0<=p);break}}}finally{xc=!1,Error.prepareStackTrace=c}return(c=s?s.displayName||s.name:"")?Dn(c):""}function N1(s){switch(s.tag){case 26:case 27:case 5:return Dn(s.type);case 16:return Dn("Lazy");case 13:return Dn("Suspense");case 19:return Dn("SuspenseList");case 0:case 15:return Ec(s.type,!1);case 11:return Ec(s.type.render,!1);case 1:return Ec(s.type,!0);case 31:return Dn("Activity");default:return""}}function Dh(s){try{var a="";do a+=N1(s),s=s.return;while(s);return a}catch(c){return`
Error generating stack: `+c.message+`
`+c.stack}}function ii(s){switch(typeof s){case"bigint":case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function wh(s){var a=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function k1(s){var a=wh(s)?"checked":"value",c=Object.getOwnPropertyDescriptor(s.constructor.prototype,a),h=""+s[a];if(!s.hasOwnProperty(a)&&typeof c<"u"&&typeof c.get=="function"&&typeof c.set=="function"){var p=c.get,x=c.set;return Object.defineProperty(s,a,{configurable:!0,get:function(){return p.call(this)},set:function(L){h=""+L,x.call(this,L)}}),Object.defineProperty(s,a,{enumerable:c.enumerable}),{getValue:function(){return h},setValue:function(L){h=""+L},stopTracking:function(){s._valueTracker=null,delete s[a]}}}}function el(s){s._valueTracker||(s._valueTracker=k1(s))}function Ih(s){if(!s)return!1;var a=s._valueTracker;if(!a)return!0;var c=a.getValue(),h="";return s&&(h=wh(s)?s.checked?"true":"false":s.value),s=h,s!==c?(a.setValue(s),!0):!1}function tl(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}var M1=/[\n"\\]/g;function si(s){return s.replace(M1,function(a){return"\\"+a.charCodeAt(0).toString(16)+" "})}function Sc(s,a,c,h,p,x,L,I){s.name="",L!=null&&typeof L!="function"&&typeof L!="symbol"&&typeof L!="boolean"?s.type=L:s.removeAttribute("type"),a!=null?L==="number"?(a===0&&s.value===""||s.value!=a)&&(s.value=""+ii(a)):s.value!==""+ii(a)&&(s.value=""+ii(a)):L!=="submit"&&L!=="reset"||s.removeAttribute("value"),a!=null?Tc(s,L,ii(a)):c!=null?Tc(s,L,ii(c)):h!=null&&s.removeAttribute("value"),p==null&&x!=null&&(s.defaultChecked=!!x),p!=null&&(s.checked=p&&typeof p!="function"&&typeof p!="symbol"),I!=null&&typeof I!="function"&&typeof I!="symbol"&&typeof I!="boolean"?s.name=""+ii(I):s.removeAttribute("name")}function Ch(s,a,c,h,p,x,L,I){if(x!=null&&typeof x!="function"&&typeof x!="symbol"&&typeof x!="boolean"&&(s.type=x),a!=null||c!=null){if(!(x!=="submit"&&x!=="reset"||a!=null))return;c=c!=null?""+ii(c):"",a=a!=null?""+ii(a):c,I||a===s.value||(s.value=a),s.defaultValue=a}h=h??p,h=typeof h!="function"&&typeof h!="symbol"&&!!h,s.checked=I?s.checked:!!h,s.defaultChecked=!!h,L!=null&&typeof L!="function"&&typeof L!="symbol"&&typeof L!="boolean"&&(s.name=L)}function Tc(s,a,c){a==="number"&&tl(s.ownerDocument)===s||s.defaultValue===""+c||(s.defaultValue=""+c)}function wn(s,a,c,h){if(s=s.options,a){a={};for(var p=0;p<c.length;p++)a["$"+c[p]]=!0;for(c=0;c<s.length;c++)p=a.hasOwnProperty("$"+s[c].value),s[c].selected!==p&&(s[c].selected=p),p&&h&&(s[c].defaultSelected=!0)}else{for(c=""+ii(c),a=null,p=0;p<s.length;p++){if(s[p].value===c){s[p].selected=!0,h&&(s[p].defaultSelected=!0);return}a!==null||s[p].disabled||(a=s[p])}a!==null&&(a.selected=!0)}}function Oh(s,a,c){if(a!=null&&(a=""+ii(a),a!==s.value&&(s.value=a),c==null)){s.defaultValue!==a&&(s.defaultValue=a);return}s.defaultValue=c!=null?""+ii(c):""}function Nh(s,a,c,h){if(a==null){if(h!=null){if(c!=null)throw Error(i(92));if(J(h)){if(1<h.length)throw Error(i(93));h=h[0]}c=h}c==null&&(c=""),a=c}c=ii(a),s.defaultValue=c,h=s.textContent,h===c&&h!==""&&h!==null&&(s.value=h)}function In(s,a){if(a){var c=s.firstChild;if(c&&c===s.lastChild&&c.nodeType===3){c.nodeValue=a;return}}s.textContent=a}var P1=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function kh(s,a,c){var h=a.indexOf("--")===0;c==null||typeof c=="boolean"||c===""?h?s.setProperty(a,""):a==="float"?s.cssFloat="":s[a]="":h?s.setProperty(a,c):typeof c!="number"||c===0||P1.has(a)?a==="float"?s.cssFloat=c:s[a]=(""+c).trim():s[a]=c+"px"}function Mh(s,a,c){if(a!=null&&typeof a!="object")throw Error(i(62));if(s=s.style,c!=null){for(var h in c)!c.hasOwnProperty(h)||a!=null&&a.hasOwnProperty(h)||(h.indexOf("--")===0?s.setProperty(h,""):h==="float"?s.cssFloat="":s[h]="");for(var p in a)h=a[p],a.hasOwnProperty(p)&&c[p]!==h&&kh(s,p,h)}else for(var x in a)a.hasOwnProperty(x)&&kh(s,x,a[x])}function bc(s){if(s.indexOf("-")===-1)return!1;switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var U1=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),B1=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function il(s){return B1.test(""+s)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":s}var Ac=null;function Rc(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var Cn=null,On=null;function Ph(s){var a=Rn(s);if(a&&(s=a.stateNode)){var c=s[Bt]||null;e:switch(s=a.stateNode,a.type){case"input":if(Sc(s,c.value,c.defaultValue,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name),a=c.name,c.type==="radio"&&a!=null){for(c=s;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll('input[name="'+si(""+a)+'"][type="radio"]'),a=0;a<c.length;a++){var h=c[a];if(h!==s&&h.form===s.form){var p=h[Bt]||null;if(!p)throw Error(i(90));Sc(h,p.value,p.defaultValue,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name)}}for(a=0;a<c.length;a++)h=c[a],h.form===s.form&&Ih(h)}break e;case"textarea":Oh(s,c.value,c.defaultValue);break e;case"select":a=c.value,a!=null&&wn(s,!!c.multiple,a,!1)}}}var Lc=!1;function Uh(s,a,c){if(Lc)return s(a,c);Lc=!0;try{var h=s(a);return h}finally{if(Lc=!1,(Cn!==null||On!==null)&&($l(),Cn&&(a=Cn,s=On,On=Cn=null,Ph(a),s)))for(a=0;a<s.length;a++)Ph(s[a])}}function wr(s,a){var c=s.stateNode;if(c===null)return null;var h=c[Bt]||null;if(h===null)return null;c=h[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(h=!h.disabled)||(s=s.type,h=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!h;break e;default:s=!1}if(s)return null;if(c&&typeof c!="function")throw Error(i(231,a,typeof c));return c}var Yi=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),_c=!1;if(Yi)try{var Ir={};Object.defineProperty(Ir,"passive",{get:function(){_c=!0}}),window.addEventListener("test",Ir,Ir),window.removeEventListener("test",Ir,Ir)}catch{_c=!1}var ps=null,Dc=null,sl=null;function Bh(){if(sl)return sl;var s,a=Dc,c=a.length,h,p="value"in ps?ps.value:ps.textContent,x=p.length;for(s=0;s<c&&a[s]===p[s];s++);var L=c-s;for(h=1;h<=L&&a[c-h]===p[x-h];h++);return sl=p.slice(s,1<h?1-h:void 0)}function nl(s){var a=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&a===13&&(s=13)):s=a,s===10&&(s=13),32<=s||s===13?s:0}function rl(){return!0}function Fh(){return!1}function Ft(s){function a(c,h,p,x,L){this._reactName=c,this._targetInst=p,this.type=h,this.nativeEvent=x,this.target=L,this.currentTarget=null;for(var I in s)s.hasOwnProperty(I)&&(c=s[I],this[I]=c?c(x):x[I]);return this.isDefaultPrevented=(x.defaultPrevented!=null?x.defaultPrevented:x.returnValue===!1)?rl:Fh,this.isPropagationStopped=Fh,this}return m(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=rl)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=rl)},persist:function(){},isPersistent:rl}),a}var Ws={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},al=Ft(Ws),Cr=m({},Ws,{view:0,detail:0}),F1=Ft(Cr),wc,Ic,Or,ll=m({},Cr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Oc,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==Or&&(Or&&s.type==="mousemove"?(wc=s.screenX-Or.screenX,Ic=s.screenY-Or.screenY):Ic=wc=0,Or=s),wc)},movementY:function(s){return"movementY"in s?s.movementY:Ic}}),jh=Ft(ll),j1=m({},ll,{dataTransfer:0}),$1=Ft(j1),G1=m({},Cr,{relatedTarget:0}),Cc=Ft(G1),H1=m({},Ws,{animationName:0,elapsedTime:0,pseudoElement:0}),V1=Ft(H1),z1=m({},Ws,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),K1=Ft(z1),Y1=m({},Ws,{data:0}),$h=Ft(Y1),q1={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},X1={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Q1={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function W1(s){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(s):(s=Q1[s])?!!a[s]:!1}function Oc(){return W1}var Z1=m({},Cr,{key:function(s){if(s.key){var a=q1[s.key]||s.key;if(a!=="Unidentified")return a}return s.type==="keypress"?(s=nl(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?X1[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Oc,charCode:function(s){return s.type==="keypress"?nl(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?nl(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),J1=Ft(Z1),eE=m({},ll,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Gh=Ft(eE),tE=m({},Cr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Oc}),iE=Ft(tE),sE=m({},Ws,{propertyName:0,elapsedTime:0,pseudoElement:0}),nE=Ft(sE),rE=m({},ll,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),aE=Ft(rE),lE=m({},Ws,{newState:0,oldState:0}),oE=Ft(lE),cE=[9,13,27,32],Nc=Yi&&"CompositionEvent"in window,Nr=null;Yi&&"documentMode"in document&&(Nr=document.documentMode);var uE=Yi&&"TextEvent"in window&&!Nr,Hh=Yi&&(!Nc||Nr&&8<Nr&&11>=Nr),Vh=" ",zh=!1;function Kh(s,a){switch(s){case"keyup":return cE.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Yh(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var Nn=!1;function fE(s,a){switch(s){case"compositionend":return Yh(a);case"keypress":return a.which!==32?null:(zh=!0,Vh);case"textInput":return s=a.data,s===Vh&&zh?null:s;default:return null}}function dE(s,a){if(Nn)return s==="compositionend"||!Nc&&Kh(s,a)?(s=Bh(),sl=Dc=ps=null,Nn=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return Hh&&a.locale!=="ko"?null:a.data;default:return null}}var hE={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function qh(s){var a=s&&s.nodeName&&s.nodeName.toLowerCase();return a==="input"?!!hE[s.type]:a==="textarea"}function Xh(s,a,c,h){Cn?On?On.push(h):On=[h]:Cn=h,a=Yl(a,"onChange"),0<a.length&&(c=new al("onChange","change",null,c,h),s.push({event:c,listeners:a}))}var kr=null,Mr=null;function mE(s){wg(s,0)}function ol(s){var a=Dr(s);if(Ih(a))return s}function Qh(s,a){if(s==="change")return a}var Wh=!1;if(Yi){var kc;if(Yi){var Mc="oninput"in document;if(!Mc){var Zh=document.createElement("div");Zh.setAttribute("oninput","return;"),Mc=typeof Zh.oninput=="function"}kc=Mc}else kc=!1;Wh=kc&&(!document.documentMode||9<document.documentMode)}function Jh(){kr&&(kr.detachEvent("onpropertychange",em),Mr=kr=null)}function em(s){if(s.propertyName==="value"&&ol(Mr)){var a=[];Xh(a,Mr,s,Rc(s)),Uh(mE,a)}}function gE(s,a,c){s==="focusin"?(Jh(),kr=a,Mr=c,kr.attachEvent("onpropertychange",em)):s==="focusout"&&Jh()}function pE(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return ol(Mr)}function yE(s,a){if(s==="click")return ol(a)}function vE(s,a){if(s==="input"||s==="change")return ol(a)}function xE(s,a){return s===a&&(s!==0||1/s===1/a)||s!==s&&a!==a}var Yt=typeof Object.is=="function"?Object.is:xE;function Pr(s,a){if(Yt(s,a))return!0;if(typeof s!="object"||s===null||typeof a!="object"||a===null)return!1;var c=Object.keys(s),h=Object.keys(a);if(c.length!==h.length)return!1;for(h=0;h<c.length;h++){var p=c[h];if(!br.call(a,p)||!Yt(s[p],a[p]))return!1}return!0}function tm(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function im(s,a){var c=tm(s);s=0;for(var h;c;){if(c.nodeType===3){if(h=s+c.textContent.length,s<=a&&h>=a)return{node:c,offset:a-s};s=h}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=tm(c)}}function sm(s,a){return s&&a?s===a?!0:s&&s.nodeType===3?!1:a&&a.nodeType===3?sm(s,a.parentNode):"contains"in s?s.contains(a):s.compareDocumentPosition?!!(s.compareDocumentPosition(a)&16):!1:!1}function nm(s){s=s!=null&&s.ownerDocument!=null&&s.ownerDocument.defaultView!=null?s.ownerDocument.defaultView:window;for(var a=tl(s.document);a instanceof s.HTMLIFrameElement;){try{var c=typeof a.contentWindow.location.href=="string"}catch{c=!1}if(c)s=a.contentWindow;else break;a=tl(s.document)}return a}function Pc(s){var a=s&&s.nodeName&&s.nodeName.toLowerCase();return a&&(a==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||a==="textarea"||s.contentEditable==="true")}var EE=Yi&&"documentMode"in document&&11>=document.documentMode,kn=null,Uc=null,Ur=null,Bc=!1;function rm(s,a,c){var h=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;Bc||kn==null||kn!==tl(h)||(h=kn,"selectionStart"in h&&Pc(h)?h={start:h.selectionStart,end:h.selectionEnd}:(h=(h.ownerDocument&&h.ownerDocument.defaultView||window).getSelection(),h={anchorNode:h.anchorNode,anchorOffset:h.anchorOffset,focusNode:h.focusNode,focusOffset:h.focusOffset}),Ur&&Pr(Ur,h)||(Ur=h,h=Yl(Uc,"onSelect"),0<h.length&&(a=new al("onSelect","select",null,a,c),s.push({event:a,listeners:h}),a.target=kn)))}function Zs(s,a){var c={};return c[s.toLowerCase()]=a.toLowerCase(),c["Webkit"+s]="webkit"+a,c["Moz"+s]="moz"+a,c}var Mn={animationend:Zs("Animation","AnimationEnd"),animationiteration:Zs("Animation","AnimationIteration"),animationstart:Zs("Animation","AnimationStart"),transitionrun:Zs("Transition","TransitionRun"),transitionstart:Zs("Transition","TransitionStart"),transitioncancel:Zs("Transition","TransitionCancel"),transitionend:Zs("Transition","TransitionEnd")},Fc={},am={};Yi&&(am=document.createElement("div").style,"AnimationEvent"in window||(delete Mn.animationend.animation,delete Mn.animationiteration.animation,delete Mn.animationstart.animation),"TransitionEvent"in window||delete Mn.transitionend.transition);function Js(s){if(Fc[s])return Fc[s];if(!Mn[s])return s;var a=Mn[s],c;for(c in a)if(a.hasOwnProperty(c)&&c in am)return Fc[s]=a[c];return s}var lm=Js("animationend"),om=Js("animationiteration"),cm=Js("animationstart"),SE=Js("transitionrun"),TE=Js("transitionstart"),bE=Js("transitioncancel"),um=Js("transitionend"),fm=new Map,jc="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");jc.push("scrollEnd");function pi(s,a){fm.set(s,a),Qs(a,[s])}var dm=new WeakMap;function ni(s,a){if(typeof s=="object"&&s!==null){var c=dm.get(s);return c!==void 0?c:(a={value:s,source:a,stack:Dh(a)},dm.set(s,a),a)}return{value:s,source:a,stack:Dh(a)}}var ri=[],Pn=0,$c=0;function cl(){for(var s=Pn,a=$c=Pn=0;a<s;){var c=ri[a];ri[a++]=null;var h=ri[a];ri[a++]=null;var p=ri[a];ri[a++]=null;var x=ri[a];if(ri[a++]=null,h!==null&&p!==null){var L=h.pending;L===null?p.next=p:(p.next=L.next,L.next=p),h.pending=p}x!==0&&hm(c,p,x)}}function ul(s,a,c,h){ri[Pn++]=s,ri[Pn++]=a,ri[Pn++]=c,ri[Pn++]=h,$c|=h,s.lanes|=h,s=s.alternate,s!==null&&(s.lanes|=h)}function Gc(s,a,c,h){return ul(s,a,c,h),fl(s)}function Un(s,a){return ul(s,null,null,a),fl(s)}function hm(s,a,c){s.lanes|=c;var h=s.alternate;h!==null&&(h.lanes|=c);for(var p=!1,x=s.return;x!==null;)x.childLanes|=c,h=x.alternate,h!==null&&(h.childLanes|=c),x.tag===22&&(s=x.stateNode,s===null||s._visibility&1||(p=!0)),s=x,x=x.return;return s.tag===3?(x=s.stateNode,p&&a!==null&&(p=31-Lt(c),s=x.hiddenUpdates,h=s[p],h===null?s[p]=[a]:h.push(a),a.lane=c|536870912),x):null}function fl(s){if(50<oa)throw oa=0,qu=null,Error(i(185));for(var a=s.return;a!==null;)s=a,a=s.return;return s.tag===3?s.stateNode:null}var Bn={};function AE(s,a,c,h){this.tag=s,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=h,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function qt(s,a,c,h){return new AE(s,a,c,h)}function Hc(s){return s=s.prototype,!(!s||!s.isReactComponent)}function qi(s,a){var c=s.alternate;return c===null?(c=qt(s.tag,a,s.key,s.mode),c.elementType=s.elementType,c.type=s.type,c.stateNode=s.stateNode,c.alternate=s,s.alternate=c):(c.pendingProps=a,c.type=s.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=s.flags&65011712,c.childLanes=s.childLanes,c.lanes=s.lanes,c.child=s.child,c.memoizedProps=s.memoizedProps,c.memoizedState=s.memoizedState,c.updateQueue=s.updateQueue,a=s.dependencies,c.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},c.sibling=s.sibling,c.index=s.index,c.ref=s.ref,c.refCleanup=s.refCleanup,c}function mm(s,a){s.flags&=65011714;var c=s.alternate;return c===null?(s.childLanes=0,s.lanes=a,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=c.childLanes,s.lanes=c.lanes,s.child=c.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=c.memoizedProps,s.memoizedState=c.memoizedState,s.updateQueue=c.updateQueue,s.type=c.type,a=c.dependencies,s.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),s}function dl(s,a,c,h,p,x){var L=0;if(h=s,typeof s=="function")Hc(s)&&(L=1);else if(typeof s=="string")L=LS(s,c,oe.current)?26:s==="html"||s==="head"||s==="body"?27:5;else e:switch(s){case z:return s=qt(31,c,a,p),s.elementType=z,s.lanes=x,s;case y:return en(c.children,p,x,a);case S:L=8,p|=24;break;case T:return s=qt(12,c,a,p|2),s.elementType=T,s.lanes=x,s;case C:return s=qt(13,c,a,p),s.elementType=C,s.lanes=x,s;case B:return s=qt(19,c,a,p),s.elementType=B,s.lanes=x,s;default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case R:case _:L=10;break e;case D:L=9;break e;case O:L=11;break e;case N:L=14;break e;case F:L=16,h=null;break e}L=29,c=Error(i(130,s===null?"null":typeof s,"")),h=null}return a=qt(L,c,a,p),a.elementType=s,a.type=h,a.lanes=x,a}function en(s,a,c,h){return s=qt(7,s,h,a),s.lanes=c,s}function Vc(s,a,c){return s=qt(6,s,null,a),s.lanes=c,s}function zc(s,a,c){return a=qt(4,s.children!==null?s.children:[],s.key,a),a.lanes=c,a.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},a}var Fn=[],jn=0,hl=null,ml=0,ai=[],li=0,tn=null,Xi=1,Qi="";function sn(s,a){Fn[jn++]=ml,Fn[jn++]=hl,hl=s,ml=a}function gm(s,a,c){ai[li++]=Xi,ai[li++]=Qi,ai[li++]=tn,tn=s;var h=Xi;s=Qi;var p=32-Lt(h)-1;h&=~(1<<p),c+=1;var x=32-Lt(a)+p;if(30<x){var L=p-p%5;x=(h&(1<<L)-1).toString(32),h>>=L,p-=L,Xi=1<<32-Lt(a)+p|c<<p|h,Qi=x+s}else Xi=1<<x|c<<p|h,Qi=s}function Kc(s){s.return!==null&&(sn(s,1),gm(s,1,0))}function Yc(s){for(;s===hl;)hl=Fn[--jn],Fn[jn]=null,ml=Fn[--jn],Fn[jn]=null;for(;s===tn;)tn=ai[--li],ai[li]=null,Qi=ai[--li],ai[li]=null,Xi=ai[--li],ai[li]=null}var Ot=null,nt=null,je=!1,nn=null,_i=!1,qc=Error(i(519));function rn(s){var a=Error(i(418,""));throw jr(ni(a,s)),qc}function pm(s){var a=s.stateNode,c=s.type,h=s.memoizedProps;switch(a[_t]=s,a[Bt]=h,c){case"dialog":Ne("cancel",a),Ne("close",a);break;case"iframe":case"object":case"embed":Ne("load",a);break;case"video":case"audio":for(c=0;c<ua.length;c++)Ne(ua[c],a);break;case"source":Ne("error",a);break;case"img":case"image":case"link":Ne("error",a),Ne("load",a);break;case"details":Ne("toggle",a);break;case"input":Ne("invalid",a),Ch(a,h.value,h.defaultValue,h.checked,h.defaultChecked,h.type,h.name,!0),el(a);break;case"select":Ne("invalid",a);break;case"textarea":Ne("invalid",a),Nh(a,h.value,h.defaultValue,h.children),el(a)}c=h.children,typeof c!="string"&&typeof c!="number"&&typeof c!="bigint"||a.textContent===""+c||h.suppressHydrationWarning===!0||Ng(a.textContent,c)?(h.popover!=null&&(Ne("beforetoggle",a),Ne("toggle",a)),h.onScroll!=null&&Ne("scroll",a),h.onScrollEnd!=null&&Ne("scrollend",a),h.onClick!=null&&(a.onclick=ql),a=!0):a=!1,a||rn(s)}function ym(s){for(Ot=s.return;Ot;)switch(Ot.tag){case 5:case 13:_i=!1;return;case 27:case 3:_i=!0;return;default:Ot=Ot.return}}function Br(s){if(s!==Ot)return!1;if(!je)return ym(s),je=!0,!1;var a=s.tag,c;if((c=a!==3&&a!==27)&&((c=a===5)&&(c=s.type,c=!(c!=="form"&&c!=="button")||ff(s.type,s.memoizedProps)),c=!c),c&&nt&&rn(s),ym(s),a===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(i(317));e:{for(s=s.nextSibling,a=0;s;){if(s.nodeType===8)if(c=s.data,c==="/$"){if(a===0){nt=vi(s.nextSibling);break e}a--}else c!=="$"&&c!=="$!"&&c!=="$?"||a++;s=s.nextSibling}nt=null}}else a===27?(a=nt,Os(s.type)?(s=gf,gf=null,nt=s):nt=a):nt=Ot?vi(s.stateNode.nextSibling):null;return!0}function Fr(){nt=Ot=null,je=!1}function vm(){var s=nn;return s!==null&&(Gt===null?Gt=s:Gt.push.apply(Gt,s),nn=null),s}function jr(s){nn===null?nn=[s]:nn.push(s)}var Xc=k(null),an=null,Wi=null;function ys(s,a,c){G(Xc,a._currentValue),a._currentValue=c}function Zi(s){s._currentValue=Xc.current,K(Xc)}function Qc(s,a,c){for(;s!==null;){var h=s.alternate;if((s.childLanes&a)!==a?(s.childLanes|=a,h!==null&&(h.childLanes|=a)):h!==null&&(h.childLanes&a)!==a&&(h.childLanes|=a),s===c)break;s=s.return}}function Wc(s,a,c,h){var p=s.child;for(p!==null&&(p.return=s);p!==null;){var x=p.dependencies;if(x!==null){var L=p.child;x=x.firstContext;e:for(;x!==null;){var I=x;x=p;for(var M=0;M<a.length;M++)if(I.context===a[M]){x.lanes|=c,I=x.alternate,I!==null&&(I.lanes|=c),Qc(x.return,c,s),h||(L=null);break e}x=I.next}}else if(p.tag===18){if(L=p.return,L===null)throw Error(i(341));L.lanes|=c,x=L.alternate,x!==null&&(x.lanes|=c),Qc(L,c,s),L=null}else L=p.child;if(L!==null)L.return=p;else for(L=p;L!==null;){if(L===s){L=null;break}if(p=L.sibling,p!==null){p.return=L.return,L=p;break}L=L.return}p=L}}function $r(s,a,c,h){s=null;for(var p=a,x=!1;p!==null;){if(!x){if((p.flags&524288)!==0)x=!0;else if((p.flags&262144)!==0)break}if(p.tag===10){var L=p.alternate;if(L===null)throw Error(i(387));if(L=L.memoizedProps,L!==null){var I=p.type;Yt(p.pendingProps.value,L.value)||(s!==null?s.push(I):s=[I])}}else if(p===ke.current){if(L=p.alternate,L===null)throw Error(i(387));L.memoizedState.memoizedState!==p.memoizedState.memoizedState&&(s!==null?s.push(pa):s=[pa])}p=p.return}s!==null&&Wc(a,s,c,h),a.flags|=262144}function gl(s){for(s=s.firstContext;s!==null;){if(!Yt(s.context._currentValue,s.memoizedValue))return!0;s=s.next}return!1}function ln(s){an=s,Wi=null,s=s.dependencies,s!==null&&(s.firstContext=null)}function Dt(s){return xm(an,s)}function pl(s,a){return an===null&&ln(s),xm(s,a)}function xm(s,a){var c=a._currentValue;if(a={context:a,memoizedValue:c,next:null},Wi===null){if(s===null)throw Error(i(308));Wi=a,s.dependencies={lanes:0,firstContext:a},s.flags|=524288}else Wi=Wi.next=a;return c}var RE=typeof AbortController<"u"?AbortController:function(){var s=[],a=this.signal={aborted:!1,addEventListener:function(c,h){s.push(h)}};this.abort=function(){a.aborted=!0,s.forEach(function(c){return c()})}},LE=r.unstable_scheduleCallback,_E=r.unstable_NormalPriority,dt={$$typeof:_,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Zc(){return{controller:new RE,data:new Map,refCount:0}}function Gr(s){s.refCount--,s.refCount===0&&LE(_E,function(){s.controller.abort()})}var Hr=null,Jc=0,$n=0,Gn=null;function DE(s,a){if(Hr===null){var c=Hr=[];Jc=0,$n=tf(),Gn={status:"pending",value:void 0,then:function(h){c.push(h)}}}return Jc++,a.then(Em,Em),a}function Em(){if(--Jc===0&&Hr!==null){Gn!==null&&(Gn.status="fulfilled");var s=Hr;Hr=null,$n=0,Gn=null;for(var a=0;a<s.length;a++)(0,s[a])()}}function wE(s,a){var c=[],h={status:"pending",value:null,reason:null,then:function(p){c.push(p)}};return s.then(function(){h.status="fulfilled",h.value=a;for(var p=0;p<c.length;p++)(0,c[p])(a)},function(p){for(h.status="rejected",h.reason=p,p=0;p<c.length;p++)(0,c[p])(void 0)}),h}var Sm=P.S;P.S=function(s,a){typeof a=="object"&&a!==null&&typeof a.then=="function"&&DE(s,a),Sm!==null&&Sm(s,a)};var on=k(null);function eu(){var s=on.current;return s!==null?s:Ze.pooledCache}function yl(s,a){a===null?G(on,on.current):G(on,a.pool)}function Tm(){var s=eu();return s===null?null:{parent:dt._currentValue,pool:s}}var Vr=Error(i(460)),bm=Error(i(474)),vl=Error(i(542)),tu={then:function(){}};function Am(s){return s=s.status,s==="fulfilled"||s==="rejected"}function xl(){}function Rm(s,a,c){switch(c=s[c],c===void 0?s.push(a):c!==a&&(a.then(xl,xl),a=c),a.status){case"fulfilled":return a.value;case"rejected":throw s=a.reason,_m(s),s;default:if(typeof a.status=="string")a.then(xl,xl);else{if(s=Ze,s!==null&&100<s.shellSuspendCounter)throw Error(i(482));s=a,s.status="pending",s.then(function(h){if(a.status==="pending"){var p=a;p.status="fulfilled",p.value=h}},function(h){if(a.status==="pending"){var p=a;p.status="rejected",p.reason=h}})}switch(a.status){case"fulfilled":return a.value;case"rejected":throw s=a.reason,_m(s),s}throw zr=a,Vr}}var zr=null;function Lm(){if(zr===null)throw Error(i(459));var s=zr;return zr=null,s}function _m(s){if(s===Vr||s===vl)throw Error(i(483))}var vs=!1;function iu(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function su(s,a){s=s.updateQueue,a.updateQueue===s&&(a.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,callbacks:null})}function xs(s){return{lane:s,tag:0,payload:null,callback:null,next:null}}function Es(s,a,c){var h=s.updateQueue;if(h===null)return null;if(h=h.shared,(He&2)!==0){var p=h.pending;return p===null?a.next=a:(a.next=p.next,p.next=a),h.pending=a,a=fl(s),hm(s,null,c),a}return ul(s,h,a,c),fl(s)}function Kr(s,a,c){if(a=a.updateQueue,a!==null&&(a=a.shared,(c&4194048)!==0)){var h=a.lanes;h&=s.pendingLanes,c|=h,a.lanes=c,Eh(s,c)}}function nu(s,a){var c=s.updateQueue,h=s.alternate;if(h!==null&&(h=h.updateQueue,c===h)){var p=null,x=null;if(c=c.firstBaseUpdate,c!==null){do{var L={lane:c.lane,tag:c.tag,payload:c.payload,callback:null,next:null};x===null?p=x=L:x=x.next=L,c=c.next}while(c!==null);x===null?p=x=a:x=x.next=a}else p=x=a;c={baseState:h.baseState,firstBaseUpdate:p,lastBaseUpdate:x,shared:h.shared,callbacks:h.callbacks},s.updateQueue=c;return}s=c.lastBaseUpdate,s===null?c.firstBaseUpdate=a:s.next=a,c.lastBaseUpdate=a}var ru=!1;function Yr(){if(ru){var s=Gn;if(s!==null)throw s}}function qr(s,a,c,h){ru=!1;var p=s.updateQueue;vs=!1;var x=p.firstBaseUpdate,L=p.lastBaseUpdate,I=p.shared.pending;if(I!==null){p.shared.pending=null;var M=I,X=M.next;M.next=null,L===null?x=X:L.next=X,L=M;var ie=s.alternate;ie!==null&&(ie=ie.updateQueue,I=ie.lastBaseUpdate,I!==L&&(I===null?ie.firstBaseUpdate=X:I.next=X,ie.lastBaseUpdate=M))}if(x!==null){var le=p.baseState;L=0,ie=X=M=null,I=x;do{var Q=I.lane&-536870913,Z=Q!==I.lane;if(Z?(Be&Q)===Q:(h&Q)===Q){Q!==0&&Q===$n&&(ru=!0),ie!==null&&(ie=ie.next={lane:0,tag:I.tag,payload:I.payload,callback:null,next:null});e:{var Te=s,Ee=I;Q=a;var Xe=c;switch(Ee.tag){case 1:if(Te=Ee.payload,typeof Te=="function"){le=Te.call(Xe,le,Q);break e}le=Te;break e;case 3:Te.flags=Te.flags&-65537|128;case 0:if(Te=Ee.payload,Q=typeof Te=="function"?Te.call(Xe,le,Q):Te,Q==null)break e;le=m({},le,Q);break e;case 2:vs=!0}}Q=I.callback,Q!==null&&(s.flags|=64,Z&&(s.flags|=8192),Z=p.callbacks,Z===null?p.callbacks=[Q]:Z.push(Q))}else Z={lane:Q,tag:I.tag,payload:I.payload,callback:I.callback,next:null},ie===null?(X=ie=Z,M=le):ie=ie.next=Z,L|=Q;if(I=I.next,I===null){if(I=p.shared.pending,I===null)break;Z=I,I=Z.next,Z.next=null,p.lastBaseUpdate=Z,p.shared.pending=null}}while(!0);ie===null&&(M=le),p.baseState=M,p.firstBaseUpdate=X,p.lastBaseUpdate=ie,x===null&&(p.shared.lanes=0),Ds|=L,s.lanes=L,s.memoizedState=le}}function Dm(s,a){if(typeof s!="function")throw Error(i(191,s));s.call(a)}function wm(s,a){var c=s.callbacks;if(c!==null)for(s.callbacks=null,s=0;s<c.length;s++)Dm(c[s],a)}var Hn=k(null),El=k(0);function Im(s,a){s=rs,G(El,s),G(Hn,a),rs=s|a.baseLanes}function au(){G(El,rs),G(Hn,Hn.current)}function lu(){rs=El.current,K(Hn),K(El)}var Ss=0,we=null,Ye=null,ut=null,Sl=!1,Vn=!1,cn=!1,Tl=0,Xr=0,zn=null,IE=0;function at(){throw Error(i(321))}function ou(s,a){if(a===null)return!1;for(var c=0;c<a.length&&c<s.length;c++)if(!Yt(s[c],a[c]))return!1;return!0}function cu(s,a,c,h,p,x){return Ss=x,we=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,P.H=s===null||s.memoizedState===null?h0:m0,cn=!1,x=c(h,p),cn=!1,Vn&&(x=Om(a,c,h,p)),Cm(s),x}function Cm(s){P.H=Dl;var a=Ye!==null&&Ye.next!==null;if(Ss=0,ut=Ye=we=null,Sl=!1,Xr=0,zn=null,a)throw Error(i(300));s===null||yt||(s=s.dependencies,s!==null&&gl(s)&&(yt=!0))}function Om(s,a,c,h){we=s;var p=0;do{if(Vn&&(zn=null),Xr=0,Vn=!1,25<=p)throw Error(i(301));if(p+=1,ut=Ye=null,s.updateQueue!=null){var x=s.updateQueue;x.lastEffect=null,x.events=null,x.stores=null,x.memoCache!=null&&(x.memoCache.index=0)}P.H=UE,x=a(c,h)}while(Vn);return x}function CE(){var s=P.H,a=s.useState()[0];return a=typeof a.then=="function"?Qr(a):a,s=s.useState()[0],(Ye!==null?Ye.memoizedState:null)!==s&&(we.flags|=1024),a}function uu(){var s=Tl!==0;return Tl=0,s}function fu(s,a,c){a.updateQueue=s.updateQueue,a.flags&=-2053,s.lanes&=~c}function du(s){if(Sl){for(s=s.memoizedState;s!==null;){var a=s.queue;a!==null&&(a.pending=null),s=s.next}Sl=!1}Ss=0,ut=Ye=we=null,Vn=!1,Xr=Tl=0,zn=null}function jt(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ut===null?we.memoizedState=ut=s:ut=ut.next=s,ut}function ft(){if(Ye===null){var s=we.alternate;s=s!==null?s.memoizedState:null}else s=Ye.next;var a=ut===null?we.memoizedState:ut.next;if(a!==null)ut=a,Ye=s;else{if(s===null)throw we.alternate===null?Error(i(467)):Error(i(310));Ye=s,s={memoizedState:Ye.memoizedState,baseState:Ye.baseState,baseQueue:Ye.baseQueue,queue:Ye.queue,next:null},ut===null?we.memoizedState=ut=s:ut=ut.next=s}return ut}function hu(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Qr(s){var a=Xr;return Xr+=1,zn===null&&(zn=[]),s=Rm(zn,s,a),a=we,(ut===null?a.memoizedState:ut.next)===null&&(a=a.alternate,P.H=a===null||a.memoizedState===null?h0:m0),s}function bl(s){if(s!==null&&typeof s=="object"){if(typeof s.then=="function")return Qr(s);if(s.$$typeof===_)return Dt(s)}throw Error(i(438,String(s)))}function mu(s){var a=null,c=we.updateQueue;if(c!==null&&(a=c.memoCache),a==null){var h=we.alternate;h!==null&&(h=h.updateQueue,h!==null&&(h=h.memoCache,h!=null&&(a={data:h.data.map(function(p){return p.slice()}),index:0})))}if(a==null&&(a={data:[],index:0}),c===null&&(c=hu(),we.updateQueue=c),c.memoCache=a,c=a.data[a.index],c===void 0)for(c=a.data[a.index]=Array(s),h=0;h<s;h++)c[h]=$;return a.index++,c}function Ji(s,a){return typeof a=="function"?a(s):a}function Al(s){var a=ft();return gu(a,Ye,s)}function gu(s,a,c){var h=s.queue;if(h===null)throw Error(i(311));h.lastRenderedReducer=c;var p=s.baseQueue,x=h.pending;if(x!==null){if(p!==null){var L=p.next;p.next=x.next,x.next=L}a.baseQueue=p=x,h.pending=null}if(x=s.baseState,p===null)s.memoizedState=x;else{a=p.next;var I=L=null,M=null,X=a,ie=!1;do{var le=X.lane&-536870913;if(le!==X.lane?(Be&le)===le:(Ss&le)===le){var Q=X.revertLane;if(Q===0)M!==null&&(M=M.next={lane:0,revertLane:0,action:X.action,hasEagerState:X.hasEagerState,eagerState:X.eagerState,next:null}),le===$n&&(ie=!0);else if((Ss&Q)===Q){X=X.next,Q===$n&&(ie=!0);continue}else le={lane:0,revertLane:X.revertLane,action:X.action,hasEagerState:X.hasEagerState,eagerState:X.eagerState,next:null},M===null?(I=M=le,L=x):M=M.next=le,we.lanes|=Q,Ds|=Q;le=X.action,cn&&c(x,le),x=X.hasEagerState?X.eagerState:c(x,le)}else Q={lane:le,revertLane:X.revertLane,action:X.action,hasEagerState:X.hasEagerState,eagerState:X.eagerState,next:null},M===null?(I=M=Q,L=x):M=M.next=Q,we.lanes|=le,Ds|=le;X=X.next}while(X!==null&&X!==a);if(M===null?L=x:M.next=I,!Yt(x,s.memoizedState)&&(yt=!0,ie&&(c=Gn,c!==null)))throw c;s.memoizedState=x,s.baseState=L,s.baseQueue=M,h.lastRenderedState=x}return p===null&&(h.lanes=0),[s.memoizedState,h.dispatch]}function pu(s){var a=ft(),c=a.queue;if(c===null)throw Error(i(311));c.lastRenderedReducer=s;var h=c.dispatch,p=c.pending,x=a.memoizedState;if(p!==null){c.pending=null;var L=p=p.next;do x=s(x,L.action),L=L.next;while(L!==p);Yt(x,a.memoizedState)||(yt=!0),a.memoizedState=x,a.baseQueue===null&&(a.baseState=x),c.lastRenderedState=x}return[x,h]}function Nm(s,a,c){var h=we,p=ft(),x=je;if(x){if(c===void 0)throw Error(i(407));c=c()}else c=a();var L=!Yt((Ye||p).memoizedState,c);L&&(p.memoizedState=c,yt=!0),p=p.queue;var I=Pm.bind(null,h,p,s);if(Wr(2048,8,I,[s]),p.getSnapshot!==a||L||ut!==null&&ut.memoizedState.tag&1){if(h.flags|=2048,Kn(9,Rl(),Mm.bind(null,h,p,c,a),null),Ze===null)throw Error(i(349));x||(Ss&124)!==0||km(h,a,c)}return c}function km(s,a,c){s.flags|=16384,s={getSnapshot:a,value:c},a=we.updateQueue,a===null?(a=hu(),we.updateQueue=a,a.stores=[s]):(c=a.stores,c===null?a.stores=[s]:c.push(s))}function Mm(s,a,c,h){a.value=c,a.getSnapshot=h,Um(a)&&Bm(s)}function Pm(s,a,c){return c(function(){Um(a)&&Bm(s)})}function Um(s){var a=s.getSnapshot;s=s.value;try{var c=a();return!Yt(s,c)}catch{return!0}}function Bm(s){var a=Un(s,2);a!==null&&Jt(a,s,2)}function yu(s){var a=jt();if(typeof s=="function"){var c=s;if(s=c(),cn){Li(!0);try{c()}finally{Li(!1)}}}return a.memoizedState=a.baseState=s,a.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ji,lastRenderedState:s},a}function Fm(s,a,c,h){return s.baseState=c,gu(s,Ye,typeof h=="function"?h:Ji)}function OE(s,a,c,h,p){if(_l(s))throw Error(i(485));if(s=a.action,s!==null){var x={payload:p,action:s,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(L){x.listeners.push(L)}};P.T!==null?c(!0):x.isTransition=!1,h(x),c=a.pending,c===null?(x.next=a.pending=x,jm(a,x)):(x.next=c.next,a.pending=c.next=x)}}function jm(s,a){var c=a.action,h=a.payload,p=s.state;if(a.isTransition){var x=P.T,L={};P.T=L;try{var I=c(p,h),M=P.S;M!==null&&M(L,I),$m(s,a,I)}catch(X){vu(s,a,X)}finally{P.T=x}}else try{x=c(p,h),$m(s,a,x)}catch(X){vu(s,a,X)}}function $m(s,a,c){c!==null&&typeof c=="object"&&typeof c.then=="function"?c.then(function(h){Gm(s,a,h)},function(h){return vu(s,a,h)}):Gm(s,a,c)}function Gm(s,a,c){a.status="fulfilled",a.value=c,Hm(a),s.state=c,a=s.pending,a!==null&&(c=a.next,c===a?s.pending=null:(c=c.next,a.next=c,jm(s,c)))}function vu(s,a,c){var h=s.pending;if(s.pending=null,h!==null){h=h.next;do a.status="rejected",a.reason=c,Hm(a),a=a.next;while(a!==h)}s.action=null}function Hm(s){s=s.listeners;for(var a=0;a<s.length;a++)(0,s[a])()}function Vm(s,a){return a}function zm(s,a){if(je){var c=Ze.formState;if(c!==null){e:{var h=we;if(je){if(nt){t:{for(var p=nt,x=_i;p.nodeType!==8;){if(!x){p=null;break t}if(p=vi(p.nextSibling),p===null){p=null;break t}}x=p.data,p=x==="F!"||x==="F"?p:null}if(p){nt=vi(p.nextSibling),h=p.data==="F!";break e}}rn(h)}h=!1}h&&(a=c[0])}}return c=jt(),c.memoizedState=c.baseState=a,h={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Vm,lastRenderedState:a},c.queue=h,c=u0.bind(null,we,h),h.dispatch=c,h=yu(!1),x=bu.bind(null,we,!1,h.queue),h=jt(),p={state:a,dispatch:null,action:s,pending:null},h.queue=p,c=OE.bind(null,we,p,x,c),p.dispatch=c,h.memoizedState=s,[a,c,!1]}function Km(s){var a=ft();return Ym(a,Ye,s)}function Ym(s,a,c){if(a=gu(s,a,Vm)[0],s=Al(Ji)[0],typeof a=="object"&&a!==null&&typeof a.then=="function")try{var h=Qr(a)}catch(L){throw L===Vr?vl:L}else h=a;a=ft();var p=a.queue,x=p.dispatch;return c!==a.memoizedState&&(we.flags|=2048,Kn(9,Rl(),NE.bind(null,p,c),null)),[h,x,s]}function NE(s,a){s.action=a}function qm(s){var a=ft(),c=Ye;if(c!==null)return Ym(a,c,s);ft(),a=a.memoizedState,c=ft();var h=c.queue.dispatch;return c.memoizedState=s,[a,h,!1]}function Kn(s,a,c,h){return s={tag:s,create:c,deps:h,inst:a,next:null},a=we.updateQueue,a===null&&(a=hu(),we.updateQueue=a),c=a.lastEffect,c===null?a.lastEffect=s.next=s:(h=c.next,c.next=s,s.next=h,a.lastEffect=s),s}function Rl(){return{destroy:void 0,resource:void 0}}function Xm(){return ft().memoizedState}function Ll(s,a,c,h){var p=jt();h=h===void 0?null:h,we.flags|=s,p.memoizedState=Kn(1|a,Rl(),c,h)}function Wr(s,a,c,h){var p=ft();h=h===void 0?null:h;var x=p.memoizedState.inst;Ye!==null&&h!==null&&ou(h,Ye.memoizedState.deps)?p.memoizedState=Kn(a,x,c,h):(we.flags|=s,p.memoizedState=Kn(1|a,x,c,h))}function Qm(s,a){Ll(8390656,8,s,a)}function Wm(s,a){Wr(2048,8,s,a)}function Zm(s,a){return Wr(4,2,s,a)}function Jm(s,a){return Wr(4,4,s,a)}function e0(s,a){if(typeof a=="function"){s=s();var c=a(s);return function(){typeof c=="function"?c():a(null)}}if(a!=null)return s=s(),a.current=s,function(){a.current=null}}function t0(s,a,c){c=c!=null?c.concat([s]):null,Wr(4,4,e0.bind(null,a,s),c)}function xu(){}function i0(s,a){var c=ft();a=a===void 0?null:a;var h=c.memoizedState;return a!==null&&ou(a,h[1])?h[0]:(c.memoizedState=[s,a],s)}function s0(s,a){var c=ft();a=a===void 0?null:a;var h=c.memoizedState;if(a!==null&&ou(a,h[1]))return h[0];if(h=s(),cn){Li(!0);try{s()}finally{Li(!1)}}return c.memoizedState=[h,a],h}function Eu(s,a,c){return c===void 0||(Ss&1073741824)!==0?s.memoizedState=a:(s.memoizedState=c,s=ag(),we.lanes|=s,Ds|=s,c)}function n0(s,a,c,h){return Yt(c,a)?c:Hn.current!==null?(s=Eu(s,c,h),Yt(s,a)||(yt=!0),s):(Ss&42)===0?(yt=!0,s.memoizedState=c):(s=ag(),we.lanes|=s,Ds|=s,a)}function r0(s,a,c,h,p){var x=W.p;W.p=x!==0&&8>x?x:8;var L=P.T,I={};P.T=I,bu(s,!1,a,c);try{var M=p(),X=P.S;if(X!==null&&X(I,M),M!==null&&typeof M=="object"&&typeof M.then=="function"){var ie=wE(M,h);Zr(s,a,ie,Zt(s))}else Zr(s,a,h,Zt(s))}catch(le){Zr(s,a,{then:function(){},status:"rejected",reason:le},Zt())}finally{W.p=x,P.T=L}}function kE(){}function Su(s,a,c,h){if(s.tag!==5)throw Error(i(476));var p=a0(s).queue;r0(s,p,a,se,c===null?kE:function(){return l0(s),c(h)})}function a0(s){var a=s.memoizedState;if(a!==null)return a;a={memoizedState:se,baseState:se,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ji,lastRenderedState:se},next:null};var c={};return a.next={memoizedState:c,baseState:c,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ji,lastRenderedState:c},next:null},s.memoizedState=a,s=s.alternate,s!==null&&(s.memoizedState=a),a}function l0(s){var a=a0(s).next.queue;Zr(s,a,{},Zt())}function Tu(){return Dt(pa)}function o0(){return ft().memoizedState}function c0(){return ft().memoizedState}function ME(s){for(var a=s.return;a!==null;){switch(a.tag){case 24:case 3:var c=Zt();s=xs(c);var h=Es(a,s,c);h!==null&&(Jt(h,a,c),Kr(h,a,c)),a={cache:Zc()},s.payload=a;return}a=a.return}}function PE(s,a,c){var h=Zt();c={lane:h,revertLane:0,action:c,hasEagerState:!1,eagerState:null,next:null},_l(s)?f0(a,c):(c=Gc(s,a,c,h),c!==null&&(Jt(c,s,h),d0(c,a,h)))}function u0(s,a,c){var h=Zt();Zr(s,a,c,h)}function Zr(s,a,c,h){var p={lane:h,revertLane:0,action:c,hasEagerState:!1,eagerState:null,next:null};if(_l(s))f0(a,p);else{var x=s.alternate;if(s.lanes===0&&(x===null||x.lanes===0)&&(x=a.lastRenderedReducer,x!==null))try{var L=a.lastRenderedState,I=x(L,c);if(p.hasEagerState=!0,p.eagerState=I,Yt(I,L))return ul(s,a,p,0),Ze===null&&cl(),!1}catch{}finally{}if(c=Gc(s,a,p,h),c!==null)return Jt(c,s,h),d0(c,a,h),!0}return!1}function bu(s,a,c,h){if(h={lane:2,revertLane:tf(),action:h,hasEagerState:!1,eagerState:null,next:null},_l(s)){if(a)throw Error(i(479))}else a=Gc(s,c,h,2),a!==null&&Jt(a,s,2)}function _l(s){var a=s.alternate;return s===we||a!==null&&a===we}function f0(s,a){Vn=Sl=!0;var c=s.pending;c===null?a.next=a:(a.next=c.next,c.next=a),s.pending=a}function d0(s,a,c){if((c&4194048)!==0){var h=a.lanes;h&=s.pendingLanes,c|=h,a.lanes=c,Eh(s,c)}}var Dl={readContext:Dt,use:bl,useCallback:at,useContext:at,useEffect:at,useImperativeHandle:at,useLayoutEffect:at,useInsertionEffect:at,useMemo:at,useReducer:at,useRef:at,useState:at,useDebugValue:at,useDeferredValue:at,useTransition:at,useSyncExternalStore:at,useId:at,useHostTransitionStatus:at,useFormState:at,useActionState:at,useOptimistic:at,useMemoCache:at,useCacheRefresh:at},h0={readContext:Dt,use:bl,useCallback:function(s,a){return jt().memoizedState=[s,a===void 0?null:a],s},useContext:Dt,useEffect:Qm,useImperativeHandle:function(s,a,c){c=c!=null?c.concat([s]):null,Ll(4194308,4,e0.bind(null,a,s),c)},useLayoutEffect:function(s,a){return Ll(4194308,4,s,a)},useInsertionEffect:function(s,a){Ll(4,2,s,a)},useMemo:function(s,a){var c=jt();a=a===void 0?null:a;var h=s();if(cn){Li(!0);try{s()}finally{Li(!1)}}return c.memoizedState=[h,a],h},useReducer:function(s,a,c){var h=jt();if(c!==void 0){var p=c(a);if(cn){Li(!0);try{c(a)}finally{Li(!1)}}}else p=a;return h.memoizedState=h.baseState=p,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:p},h.queue=s,s=s.dispatch=PE.bind(null,we,s),[h.memoizedState,s]},useRef:function(s){var a=jt();return s={current:s},a.memoizedState=s},useState:function(s){s=yu(s);var a=s.queue,c=u0.bind(null,we,a);return a.dispatch=c,[s.memoizedState,c]},useDebugValue:xu,useDeferredValue:function(s,a){var c=jt();return Eu(c,s,a)},useTransition:function(){var s=yu(!1);return s=r0.bind(null,we,s.queue,!0,!1),jt().memoizedState=s,[!1,s]},useSyncExternalStore:function(s,a,c){var h=we,p=jt();if(je){if(c===void 0)throw Error(i(407));c=c()}else{if(c=a(),Ze===null)throw Error(i(349));(Be&124)!==0||km(h,a,c)}p.memoizedState=c;var x={value:c,getSnapshot:a};return p.queue=x,Qm(Pm.bind(null,h,x,s),[s]),h.flags|=2048,Kn(9,Rl(),Mm.bind(null,h,x,c,a),null),c},useId:function(){var s=jt(),a=Ze.identifierPrefix;if(je){var c=Qi,h=Xi;c=(h&~(1<<32-Lt(h)-1)).toString(32)+c,a="«"+a+"R"+c,c=Tl++,0<c&&(a+="H"+c.toString(32)),a+="»"}else c=IE++,a="«"+a+"r"+c.toString(32)+"»";return s.memoizedState=a},useHostTransitionStatus:Tu,useFormState:zm,useActionState:zm,useOptimistic:function(s){var a=jt();a.memoizedState=a.baseState=s;var c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return a.queue=c,a=bu.bind(null,we,!0,c),c.dispatch=a,[s,a]},useMemoCache:mu,useCacheRefresh:function(){return jt().memoizedState=ME.bind(null,we)}},m0={readContext:Dt,use:bl,useCallback:i0,useContext:Dt,useEffect:Wm,useImperativeHandle:t0,useInsertionEffect:Zm,useLayoutEffect:Jm,useMemo:s0,useReducer:Al,useRef:Xm,useState:function(){return Al(Ji)},useDebugValue:xu,useDeferredValue:function(s,a){var c=ft();return n0(c,Ye.memoizedState,s,a)},useTransition:function(){var s=Al(Ji)[0],a=ft().memoizedState;return[typeof s=="boolean"?s:Qr(s),a]},useSyncExternalStore:Nm,useId:o0,useHostTransitionStatus:Tu,useFormState:Km,useActionState:Km,useOptimistic:function(s,a){var c=ft();return Fm(c,Ye,s,a)},useMemoCache:mu,useCacheRefresh:c0},UE={readContext:Dt,use:bl,useCallback:i0,useContext:Dt,useEffect:Wm,useImperativeHandle:t0,useInsertionEffect:Zm,useLayoutEffect:Jm,useMemo:s0,useReducer:pu,useRef:Xm,useState:function(){return pu(Ji)},useDebugValue:xu,useDeferredValue:function(s,a){var c=ft();return Ye===null?Eu(c,s,a):n0(c,Ye.memoizedState,s,a)},useTransition:function(){var s=pu(Ji)[0],a=ft().memoizedState;return[typeof s=="boolean"?s:Qr(s),a]},useSyncExternalStore:Nm,useId:o0,useHostTransitionStatus:Tu,useFormState:qm,useActionState:qm,useOptimistic:function(s,a){var c=ft();return Ye!==null?Fm(c,Ye,s,a):(c.baseState=s,[s,c.queue.dispatch])},useMemoCache:mu,useCacheRefresh:c0},Yn=null,Jr=0;function wl(s){var a=Jr;return Jr+=1,Yn===null&&(Yn=[]),Rm(Yn,s,a)}function ea(s,a){a=a.props.ref,s.ref=a!==void 0?a:null}function Il(s,a){throw a.$$typeof===g?Error(i(525)):(s=Object.prototype.toString.call(a),Error(i(31,s==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":s)))}function g0(s){var a=s._init;return a(s._payload)}function p0(s){function a(H,j){if(s){var Y=H.deletions;Y===null?(H.deletions=[j],H.flags|=16):Y.push(j)}}function c(H,j){if(!s)return null;for(;j!==null;)a(H,j),j=j.sibling;return null}function h(H){for(var j=new Map;H!==null;)H.key!==null?j.set(H.key,H):j.set(H.index,H),H=H.sibling;return j}function p(H,j){return H=qi(H,j),H.index=0,H.sibling=null,H}function x(H,j,Y){return H.index=Y,s?(Y=H.alternate,Y!==null?(Y=Y.index,Y<j?(H.flags|=67108866,j):Y):(H.flags|=67108866,j)):(H.flags|=1048576,j)}function L(H){return s&&H.alternate===null&&(H.flags|=67108866),H}function I(H,j,Y,re){return j===null||j.tag!==6?(j=Vc(Y,H.mode,re),j.return=H,j):(j=p(j,Y),j.return=H,j)}function M(H,j,Y,re){var me=Y.type;return me===y?ie(H,j,Y.props.children,re,Y.key):j!==null&&(j.elementType===me||typeof me=="object"&&me!==null&&me.$$typeof===F&&g0(me)===j.type)?(j=p(j,Y.props),ea(j,Y),j.return=H,j):(j=dl(Y.type,Y.key,Y.props,null,H.mode,re),ea(j,Y),j.return=H,j)}function X(H,j,Y,re){return j===null||j.tag!==4||j.stateNode.containerInfo!==Y.containerInfo||j.stateNode.implementation!==Y.implementation?(j=zc(Y,H.mode,re),j.return=H,j):(j=p(j,Y.children||[]),j.return=H,j)}function ie(H,j,Y,re,me){return j===null||j.tag!==7?(j=en(Y,H.mode,re,me),j.return=H,j):(j=p(j,Y),j.return=H,j)}function le(H,j,Y){if(typeof j=="string"&&j!==""||typeof j=="number"||typeof j=="bigint")return j=Vc(""+j,H.mode,Y),j.return=H,j;if(typeof j=="object"&&j!==null){switch(j.$$typeof){case v:return Y=dl(j.type,j.key,j.props,null,H.mode,Y),ea(Y,j),Y.return=H,Y;case E:return j=zc(j,H.mode,Y),j.return=H,j;case F:var re=j._init;return j=re(j._payload),le(H,j,Y)}if(J(j)||ce(j))return j=en(j,H.mode,Y,null),j.return=H,j;if(typeof j.then=="function")return le(H,wl(j),Y);if(j.$$typeof===_)return le(H,pl(H,j),Y);Il(H,j)}return null}function Q(H,j,Y,re){var me=j!==null?j.key:null;if(typeof Y=="string"&&Y!==""||typeof Y=="number"||typeof Y=="bigint")return me!==null?null:I(H,j,""+Y,re);if(typeof Y=="object"&&Y!==null){switch(Y.$$typeof){case v:return Y.key===me?M(H,j,Y,re):null;case E:return Y.key===me?X(H,j,Y,re):null;case F:return me=Y._init,Y=me(Y._payload),Q(H,j,Y,re)}if(J(Y)||ce(Y))return me!==null?null:ie(H,j,Y,re,null);if(typeof Y.then=="function")return Q(H,j,wl(Y),re);if(Y.$$typeof===_)return Q(H,j,pl(H,Y),re);Il(H,Y)}return null}function Z(H,j,Y,re,me){if(typeof re=="string"&&re!==""||typeof re=="number"||typeof re=="bigint")return H=H.get(Y)||null,I(j,H,""+re,me);if(typeof re=="object"&&re!==null){switch(re.$$typeof){case v:return H=H.get(re.key===null?Y:re.key)||null,M(j,H,re,me);case E:return H=H.get(re.key===null?Y:re.key)||null,X(j,H,re,me);case F:var Ie=re._init;return re=Ie(re._payload),Z(H,j,Y,re,me)}if(J(re)||ce(re))return H=H.get(Y)||null,ie(j,H,re,me,null);if(typeof re.then=="function")return Z(H,j,Y,wl(re),me);if(re.$$typeof===_)return Z(H,j,Y,pl(j,re),me);Il(j,re)}return null}function Te(H,j,Y,re){for(var me=null,Ie=null,ye=j,Se=j=0,xt=null;ye!==null&&Se<Y.length;Se++){ye.index>Se?(xt=ye,ye=null):xt=ye.sibling;var Fe=Q(H,ye,Y[Se],re);if(Fe===null){ye===null&&(ye=xt);break}s&&ye&&Fe.alternate===null&&a(H,ye),j=x(Fe,j,Se),Ie===null?me=Fe:Ie.sibling=Fe,Ie=Fe,ye=xt}if(Se===Y.length)return c(H,ye),je&&sn(H,Se),me;if(ye===null){for(;Se<Y.length;Se++)ye=le(H,Y[Se],re),ye!==null&&(j=x(ye,j,Se),Ie===null?me=ye:Ie.sibling=ye,Ie=ye);return je&&sn(H,Se),me}for(ye=h(ye);Se<Y.length;Se++)xt=Z(ye,H,Se,Y[Se],re),xt!==null&&(s&&xt.alternate!==null&&ye.delete(xt.key===null?Se:xt.key),j=x(xt,j,Se),Ie===null?me=xt:Ie.sibling=xt,Ie=xt);return s&&ye.forEach(function(Us){return a(H,Us)}),je&&sn(H,Se),me}function Ee(H,j,Y,re){if(Y==null)throw Error(i(151));for(var me=null,Ie=null,ye=j,Se=j=0,xt=null,Fe=Y.next();ye!==null&&!Fe.done;Se++,Fe=Y.next()){ye.index>Se?(xt=ye,ye=null):xt=ye.sibling;var Us=Q(H,ye,Fe.value,re);if(Us===null){ye===null&&(ye=xt);break}s&&ye&&Us.alternate===null&&a(H,ye),j=x(Us,j,Se),Ie===null?me=Us:Ie.sibling=Us,Ie=Us,ye=xt}if(Fe.done)return c(H,ye),je&&sn(H,Se),me;if(ye===null){for(;!Fe.done;Se++,Fe=Y.next())Fe=le(H,Fe.value,re),Fe!==null&&(j=x(Fe,j,Se),Ie===null?me=Fe:Ie.sibling=Fe,Ie=Fe);return je&&sn(H,Se),me}for(ye=h(ye);!Fe.done;Se++,Fe=Y.next())Fe=Z(ye,H,Se,Fe.value,re),Fe!==null&&(s&&Fe.alternate!==null&&ye.delete(Fe.key===null?Se:Fe.key),j=x(Fe,j,Se),Ie===null?me=Fe:Ie.sibling=Fe,Ie=Fe);return s&&ye.forEach(function(BS){return a(H,BS)}),je&&sn(H,Se),me}function Xe(H,j,Y,re){if(typeof Y=="object"&&Y!==null&&Y.type===y&&Y.key===null&&(Y=Y.props.children),typeof Y=="object"&&Y!==null){switch(Y.$$typeof){case v:e:{for(var me=Y.key;j!==null;){if(j.key===me){if(me=Y.type,me===y){if(j.tag===7){c(H,j.sibling),re=p(j,Y.props.children),re.return=H,H=re;break e}}else if(j.elementType===me||typeof me=="object"&&me!==null&&me.$$typeof===F&&g0(me)===j.type){c(H,j.sibling),re=p(j,Y.props),ea(re,Y),re.return=H,H=re;break e}c(H,j);break}else a(H,j);j=j.sibling}Y.type===y?(re=en(Y.props.children,H.mode,re,Y.key),re.return=H,H=re):(re=dl(Y.type,Y.key,Y.props,null,H.mode,re),ea(re,Y),re.return=H,H=re)}return L(H);case E:e:{for(me=Y.key;j!==null;){if(j.key===me)if(j.tag===4&&j.stateNode.containerInfo===Y.containerInfo&&j.stateNode.implementation===Y.implementation){c(H,j.sibling),re=p(j,Y.children||[]),re.return=H,H=re;break e}else{c(H,j);break}else a(H,j);j=j.sibling}re=zc(Y,H.mode,re),re.return=H,H=re}return L(H);case F:return me=Y._init,Y=me(Y._payload),Xe(H,j,Y,re)}if(J(Y))return Te(H,j,Y,re);if(ce(Y)){if(me=ce(Y),typeof me!="function")throw Error(i(150));return Y=me.call(Y),Ee(H,j,Y,re)}if(typeof Y.then=="function")return Xe(H,j,wl(Y),re);if(Y.$$typeof===_)return Xe(H,j,pl(H,Y),re);Il(H,Y)}return typeof Y=="string"&&Y!==""||typeof Y=="number"||typeof Y=="bigint"?(Y=""+Y,j!==null&&j.tag===6?(c(H,j.sibling),re=p(j,Y),re.return=H,H=re):(c(H,j),re=Vc(Y,H.mode,re),re.return=H,H=re),L(H)):c(H,j)}return function(H,j,Y,re){try{Jr=0;var me=Xe(H,j,Y,re);return Yn=null,me}catch(ye){if(ye===Vr||ye===vl)throw ye;var Ie=qt(29,ye,null,H.mode);return Ie.lanes=re,Ie.return=H,Ie}finally{}}}var qn=p0(!0),y0=p0(!1),oi=k(null),Di=null;function Ts(s){var a=s.alternate;G(ht,ht.current&1),G(oi,s),Di===null&&(a===null||Hn.current!==null||a.memoizedState!==null)&&(Di=s)}function v0(s){if(s.tag===22){if(G(ht,ht.current),G(oi,s),Di===null){var a=s.alternate;a!==null&&a.memoizedState!==null&&(Di=s)}}else bs()}function bs(){G(ht,ht.current),G(oi,oi.current)}function es(s){K(oi),Di===s&&(Di=null),K(ht)}var ht=k(0);function Cl(s){for(var a=s;a!==null;){if(a.tag===13){var c=a.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||c.data==="$?"||mf(c)))return a}else if(a.tag===19&&a.memoizedProps.revealOrder!==void 0){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===s)break;for(;a.sibling===null;){if(a.return===null||a.return===s)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}function Au(s,a,c,h){a=s.memoizedState,c=c(h,a),c=c==null?a:m({},a,c),s.memoizedState=c,s.lanes===0&&(s.updateQueue.baseState=c)}var Ru={enqueueSetState:function(s,a,c){s=s._reactInternals;var h=Zt(),p=xs(h);p.payload=a,c!=null&&(p.callback=c),a=Es(s,p,h),a!==null&&(Jt(a,s,h),Kr(a,s,h))},enqueueReplaceState:function(s,a,c){s=s._reactInternals;var h=Zt(),p=xs(h);p.tag=1,p.payload=a,c!=null&&(p.callback=c),a=Es(s,p,h),a!==null&&(Jt(a,s,h),Kr(a,s,h))},enqueueForceUpdate:function(s,a){s=s._reactInternals;var c=Zt(),h=xs(c);h.tag=2,a!=null&&(h.callback=a),a=Es(s,h,c),a!==null&&(Jt(a,s,c),Kr(a,s,c))}};function x0(s,a,c,h,p,x,L){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(h,x,L):a.prototype&&a.prototype.isPureReactComponent?!Pr(c,h)||!Pr(p,x):!0}function E0(s,a,c,h){s=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(c,h),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(c,h),a.state!==s&&Ru.enqueueReplaceState(a,a.state,null)}function un(s,a){var c=a;if("ref"in a){c={};for(var h in a)h!=="ref"&&(c[h]=a[h])}if(s=s.defaultProps){c===a&&(c=m({},c));for(var p in s)c[p]===void 0&&(c[p]=s[p])}return c}var Ol=typeof reportError=="function"?reportError:function(s){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof s=="object"&&s!==null&&typeof s.message=="string"?String(s.message):String(s),error:s});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",s);return}console.error(s)};function S0(s){Ol(s)}function T0(s){console.error(s)}function b0(s){Ol(s)}function Nl(s,a){try{var c=s.onUncaughtError;c(a.value,{componentStack:a.stack})}catch(h){setTimeout(function(){throw h})}}function A0(s,a,c){try{var h=s.onCaughtError;h(c.value,{componentStack:c.stack,errorBoundary:a.tag===1?a.stateNode:null})}catch(p){setTimeout(function(){throw p})}}function Lu(s,a,c){return c=xs(c),c.tag=3,c.payload={element:null},c.callback=function(){Nl(s,a)},c}function R0(s){return s=xs(s),s.tag=3,s}function L0(s,a,c,h){var p=c.type.getDerivedStateFromError;if(typeof p=="function"){var x=h.value;s.payload=function(){return p(x)},s.callback=function(){A0(a,c,h)}}var L=c.stateNode;L!==null&&typeof L.componentDidCatch=="function"&&(s.callback=function(){A0(a,c,h),typeof p!="function"&&(ws===null?ws=new Set([this]):ws.add(this));var I=h.stack;this.componentDidCatch(h.value,{componentStack:I!==null?I:""})})}function BE(s,a,c,h,p){if(c.flags|=32768,h!==null&&typeof h=="object"&&typeof h.then=="function"){if(a=c.alternate,a!==null&&$r(a,c,p,!0),c=oi.current,c!==null){switch(c.tag){case 13:return Di===null?Qu():c.alternate===null&&rt===0&&(rt=3),c.flags&=-257,c.flags|=65536,c.lanes=p,h===tu?c.flags|=16384:(a=c.updateQueue,a===null?c.updateQueue=new Set([h]):a.add(h),Zu(s,h,p)),!1;case 22:return c.flags|=65536,h===tu?c.flags|=16384:(a=c.updateQueue,a===null?(a={transitions:null,markerInstances:null,retryQueue:new Set([h])},c.updateQueue=a):(c=a.retryQueue,c===null?a.retryQueue=new Set([h]):c.add(h)),Zu(s,h,p)),!1}throw Error(i(435,c.tag))}return Zu(s,h,p),Qu(),!1}if(je)return a=oi.current,a!==null?((a.flags&65536)===0&&(a.flags|=256),a.flags|=65536,a.lanes=p,h!==qc&&(s=Error(i(422),{cause:h}),jr(ni(s,c)))):(h!==qc&&(a=Error(i(423),{cause:h}),jr(ni(a,c))),s=s.current.alternate,s.flags|=65536,p&=-p,s.lanes|=p,h=ni(h,c),p=Lu(s.stateNode,h,p),nu(s,p),rt!==4&&(rt=2)),!1;var x=Error(i(520),{cause:h});if(x=ni(x,c),la===null?la=[x]:la.push(x),rt!==4&&(rt=2),a===null)return!0;h=ni(h,c),c=a;do{switch(c.tag){case 3:return c.flags|=65536,s=p&-p,c.lanes|=s,s=Lu(c.stateNode,h,s),nu(c,s),!1;case 1:if(a=c.type,x=c.stateNode,(c.flags&128)===0&&(typeof a.getDerivedStateFromError=="function"||x!==null&&typeof x.componentDidCatch=="function"&&(ws===null||!ws.has(x))))return c.flags|=65536,p&=-p,c.lanes|=p,p=R0(p),L0(p,s,c,h),nu(c,p),!1}c=c.return}while(c!==null);return!1}var _0=Error(i(461)),yt=!1;function Tt(s,a,c,h){a.child=s===null?y0(a,null,c,h):qn(a,s.child,c,h)}function D0(s,a,c,h,p){c=c.render;var x=a.ref;if("ref"in h){var L={};for(var I in h)I!=="ref"&&(L[I]=h[I])}else L=h;return ln(a),h=cu(s,a,c,L,x,p),I=uu(),s!==null&&!yt?(fu(s,a,p),ts(s,a,p)):(je&&I&&Kc(a),a.flags|=1,Tt(s,a,h,p),a.child)}function w0(s,a,c,h,p){if(s===null){var x=c.type;return typeof x=="function"&&!Hc(x)&&x.defaultProps===void 0&&c.compare===null?(a.tag=15,a.type=x,I0(s,a,x,h,p)):(s=dl(c.type,null,h,a,a.mode,p),s.ref=a.ref,s.return=a,a.child=s)}if(x=s.child,!ku(s,p)){var L=x.memoizedProps;if(c=c.compare,c=c!==null?c:Pr,c(L,h)&&s.ref===a.ref)return ts(s,a,p)}return a.flags|=1,s=qi(x,h),s.ref=a.ref,s.return=a,a.child=s}function I0(s,a,c,h,p){if(s!==null){var x=s.memoizedProps;if(Pr(x,h)&&s.ref===a.ref)if(yt=!1,a.pendingProps=h=x,ku(s,p))(s.flags&131072)!==0&&(yt=!0);else return a.lanes=s.lanes,ts(s,a,p)}return _u(s,a,c,h,p)}function C0(s,a,c){var h=a.pendingProps,p=h.children,x=s!==null?s.memoizedState:null;if(h.mode==="hidden"){if((a.flags&128)!==0){if(h=x!==null?x.baseLanes|c:c,s!==null){for(p=a.child=s.child,x=0;p!==null;)x=x|p.lanes|p.childLanes,p=p.sibling;a.childLanes=x&~h}else a.childLanes=0,a.child=null;return O0(s,a,h,c)}if((c&536870912)!==0)a.memoizedState={baseLanes:0,cachePool:null},s!==null&&yl(a,x!==null?x.cachePool:null),x!==null?Im(a,x):au(),v0(a);else return a.lanes=a.childLanes=536870912,O0(s,a,x!==null?x.baseLanes|c:c,c)}else x!==null?(yl(a,x.cachePool),Im(a,x),bs(),a.memoizedState=null):(s!==null&&yl(a,null),au(),bs());return Tt(s,a,p,c),a.child}function O0(s,a,c,h){var p=eu();return p=p===null?null:{parent:dt._currentValue,pool:p},a.memoizedState={baseLanes:c,cachePool:p},s!==null&&yl(a,null),au(),v0(a),s!==null&&$r(s,a,h,!0),null}function kl(s,a){var c=a.ref;if(c===null)s!==null&&s.ref!==null&&(a.flags|=4194816);else{if(typeof c!="function"&&typeof c!="object")throw Error(i(284));(s===null||s.ref!==c)&&(a.flags|=4194816)}}function _u(s,a,c,h,p){return ln(a),c=cu(s,a,c,h,void 0,p),h=uu(),s!==null&&!yt?(fu(s,a,p),ts(s,a,p)):(je&&h&&Kc(a),a.flags|=1,Tt(s,a,c,p),a.child)}function N0(s,a,c,h,p,x){return ln(a),a.updateQueue=null,c=Om(a,h,c,p),Cm(s),h=uu(),s!==null&&!yt?(fu(s,a,x),ts(s,a,x)):(je&&h&&Kc(a),a.flags|=1,Tt(s,a,c,x),a.child)}function k0(s,a,c,h,p){if(ln(a),a.stateNode===null){var x=Bn,L=c.contextType;typeof L=="object"&&L!==null&&(x=Dt(L)),x=new c(h,x),a.memoizedState=x.state!==null&&x.state!==void 0?x.state:null,x.updater=Ru,a.stateNode=x,x._reactInternals=a,x=a.stateNode,x.props=h,x.state=a.memoizedState,x.refs={},iu(a),L=c.contextType,x.context=typeof L=="object"&&L!==null?Dt(L):Bn,x.state=a.memoizedState,L=c.getDerivedStateFromProps,typeof L=="function"&&(Au(a,c,L,h),x.state=a.memoizedState),typeof c.getDerivedStateFromProps=="function"||typeof x.getSnapshotBeforeUpdate=="function"||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(L=x.state,typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount(),L!==x.state&&Ru.enqueueReplaceState(x,x.state,null),qr(a,h,x,p),Yr(),x.state=a.memoizedState),typeof x.componentDidMount=="function"&&(a.flags|=4194308),h=!0}else if(s===null){x=a.stateNode;var I=a.memoizedProps,M=un(c,I);x.props=M;var X=x.context,ie=c.contextType;L=Bn,typeof ie=="object"&&ie!==null&&(L=Dt(ie));var le=c.getDerivedStateFromProps;ie=typeof le=="function"||typeof x.getSnapshotBeforeUpdate=="function",I=a.pendingProps!==I,ie||typeof x.UNSAFE_componentWillReceiveProps!="function"&&typeof x.componentWillReceiveProps!="function"||(I||X!==L)&&E0(a,x,h,L),vs=!1;var Q=a.memoizedState;x.state=Q,qr(a,h,x,p),Yr(),X=a.memoizedState,I||Q!==X||vs?(typeof le=="function"&&(Au(a,c,le,h),X=a.memoizedState),(M=vs||x0(a,c,M,h,Q,X,L))?(ie||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount()),typeof x.componentDidMount=="function"&&(a.flags|=4194308)):(typeof x.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=h,a.memoizedState=X),x.props=h,x.state=X,x.context=L,h=M):(typeof x.componentDidMount=="function"&&(a.flags|=4194308),h=!1)}else{x=a.stateNode,su(s,a),L=a.memoizedProps,ie=un(c,L),x.props=ie,le=a.pendingProps,Q=x.context,X=c.contextType,M=Bn,typeof X=="object"&&X!==null&&(M=Dt(X)),I=c.getDerivedStateFromProps,(X=typeof I=="function"||typeof x.getSnapshotBeforeUpdate=="function")||typeof x.UNSAFE_componentWillReceiveProps!="function"&&typeof x.componentWillReceiveProps!="function"||(L!==le||Q!==M)&&E0(a,x,h,M),vs=!1,Q=a.memoizedState,x.state=Q,qr(a,h,x,p),Yr();var Z=a.memoizedState;L!==le||Q!==Z||vs||s!==null&&s.dependencies!==null&&gl(s.dependencies)?(typeof I=="function"&&(Au(a,c,I,h),Z=a.memoizedState),(ie=vs||x0(a,c,ie,h,Q,Z,M)||s!==null&&s.dependencies!==null&&gl(s.dependencies))?(X||typeof x.UNSAFE_componentWillUpdate!="function"&&typeof x.componentWillUpdate!="function"||(typeof x.componentWillUpdate=="function"&&x.componentWillUpdate(h,Z,M),typeof x.UNSAFE_componentWillUpdate=="function"&&x.UNSAFE_componentWillUpdate(h,Z,M)),typeof x.componentDidUpdate=="function"&&(a.flags|=4),typeof x.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof x.componentDidUpdate!="function"||L===s.memoizedProps&&Q===s.memoizedState||(a.flags|=4),typeof x.getSnapshotBeforeUpdate!="function"||L===s.memoizedProps&&Q===s.memoizedState||(a.flags|=1024),a.memoizedProps=h,a.memoizedState=Z),x.props=h,x.state=Z,x.context=M,h=ie):(typeof x.componentDidUpdate!="function"||L===s.memoizedProps&&Q===s.memoizedState||(a.flags|=4),typeof x.getSnapshotBeforeUpdate!="function"||L===s.memoizedProps&&Q===s.memoizedState||(a.flags|=1024),h=!1)}return x=h,kl(s,a),h=(a.flags&128)!==0,x||h?(x=a.stateNode,c=h&&typeof c.getDerivedStateFromError!="function"?null:x.render(),a.flags|=1,s!==null&&h?(a.child=qn(a,s.child,null,p),a.child=qn(a,null,c,p)):Tt(s,a,c,p),a.memoizedState=x.state,s=a.child):s=ts(s,a,p),s}function M0(s,a,c,h){return Fr(),a.flags|=256,Tt(s,a,c,h),a.child}var Du={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function wu(s){return{baseLanes:s,cachePool:Tm()}}function Iu(s,a,c){return s=s!==null?s.childLanes&~c:0,a&&(s|=ci),s}function P0(s,a,c){var h=a.pendingProps,p=!1,x=(a.flags&128)!==0,L;if((L=x)||(L=s!==null&&s.memoizedState===null?!1:(ht.current&2)!==0),L&&(p=!0,a.flags&=-129),L=(a.flags&32)!==0,a.flags&=-33,s===null){if(je){if(p?Ts(a):bs(),je){var I=nt,M;if(M=I){e:{for(M=I,I=_i;M.nodeType!==8;){if(!I){I=null;break e}if(M=vi(M.nextSibling),M===null){I=null;break e}}I=M}I!==null?(a.memoizedState={dehydrated:I,treeContext:tn!==null?{id:Xi,overflow:Qi}:null,retryLane:536870912,hydrationErrors:null},M=qt(18,null,null,0),M.stateNode=I,M.return=a,a.child=M,Ot=a,nt=null,M=!0):M=!1}M||rn(a)}if(I=a.memoizedState,I!==null&&(I=I.dehydrated,I!==null))return mf(I)?a.lanes=32:a.lanes=536870912,null;es(a)}return I=h.children,h=h.fallback,p?(bs(),p=a.mode,I=Ml({mode:"hidden",children:I},p),h=en(h,p,c,null),I.return=a,h.return=a,I.sibling=h,a.child=I,p=a.child,p.memoizedState=wu(c),p.childLanes=Iu(s,L,c),a.memoizedState=Du,h):(Ts(a),Cu(a,I))}if(M=s.memoizedState,M!==null&&(I=M.dehydrated,I!==null)){if(x)a.flags&256?(Ts(a),a.flags&=-257,a=Ou(s,a,c)):a.memoizedState!==null?(bs(),a.child=s.child,a.flags|=128,a=null):(bs(),p=h.fallback,I=a.mode,h=Ml({mode:"visible",children:h.children},I),p=en(p,I,c,null),p.flags|=2,h.return=a,p.return=a,h.sibling=p,a.child=h,qn(a,s.child,null,c),h=a.child,h.memoizedState=wu(c),h.childLanes=Iu(s,L,c),a.memoizedState=Du,a=p);else if(Ts(a),mf(I)){if(L=I.nextSibling&&I.nextSibling.dataset,L)var X=L.dgst;L=X,h=Error(i(419)),h.stack="",h.digest=L,jr({value:h,source:null,stack:null}),a=Ou(s,a,c)}else if(yt||$r(s,a,c,!1),L=(c&s.childLanes)!==0,yt||L){if(L=Ze,L!==null&&(h=c&-c,h=(h&42)!==0?1:mc(h),h=(h&(L.suspendedLanes|c))!==0?0:h,h!==0&&h!==M.retryLane))throw M.retryLane=h,Un(s,h),Jt(L,s,h),_0;I.data==="$?"||Qu(),a=Ou(s,a,c)}else I.data==="$?"?(a.flags|=192,a.child=s.child,a=null):(s=M.treeContext,nt=vi(I.nextSibling),Ot=a,je=!0,nn=null,_i=!1,s!==null&&(ai[li++]=Xi,ai[li++]=Qi,ai[li++]=tn,Xi=s.id,Qi=s.overflow,tn=a),a=Cu(a,h.children),a.flags|=4096);return a}return p?(bs(),p=h.fallback,I=a.mode,M=s.child,X=M.sibling,h=qi(M,{mode:"hidden",children:h.children}),h.subtreeFlags=M.subtreeFlags&65011712,X!==null?p=qi(X,p):(p=en(p,I,c,null),p.flags|=2),p.return=a,h.return=a,h.sibling=p,a.child=h,h=p,p=a.child,I=s.child.memoizedState,I===null?I=wu(c):(M=I.cachePool,M!==null?(X=dt._currentValue,M=M.parent!==X?{parent:X,pool:X}:M):M=Tm(),I={baseLanes:I.baseLanes|c,cachePool:M}),p.memoizedState=I,p.childLanes=Iu(s,L,c),a.memoizedState=Du,h):(Ts(a),c=s.child,s=c.sibling,c=qi(c,{mode:"visible",children:h.children}),c.return=a,c.sibling=null,s!==null&&(L=a.deletions,L===null?(a.deletions=[s],a.flags|=16):L.push(s)),a.child=c,a.memoizedState=null,c)}function Cu(s,a){return a=Ml({mode:"visible",children:a},s.mode),a.return=s,s.child=a}function Ml(s,a){return s=qt(22,s,null,a),s.lanes=0,s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},s}function Ou(s,a,c){return qn(a,s.child,null,c),s=Cu(a,a.pendingProps.children),s.flags|=2,a.memoizedState=null,s}function U0(s,a,c){s.lanes|=a;var h=s.alternate;h!==null&&(h.lanes|=a),Qc(s.return,a,c)}function Nu(s,a,c,h,p){var x=s.memoizedState;x===null?s.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:h,tail:c,tailMode:p}:(x.isBackwards=a,x.rendering=null,x.renderingStartTime=0,x.last=h,x.tail=c,x.tailMode=p)}function B0(s,a,c){var h=a.pendingProps,p=h.revealOrder,x=h.tail;if(Tt(s,a,h.children,c),h=ht.current,(h&2)!==0)h=h&1|2,a.flags|=128;else{if(s!==null&&(s.flags&128)!==0)e:for(s=a.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&U0(s,c,a);else if(s.tag===19)U0(s,c,a);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===a)break e;for(;s.sibling===null;){if(s.return===null||s.return===a)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}h&=1}switch(G(ht,h),p){case"forwards":for(c=a.child,p=null;c!==null;)s=c.alternate,s!==null&&Cl(s)===null&&(p=c),c=c.sibling;c=p,c===null?(p=a.child,a.child=null):(p=c.sibling,c.sibling=null),Nu(a,!1,p,c,x);break;case"backwards":for(c=null,p=a.child,a.child=null;p!==null;){if(s=p.alternate,s!==null&&Cl(s)===null){a.child=p;break}s=p.sibling,p.sibling=c,c=p,p=s}Nu(a,!0,c,null,x);break;case"together":Nu(a,!1,null,null,void 0);break;default:a.memoizedState=null}return a.child}function ts(s,a,c){if(s!==null&&(a.dependencies=s.dependencies),Ds|=a.lanes,(c&a.childLanes)===0)if(s!==null){if($r(s,a,c,!1),(c&a.childLanes)===0)return null}else return null;if(s!==null&&a.child!==s.child)throw Error(i(153));if(a.child!==null){for(s=a.child,c=qi(s,s.pendingProps),a.child=c,c.return=a;s.sibling!==null;)s=s.sibling,c=c.sibling=qi(s,s.pendingProps),c.return=a;c.sibling=null}return a.child}function ku(s,a){return(s.lanes&a)!==0?!0:(s=s.dependencies,!!(s!==null&&gl(s)))}function FE(s,a,c){switch(a.tag){case 3:Le(a,a.stateNode.containerInfo),ys(a,dt,s.memoizedState.cache),Fr();break;case 27:case 5:Vi(a);break;case 4:Le(a,a.stateNode.containerInfo);break;case 10:ys(a,a.type,a.memoizedProps.value);break;case 13:var h=a.memoizedState;if(h!==null)return h.dehydrated!==null?(Ts(a),a.flags|=128,null):(c&a.child.childLanes)!==0?P0(s,a,c):(Ts(a),s=ts(s,a,c),s!==null?s.sibling:null);Ts(a);break;case 19:var p=(s.flags&128)!==0;if(h=(c&a.childLanes)!==0,h||($r(s,a,c,!1),h=(c&a.childLanes)!==0),p){if(h)return B0(s,a,c);a.flags|=128}if(p=a.memoizedState,p!==null&&(p.rendering=null,p.tail=null,p.lastEffect=null),G(ht,ht.current),h)break;return null;case 22:case 23:return a.lanes=0,C0(s,a,c);case 24:ys(a,dt,s.memoizedState.cache)}return ts(s,a,c)}function F0(s,a,c){if(s!==null)if(s.memoizedProps!==a.pendingProps)yt=!0;else{if(!ku(s,c)&&(a.flags&128)===0)return yt=!1,FE(s,a,c);yt=(s.flags&131072)!==0}else yt=!1,je&&(a.flags&1048576)!==0&&gm(a,ml,a.index);switch(a.lanes=0,a.tag){case 16:e:{s=a.pendingProps;var h=a.elementType,p=h._init;if(h=p(h._payload),a.type=h,typeof h=="function")Hc(h)?(s=un(h,s),a.tag=1,a=k0(null,a,h,s,c)):(a.tag=0,a=_u(null,a,h,s,c));else{if(h!=null){if(p=h.$$typeof,p===O){a.tag=11,a=D0(null,a,h,s,c);break e}else if(p===N){a.tag=14,a=w0(null,a,h,s,c);break e}}throw a=he(h)||h,Error(i(306,a,""))}}return a;case 0:return _u(s,a,a.type,a.pendingProps,c);case 1:return h=a.type,p=un(h,a.pendingProps),k0(s,a,h,p,c);case 3:e:{if(Le(a,a.stateNode.containerInfo),s===null)throw Error(i(387));h=a.pendingProps;var x=a.memoizedState;p=x.element,su(s,a),qr(a,h,null,c);var L=a.memoizedState;if(h=L.cache,ys(a,dt,h),h!==x.cache&&Wc(a,[dt],c,!0),Yr(),h=L.element,x.isDehydrated)if(x={element:h,isDehydrated:!1,cache:L.cache},a.updateQueue.baseState=x,a.memoizedState=x,a.flags&256){a=M0(s,a,h,c);break e}else if(h!==p){p=ni(Error(i(424)),a),jr(p),a=M0(s,a,h,c);break e}else{switch(s=a.stateNode.containerInfo,s.nodeType){case 9:s=s.body;break;default:s=s.nodeName==="HTML"?s.ownerDocument.body:s}for(nt=vi(s.firstChild),Ot=a,je=!0,nn=null,_i=!0,c=y0(a,null,h,c),a.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling}else{if(Fr(),h===p){a=ts(s,a,c);break e}Tt(s,a,h,c)}a=a.child}return a;case 26:return kl(s,a),s===null?(c=Hg(a.type,null,a.pendingProps,null))?a.memoizedState=c:je||(c=a.type,s=a.pendingProps,h=Xl(ue.current).createElement(c),h[_t]=a,h[Bt]=s,At(h,c,s),pt(h),a.stateNode=h):a.memoizedState=Hg(a.type,s.memoizedProps,a.pendingProps,s.memoizedState),null;case 27:return Vi(a),s===null&&je&&(h=a.stateNode=jg(a.type,a.pendingProps,ue.current),Ot=a,_i=!0,p=nt,Os(a.type)?(gf=p,nt=vi(h.firstChild)):nt=p),Tt(s,a,a.pendingProps.children,c),kl(s,a),s===null&&(a.flags|=4194304),a.child;case 5:return s===null&&je&&((p=h=nt)&&(h=hS(h,a.type,a.pendingProps,_i),h!==null?(a.stateNode=h,Ot=a,nt=vi(h.firstChild),_i=!1,p=!0):p=!1),p||rn(a)),Vi(a),p=a.type,x=a.pendingProps,L=s!==null?s.memoizedProps:null,h=x.children,ff(p,x)?h=null:L!==null&&ff(p,L)&&(a.flags|=32),a.memoizedState!==null&&(p=cu(s,a,CE,null,null,c),pa._currentValue=p),kl(s,a),Tt(s,a,h,c),a.child;case 6:return s===null&&je&&((s=c=nt)&&(c=mS(c,a.pendingProps,_i),c!==null?(a.stateNode=c,Ot=a,nt=null,s=!0):s=!1),s||rn(a)),null;case 13:return P0(s,a,c);case 4:return Le(a,a.stateNode.containerInfo),h=a.pendingProps,s===null?a.child=qn(a,null,h,c):Tt(s,a,h,c),a.child;case 11:return D0(s,a,a.type,a.pendingProps,c);case 7:return Tt(s,a,a.pendingProps,c),a.child;case 8:return Tt(s,a,a.pendingProps.children,c),a.child;case 12:return Tt(s,a,a.pendingProps.children,c),a.child;case 10:return h=a.pendingProps,ys(a,a.type,h.value),Tt(s,a,h.children,c),a.child;case 9:return p=a.type._context,h=a.pendingProps.children,ln(a),p=Dt(p),h=h(p),a.flags|=1,Tt(s,a,h,c),a.child;case 14:return w0(s,a,a.type,a.pendingProps,c);case 15:return I0(s,a,a.type,a.pendingProps,c);case 19:return B0(s,a,c);case 31:return h=a.pendingProps,c=a.mode,h={mode:h.mode,children:h.children},s===null?(c=Ml(h,c),c.ref=a.ref,a.child=c,c.return=a,a=c):(c=qi(s.child,h),c.ref=a.ref,a.child=c,c.return=a,a=c),a;case 22:return C0(s,a,c);case 24:return ln(a),h=Dt(dt),s===null?(p=eu(),p===null&&(p=Ze,x=Zc(),p.pooledCache=x,x.refCount++,x!==null&&(p.pooledCacheLanes|=c),p=x),a.memoizedState={parent:h,cache:p},iu(a),ys(a,dt,p)):((s.lanes&c)!==0&&(su(s,a),qr(a,null,null,c),Yr()),p=s.memoizedState,x=a.memoizedState,p.parent!==h?(p={parent:h,cache:h},a.memoizedState=p,a.lanes===0&&(a.memoizedState=a.updateQueue.baseState=p),ys(a,dt,h)):(h=x.cache,ys(a,dt,h),h!==p.cache&&Wc(a,[dt],c,!0))),Tt(s,a,a.pendingProps.children,c),a.child;case 29:throw a.pendingProps}throw Error(i(156,a.tag))}function is(s){s.flags|=4}function j0(s,a){if(a.type!=="stylesheet"||(a.state.loading&4)!==0)s.flags&=-16777217;else if(s.flags|=16777216,!qg(a)){if(a=oi.current,a!==null&&((Be&4194048)===Be?Di!==null:(Be&62914560)!==Be&&(Be&536870912)===0||a!==Di))throw zr=tu,bm;s.flags|=8192}}function Pl(s,a){a!==null&&(s.flags|=4),s.flags&16384&&(a=s.tag!==22?vh():536870912,s.lanes|=a,Zn|=a)}function ta(s,a){if(!je)switch(s.tailMode){case"hidden":a=s.tail;for(var c=null;a!==null;)a.alternate!==null&&(c=a),a=a.sibling;c===null?s.tail=null:c.sibling=null;break;case"collapsed":c=s.tail;for(var h=null;c!==null;)c.alternate!==null&&(h=c),c=c.sibling;h===null?a||s.tail===null?s.tail=null:s.tail.sibling=null:h.sibling=null}}function tt(s){var a=s.alternate!==null&&s.alternate.child===s.child,c=0,h=0;if(a)for(var p=s.child;p!==null;)c|=p.lanes|p.childLanes,h|=p.subtreeFlags&65011712,h|=p.flags&65011712,p.return=s,p=p.sibling;else for(p=s.child;p!==null;)c|=p.lanes|p.childLanes,h|=p.subtreeFlags,h|=p.flags,p.return=s,p=p.sibling;return s.subtreeFlags|=h,s.childLanes=c,a}function jE(s,a,c){var h=a.pendingProps;switch(Yc(a),a.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return tt(a),null;case 1:return tt(a),null;case 3:return c=a.stateNode,h=null,s!==null&&(h=s.memoizedState.cache),a.memoizedState.cache!==h&&(a.flags|=2048),Zi(dt),ct(),c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),(s===null||s.child===null)&&(Br(a)?is(a):s===null||s.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,vm())),tt(a),null;case 26:return c=a.memoizedState,s===null?(is(a),c!==null?(tt(a),j0(a,c)):(tt(a),a.flags&=-16777217)):c?c!==s.memoizedState?(is(a),tt(a),j0(a,c)):(tt(a),a.flags&=-16777217):(s.memoizedProps!==h&&is(a),tt(a),a.flags&=-16777217),null;case 27:Sn(a),c=ue.current;var p=a.type;if(s!==null&&a.stateNode!=null)s.memoizedProps!==h&&is(a);else{if(!h){if(a.stateNode===null)throw Error(i(166));return tt(a),null}s=oe.current,Br(a)?pm(a):(s=jg(p,h,c),a.stateNode=s,is(a))}return tt(a),null;case 5:if(Sn(a),c=a.type,s!==null&&a.stateNode!=null)s.memoizedProps!==h&&is(a);else{if(!h){if(a.stateNode===null)throw Error(i(166));return tt(a),null}if(s=oe.current,Br(a))pm(a);else{switch(p=Xl(ue.current),s){case 1:s=p.createElementNS("http://www.w3.org/2000/svg",c);break;case 2:s=p.createElementNS("http://www.w3.org/1998/Math/MathML",c);break;default:switch(c){case"svg":s=p.createElementNS("http://www.w3.org/2000/svg",c);break;case"math":s=p.createElementNS("http://www.w3.org/1998/Math/MathML",c);break;case"script":s=p.createElement("div"),s.innerHTML="<script><\/script>",s=s.removeChild(s.firstChild);break;case"select":s=typeof h.is=="string"?p.createElement("select",{is:h.is}):p.createElement("select"),h.multiple?s.multiple=!0:h.size&&(s.size=h.size);break;default:s=typeof h.is=="string"?p.createElement(c,{is:h.is}):p.createElement(c)}}s[_t]=a,s[Bt]=h;e:for(p=a.child;p!==null;){if(p.tag===5||p.tag===6)s.appendChild(p.stateNode);else if(p.tag!==4&&p.tag!==27&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===a)break e;for(;p.sibling===null;){if(p.return===null||p.return===a)break e;p=p.return}p.sibling.return=p.return,p=p.sibling}a.stateNode=s;e:switch(At(s,c,h),c){case"button":case"input":case"select":case"textarea":s=!!h.autoFocus;break e;case"img":s=!0;break e;default:s=!1}s&&is(a)}}return tt(a),a.flags&=-16777217,null;case 6:if(s&&a.stateNode!=null)s.memoizedProps!==h&&is(a);else{if(typeof h!="string"&&a.stateNode===null)throw Error(i(166));if(s=ue.current,Br(a)){if(s=a.stateNode,c=a.memoizedProps,h=null,p=Ot,p!==null)switch(p.tag){case 27:case 5:h=p.memoizedProps}s[_t]=a,s=!!(s.nodeValue===c||h!==null&&h.suppressHydrationWarning===!0||Ng(s.nodeValue,c)),s||rn(a)}else s=Xl(s).createTextNode(h),s[_t]=a,a.stateNode=s}return tt(a),null;case 13:if(h=a.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(p=Br(a),h!==null&&h.dehydrated!==null){if(s===null){if(!p)throw Error(i(318));if(p=a.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(i(317));p[_t]=a}else Fr(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;tt(a),p=!1}else p=vm(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=p),p=!0;if(!p)return a.flags&256?(es(a),a):(es(a),null)}if(es(a),(a.flags&128)!==0)return a.lanes=c,a;if(c=h!==null,s=s!==null&&s.memoizedState!==null,c){h=a.child,p=null,h.alternate!==null&&h.alternate.memoizedState!==null&&h.alternate.memoizedState.cachePool!==null&&(p=h.alternate.memoizedState.cachePool.pool);var x=null;h.memoizedState!==null&&h.memoizedState.cachePool!==null&&(x=h.memoizedState.cachePool.pool),x!==p&&(h.flags|=2048)}return c!==s&&c&&(a.child.flags|=8192),Pl(a,a.updateQueue),tt(a),null;case 4:return ct(),s===null&&af(a.stateNode.containerInfo),tt(a),null;case 10:return Zi(a.type),tt(a),null;case 19:if(K(ht),p=a.memoizedState,p===null)return tt(a),null;if(h=(a.flags&128)!==0,x=p.rendering,x===null)if(h)ta(p,!1);else{if(rt!==0||s!==null&&(s.flags&128)!==0)for(s=a.child;s!==null;){if(x=Cl(s),x!==null){for(a.flags|=128,ta(p,!1),s=x.updateQueue,a.updateQueue=s,Pl(a,s),a.subtreeFlags=0,s=c,c=a.child;c!==null;)mm(c,s),c=c.sibling;return G(ht,ht.current&1|2),a.child}s=s.sibling}p.tail!==null&&Qe()>Fl&&(a.flags|=128,h=!0,ta(p,!1),a.lanes=4194304)}else{if(!h)if(s=Cl(x),s!==null){if(a.flags|=128,h=!0,s=s.updateQueue,a.updateQueue=s,Pl(a,s),ta(p,!0),p.tail===null&&p.tailMode==="hidden"&&!x.alternate&&!je)return tt(a),null}else 2*Qe()-p.renderingStartTime>Fl&&c!==536870912&&(a.flags|=128,h=!0,ta(p,!1),a.lanes=4194304);p.isBackwards?(x.sibling=a.child,a.child=x):(s=p.last,s!==null?s.sibling=x:a.child=x,p.last=x)}return p.tail!==null?(a=p.tail,p.rendering=a,p.tail=a.sibling,p.renderingStartTime=Qe(),a.sibling=null,s=ht.current,G(ht,h?s&1|2:s&1),a):(tt(a),null);case 22:case 23:return es(a),lu(),h=a.memoizedState!==null,s!==null?s.memoizedState!==null!==h&&(a.flags|=8192):h&&(a.flags|=8192),h?(c&536870912)!==0&&(a.flags&128)===0&&(tt(a),a.subtreeFlags&6&&(a.flags|=8192)):tt(a),c=a.updateQueue,c!==null&&Pl(a,c.retryQueue),c=null,s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(c=s.memoizedState.cachePool.pool),h=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(h=a.memoizedState.cachePool.pool),h!==c&&(a.flags|=2048),s!==null&&K(on),null;case 24:return c=null,s!==null&&(c=s.memoizedState.cache),a.memoizedState.cache!==c&&(a.flags|=2048),Zi(dt),tt(a),null;case 25:return null;case 30:return null}throw Error(i(156,a.tag))}function $E(s,a){switch(Yc(a),a.tag){case 1:return s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 3:return Zi(dt),ct(),s=a.flags,(s&65536)!==0&&(s&128)===0?(a.flags=s&-65537|128,a):null;case 26:case 27:case 5:return Sn(a),null;case 13:if(es(a),s=a.memoizedState,s!==null&&s.dehydrated!==null){if(a.alternate===null)throw Error(i(340));Fr()}return s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 19:return K(ht),null;case 4:return ct(),null;case 10:return Zi(a.type),null;case 22:case 23:return es(a),lu(),s!==null&&K(on),s=a.flags,s&65536?(a.flags=s&-65537|128,a):null;case 24:return Zi(dt),null;case 25:return null;default:return null}}function $0(s,a){switch(Yc(a),a.tag){case 3:Zi(dt),ct();break;case 26:case 27:case 5:Sn(a);break;case 4:ct();break;case 13:es(a);break;case 19:K(ht);break;case 10:Zi(a.type);break;case 22:case 23:es(a),lu(),s!==null&&K(on);break;case 24:Zi(dt)}}function ia(s,a){try{var c=a.updateQueue,h=c!==null?c.lastEffect:null;if(h!==null){var p=h.next;c=p;do{if((c.tag&s)===s){h=void 0;var x=c.create,L=c.inst;h=x(),L.destroy=h}c=c.next}while(c!==p)}}catch(I){We(a,a.return,I)}}function As(s,a,c){try{var h=a.updateQueue,p=h!==null?h.lastEffect:null;if(p!==null){var x=p.next;h=x;do{if((h.tag&s)===s){var L=h.inst,I=L.destroy;if(I!==void 0){L.destroy=void 0,p=a;var M=c,X=I;try{X()}catch(ie){We(p,M,ie)}}}h=h.next}while(h!==x)}}catch(ie){We(a,a.return,ie)}}function G0(s){var a=s.updateQueue;if(a!==null){var c=s.stateNode;try{wm(a,c)}catch(h){We(s,s.return,h)}}}function H0(s,a,c){c.props=un(s.type,s.memoizedProps),c.state=s.memoizedState;try{c.componentWillUnmount()}catch(h){We(s,a,h)}}function sa(s,a){try{var c=s.ref;if(c!==null){switch(s.tag){case 26:case 27:case 5:var h=s.stateNode;break;case 30:h=s.stateNode;break;default:h=s.stateNode}typeof c=="function"?s.refCleanup=c(h):c.current=h}}catch(p){We(s,a,p)}}function wi(s,a){var c=s.ref,h=s.refCleanup;if(c!==null)if(typeof h=="function")try{h()}catch(p){We(s,a,p)}finally{s.refCleanup=null,s=s.alternate,s!=null&&(s.refCleanup=null)}else if(typeof c=="function")try{c(null)}catch(p){We(s,a,p)}else c.current=null}function V0(s){var a=s.type,c=s.memoizedProps,h=s.stateNode;try{e:switch(a){case"button":case"input":case"select":case"textarea":c.autoFocus&&h.focus();break e;case"img":c.src?h.src=c.src:c.srcSet&&(h.srcset=c.srcSet)}}catch(p){We(s,s.return,p)}}function Mu(s,a,c){try{var h=s.stateNode;oS(h,s.type,c,a),h[Bt]=a}catch(p){We(s,s.return,p)}}function z0(s){return s.tag===5||s.tag===3||s.tag===26||s.tag===27&&Os(s.type)||s.tag===4}function Pu(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||z0(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.tag===27&&Os(s.type)||s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function Uu(s,a,c){var h=s.tag;if(h===5||h===6)s=s.stateNode,a?(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c).insertBefore(s,a):(a=c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,a.appendChild(s),c=c._reactRootContainer,c!=null||a.onclick!==null||(a.onclick=ql));else if(h!==4&&(h===27&&Os(s.type)&&(c=s.stateNode,a=null),s=s.child,s!==null))for(Uu(s,a,c),s=s.sibling;s!==null;)Uu(s,a,c),s=s.sibling}function Ul(s,a,c){var h=s.tag;if(h===5||h===6)s=s.stateNode,a?c.insertBefore(s,a):c.appendChild(s);else if(h!==4&&(h===27&&Os(s.type)&&(c=s.stateNode),s=s.child,s!==null))for(Ul(s,a,c),s=s.sibling;s!==null;)Ul(s,a,c),s=s.sibling}function K0(s){var a=s.stateNode,c=s.memoizedProps;try{for(var h=s.type,p=a.attributes;p.length;)a.removeAttributeNode(p[0]);At(a,h,c),a[_t]=s,a[Bt]=c}catch(x){We(s,s.return,x)}}var ss=!1,lt=!1,Bu=!1,Y0=typeof WeakSet=="function"?WeakSet:Set,vt=null;function GE(s,a){if(s=s.containerInfo,cf=to,s=nm(s),Pc(s)){if("selectionStart"in s)var c={start:s.selectionStart,end:s.selectionEnd};else e:{c=(c=s.ownerDocument)&&c.defaultView||window;var h=c.getSelection&&c.getSelection();if(h&&h.rangeCount!==0){c=h.anchorNode;var p=h.anchorOffset,x=h.focusNode;h=h.focusOffset;try{c.nodeType,x.nodeType}catch{c=null;break e}var L=0,I=-1,M=-1,X=0,ie=0,le=s,Q=null;t:for(;;){for(var Z;le!==c||p!==0&&le.nodeType!==3||(I=L+p),le!==x||h!==0&&le.nodeType!==3||(M=L+h),le.nodeType===3&&(L+=le.nodeValue.length),(Z=le.firstChild)!==null;)Q=le,le=Z;for(;;){if(le===s)break t;if(Q===c&&++X===p&&(I=L),Q===x&&++ie===h&&(M=L),(Z=le.nextSibling)!==null)break;le=Q,Q=le.parentNode}le=Z}c=I===-1||M===-1?null:{start:I,end:M}}else c=null}c=c||{start:0,end:0}}else c=null;for(uf={focusedElem:s,selectionRange:c},to=!1,vt=a;vt!==null;)if(a=vt,s=a.child,(a.subtreeFlags&1024)!==0&&s!==null)s.return=a,vt=s;else for(;vt!==null;){switch(a=vt,x=a.alternate,s=a.flags,a.tag){case 0:break;case 11:case 15:break;case 1:if((s&1024)!==0&&x!==null){s=void 0,c=a,p=x.memoizedProps,x=x.memoizedState,h=c.stateNode;try{var Te=un(c.type,p,c.elementType===c.type);s=h.getSnapshotBeforeUpdate(Te,x),h.__reactInternalSnapshotBeforeUpdate=s}catch(Ee){We(c,c.return,Ee)}}break;case 3:if((s&1024)!==0){if(s=a.stateNode.containerInfo,c=s.nodeType,c===9)hf(s);else if(c===1)switch(s.nodeName){case"HEAD":case"HTML":case"BODY":hf(s);break;default:s.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((s&1024)!==0)throw Error(i(163))}if(s=a.sibling,s!==null){s.return=a.return,vt=s;break}vt=a.return}}function q0(s,a,c){var h=c.flags;switch(c.tag){case 0:case 11:case 15:Rs(s,c),h&4&&ia(5,c);break;case 1:if(Rs(s,c),h&4)if(s=c.stateNode,a===null)try{s.componentDidMount()}catch(L){We(c,c.return,L)}else{var p=un(c.type,a.memoizedProps);a=a.memoizedState;try{s.componentDidUpdate(p,a,s.__reactInternalSnapshotBeforeUpdate)}catch(L){We(c,c.return,L)}}h&64&&G0(c),h&512&&sa(c,c.return);break;case 3:if(Rs(s,c),h&64&&(s=c.updateQueue,s!==null)){if(a=null,c.child!==null)switch(c.child.tag){case 27:case 5:a=c.child.stateNode;break;case 1:a=c.child.stateNode}try{wm(s,a)}catch(L){We(c,c.return,L)}}break;case 27:a===null&&h&4&&K0(c);case 26:case 5:Rs(s,c),a===null&&h&4&&V0(c),h&512&&sa(c,c.return);break;case 12:Rs(s,c);break;case 13:Rs(s,c),h&4&&W0(s,c),h&64&&(s=c.memoizedState,s!==null&&(s=s.dehydrated,s!==null&&(c=WE.bind(null,c),gS(s,c))));break;case 22:if(h=c.memoizedState!==null||ss,!h){a=a!==null&&a.memoizedState!==null||lt,p=ss;var x=lt;ss=h,(lt=a)&&!x?Ls(s,c,(c.subtreeFlags&8772)!==0):Rs(s,c),ss=p,lt=x}break;case 30:break;default:Rs(s,c)}}function X0(s){var a=s.alternate;a!==null&&(s.alternate=null,X0(a)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(a=s.stateNode,a!==null&&yc(a)),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}var Je=null,$t=!1;function ns(s,a,c){for(c=c.child;c!==null;)Q0(s,a,c),c=c.sibling}function Q0(s,a,c){if(Rt&&typeof Rt.onCommitFiberUnmount=="function")try{Rt.onCommitFiberUnmount(gi,c)}catch{}switch(c.tag){case 26:lt||wi(c,a),ns(s,a,c),c.memoizedState?c.memoizedState.count--:c.stateNode&&(c=c.stateNode,c.parentNode.removeChild(c));break;case 27:lt||wi(c,a);var h=Je,p=$t;Os(c.type)&&(Je=c.stateNode,$t=!1),ns(s,a,c),da(c.stateNode),Je=h,$t=p;break;case 5:lt||wi(c,a);case 6:if(h=Je,p=$t,Je=null,ns(s,a,c),Je=h,$t=p,Je!==null)if($t)try{(Je.nodeType===9?Je.body:Je.nodeName==="HTML"?Je.ownerDocument.body:Je).removeChild(c.stateNode)}catch(x){We(c,a,x)}else try{Je.removeChild(c.stateNode)}catch(x){We(c,a,x)}break;case 18:Je!==null&&($t?(s=Je,Bg(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,c.stateNode),Ea(s)):Bg(Je,c.stateNode));break;case 4:h=Je,p=$t,Je=c.stateNode.containerInfo,$t=!0,ns(s,a,c),Je=h,$t=p;break;case 0:case 11:case 14:case 15:lt||As(2,c,a),lt||As(4,c,a),ns(s,a,c);break;case 1:lt||(wi(c,a),h=c.stateNode,typeof h.componentWillUnmount=="function"&&H0(c,a,h)),ns(s,a,c);break;case 21:ns(s,a,c);break;case 22:lt=(h=lt)||c.memoizedState!==null,ns(s,a,c),lt=h;break;default:ns(s,a,c)}}function W0(s,a){if(a.memoizedState===null&&(s=a.alternate,s!==null&&(s=s.memoizedState,s!==null&&(s=s.dehydrated,s!==null))))try{Ea(s)}catch(c){We(a,a.return,c)}}function HE(s){switch(s.tag){case 13:case 19:var a=s.stateNode;return a===null&&(a=s.stateNode=new Y0),a;case 22:return s=s.stateNode,a=s._retryCache,a===null&&(a=s._retryCache=new Y0),a;default:throw Error(i(435,s.tag))}}function Fu(s,a){var c=HE(s);a.forEach(function(h){var p=ZE.bind(null,s,h);c.has(h)||(c.add(h),h.then(p,p))})}function Xt(s,a){var c=a.deletions;if(c!==null)for(var h=0;h<c.length;h++){var p=c[h],x=s,L=a,I=L;e:for(;I!==null;){switch(I.tag){case 27:if(Os(I.type)){Je=I.stateNode,$t=!1;break e}break;case 5:Je=I.stateNode,$t=!1;break e;case 3:case 4:Je=I.stateNode.containerInfo,$t=!0;break e}I=I.return}if(Je===null)throw Error(i(160));Q0(x,L,p),Je=null,$t=!1,x=p.alternate,x!==null&&(x.return=null),p.return=null}if(a.subtreeFlags&13878)for(a=a.child;a!==null;)Z0(a,s),a=a.sibling}var yi=null;function Z0(s,a){var c=s.alternate,h=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:Xt(a,s),Qt(s),h&4&&(As(3,s,s.return),ia(3,s),As(5,s,s.return));break;case 1:Xt(a,s),Qt(s),h&512&&(lt||c===null||wi(c,c.return)),h&64&&ss&&(s=s.updateQueue,s!==null&&(h=s.callbacks,h!==null&&(c=s.shared.hiddenCallbacks,s.shared.hiddenCallbacks=c===null?h:c.concat(h))));break;case 26:var p=yi;if(Xt(a,s),Qt(s),h&512&&(lt||c===null||wi(c,c.return)),h&4){var x=c!==null?c.memoizedState:null;if(h=s.memoizedState,c===null)if(h===null)if(s.stateNode===null){e:{h=s.type,c=s.memoizedProps,p=p.ownerDocument||p;t:switch(h){case"title":x=p.getElementsByTagName("title")[0],(!x||x[_r]||x[_t]||x.namespaceURI==="http://www.w3.org/2000/svg"||x.hasAttribute("itemprop"))&&(x=p.createElement(h),p.head.insertBefore(x,p.querySelector("head > title"))),At(x,h,c),x[_t]=s,pt(x),h=x;break e;case"link":var L=Kg("link","href",p).get(h+(c.href||""));if(L){for(var I=0;I<L.length;I++)if(x=L[I],x.getAttribute("href")===(c.href==null||c.href===""?null:c.href)&&x.getAttribute("rel")===(c.rel==null?null:c.rel)&&x.getAttribute("title")===(c.title==null?null:c.title)&&x.getAttribute("crossorigin")===(c.crossOrigin==null?null:c.crossOrigin)){L.splice(I,1);break t}}x=p.createElement(h),At(x,h,c),p.head.appendChild(x);break;case"meta":if(L=Kg("meta","content",p).get(h+(c.content||""))){for(I=0;I<L.length;I++)if(x=L[I],x.getAttribute("content")===(c.content==null?null:""+c.content)&&x.getAttribute("name")===(c.name==null?null:c.name)&&x.getAttribute("property")===(c.property==null?null:c.property)&&x.getAttribute("http-equiv")===(c.httpEquiv==null?null:c.httpEquiv)&&x.getAttribute("charset")===(c.charSet==null?null:c.charSet)){L.splice(I,1);break t}}x=p.createElement(h),At(x,h,c),p.head.appendChild(x);break;default:throw Error(i(468,h))}x[_t]=s,pt(x),h=x}s.stateNode=h}else Yg(p,s.type,s.stateNode);else s.stateNode=zg(p,h,s.memoizedProps);else x!==h?(x===null?c.stateNode!==null&&(c=c.stateNode,c.parentNode.removeChild(c)):x.count--,h===null?Yg(p,s.type,s.stateNode):zg(p,h,s.memoizedProps)):h===null&&s.stateNode!==null&&Mu(s,s.memoizedProps,c.memoizedProps)}break;case 27:Xt(a,s),Qt(s),h&512&&(lt||c===null||wi(c,c.return)),c!==null&&h&4&&Mu(s,s.memoizedProps,c.memoizedProps);break;case 5:if(Xt(a,s),Qt(s),h&512&&(lt||c===null||wi(c,c.return)),s.flags&32){p=s.stateNode;try{In(p,"")}catch(Z){We(s,s.return,Z)}}h&4&&s.stateNode!=null&&(p=s.memoizedProps,Mu(s,p,c!==null?c.memoizedProps:p)),h&1024&&(Bu=!0);break;case 6:if(Xt(a,s),Qt(s),h&4){if(s.stateNode===null)throw Error(i(162));h=s.memoizedProps,c=s.stateNode;try{c.nodeValue=h}catch(Z){We(s,s.return,Z)}}break;case 3:if(Zl=null,p=yi,yi=Ql(a.containerInfo),Xt(a,s),yi=p,Qt(s),h&4&&c!==null&&c.memoizedState.isDehydrated)try{Ea(a.containerInfo)}catch(Z){We(s,s.return,Z)}Bu&&(Bu=!1,J0(s));break;case 4:h=yi,yi=Ql(s.stateNode.containerInfo),Xt(a,s),Qt(s),yi=h;break;case 12:Xt(a,s),Qt(s);break;case 13:Xt(a,s),Qt(s),s.child.flags&8192&&s.memoizedState!==null!=(c!==null&&c.memoizedState!==null)&&(zu=Qe()),h&4&&(h=s.updateQueue,h!==null&&(s.updateQueue=null,Fu(s,h)));break;case 22:p=s.memoizedState!==null;var M=c!==null&&c.memoizedState!==null,X=ss,ie=lt;if(ss=X||p,lt=ie||M,Xt(a,s),lt=ie,ss=X,Qt(s),h&8192)e:for(a=s.stateNode,a._visibility=p?a._visibility&-2:a._visibility|1,p&&(c===null||M||ss||lt||fn(s)),c=null,a=s;;){if(a.tag===5||a.tag===26){if(c===null){M=c=a;try{if(x=M.stateNode,p)L=x.style,typeof L.setProperty=="function"?L.setProperty("display","none","important"):L.display="none";else{I=M.stateNode;var le=M.memoizedProps.style,Q=le!=null&&le.hasOwnProperty("display")?le.display:null;I.style.display=Q==null||typeof Q=="boolean"?"":(""+Q).trim()}}catch(Z){We(M,M.return,Z)}}}else if(a.tag===6){if(c===null){M=a;try{M.stateNode.nodeValue=p?"":M.memoizedProps}catch(Z){We(M,M.return,Z)}}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===s)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===s)break e;for(;a.sibling===null;){if(a.return===null||a.return===s)break e;c===a&&(c=null),a=a.return}c===a&&(c=null),a.sibling.return=a.return,a=a.sibling}h&4&&(h=s.updateQueue,h!==null&&(c=h.retryQueue,c!==null&&(h.retryQueue=null,Fu(s,c))));break;case 19:Xt(a,s),Qt(s),h&4&&(h=s.updateQueue,h!==null&&(s.updateQueue=null,Fu(s,h)));break;case 30:break;case 21:break;default:Xt(a,s),Qt(s)}}function Qt(s){var a=s.flags;if(a&2){try{for(var c,h=s.return;h!==null;){if(z0(h)){c=h;break}h=h.return}if(c==null)throw Error(i(160));switch(c.tag){case 27:var p=c.stateNode,x=Pu(s);Ul(s,x,p);break;case 5:var L=c.stateNode;c.flags&32&&(In(L,""),c.flags&=-33);var I=Pu(s);Ul(s,I,L);break;case 3:case 4:var M=c.stateNode.containerInfo,X=Pu(s);Uu(s,X,M);break;default:throw Error(i(161))}}catch(ie){We(s,s.return,ie)}s.flags&=-3}a&4096&&(s.flags&=-4097)}function J0(s){if(s.subtreeFlags&1024)for(s=s.child;s!==null;){var a=s;J0(a),a.tag===5&&a.flags&1024&&a.stateNode.reset(),s=s.sibling}}function Rs(s,a){if(a.subtreeFlags&8772)for(a=a.child;a!==null;)q0(s,a.alternate,a),a=a.sibling}function fn(s){for(s=s.child;s!==null;){var a=s;switch(a.tag){case 0:case 11:case 14:case 15:As(4,a,a.return),fn(a);break;case 1:wi(a,a.return);var c=a.stateNode;typeof c.componentWillUnmount=="function"&&H0(a,a.return,c),fn(a);break;case 27:da(a.stateNode);case 26:case 5:wi(a,a.return),fn(a);break;case 22:a.memoizedState===null&&fn(a);break;case 30:fn(a);break;default:fn(a)}s=s.sibling}}function Ls(s,a,c){for(c=c&&(a.subtreeFlags&8772)!==0,a=a.child;a!==null;){var h=a.alternate,p=s,x=a,L=x.flags;switch(x.tag){case 0:case 11:case 15:Ls(p,x,c),ia(4,x);break;case 1:if(Ls(p,x,c),h=x,p=h.stateNode,typeof p.componentDidMount=="function")try{p.componentDidMount()}catch(X){We(h,h.return,X)}if(h=x,p=h.updateQueue,p!==null){var I=h.stateNode;try{var M=p.shared.hiddenCallbacks;if(M!==null)for(p.shared.hiddenCallbacks=null,p=0;p<M.length;p++)Dm(M[p],I)}catch(X){We(h,h.return,X)}}c&&L&64&&G0(x),sa(x,x.return);break;case 27:K0(x);case 26:case 5:Ls(p,x,c),c&&h===null&&L&4&&V0(x),sa(x,x.return);break;case 12:Ls(p,x,c);break;case 13:Ls(p,x,c),c&&L&4&&W0(p,x);break;case 22:x.memoizedState===null&&Ls(p,x,c),sa(x,x.return);break;case 30:break;default:Ls(p,x,c)}a=a.sibling}}function ju(s,a){var c=null;s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(c=s.memoizedState.cachePool.pool),s=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(s=a.memoizedState.cachePool.pool),s!==c&&(s!=null&&s.refCount++,c!=null&&Gr(c))}function $u(s,a){s=null,a.alternate!==null&&(s=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==s&&(a.refCount++,s!=null&&Gr(s))}function Ii(s,a,c,h){if(a.subtreeFlags&10256)for(a=a.child;a!==null;)eg(s,a,c,h),a=a.sibling}function eg(s,a,c,h){var p=a.flags;switch(a.tag){case 0:case 11:case 15:Ii(s,a,c,h),p&2048&&ia(9,a);break;case 1:Ii(s,a,c,h);break;case 3:Ii(s,a,c,h),p&2048&&(s=null,a.alternate!==null&&(s=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==s&&(a.refCount++,s!=null&&Gr(s)));break;case 12:if(p&2048){Ii(s,a,c,h),s=a.stateNode;try{var x=a.memoizedProps,L=x.id,I=x.onPostCommit;typeof I=="function"&&I(L,a.alternate===null?"mount":"update",s.passiveEffectDuration,-0)}catch(M){We(a,a.return,M)}}else Ii(s,a,c,h);break;case 13:Ii(s,a,c,h);break;case 23:break;case 22:x=a.stateNode,L=a.alternate,a.memoizedState!==null?x._visibility&2?Ii(s,a,c,h):na(s,a):x._visibility&2?Ii(s,a,c,h):(x._visibility|=2,Xn(s,a,c,h,(a.subtreeFlags&10256)!==0)),p&2048&&ju(L,a);break;case 24:Ii(s,a,c,h),p&2048&&$u(a.alternate,a);break;default:Ii(s,a,c,h)}}function Xn(s,a,c,h,p){for(p=p&&(a.subtreeFlags&10256)!==0,a=a.child;a!==null;){var x=s,L=a,I=c,M=h,X=L.flags;switch(L.tag){case 0:case 11:case 15:Xn(x,L,I,M,p),ia(8,L);break;case 23:break;case 22:var ie=L.stateNode;L.memoizedState!==null?ie._visibility&2?Xn(x,L,I,M,p):na(x,L):(ie._visibility|=2,Xn(x,L,I,M,p)),p&&X&2048&&ju(L.alternate,L);break;case 24:Xn(x,L,I,M,p),p&&X&2048&&$u(L.alternate,L);break;default:Xn(x,L,I,M,p)}a=a.sibling}}function na(s,a){if(a.subtreeFlags&10256)for(a=a.child;a!==null;){var c=s,h=a,p=h.flags;switch(h.tag){case 22:na(c,h),p&2048&&ju(h.alternate,h);break;case 24:na(c,h),p&2048&&$u(h.alternate,h);break;default:na(c,h)}a=a.sibling}}var ra=8192;function Qn(s){if(s.subtreeFlags&ra)for(s=s.child;s!==null;)tg(s),s=s.sibling}function tg(s){switch(s.tag){case 26:Qn(s),s.flags&ra&&s.memoizedState!==null&&DS(yi,s.memoizedState,s.memoizedProps);break;case 5:Qn(s);break;case 3:case 4:var a=yi;yi=Ql(s.stateNode.containerInfo),Qn(s),yi=a;break;case 22:s.memoizedState===null&&(a=s.alternate,a!==null&&a.memoizedState!==null?(a=ra,ra=16777216,Qn(s),ra=a):Qn(s));break;default:Qn(s)}}function ig(s){var a=s.alternate;if(a!==null&&(s=a.child,s!==null)){a.child=null;do a=s.sibling,s.sibling=null,s=a;while(s!==null)}}function aa(s){var a=s.deletions;if((s.flags&16)!==0){if(a!==null)for(var c=0;c<a.length;c++){var h=a[c];vt=h,ng(h,s)}ig(s)}if(s.subtreeFlags&10256)for(s=s.child;s!==null;)sg(s),s=s.sibling}function sg(s){switch(s.tag){case 0:case 11:case 15:aa(s),s.flags&2048&&As(9,s,s.return);break;case 3:aa(s);break;case 12:aa(s);break;case 22:var a=s.stateNode;s.memoizedState!==null&&a._visibility&2&&(s.return===null||s.return.tag!==13)?(a._visibility&=-3,Bl(s)):aa(s);break;default:aa(s)}}function Bl(s){var a=s.deletions;if((s.flags&16)!==0){if(a!==null)for(var c=0;c<a.length;c++){var h=a[c];vt=h,ng(h,s)}ig(s)}for(s=s.child;s!==null;){switch(a=s,a.tag){case 0:case 11:case 15:As(8,a,a.return),Bl(a);break;case 22:c=a.stateNode,c._visibility&2&&(c._visibility&=-3,Bl(a));break;default:Bl(a)}s=s.sibling}}function ng(s,a){for(;vt!==null;){var c=vt;switch(c.tag){case 0:case 11:case 15:As(8,c,a);break;case 23:case 22:if(c.memoizedState!==null&&c.memoizedState.cachePool!==null){var h=c.memoizedState.cachePool.pool;h!=null&&h.refCount++}break;case 24:Gr(c.memoizedState.cache)}if(h=c.child,h!==null)h.return=c,vt=h;else e:for(c=s;vt!==null;){h=vt;var p=h.sibling,x=h.return;if(X0(h),h===c){vt=null;break e}if(p!==null){p.return=x,vt=p;break e}vt=x}}}var VE={getCacheForType:function(s){var a=Dt(dt),c=a.data.get(s);return c===void 0&&(c=s(),a.data.set(s,c)),c}},zE=typeof WeakMap=="function"?WeakMap:Map,He=0,Ze=null,Oe=null,Be=0,Ve=0,Wt=null,_s=!1,Wn=!1,Gu=!1,rs=0,rt=0,Ds=0,dn=0,Hu=0,ci=0,Zn=0,la=null,Gt=null,Vu=!1,zu=0,Fl=1/0,jl=null,ws=null,bt=0,Is=null,Jn=null,er=0,Ku=0,Yu=null,rg=null,oa=0,qu=null;function Zt(){if((He&2)!==0&&Be!==0)return Be&-Be;if(P.T!==null){var s=$n;return s!==0?s:tf()}return Sh()}function ag(){ci===0&&(ci=(Be&536870912)===0||je?yh():536870912);var s=oi.current;return s!==null&&(s.flags|=32),ci}function Jt(s,a,c){(s===Ze&&(Ve===2||Ve===9)||s.cancelPendingCommit!==null)&&(tr(s,0),Cs(s,Be,ci,!1)),Lr(s,c),((He&2)===0||s!==Ze)&&(s===Ze&&((He&2)===0&&(dn|=c),rt===4&&Cs(s,Be,ci,!1)),Ci(s))}function lg(s,a,c){if((He&6)!==0)throw Error(i(327));var h=!c&&(a&124)===0&&(a&s.expiredLanes)===0||Rr(s,a),p=h?qE(s,a):Wu(s,a,!0),x=h;do{if(p===0){Wn&&!h&&Cs(s,a,0,!1);break}else{if(c=s.current.alternate,x&&!KE(c)){p=Wu(s,a,!1),x=!1;continue}if(p===2){if(x=a,s.errorRecoveryDisabledLanes&x)var L=0;else L=s.pendingLanes&-536870913,L=L!==0?L:L&536870912?536870912:0;if(L!==0){a=L;e:{var I=s;p=la;var M=I.current.memoizedState.isDehydrated;if(M&&(tr(I,L).flags|=256),L=Wu(I,L,!1),L!==2){if(Gu&&!M){I.errorRecoveryDisabledLanes|=x,dn|=x,p=4;break e}x=Gt,Gt=p,x!==null&&(Gt===null?Gt=x:Gt.push.apply(Gt,x))}p=L}if(x=!1,p!==2)continue}}if(p===1){tr(s,0),Cs(s,a,0,!0);break}e:{switch(h=s,x=p,x){case 0:case 1:throw Error(i(345));case 4:if((a&4194048)!==a)break;case 6:Cs(h,a,ci,!_s);break e;case 2:Gt=null;break;case 3:case 5:break;default:throw Error(i(329))}if((a&62914560)===a&&(p=zu+300-Qe(),10<p)){if(Cs(h,a,ci,!_s),Wa(h,0,!0)!==0)break e;h.timeoutHandle=Pg(og.bind(null,h,c,Gt,jl,Vu,a,ci,dn,Zn,_s,x,2,-0,0),p);break e}og(h,c,Gt,jl,Vu,a,ci,dn,Zn,_s,x,0,-0,0)}}break}while(!0);Ci(s)}function og(s,a,c,h,p,x,L,I,M,X,ie,le,Q,Z){if(s.timeoutHandle=-1,le=a.subtreeFlags,(le&8192||(le&16785408)===16785408)&&(ga={stylesheets:null,count:0,unsuspend:_S},tg(a),le=wS(),le!==null)){s.cancelPendingCommit=le(gg.bind(null,s,a,x,c,h,p,L,I,M,ie,1,Q,Z)),Cs(s,x,L,!X);return}gg(s,a,x,c,h,p,L,I,M)}function KE(s){for(var a=s;;){var c=a.tag;if((c===0||c===11||c===15)&&a.flags&16384&&(c=a.updateQueue,c!==null&&(c=c.stores,c!==null)))for(var h=0;h<c.length;h++){var p=c[h],x=p.getSnapshot;p=p.value;try{if(!Yt(x(),p))return!1}catch{return!1}}if(c=a.child,a.subtreeFlags&16384&&c!==null)c.return=a,a=c;else{if(a===s)break;for(;a.sibling===null;){if(a.return===null||a.return===s)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function Cs(s,a,c,h){a&=~Hu,a&=~dn,s.suspendedLanes|=a,s.pingedLanes&=~a,h&&(s.warmLanes|=a),h=s.expirationTimes;for(var p=a;0<p;){var x=31-Lt(p),L=1<<x;h[x]=-1,p&=~L}c!==0&&xh(s,c,a)}function $l(){return(He&6)===0?(ca(0),!1):!0}function Xu(){if(Oe!==null){if(Ve===0)var s=Oe.return;else s=Oe,Wi=an=null,du(s),Yn=null,Jr=0,s=Oe;for(;s!==null;)$0(s.alternate,s),s=s.return;Oe=null}}function tr(s,a){var c=s.timeoutHandle;c!==-1&&(s.timeoutHandle=-1,uS(c)),c=s.cancelPendingCommit,c!==null&&(s.cancelPendingCommit=null,c()),Xu(),Ze=s,Oe=c=qi(s.current,null),Be=a,Ve=0,Wt=null,_s=!1,Wn=Rr(s,a),Gu=!1,Zn=ci=Hu=dn=Ds=rt=0,Gt=la=null,Vu=!1,(a&8)!==0&&(a|=a&32);var h=s.entangledLanes;if(h!==0)for(s=s.entanglements,h&=a;0<h;){var p=31-Lt(h),x=1<<p;a|=s[p],h&=~x}return rs=a,cl(),c}function cg(s,a){we=null,P.H=Dl,a===Vr||a===vl?(a=Lm(),Ve=3):a===bm?(a=Lm(),Ve=4):Ve=a===_0?8:a!==null&&typeof a=="object"&&typeof a.then=="function"?6:1,Wt=a,Oe===null&&(rt=1,Nl(s,ni(a,s.current)))}function ug(){var s=P.H;return P.H=Dl,s===null?Dl:s}function fg(){var s=P.A;return P.A=VE,s}function Qu(){rt=4,_s||(Be&4194048)!==Be&&oi.current!==null||(Wn=!0),(Ds&134217727)===0&&(dn&134217727)===0||Ze===null||Cs(Ze,Be,ci,!1)}function Wu(s,a,c){var h=He;He|=2;var p=ug(),x=fg();(Ze!==s||Be!==a)&&(jl=null,tr(s,a)),a=!1;var L=rt;e:do try{if(Ve!==0&&Oe!==null){var I=Oe,M=Wt;switch(Ve){case 8:Xu(),L=6;break e;case 3:case 2:case 9:case 6:oi.current===null&&(a=!0);var X=Ve;if(Ve=0,Wt=null,ir(s,I,M,X),c&&Wn){L=0;break e}break;default:X=Ve,Ve=0,Wt=null,ir(s,I,M,X)}}YE(),L=rt;break}catch(ie){cg(s,ie)}while(!0);return a&&s.shellSuspendCounter++,Wi=an=null,He=h,P.H=p,P.A=x,Oe===null&&(Ze=null,Be=0,cl()),L}function YE(){for(;Oe!==null;)dg(Oe)}function qE(s,a){var c=He;He|=2;var h=ug(),p=fg();Ze!==s||Be!==a?(jl=null,Fl=Qe()+500,tr(s,a)):Wn=Rr(s,a);e:do try{if(Ve!==0&&Oe!==null){a=Oe;var x=Wt;t:switch(Ve){case 1:Ve=0,Wt=null,ir(s,a,x,1);break;case 2:case 9:if(Am(x)){Ve=0,Wt=null,hg(a);break}a=function(){Ve!==2&&Ve!==9||Ze!==s||(Ve=7),Ci(s)},x.then(a,a);break e;case 3:Ve=7;break e;case 4:Ve=5;break e;case 7:Am(x)?(Ve=0,Wt=null,hg(a)):(Ve=0,Wt=null,ir(s,a,x,7));break;case 5:var L=null;switch(Oe.tag){case 26:L=Oe.memoizedState;case 5:case 27:var I=Oe;if(!L||qg(L)){Ve=0,Wt=null;var M=I.sibling;if(M!==null)Oe=M;else{var X=I.return;X!==null?(Oe=X,Gl(X)):Oe=null}break t}}Ve=0,Wt=null,ir(s,a,x,5);break;case 6:Ve=0,Wt=null,ir(s,a,x,6);break;case 8:Xu(),rt=6;break e;default:throw Error(i(462))}}XE();break}catch(ie){cg(s,ie)}while(!0);return Wi=an=null,P.H=h,P.A=p,He=c,Oe!==null?0:(Ze=null,Be=0,cl(),rt)}function XE(){for(;Oe!==null&&!ph();)dg(Oe)}function dg(s){var a=F0(s.alternate,s,rs);s.memoizedProps=s.pendingProps,a===null?Gl(s):Oe=a}function hg(s){var a=s,c=a.alternate;switch(a.tag){case 15:case 0:a=N0(c,a,a.pendingProps,a.type,void 0,Be);break;case 11:a=N0(c,a,a.pendingProps,a.type.render,a.ref,Be);break;case 5:du(a);default:$0(c,a),a=Oe=mm(a,rs),a=F0(c,a,rs)}s.memoizedProps=s.pendingProps,a===null?Gl(s):Oe=a}function ir(s,a,c,h){Wi=an=null,du(a),Yn=null,Jr=0;var p=a.return;try{if(BE(s,p,a,c,Be)){rt=1,Nl(s,ni(c,s.current)),Oe=null;return}}catch(x){if(p!==null)throw Oe=p,x;rt=1,Nl(s,ni(c,s.current)),Oe=null;return}a.flags&32768?(je||h===1?s=!0:Wn||(Be&536870912)!==0?s=!1:(_s=s=!0,(h===2||h===9||h===3||h===6)&&(h=oi.current,h!==null&&h.tag===13&&(h.flags|=16384))),mg(a,s)):Gl(a)}function Gl(s){var a=s;do{if((a.flags&32768)!==0){mg(a,_s);return}s=a.return;var c=jE(a.alternate,a,rs);if(c!==null){Oe=c;return}if(a=a.sibling,a!==null){Oe=a;return}Oe=a=s}while(a!==null);rt===0&&(rt=5)}function mg(s,a){do{var c=$E(s.alternate,s);if(c!==null){c.flags&=32767,Oe=c;return}if(c=s.return,c!==null&&(c.flags|=32768,c.subtreeFlags=0,c.deletions=null),!a&&(s=s.sibling,s!==null)){Oe=s;return}Oe=s=c}while(s!==null);rt=6,Oe=null}function gg(s,a,c,h,p,x,L,I,M){s.cancelPendingCommit=null;do Hl();while(bt!==0);if((He&6)!==0)throw Error(i(327));if(a!==null){if(a===s.current)throw Error(i(177));if(x=a.lanes|a.childLanes,x|=$c,_1(s,c,x,L,I,M),s===Ze&&(Oe=Ze=null,Be=0),Jn=a,Is=s,er=c,Ku=x,Yu=p,rg=h,(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?(s.callbackNode=null,s.callbackPriority=0,JE(mi,function(){return Eg(),null})):(s.callbackNode=null,s.callbackPriority=0),h=(a.flags&13878)!==0,(a.subtreeFlags&13878)!==0||h){h=P.T,P.T=null,p=W.p,W.p=2,L=He,He|=4;try{GE(s,a,c)}finally{He=L,W.p=p,P.T=h}}bt=1,pg(),yg(),vg()}}function pg(){if(bt===1){bt=0;var s=Is,a=Jn,c=(a.flags&13878)!==0;if((a.subtreeFlags&13878)!==0||c){c=P.T,P.T=null;var h=W.p;W.p=2;var p=He;He|=4;try{Z0(a,s);var x=uf,L=nm(s.containerInfo),I=x.focusedElem,M=x.selectionRange;if(L!==I&&I&&I.ownerDocument&&sm(I.ownerDocument.documentElement,I)){if(M!==null&&Pc(I)){var X=M.start,ie=M.end;if(ie===void 0&&(ie=X),"selectionStart"in I)I.selectionStart=X,I.selectionEnd=Math.min(ie,I.value.length);else{var le=I.ownerDocument||document,Q=le&&le.defaultView||window;if(Q.getSelection){var Z=Q.getSelection(),Te=I.textContent.length,Ee=Math.min(M.start,Te),Xe=M.end===void 0?Ee:Math.min(M.end,Te);!Z.extend&&Ee>Xe&&(L=Xe,Xe=Ee,Ee=L);var H=im(I,Ee),j=im(I,Xe);if(H&&j&&(Z.rangeCount!==1||Z.anchorNode!==H.node||Z.anchorOffset!==H.offset||Z.focusNode!==j.node||Z.focusOffset!==j.offset)){var Y=le.createRange();Y.setStart(H.node,H.offset),Z.removeAllRanges(),Ee>Xe?(Z.addRange(Y),Z.extend(j.node,j.offset)):(Y.setEnd(j.node,j.offset),Z.addRange(Y))}}}}for(le=[],Z=I;Z=Z.parentNode;)Z.nodeType===1&&le.push({element:Z,left:Z.scrollLeft,top:Z.scrollTop});for(typeof I.focus=="function"&&I.focus(),I=0;I<le.length;I++){var re=le[I];re.element.scrollLeft=re.left,re.element.scrollTop=re.top}}to=!!cf,uf=cf=null}finally{He=p,W.p=h,P.T=c}}s.current=a,bt=2}}function yg(){if(bt===2){bt=0;var s=Is,a=Jn,c=(a.flags&8772)!==0;if((a.subtreeFlags&8772)!==0||c){c=P.T,P.T=null;var h=W.p;W.p=2;var p=He;He|=4;try{q0(s,a.alternate,a)}finally{He=p,W.p=h,P.T=c}}bt=3}}function vg(){if(bt===4||bt===3){bt=0,Ue();var s=Is,a=Jn,c=er,h=rg;(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?bt=5:(bt=0,Jn=Is=null,xg(s,s.pendingLanes));var p=s.pendingLanes;if(p===0&&(ws=null),gc(c),a=a.stateNode,Rt&&typeof Rt.onCommitFiberRoot=="function")try{Rt.onCommitFiberRoot(gi,a,void 0,(a.current.flags&128)===128)}catch{}if(h!==null){a=P.T,p=W.p,W.p=2,P.T=null;try{for(var x=s.onRecoverableError,L=0;L<h.length;L++){var I=h[L];x(I.value,{componentStack:I.stack})}}finally{P.T=a,W.p=p}}(er&3)!==0&&Hl(),Ci(s),p=s.pendingLanes,(c&4194090)!==0&&(p&42)!==0?s===qu?oa++:(oa=0,qu=s):oa=0,ca(0)}}function xg(s,a){(s.pooledCacheLanes&=a)===0&&(a=s.pooledCache,a!=null&&(s.pooledCache=null,Gr(a)))}function Hl(s){return pg(),yg(),vg(),Eg()}function Eg(){if(bt!==5)return!1;var s=Is,a=Ku;Ku=0;var c=gc(er),h=P.T,p=W.p;try{W.p=32>c?32:c,P.T=null,c=Yu,Yu=null;var x=Is,L=er;if(bt=0,Jn=Is=null,er=0,(He&6)!==0)throw Error(i(331));var I=He;if(He|=4,sg(x.current),eg(x,x.current,L,c),He=I,ca(0,!1),Rt&&typeof Rt.onPostCommitFiberRoot=="function")try{Rt.onPostCommitFiberRoot(gi,x)}catch{}return!0}finally{W.p=p,P.T=h,xg(s,a)}}function Sg(s,a,c){a=ni(c,a),a=Lu(s.stateNode,a,2),s=Es(s,a,2),s!==null&&(Lr(s,2),Ci(s))}function We(s,a,c){if(s.tag===3)Sg(s,s,c);else for(;a!==null;){if(a.tag===3){Sg(a,s,c);break}else if(a.tag===1){var h=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof h.componentDidCatch=="function"&&(ws===null||!ws.has(h))){s=ni(c,s),c=R0(2),h=Es(a,c,2),h!==null&&(L0(c,h,a,s),Lr(h,2),Ci(h));break}}a=a.return}}function Zu(s,a,c){var h=s.pingCache;if(h===null){h=s.pingCache=new zE;var p=new Set;h.set(a,p)}else p=h.get(a),p===void 0&&(p=new Set,h.set(a,p));p.has(c)||(Gu=!0,p.add(c),s=QE.bind(null,s,a,c),a.then(s,s))}function QE(s,a,c){var h=s.pingCache;h!==null&&h.delete(a),s.pingedLanes|=s.suspendedLanes&c,s.warmLanes&=~c,Ze===s&&(Be&c)===c&&(rt===4||rt===3&&(Be&62914560)===Be&&300>Qe()-zu?(He&2)===0&&tr(s,0):Hu|=c,Zn===Be&&(Zn=0)),Ci(s)}function Tg(s,a){a===0&&(a=vh()),s=Un(s,a),s!==null&&(Lr(s,a),Ci(s))}function WE(s){var a=s.memoizedState,c=0;a!==null&&(c=a.retryLane),Tg(s,c)}function ZE(s,a){var c=0;switch(s.tag){case 13:var h=s.stateNode,p=s.memoizedState;p!==null&&(c=p.retryLane);break;case 19:h=s.stateNode;break;case 22:h=s.stateNode._retryCache;break;default:throw Error(i(314))}h!==null&&h.delete(a),Tg(s,c)}function JE(s,a){return Ks(s,a)}var Vl=null,sr=null,Ju=!1,zl=!1,ef=!1,hn=0;function Ci(s){s!==sr&&s.next===null&&(sr===null?Vl=sr=s:sr=sr.next=s),zl=!0,Ju||(Ju=!0,tS())}function ca(s,a){if(!ef&&zl){ef=!0;do for(var c=!1,h=Vl;h!==null;){if(s!==0){var p=h.pendingLanes;if(p===0)var x=0;else{var L=h.suspendedLanes,I=h.pingedLanes;x=(1<<31-Lt(42|s)+1)-1,x&=p&~(L&~I),x=x&201326741?x&201326741|1:x?x|2:0}x!==0&&(c=!0,Lg(h,x))}else x=Be,x=Wa(h,h===Ze?x:0,h.cancelPendingCommit!==null||h.timeoutHandle!==-1),(x&3)===0||Rr(h,x)||(c=!0,Lg(h,x));h=h.next}while(c);ef=!1}}function eS(){bg()}function bg(){zl=Ju=!1;var s=0;hn!==0&&(cS()&&(s=hn),hn=0);for(var a=Qe(),c=null,h=Vl;h!==null;){var p=h.next,x=Ag(h,a);x===0?(h.next=null,c===null?Vl=p:c.next=p,p===null&&(sr=c)):(c=h,(s!==0||(x&3)!==0)&&(zl=!0)),h=p}ca(s)}function Ag(s,a){for(var c=s.suspendedLanes,h=s.pingedLanes,p=s.expirationTimes,x=s.pendingLanes&-62914561;0<x;){var L=31-Lt(x),I=1<<L,M=p[L];M===-1?((I&c)===0||(I&h)!==0)&&(p[L]=L1(I,a)):M<=a&&(s.expiredLanes|=I),x&=~I}if(a=Ze,c=Be,c=Wa(s,s===a?c:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),h=s.callbackNode,c===0||s===a&&(Ve===2||Ve===9)||s.cancelPendingCommit!==null)return h!==null&&h!==null&&Ys(h),s.callbackNode=null,s.callbackPriority=0;if((c&3)===0||Rr(s,c)){if(a=c&-c,a===s.callbackPriority)return a;switch(h!==null&&Ys(h),gc(c)){case 2:case 8:c=Ut;break;case 32:c=mi;break;case 268435456:c=Ar;break;default:c=mi}return h=Rg.bind(null,s),c=Ks(c,h),s.callbackPriority=a,s.callbackNode=c,a}return h!==null&&h!==null&&Ys(h),s.callbackPriority=2,s.callbackNode=null,2}function Rg(s,a){if(bt!==0&&bt!==5)return s.callbackNode=null,s.callbackPriority=0,null;var c=s.callbackNode;if(Hl()&&s.callbackNode!==c)return null;var h=Be;return h=Wa(s,s===Ze?h:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),h===0?null:(lg(s,h,a),Ag(s,Qe()),s.callbackNode!=null&&s.callbackNode===c?Rg.bind(null,s):null)}function Lg(s,a){if(Hl())return null;lg(s,a,!0)}function tS(){fS(function(){(He&6)!==0?Ks(Ri,eS):bg()})}function tf(){return hn===0&&(hn=yh()),hn}function _g(s){return s==null||typeof s=="symbol"||typeof s=="boolean"?null:typeof s=="function"?s:il(""+s)}function Dg(s,a){var c=a.ownerDocument.createElement("input");return c.name=a.name,c.value=a.value,s.id&&c.setAttribute("form",s.id),a.parentNode.insertBefore(c,a),s=new FormData(s),c.parentNode.removeChild(c),s}function iS(s,a,c,h,p){if(a==="submit"&&c&&c.stateNode===p){var x=_g((p[Bt]||null).action),L=h.submitter;L&&(a=(a=L[Bt]||null)?_g(a.formAction):L.getAttribute("formAction"),a!==null&&(x=a,L=null));var I=new al("action","action",null,h,p);s.push({event:I,listeners:[{instance:null,listener:function(){if(h.defaultPrevented){if(hn!==0){var M=L?Dg(p,L):new FormData(p);Su(c,{pending:!0,data:M,method:p.method,action:x},null,M)}}else typeof x=="function"&&(I.preventDefault(),M=L?Dg(p,L):new FormData(p),Su(c,{pending:!0,data:M,method:p.method,action:x},x,M))},currentTarget:p}]})}}for(var sf=0;sf<jc.length;sf++){var nf=jc[sf],sS=nf.toLowerCase(),nS=nf[0].toUpperCase()+nf.slice(1);pi(sS,"on"+nS)}pi(lm,"onAnimationEnd"),pi(om,"onAnimationIteration"),pi(cm,"onAnimationStart"),pi("dblclick","onDoubleClick"),pi("focusin","onFocus"),pi("focusout","onBlur"),pi(SE,"onTransitionRun"),pi(TE,"onTransitionStart"),pi(bE,"onTransitionCancel"),pi(um,"onTransitionEnd"),_n("onMouseEnter",["mouseout","mouseover"]),_n("onMouseLeave",["mouseout","mouseover"]),_n("onPointerEnter",["pointerout","pointerover"]),_n("onPointerLeave",["pointerout","pointerover"]),Qs("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Qs("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Qs("onBeforeInput",["compositionend","keypress","textInput","paste"]),Qs("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Qs("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Qs("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ua="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),rS=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(ua));function wg(s,a){a=(a&4)!==0;for(var c=0;c<s.length;c++){var h=s[c],p=h.event;h=h.listeners;e:{var x=void 0;if(a)for(var L=h.length-1;0<=L;L--){var I=h[L],M=I.instance,X=I.currentTarget;if(I=I.listener,M!==x&&p.isPropagationStopped())break e;x=I,p.currentTarget=X;try{x(p)}catch(ie){Ol(ie)}p.currentTarget=null,x=M}else for(L=0;L<h.length;L++){if(I=h[L],M=I.instance,X=I.currentTarget,I=I.listener,M!==x&&p.isPropagationStopped())break e;x=I,p.currentTarget=X;try{x(p)}catch(ie){Ol(ie)}p.currentTarget=null,x=M}}}}function Ne(s,a){var c=a[pc];c===void 0&&(c=a[pc]=new Set);var h=s+"__bubble";c.has(h)||(Ig(a,s,2,!1),c.add(h))}function rf(s,a,c){var h=0;a&&(h|=4),Ig(c,s,h,a)}var Kl="_reactListening"+Math.random().toString(36).slice(2);function af(s){if(!s[Kl]){s[Kl]=!0,bh.forEach(function(c){c!=="selectionchange"&&(rS.has(c)||rf(c,!1,s),rf(c,!0,s))});var a=s.nodeType===9?s:s.ownerDocument;a===null||a[Kl]||(a[Kl]=!0,rf("selectionchange",!1,a))}}function Ig(s,a,c,h){switch(ep(a)){case 2:var p=OS;break;case 8:p=NS;break;default:p=Ef}c=p.bind(null,a,c,s),p=void 0,!_c||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(p=!0),h?p!==void 0?s.addEventListener(a,c,{capture:!0,passive:p}):s.addEventListener(a,c,!0):p!==void 0?s.addEventListener(a,c,{passive:p}):s.addEventListener(a,c,!1)}function lf(s,a,c,h,p){var x=h;if((a&1)===0&&(a&2)===0&&h!==null)e:for(;;){if(h===null)return;var L=h.tag;if(L===3||L===4){var I=h.stateNode.containerInfo;if(I===p)break;if(L===4)for(L=h.return;L!==null;){var M=L.tag;if((M===3||M===4)&&L.stateNode.containerInfo===p)return;L=L.return}for(;I!==null;){if(L=An(I),L===null)return;if(M=L.tag,M===5||M===6||M===26||M===27){h=x=L;continue e}I=I.parentNode}}h=h.return}Uh(function(){var X=x,ie=Rc(c),le=[];e:{var Q=fm.get(s);if(Q!==void 0){var Z=al,Te=s;switch(s){case"keypress":if(nl(c)===0)break e;case"keydown":case"keyup":Z=J1;break;case"focusin":Te="focus",Z=Cc;break;case"focusout":Te="blur",Z=Cc;break;case"beforeblur":case"afterblur":Z=Cc;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Z=jh;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Z=$1;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Z=iE;break;case lm:case om:case cm:Z=V1;break;case um:Z=nE;break;case"scroll":case"scrollend":Z=F1;break;case"wheel":Z=aE;break;case"copy":case"cut":case"paste":Z=K1;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Z=Gh;break;case"toggle":case"beforetoggle":Z=oE}var Ee=(a&4)!==0,Xe=!Ee&&(s==="scroll"||s==="scrollend"),H=Ee?Q!==null?Q+"Capture":null:Q;Ee=[];for(var j=X,Y;j!==null;){var re=j;if(Y=re.stateNode,re=re.tag,re!==5&&re!==26&&re!==27||Y===null||H===null||(re=wr(j,H),re!=null&&Ee.push(fa(j,re,Y))),Xe)break;j=j.return}0<Ee.length&&(Q=new Z(Q,Te,null,c,ie),le.push({event:Q,listeners:Ee}))}}if((a&7)===0){e:{if(Q=s==="mouseover"||s==="pointerover",Z=s==="mouseout"||s==="pointerout",Q&&c!==Ac&&(Te=c.relatedTarget||c.fromElement)&&(An(Te)||Te[bn]))break e;if((Z||Q)&&(Q=ie.window===ie?ie:(Q=ie.ownerDocument)?Q.defaultView||Q.parentWindow:window,Z?(Te=c.relatedTarget||c.toElement,Z=X,Te=Te?An(Te):null,Te!==null&&(Xe=l(Te),Ee=Te.tag,Te!==Xe||Ee!==5&&Ee!==27&&Ee!==6)&&(Te=null)):(Z=null,Te=X),Z!==Te)){if(Ee=jh,re="onMouseLeave",H="onMouseEnter",j="mouse",(s==="pointerout"||s==="pointerover")&&(Ee=Gh,re="onPointerLeave",H="onPointerEnter",j="pointer"),Xe=Z==null?Q:Dr(Z),Y=Te==null?Q:Dr(Te),Q=new Ee(re,j+"leave",Z,c,ie),Q.target=Xe,Q.relatedTarget=Y,re=null,An(ie)===X&&(Ee=new Ee(H,j+"enter",Te,c,ie),Ee.target=Y,Ee.relatedTarget=Xe,re=Ee),Xe=re,Z&&Te)t:{for(Ee=Z,H=Te,j=0,Y=Ee;Y;Y=nr(Y))j++;for(Y=0,re=H;re;re=nr(re))Y++;for(;0<j-Y;)Ee=nr(Ee),j--;for(;0<Y-j;)H=nr(H),Y--;for(;j--;){if(Ee===H||H!==null&&Ee===H.alternate)break t;Ee=nr(Ee),H=nr(H)}Ee=null}else Ee=null;Z!==null&&Cg(le,Q,Z,Ee,!1),Te!==null&&Xe!==null&&Cg(le,Xe,Te,Ee,!0)}}e:{if(Q=X?Dr(X):window,Z=Q.nodeName&&Q.nodeName.toLowerCase(),Z==="select"||Z==="input"&&Q.type==="file")var me=Qh;else if(qh(Q))if(Wh)me=vE;else{me=pE;var Ie=gE}else Z=Q.nodeName,!Z||Z.toLowerCase()!=="input"||Q.type!=="checkbox"&&Q.type!=="radio"?X&&bc(X.elementType)&&(me=Qh):me=yE;if(me&&(me=me(s,X))){Xh(le,me,c,ie);break e}Ie&&Ie(s,Q,X),s==="focusout"&&X&&Q.type==="number"&&X.memoizedProps.value!=null&&Tc(Q,"number",Q.value)}switch(Ie=X?Dr(X):window,s){case"focusin":(qh(Ie)||Ie.contentEditable==="true")&&(kn=Ie,Uc=X,Ur=null);break;case"focusout":Ur=Uc=kn=null;break;case"mousedown":Bc=!0;break;case"contextmenu":case"mouseup":case"dragend":Bc=!1,rm(le,c,ie);break;case"selectionchange":if(EE)break;case"keydown":case"keyup":rm(le,c,ie)}var ye;if(Nc)e:{switch(s){case"compositionstart":var Se="onCompositionStart";break e;case"compositionend":Se="onCompositionEnd";break e;case"compositionupdate":Se="onCompositionUpdate";break e}Se=void 0}else Nn?Kh(s,c)&&(Se="onCompositionEnd"):s==="keydown"&&c.keyCode===229&&(Se="onCompositionStart");Se&&(Hh&&c.locale!=="ko"&&(Nn||Se!=="onCompositionStart"?Se==="onCompositionEnd"&&Nn&&(ye=Bh()):(ps=ie,Dc="value"in ps?ps.value:ps.textContent,Nn=!0)),Ie=Yl(X,Se),0<Ie.length&&(Se=new $h(Se,s,null,c,ie),le.push({event:Se,listeners:Ie}),ye?Se.data=ye:(ye=Yh(c),ye!==null&&(Se.data=ye)))),(ye=uE?fE(s,c):dE(s,c))&&(Se=Yl(X,"onBeforeInput"),0<Se.length&&(Ie=new $h("onBeforeInput","beforeinput",null,c,ie),le.push({event:Ie,listeners:Se}),Ie.data=ye)),iS(le,s,X,c,ie)}wg(le,a)})}function fa(s,a,c){return{instance:s,listener:a,currentTarget:c}}function Yl(s,a){for(var c=a+"Capture",h=[];s!==null;){var p=s,x=p.stateNode;if(p=p.tag,p!==5&&p!==26&&p!==27||x===null||(p=wr(s,c),p!=null&&h.unshift(fa(s,p,x)),p=wr(s,a),p!=null&&h.push(fa(s,p,x))),s.tag===3)return h;s=s.return}return[]}function nr(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5&&s.tag!==27);return s||null}function Cg(s,a,c,h,p){for(var x=a._reactName,L=[];c!==null&&c!==h;){var I=c,M=I.alternate,X=I.stateNode;if(I=I.tag,M!==null&&M===h)break;I!==5&&I!==26&&I!==27||X===null||(M=X,p?(X=wr(c,x),X!=null&&L.unshift(fa(c,X,M))):p||(X=wr(c,x),X!=null&&L.push(fa(c,X,M)))),c=c.return}L.length!==0&&s.push({event:a,listeners:L})}var aS=/\r\n?/g,lS=/\u0000|\uFFFD/g;function Og(s){return(typeof s=="string"?s:""+s).replace(aS,`
`).replace(lS,"")}function Ng(s,a){return a=Og(a),Og(s)===a}function ql(){}function qe(s,a,c,h,p,x){switch(c){case"children":typeof h=="string"?a==="body"||a==="textarea"&&h===""||In(s,h):(typeof h=="number"||typeof h=="bigint")&&a!=="body"&&In(s,""+h);break;case"className":Ja(s,"class",h);break;case"tabIndex":Ja(s,"tabindex",h);break;case"dir":case"role":case"viewBox":case"width":case"height":Ja(s,c,h);break;case"style":Mh(s,h,x);break;case"data":if(a!=="object"){Ja(s,"data",h);break}case"src":case"href":if(h===""&&(a!=="a"||c!=="href")){s.removeAttribute(c);break}if(h==null||typeof h=="function"||typeof h=="symbol"||typeof h=="boolean"){s.removeAttribute(c);break}h=il(""+h),s.setAttribute(c,h);break;case"action":case"formAction":if(typeof h=="function"){s.setAttribute(c,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof x=="function"&&(c==="formAction"?(a!=="input"&&qe(s,a,"name",p.name,p,null),qe(s,a,"formEncType",p.formEncType,p,null),qe(s,a,"formMethod",p.formMethod,p,null),qe(s,a,"formTarget",p.formTarget,p,null)):(qe(s,a,"encType",p.encType,p,null),qe(s,a,"method",p.method,p,null),qe(s,a,"target",p.target,p,null)));if(h==null||typeof h=="symbol"||typeof h=="boolean"){s.removeAttribute(c);break}h=il(""+h),s.setAttribute(c,h);break;case"onClick":h!=null&&(s.onclick=ql);break;case"onScroll":h!=null&&Ne("scroll",s);break;case"onScrollEnd":h!=null&&Ne("scrollend",s);break;case"dangerouslySetInnerHTML":if(h!=null){if(typeof h!="object"||!("__html"in h))throw Error(i(61));if(c=h.__html,c!=null){if(p.children!=null)throw Error(i(60));s.innerHTML=c}}break;case"multiple":s.multiple=h&&typeof h!="function"&&typeof h!="symbol";break;case"muted":s.muted=h&&typeof h!="function"&&typeof h!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(h==null||typeof h=="function"||typeof h=="boolean"||typeof h=="symbol"){s.removeAttribute("xlink:href");break}c=il(""+h),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",c);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":h!=null&&typeof h!="function"&&typeof h!="symbol"?s.setAttribute(c,""+h):s.removeAttribute(c);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":h&&typeof h!="function"&&typeof h!="symbol"?s.setAttribute(c,""):s.removeAttribute(c);break;case"capture":case"download":h===!0?s.setAttribute(c,""):h!==!1&&h!=null&&typeof h!="function"&&typeof h!="symbol"?s.setAttribute(c,h):s.removeAttribute(c);break;case"cols":case"rows":case"size":case"span":h!=null&&typeof h!="function"&&typeof h!="symbol"&&!isNaN(h)&&1<=h?s.setAttribute(c,h):s.removeAttribute(c);break;case"rowSpan":case"start":h==null||typeof h=="function"||typeof h=="symbol"||isNaN(h)?s.removeAttribute(c):s.setAttribute(c,h);break;case"popover":Ne("beforetoggle",s),Ne("toggle",s),Za(s,"popover",h);break;case"xlinkActuate":Ki(s,"http://www.w3.org/1999/xlink","xlink:actuate",h);break;case"xlinkArcrole":Ki(s,"http://www.w3.org/1999/xlink","xlink:arcrole",h);break;case"xlinkRole":Ki(s,"http://www.w3.org/1999/xlink","xlink:role",h);break;case"xlinkShow":Ki(s,"http://www.w3.org/1999/xlink","xlink:show",h);break;case"xlinkTitle":Ki(s,"http://www.w3.org/1999/xlink","xlink:title",h);break;case"xlinkType":Ki(s,"http://www.w3.org/1999/xlink","xlink:type",h);break;case"xmlBase":Ki(s,"http://www.w3.org/XML/1998/namespace","xml:base",h);break;case"xmlLang":Ki(s,"http://www.w3.org/XML/1998/namespace","xml:lang",h);break;case"xmlSpace":Ki(s,"http://www.w3.org/XML/1998/namespace","xml:space",h);break;case"is":Za(s,"is",h);break;case"innerText":case"textContent":break;default:(!(2<c.length)||c[0]!=="o"&&c[0]!=="O"||c[1]!=="n"&&c[1]!=="N")&&(c=U1.get(c)||c,Za(s,c,h))}}function of(s,a,c,h,p,x){switch(c){case"style":Mh(s,h,x);break;case"dangerouslySetInnerHTML":if(h!=null){if(typeof h!="object"||!("__html"in h))throw Error(i(61));if(c=h.__html,c!=null){if(p.children!=null)throw Error(i(60));s.innerHTML=c}}break;case"children":typeof h=="string"?In(s,h):(typeof h=="number"||typeof h=="bigint")&&In(s,""+h);break;case"onScroll":h!=null&&Ne("scroll",s);break;case"onScrollEnd":h!=null&&Ne("scrollend",s);break;case"onClick":h!=null&&(s.onclick=ql);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Ah.hasOwnProperty(c))e:{if(c[0]==="o"&&c[1]==="n"&&(p=c.endsWith("Capture"),a=c.slice(2,p?c.length-7:void 0),x=s[Bt]||null,x=x!=null?x[c]:null,typeof x=="function"&&s.removeEventListener(a,x,p),typeof h=="function")){typeof x!="function"&&x!==null&&(c in s?s[c]=null:s.hasAttribute(c)&&s.removeAttribute(c)),s.addEventListener(a,h,p);break e}c in s?s[c]=h:h===!0?s.setAttribute(c,""):Za(s,c,h)}}}function At(s,a,c){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ne("error",s),Ne("load",s);var h=!1,p=!1,x;for(x in c)if(c.hasOwnProperty(x)){var L=c[x];if(L!=null)switch(x){case"src":h=!0;break;case"srcSet":p=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,a));default:qe(s,a,x,L,c,null)}}p&&qe(s,a,"srcSet",c.srcSet,c,null),h&&qe(s,a,"src",c.src,c,null);return;case"input":Ne("invalid",s);var I=x=L=p=null,M=null,X=null;for(h in c)if(c.hasOwnProperty(h)){var ie=c[h];if(ie!=null)switch(h){case"name":p=ie;break;case"type":L=ie;break;case"checked":M=ie;break;case"defaultChecked":X=ie;break;case"value":x=ie;break;case"defaultValue":I=ie;break;case"children":case"dangerouslySetInnerHTML":if(ie!=null)throw Error(i(137,a));break;default:qe(s,a,h,ie,c,null)}}Ch(s,x,I,M,X,L,p,!1),el(s);return;case"select":Ne("invalid",s),h=L=x=null;for(p in c)if(c.hasOwnProperty(p)&&(I=c[p],I!=null))switch(p){case"value":x=I;break;case"defaultValue":L=I;break;case"multiple":h=I;default:qe(s,a,p,I,c,null)}a=x,c=L,s.multiple=!!h,a!=null?wn(s,!!h,a,!1):c!=null&&wn(s,!!h,c,!0);return;case"textarea":Ne("invalid",s),x=p=h=null;for(L in c)if(c.hasOwnProperty(L)&&(I=c[L],I!=null))switch(L){case"value":h=I;break;case"defaultValue":p=I;break;case"children":x=I;break;case"dangerouslySetInnerHTML":if(I!=null)throw Error(i(91));break;default:qe(s,a,L,I,c,null)}Nh(s,h,p,x),el(s);return;case"option":for(M in c)if(c.hasOwnProperty(M)&&(h=c[M],h!=null))switch(M){case"selected":s.selected=h&&typeof h!="function"&&typeof h!="symbol";break;default:qe(s,a,M,h,c,null)}return;case"dialog":Ne("beforetoggle",s),Ne("toggle",s),Ne("cancel",s),Ne("close",s);break;case"iframe":case"object":Ne("load",s);break;case"video":case"audio":for(h=0;h<ua.length;h++)Ne(ua[h],s);break;case"image":Ne("error",s),Ne("load",s);break;case"details":Ne("toggle",s);break;case"embed":case"source":case"link":Ne("error",s),Ne("load",s);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(X in c)if(c.hasOwnProperty(X)&&(h=c[X],h!=null))switch(X){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,a));default:qe(s,a,X,h,c,null)}return;default:if(bc(a)){for(ie in c)c.hasOwnProperty(ie)&&(h=c[ie],h!==void 0&&of(s,a,ie,h,c,void 0));return}}for(I in c)c.hasOwnProperty(I)&&(h=c[I],h!=null&&qe(s,a,I,h,c,null))}function oS(s,a,c,h){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var p=null,x=null,L=null,I=null,M=null,X=null,ie=null;for(Z in c){var le=c[Z];if(c.hasOwnProperty(Z)&&le!=null)switch(Z){case"checked":break;case"value":break;case"defaultValue":M=le;default:h.hasOwnProperty(Z)||qe(s,a,Z,null,h,le)}}for(var Q in h){var Z=h[Q];if(le=c[Q],h.hasOwnProperty(Q)&&(Z!=null||le!=null))switch(Q){case"type":x=Z;break;case"name":p=Z;break;case"checked":X=Z;break;case"defaultChecked":ie=Z;break;case"value":L=Z;break;case"defaultValue":I=Z;break;case"children":case"dangerouslySetInnerHTML":if(Z!=null)throw Error(i(137,a));break;default:Z!==le&&qe(s,a,Q,Z,h,le)}}Sc(s,L,I,M,X,ie,x,p);return;case"select":Z=L=I=Q=null;for(x in c)if(M=c[x],c.hasOwnProperty(x)&&M!=null)switch(x){case"value":break;case"multiple":Z=M;default:h.hasOwnProperty(x)||qe(s,a,x,null,h,M)}for(p in h)if(x=h[p],M=c[p],h.hasOwnProperty(p)&&(x!=null||M!=null))switch(p){case"value":Q=x;break;case"defaultValue":I=x;break;case"multiple":L=x;default:x!==M&&qe(s,a,p,x,h,M)}a=I,c=L,h=Z,Q!=null?wn(s,!!c,Q,!1):!!h!=!!c&&(a!=null?wn(s,!!c,a,!0):wn(s,!!c,c?[]:"",!1));return;case"textarea":Z=Q=null;for(I in c)if(p=c[I],c.hasOwnProperty(I)&&p!=null&&!h.hasOwnProperty(I))switch(I){case"value":break;case"children":break;default:qe(s,a,I,null,h,p)}for(L in h)if(p=h[L],x=c[L],h.hasOwnProperty(L)&&(p!=null||x!=null))switch(L){case"value":Q=p;break;case"defaultValue":Z=p;break;case"children":break;case"dangerouslySetInnerHTML":if(p!=null)throw Error(i(91));break;default:p!==x&&qe(s,a,L,p,h,x)}Oh(s,Q,Z);return;case"option":for(var Te in c)if(Q=c[Te],c.hasOwnProperty(Te)&&Q!=null&&!h.hasOwnProperty(Te))switch(Te){case"selected":s.selected=!1;break;default:qe(s,a,Te,null,h,Q)}for(M in h)if(Q=h[M],Z=c[M],h.hasOwnProperty(M)&&Q!==Z&&(Q!=null||Z!=null))switch(M){case"selected":s.selected=Q&&typeof Q!="function"&&typeof Q!="symbol";break;default:qe(s,a,M,Q,h,Z)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ee in c)Q=c[Ee],c.hasOwnProperty(Ee)&&Q!=null&&!h.hasOwnProperty(Ee)&&qe(s,a,Ee,null,h,Q);for(X in h)if(Q=h[X],Z=c[X],h.hasOwnProperty(X)&&Q!==Z&&(Q!=null||Z!=null))switch(X){case"children":case"dangerouslySetInnerHTML":if(Q!=null)throw Error(i(137,a));break;default:qe(s,a,X,Q,h,Z)}return;default:if(bc(a)){for(var Xe in c)Q=c[Xe],c.hasOwnProperty(Xe)&&Q!==void 0&&!h.hasOwnProperty(Xe)&&of(s,a,Xe,void 0,h,Q);for(ie in h)Q=h[ie],Z=c[ie],!h.hasOwnProperty(ie)||Q===Z||Q===void 0&&Z===void 0||of(s,a,ie,Q,h,Z);return}}for(var H in c)Q=c[H],c.hasOwnProperty(H)&&Q!=null&&!h.hasOwnProperty(H)&&qe(s,a,H,null,h,Q);for(le in h)Q=h[le],Z=c[le],!h.hasOwnProperty(le)||Q===Z||Q==null&&Z==null||qe(s,a,le,Q,h,Z)}var cf=null,uf=null;function Xl(s){return s.nodeType===9?s:s.ownerDocument}function kg(s){switch(s){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Mg(s,a){if(s===0)switch(a){case"svg":return 1;case"math":return 2;default:return 0}return s===1&&a==="foreignObject"?0:s}function ff(s,a){return s==="textarea"||s==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.children=="bigint"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var df=null;function cS(){var s=window.event;return s&&s.type==="popstate"?s===df?!1:(df=s,!0):(df=null,!1)}var Pg=typeof setTimeout=="function"?setTimeout:void 0,uS=typeof clearTimeout=="function"?clearTimeout:void 0,Ug=typeof Promise=="function"?Promise:void 0,fS=typeof queueMicrotask=="function"?queueMicrotask:typeof Ug<"u"?function(s){return Ug.resolve(null).then(s).catch(dS)}:Pg;function dS(s){setTimeout(function(){throw s})}function Os(s){return s==="head"}function Bg(s,a){var c=a,h=0,p=0;do{var x=c.nextSibling;if(s.removeChild(c),x&&x.nodeType===8)if(c=x.data,c==="/$"){if(0<h&&8>h){c=h;var L=s.ownerDocument;if(c&1&&da(L.documentElement),c&2&&da(L.body),c&4)for(c=L.head,da(c),L=c.firstChild;L;){var I=L.nextSibling,M=L.nodeName;L[_r]||M==="SCRIPT"||M==="STYLE"||M==="LINK"&&L.rel.toLowerCase()==="stylesheet"||c.removeChild(L),L=I}}if(p===0){s.removeChild(x),Ea(a);return}p--}else c==="$"||c==="$?"||c==="$!"?p++:h=c.charCodeAt(0)-48;else h=0;c=x}while(c);Ea(a)}function hf(s){var a=s.firstChild;for(a&&a.nodeType===10&&(a=a.nextSibling);a;){var c=a;switch(a=a.nextSibling,c.nodeName){case"HTML":case"HEAD":case"BODY":hf(c),yc(c);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(c.rel.toLowerCase()==="stylesheet")continue}s.removeChild(c)}}function hS(s,a,c,h){for(;s.nodeType===1;){var p=c;if(s.nodeName.toLowerCase()!==a.toLowerCase()){if(!h&&(s.nodeName!=="INPUT"||s.type!=="hidden"))break}else if(h){if(!s[_r])switch(a){case"meta":if(!s.hasAttribute("itemprop"))break;return s;case"link":if(x=s.getAttribute("rel"),x==="stylesheet"&&s.hasAttribute("data-precedence"))break;if(x!==p.rel||s.getAttribute("href")!==(p.href==null||p.href===""?null:p.href)||s.getAttribute("crossorigin")!==(p.crossOrigin==null?null:p.crossOrigin)||s.getAttribute("title")!==(p.title==null?null:p.title))break;return s;case"style":if(s.hasAttribute("data-precedence"))break;return s;case"script":if(x=s.getAttribute("src"),(x!==(p.src==null?null:p.src)||s.getAttribute("type")!==(p.type==null?null:p.type)||s.getAttribute("crossorigin")!==(p.crossOrigin==null?null:p.crossOrigin))&&x&&s.hasAttribute("async")&&!s.hasAttribute("itemprop"))break;return s;default:return s}}else if(a==="input"&&s.type==="hidden"){var x=p.name==null?null:""+p.name;if(p.type==="hidden"&&s.getAttribute("name")===x)return s}else return s;if(s=vi(s.nextSibling),s===null)break}return null}function mS(s,a,c){if(a==="")return null;for(;s.nodeType!==3;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!c||(s=vi(s.nextSibling),s===null))return null;return s}function mf(s){return s.data==="$!"||s.data==="$?"&&s.ownerDocument.readyState==="complete"}function gS(s,a){var c=s.ownerDocument;if(s.data!=="$?"||c.readyState==="complete")a();else{var h=function(){a(),c.removeEventListener("DOMContentLoaded",h)};c.addEventListener("DOMContentLoaded",h),s._reactRetry=h}}function vi(s){for(;s!=null;s=s.nextSibling){var a=s.nodeType;if(a===1||a===3)break;if(a===8){if(a=s.data,a==="$"||a==="$!"||a==="$?"||a==="F!"||a==="F")break;if(a==="/$")return null}}return s}var gf=null;function Fg(s){s=s.previousSibling;for(var a=0;s;){if(s.nodeType===8){var c=s.data;if(c==="$"||c==="$!"||c==="$?"){if(a===0)return s;a--}else c==="/$"&&a++}s=s.previousSibling}return null}function jg(s,a,c){switch(a=Xl(c),s){case"html":if(s=a.documentElement,!s)throw Error(i(452));return s;case"head":if(s=a.head,!s)throw Error(i(453));return s;case"body":if(s=a.body,!s)throw Error(i(454));return s;default:throw Error(i(451))}}function da(s){for(var a=s.attributes;a.length;)s.removeAttributeNode(a[0]);yc(s)}var ui=new Map,$g=new Set;function Ql(s){return typeof s.getRootNode=="function"?s.getRootNode():s.nodeType===9?s:s.ownerDocument}var as=W.d;W.d={f:pS,r:yS,D:vS,C:xS,L:ES,m:SS,X:bS,S:TS,M:AS};function pS(){var s=as.f(),a=$l();return s||a}function yS(s){var a=Rn(s);a!==null&&a.tag===5&&a.type==="form"?l0(a):as.r(s)}var rr=typeof document>"u"?null:document;function Gg(s,a,c){var h=rr;if(h&&typeof a=="string"&&a){var p=si(a);p='link[rel="'+s+'"][href="'+p+'"]',typeof c=="string"&&(p+='[crossorigin="'+c+'"]'),$g.has(p)||($g.add(p),s={rel:s,crossOrigin:c,href:a},h.querySelector(p)===null&&(a=h.createElement("link"),At(a,"link",s),pt(a),h.head.appendChild(a)))}}function vS(s){as.D(s),Gg("dns-prefetch",s,null)}function xS(s,a){as.C(s,a),Gg("preconnect",s,a)}function ES(s,a,c){as.L(s,a,c);var h=rr;if(h&&s&&a){var p='link[rel="preload"][as="'+si(a)+'"]';a==="image"&&c&&c.imageSrcSet?(p+='[imagesrcset="'+si(c.imageSrcSet)+'"]',typeof c.imageSizes=="string"&&(p+='[imagesizes="'+si(c.imageSizes)+'"]')):p+='[href="'+si(s)+'"]';var x=p;switch(a){case"style":x=ar(s);break;case"script":x=lr(s)}ui.has(x)||(s=m({rel:"preload",href:a==="image"&&c&&c.imageSrcSet?void 0:s,as:a},c),ui.set(x,s),h.querySelector(p)!==null||a==="style"&&h.querySelector(ha(x))||a==="script"&&h.querySelector(ma(x))||(a=h.createElement("link"),At(a,"link",s),pt(a),h.head.appendChild(a)))}}function SS(s,a){as.m(s,a);var c=rr;if(c&&s){var h=a&&typeof a.as=="string"?a.as:"script",p='link[rel="modulepreload"][as="'+si(h)+'"][href="'+si(s)+'"]',x=p;switch(h){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":x=lr(s)}if(!ui.has(x)&&(s=m({rel:"modulepreload",href:s},a),ui.set(x,s),c.querySelector(p)===null)){switch(h){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(c.querySelector(ma(x)))return}h=c.createElement("link"),At(h,"link",s),pt(h),c.head.appendChild(h)}}}function TS(s,a,c){as.S(s,a,c);var h=rr;if(h&&s){var p=Ln(h).hoistableStyles,x=ar(s);a=a||"default";var L=p.get(x);if(!L){var I={loading:0,preload:null};if(L=h.querySelector(ha(x)))I.loading=5;else{s=m({rel:"stylesheet",href:s,"data-precedence":a},c),(c=ui.get(x))&&pf(s,c);var M=L=h.createElement("link");pt(M),At(M,"link",s),M._p=new Promise(function(X,ie){M.onload=X,M.onerror=ie}),M.addEventListener("load",function(){I.loading|=1}),M.addEventListener("error",function(){I.loading|=2}),I.loading|=4,Wl(L,a,h)}L={type:"stylesheet",instance:L,count:1,state:I},p.set(x,L)}}}function bS(s,a){as.X(s,a);var c=rr;if(c&&s){var h=Ln(c).hoistableScripts,p=lr(s),x=h.get(p);x||(x=c.querySelector(ma(p)),x||(s=m({src:s,async:!0},a),(a=ui.get(p))&&yf(s,a),x=c.createElement("script"),pt(x),At(x,"link",s),c.head.appendChild(x)),x={type:"script",instance:x,count:1,state:null},h.set(p,x))}}function AS(s,a){as.M(s,a);var c=rr;if(c&&s){var h=Ln(c).hoistableScripts,p=lr(s),x=h.get(p);x||(x=c.querySelector(ma(p)),x||(s=m({src:s,async:!0,type:"module"},a),(a=ui.get(p))&&yf(s,a),x=c.createElement("script"),pt(x),At(x,"link",s),c.head.appendChild(x)),x={type:"script",instance:x,count:1,state:null},h.set(p,x))}}function Hg(s,a,c,h){var p=(p=ue.current)?Ql(p):null;if(!p)throw Error(i(446));switch(s){case"meta":case"title":return null;case"style":return typeof c.precedence=="string"&&typeof c.href=="string"?(a=ar(c.href),c=Ln(p).hoistableStyles,h=c.get(a),h||(h={type:"style",instance:null,count:0,state:null},c.set(a,h)),h):{type:"void",instance:null,count:0,state:null};case"link":if(c.rel==="stylesheet"&&typeof c.href=="string"&&typeof c.precedence=="string"){s=ar(c.href);var x=Ln(p).hoistableStyles,L=x.get(s);if(L||(p=p.ownerDocument||p,L={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},x.set(s,L),(x=p.querySelector(ha(s)))&&!x._p&&(L.instance=x,L.state.loading=5),ui.has(s)||(c={rel:"preload",as:"style",href:c.href,crossOrigin:c.crossOrigin,integrity:c.integrity,media:c.media,hrefLang:c.hrefLang,referrerPolicy:c.referrerPolicy},ui.set(s,c),x||RS(p,s,c,L.state))),a&&h===null)throw Error(i(528,""));return L}if(a&&h!==null)throw Error(i(529,""));return null;case"script":return a=c.async,c=c.src,typeof c=="string"&&a&&typeof a!="function"&&typeof a!="symbol"?(a=lr(c),c=Ln(p).hoistableScripts,h=c.get(a),h||(h={type:"script",instance:null,count:0,state:null},c.set(a,h)),h):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,s))}}function ar(s){return'href="'+si(s)+'"'}function ha(s){return'link[rel="stylesheet"]['+s+"]"}function Vg(s){return m({},s,{"data-precedence":s.precedence,precedence:null})}function RS(s,a,c,h){s.querySelector('link[rel="preload"][as="style"]['+a+"]")?h.loading=1:(a=s.createElement("link"),h.preload=a,a.addEventListener("load",function(){return h.loading|=1}),a.addEventListener("error",function(){return h.loading|=2}),At(a,"link",c),pt(a),s.head.appendChild(a))}function lr(s){return'[src="'+si(s)+'"]'}function ma(s){return"script[async]"+s}function zg(s,a,c){if(a.count++,a.instance===null)switch(a.type){case"style":var h=s.querySelector('style[data-href~="'+si(c.href)+'"]');if(h)return a.instance=h,pt(h),h;var p=m({},c,{"data-href":c.href,"data-precedence":c.precedence,href:null,precedence:null});return h=(s.ownerDocument||s).createElement("style"),pt(h),At(h,"style",p),Wl(h,c.precedence,s),a.instance=h;case"stylesheet":p=ar(c.href);var x=s.querySelector(ha(p));if(x)return a.state.loading|=4,a.instance=x,pt(x),x;h=Vg(c),(p=ui.get(p))&&pf(h,p),x=(s.ownerDocument||s).createElement("link"),pt(x);var L=x;return L._p=new Promise(function(I,M){L.onload=I,L.onerror=M}),At(x,"link",h),a.state.loading|=4,Wl(x,c.precedence,s),a.instance=x;case"script":return x=lr(c.src),(p=s.querySelector(ma(x)))?(a.instance=p,pt(p),p):(h=c,(p=ui.get(x))&&(h=m({},c),yf(h,p)),s=s.ownerDocument||s,p=s.createElement("script"),pt(p),At(p,"link",h),s.head.appendChild(p),a.instance=p);case"void":return null;default:throw Error(i(443,a.type))}else a.type==="stylesheet"&&(a.state.loading&4)===0&&(h=a.instance,a.state.loading|=4,Wl(h,c.precedence,s));return a.instance}function Wl(s,a,c){for(var h=c.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),p=h.length?h[h.length-1]:null,x=p,L=0;L<h.length;L++){var I=h[L];if(I.dataset.precedence===a)x=I;else if(x!==p)break}x?x.parentNode.insertBefore(s,x.nextSibling):(a=c.nodeType===9?c.head:c,a.insertBefore(s,a.firstChild))}function pf(s,a){s.crossOrigin==null&&(s.crossOrigin=a.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=a.referrerPolicy),s.title==null&&(s.title=a.title)}function yf(s,a){s.crossOrigin==null&&(s.crossOrigin=a.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=a.referrerPolicy),s.integrity==null&&(s.integrity=a.integrity)}var Zl=null;function Kg(s,a,c){if(Zl===null){var h=new Map,p=Zl=new Map;p.set(c,h)}else p=Zl,h=p.get(c),h||(h=new Map,p.set(c,h));if(h.has(s))return h;for(h.set(s,null),c=c.getElementsByTagName(s),p=0;p<c.length;p++){var x=c[p];if(!(x[_r]||x[_t]||s==="link"&&x.getAttribute("rel")==="stylesheet")&&x.namespaceURI!=="http://www.w3.org/2000/svg"){var L=x.getAttribute(a)||"";L=s+L;var I=h.get(L);I?I.push(x):h.set(L,[x])}}return h}function Yg(s,a,c){s=s.ownerDocument||s,s.head.insertBefore(c,a==="title"?s.querySelector("head > title"):null)}function LS(s,a,c){if(c===1||a.itemProp!=null)return!1;switch(s){case"meta":case"title":return!0;case"style":if(typeof a.precedence!="string"||typeof a.href!="string"||a.href==="")break;return!0;case"link":if(typeof a.rel!="string"||typeof a.href!="string"||a.href===""||a.onLoad||a.onError)break;switch(a.rel){case"stylesheet":return s=a.disabled,typeof a.precedence=="string"&&s==null;default:return!0}case"script":if(a.async&&typeof a.async!="function"&&typeof a.async!="symbol"&&!a.onLoad&&!a.onError&&a.src&&typeof a.src=="string")return!0}return!1}function qg(s){return!(s.type==="stylesheet"&&(s.state.loading&3)===0)}var ga=null;function _S(){}function DS(s,a,c){if(ga===null)throw Error(i(475));var h=ga;if(a.type==="stylesheet"&&(typeof c.media!="string"||matchMedia(c.media).matches!==!1)&&(a.state.loading&4)===0){if(a.instance===null){var p=ar(c.href),x=s.querySelector(ha(p));if(x){s=x._p,s!==null&&typeof s=="object"&&typeof s.then=="function"&&(h.count++,h=Jl.bind(h),s.then(h,h)),a.state.loading|=4,a.instance=x,pt(x);return}x=s.ownerDocument||s,c=Vg(c),(p=ui.get(p))&&pf(c,p),x=x.createElement("link"),pt(x);var L=x;L._p=new Promise(function(I,M){L.onload=I,L.onerror=M}),At(x,"link",c),a.instance=x}h.stylesheets===null&&(h.stylesheets=new Map),h.stylesheets.set(a,s),(s=a.state.preload)&&(a.state.loading&3)===0&&(h.count++,a=Jl.bind(h),s.addEventListener("load",a),s.addEventListener("error",a))}}function wS(){if(ga===null)throw Error(i(475));var s=ga;return s.stylesheets&&s.count===0&&vf(s,s.stylesheets),0<s.count?function(a){var c=setTimeout(function(){if(s.stylesheets&&vf(s,s.stylesheets),s.unsuspend){var h=s.unsuspend;s.unsuspend=null,h()}},6e4);return s.unsuspend=a,function(){s.unsuspend=null,clearTimeout(c)}}:null}function Jl(){if(this.count--,this.count===0){if(this.stylesheets)vf(this,this.stylesheets);else if(this.unsuspend){var s=this.unsuspend;this.unsuspend=null,s()}}}var eo=null;function vf(s,a){s.stylesheets=null,s.unsuspend!==null&&(s.count++,eo=new Map,a.forEach(IS,s),eo=null,Jl.call(s))}function IS(s,a){if(!(a.state.loading&4)){var c=eo.get(s);if(c)var h=c.get(null);else{c=new Map,eo.set(s,c);for(var p=s.querySelectorAll("link[data-precedence],style[data-precedence]"),x=0;x<p.length;x++){var L=p[x];(L.nodeName==="LINK"||L.getAttribute("media")!=="not all")&&(c.set(L.dataset.precedence,L),h=L)}h&&c.set(null,h)}p=a.instance,L=p.getAttribute("data-precedence"),x=c.get(L)||h,x===h&&c.set(null,p),c.set(L,p),this.count++,h=Jl.bind(this),p.addEventListener("load",h),p.addEventListener("error",h),x?x.parentNode.insertBefore(p,x.nextSibling):(s=s.nodeType===9?s.head:s,s.insertBefore(p,s.firstChild)),a.state.loading|=4}}var pa={$$typeof:_,Provider:null,Consumer:null,_currentValue:se,_currentValue2:se,_threadCount:0};function CS(s,a,c,h,p,x,L,I){this.tag=1,this.containerInfo=s,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=hc(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=hc(0),this.hiddenUpdates=hc(null),this.identifierPrefix=h,this.onUncaughtError=p,this.onCaughtError=x,this.onRecoverableError=L,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=I,this.incompleteTransitions=new Map}function Xg(s,a,c,h,p,x,L,I,M,X,ie,le){return s=new CS(s,a,c,L,I,M,X,le),a=1,x===!0&&(a|=24),x=qt(3,null,null,a),s.current=x,x.stateNode=s,a=Zc(),a.refCount++,s.pooledCache=a,a.refCount++,x.memoizedState={element:h,isDehydrated:c,cache:a},iu(x),s}function Qg(s){return s?(s=Bn,s):Bn}function Wg(s,a,c,h,p,x){p=Qg(p),h.context===null?h.context=p:h.pendingContext=p,h=xs(a),h.payload={element:c},x=x===void 0?null:x,x!==null&&(h.callback=x),c=Es(s,h,a),c!==null&&(Jt(c,s,a),Kr(c,s,a))}function Zg(s,a){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var c=s.retryLane;s.retryLane=c!==0&&c<a?c:a}}function xf(s,a){Zg(s,a),(s=s.alternate)&&Zg(s,a)}function Jg(s){if(s.tag===13){var a=Un(s,67108864);a!==null&&Jt(a,s,67108864),xf(s,67108864)}}var to=!0;function OS(s,a,c,h){var p=P.T;P.T=null;var x=W.p;try{W.p=2,Ef(s,a,c,h)}finally{W.p=x,P.T=p}}function NS(s,a,c,h){var p=P.T;P.T=null;var x=W.p;try{W.p=8,Ef(s,a,c,h)}finally{W.p=x,P.T=p}}function Ef(s,a,c,h){if(to){var p=Sf(h);if(p===null)lf(s,a,h,io,c),tp(s,h);else if(MS(p,s,a,c,h))h.stopPropagation();else if(tp(s,h),a&4&&-1<kS.indexOf(s)){for(;p!==null;){var x=Rn(p);if(x!==null)switch(x.tag){case 3:if(x=x.stateNode,x.current.memoizedState.isDehydrated){var L=Xs(x.pendingLanes);if(L!==0){var I=x;for(I.pendingLanes|=2,I.entangledLanes|=2;L;){var M=1<<31-Lt(L);I.entanglements[1]|=M,L&=~M}Ci(x),(He&6)===0&&(Fl=Qe()+500,ca(0))}}break;case 13:I=Un(x,2),I!==null&&Jt(I,x,2),$l(),xf(x,2)}if(x=Sf(h),x===null&&lf(s,a,h,io,c),x===p)break;p=x}p!==null&&h.stopPropagation()}else lf(s,a,h,null,c)}}function Sf(s){return s=Rc(s),Tf(s)}var io=null;function Tf(s){if(io=null,s=An(s),s!==null){var a=l(s);if(a===null)s=null;else{var c=a.tag;if(c===13){if(s=o(a),s!==null)return s;s=null}else if(c===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;s=null}else a!==s&&(s=null)}}return io=s,null}function ep(s){switch(s){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Pt()){case Ri:return 2;case Ut:return 8;case mi:case zi:return 32;case Ar:return 268435456;default:return 32}default:return 32}}var bf=!1,Ns=null,ks=null,Ms=null,ya=new Map,va=new Map,Ps=[],kS="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function tp(s,a){switch(s){case"focusin":case"focusout":Ns=null;break;case"dragenter":case"dragleave":ks=null;break;case"mouseover":case"mouseout":Ms=null;break;case"pointerover":case"pointerout":ya.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":va.delete(a.pointerId)}}function xa(s,a,c,h,p,x){return s===null||s.nativeEvent!==x?(s={blockedOn:a,domEventName:c,eventSystemFlags:h,nativeEvent:x,targetContainers:[p]},a!==null&&(a=Rn(a),a!==null&&Jg(a)),s):(s.eventSystemFlags|=h,a=s.targetContainers,p!==null&&a.indexOf(p)===-1&&a.push(p),s)}function MS(s,a,c,h,p){switch(a){case"focusin":return Ns=xa(Ns,s,a,c,h,p),!0;case"dragenter":return ks=xa(ks,s,a,c,h,p),!0;case"mouseover":return Ms=xa(Ms,s,a,c,h,p),!0;case"pointerover":var x=p.pointerId;return ya.set(x,xa(ya.get(x)||null,s,a,c,h,p)),!0;case"gotpointercapture":return x=p.pointerId,va.set(x,xa(va.get(x)||null,s,a,c,h,p)),!0}return!1}function ip(s){var a=An(s.target);if(a!==null){var c=l(a);if(c!==null){if(a=c.tag,a===13){if(a=o(c),a!==null){s.blockedOn=a,D1(s.priority,function(){if(c.tag===13){var h=Zt();h=mc(h);var p=Un(c,h);p!==null&&Jt(p,c,h),xf(c,h)}});return}}else if(a===3&&c.stateNode.current.memoizedState.isDehydrated){s.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}s.blockedOn=null}function so(s){if(s.blockedOn!==null)return!1;for(var a=s.targetContainers;0<a.length;){var c=Sf(s.nativeEvent);if(c===null){c=s.nativeEvent;var h=new c.constructor(c.type,c);Ac=h,c.target.dispatchEvent(h),Ac=null}else return a=Rn(c),a!==null&&Jg(a),s.blockedOn=c,!1;a.shift()}return!0}function sp(s,a,c){so(s)&&c.delete(a)}function PS(){bf=!1,Ns!==null&&so(Ns)&&(Ns=null),ks!==null&&so(ks)&&(ks=null),Ms!==null&&so(Ms)&&(Ms=null),ya.forEach(sp),va.forEach(sp)}function no(s,a){s.blockedOn===a&&(s.blockedOn=null,bf||(bf=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,PS)))}var ro=null;function np(s){ro!==s&&(ro=s,r.unstable_scheduleCallback(r.unstable_NormalPriority,function(){ro===s&&(ro=null);for(var a=0;a<s.length;a+=3){var c=s[a],h=s[a+1],p=s[a+2];if(typeof h!="function"){if(Tf(h||c)===null)continue;break}var x=Rn(c);x!==null&&(s.splice(a,3),a-=3,Su(x,{pending:!0,data:p,method:c.method,action:h},h,p))}}))}function Ea(s){function a(M){return no(M,s)}Ns!==null&&no(Ns,s),ks!==null&&no(ks,s),Ms!==null&&no(Ms,s),ya.forEach(a),va.forEach(a);for(var c=0;c<Ps.length;c++){var h=Ps[c];h.blockedOn===s&&(h.blockedOn=null)}for(;0<Ps.length&&(c=Ps[0],c.blockedOn===null);)ip(c),c.blockedOn===null&&Ps.shift();if(c=(s.ownerDocument||s).$$reactFormReplay,c!=null)for(h=0;h<c.length;h+=3){var p=c[h],x=c[h+1],L=p[Bt]||null;if(typeof x=="function")L||np(c);else if(L){var I=null;if(x&&x.hasAttribute("formAction")){if(p=x,L=x[Bt]||null)I=L.formAction;else if(Tf(p)!==null)continue}else I=L.action;typeof I=="function"?c[h+1]=I:(c.splice(h,3),h-=3),np(c)}}}function Af(s){this._internalRoot=s}ao.prototype.render=Af.prototype.render=function(s){var a=this._internalRoot;if(a===null)throw Error(i(409));var c=a.current,h=Zt();Wg(c,h,s,a,null,null)},ao.prototype.unmount=Af.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var a=s.containerInfo;Wg(s.current,2,null,s,null,null),$l(),a[bn]=null}};function ao(s){this._internalRoot=s}ao.prototype.unstable_scheduleHydration=function(s){if(s){var a=Sh();s={blockedOn:null,target:s,priority:a};for(var c=0;c<Ps.length&&a!==0&&a<Ps[c].priority;c++);Ps.splice(c,0,s),c===0&&ip(s)}};var rp=e.version;if(rp!=="19.1.0")throw Error(i(527,rp,"19.1.0"));W.findDOMNode=function(s){var a=s._reactInternals;if(a===void 0)throw typeof s.render=="function"?Error(i(188)):(s=Object.keys(s).join(","),Error(i(268,s)));return s=d(a),s=s!==null?f(s):null,s=s===null?null:s.stateNode,s};var US={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:P,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var lo=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!lo.isDisabled&&lo.supportsFiber)try{gi=lo.inject(US),Rt=lo}catch{}}return Ta.createRoot=function(s,a){if(!n(s))throw Error(i(299));var c=!1,h="",p=S0,x=T0,L=b0,I=null;return a!=null&&(a.unstable_strictMode===!0&&(c=!0),a.identifierPrefix!==void 0&&(h=a.identifierPrefix),a.onUncaughtError!==void 0&&(p=a.onUncaughtError),a.onCaughtError!==void 0&&(x=a.onCaughtError),a.onRecoverableError!==void 0&&(L=a.onRecoverableError),a.unstable_transitionCallbacks!==void 0&&(I=a.unstable_transitionCallbacks)),a=Xg(s,1,!1,null,null,c,h,p,x,L,I,null),s[bn]=a.current,af(s),new Af(a)},Ta.hydrateRoot=function(s,a,c){if(!n(s))throw Error(i(299));var h=!1,p="",x=S0,L=T0,I=b0,M=null,X=null;return c!=null&&(c.unstable_strictMode===!0&&(h=!0),c.identifierPrefix!==void 0&&(p=c.identifierPrefix),c.onUncaughtError!==void 0&&(x=c.onUncaughtError),c.onCaughtError!==void 0&&(L=c.onCaughtError),c.onRecoverableError!==void 0&&(I=c.onRecoverableError),c.unstable_transitionCallbacks!==void 0&&(M=c.unstable_transitionCallbacks),c.formState!==void 0&&(X=c.formState)),a=Xg(s,1,!0,a,c??null,h,p,x,L,I,M,X),a.context=Qg(null),c=a.current,h=Zt(),h=mc(h),p=xs(h),p.callback=null,Es(c,p,h),c=h,a.current.lanes=c,Lr(a,c),Ci(a),s[bn]=a.current,af(s),new ao(a)},Ta.version="19.1.0",Ta}var gp;function YS(){if(gp)return _f.exports;gp=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(e){console.error(e)}}return r(),_f.exports=KS(),_f.exports}var qS=YS();const XS=Ud(qS);var ba={},pp;function QS(){if(pp)return ba;pp=1,Object.defineProperty(ba,"__esModule",{value:!0}),ba.parse=o,ba.serialize=f;const r=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,e=/^[\u0021-\u003A\u003C-\u007E]*$/,t=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,i=/^[\u0020-\u003A\u003D-\u007E]*$/,n=Object.prototype.toString,l=(()=>{const v=function(){};return v.prototype=Object.create(null),v})();function o(v,E){const y=new l,S=v.length;if(S<2)return y;const T=(E==null?void 0:E.decode)||m;let R=0;do{const D=v.indexOf("=",R);if(D===-1)break;const _=v.indexOf(";",R),O=_===-1?S:_;if(D>O){R=v.lastIndexOf(";",D-1)+1;continue}const C=u(v,R,D),B=d(v,D,C),N=v.slice(C,B);if(y[N]===void 0){let F=u(v,D+1,O),z=d(v,O,F);const $=T(v.slice(F,z));y[N]=$}R=O+1}while(R<S);return y}function u(v,E,y){do{const S=v.charCodeAt(E);if(S!==32&&S!==9)return E}while(++E<y);return y}function d(v,E,y){for(;E>y;){const S=v.charCodeAt(--E);if(S!==32&&S!==9)return E+1}return y}function f(v,E,y){const S=(y==null?void 0:y.encode)||encodeURIComponent;if(!r.test(v))throw new TypeError(`argument name is invalid: ${v}`);const T=S(E);if(!e.test(T))throw new TypeError(`argument val is invalid: ${E}`);let R=v+"="+T;if(!y)return R;if(y.maxAge!==void 0){if(!Number.isInteger(y.maxAge))throw new TypeError(`option maxAge is invalid: ${y.maxAge}`);R+="; Max-Age="+y.maxAge}if(y.domain){if(!t.test(y.domain))throw new TypeError(`option domain is invalid: ${y.domain}`);R+="; Domain="+y.domain}if(y.path){if(!i.test(y.path))throw new TypeError(`option path is invalid: ${y.path}`);R+="; Path="+y.path}if(y.expires){if(!g(y.expires)||!Number.isFinite(y.expires.valueOf()))throw new TypeError(`option expires is invalid: ${y.expires}`);R+="; Expires="+y.expires.toUTCString()}if(y.httpOnly&&(R+="; HttpOnly"),y.secure&&(R+="; Secure"),y.partitioned&&(R+="; Partitioned"),y.priority)switch(typeof y.priority=="string"?y.priority.toLowerCase():void 0){case"low":R+="; Priority=Low";break;case"medium":R+="; Priority=Medium";break;case"high":R+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${y.priority}`)}if(y.sameSite)switch(typeof y.sameSite=="string"?y.sameSite.toLowerCase():y.sameSite){case!0:case"strict":R+="; SameSite=Strict";break;case"lax":R+="; SameSite=Lax";break;case"none":R+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${y.sameSite}`)}return R}function m(v){if(v.indexOf("%")===-1)return v;try{return decodeURIComponent(v)}catch{return v}}function g(v){return n.call(v)==="[object Date]"}return ba}QS();var yp="popstate";function WS(r={}){function e(i,n){let{pathname:l,search:o,hash:u}=i.location;return ad("",{pathname:l,search:o,hash:u},n.state&&n.state.usr||null,n.state&&n.state.key||"default")}function t(i,n){return typeof n=="string"?n:Oa(n)}return JS(e,t,null,r)}function st(r,e){if(r===!1||r===null||typeof r>"u")throw new Error(e)}function Ti(r,e){if(!r){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function ZS(){return Math.random().toString(36).substring(2,10)}function vp(r,e){return{usr:r.state,key:r.key,idx:e}}function ad(r,e,t=null,i){return{pathname:typeof r=="string"?r:r.pathname,search:"",hash:"",...typeof e=="string"?xr(e):e,state:t,key:e&&e.key||i||ZS()}}function Oa({pathname:r="/",search:e="",hash:t=""}){return e&&e!=="?"&&(r+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(r+=t.charAt(0)==="#"?t:"#"+t),r}function xr(r){let e={};if(r){let t=r.indexOf("#");t>=0&&(e.hash=r.substring(t),r=r.substring(0,t));let i=r.indexOf("?");i>=0&&(e.search=r.substring(i),r=r.substring(0,i)),r&&(e.pathname=r)}return e}function JS(r,e,t,i={}){let{window:n=document.defaultView,v5Compat:l=!1}=i,o=n.history,u="POP",d=null,f=m();f==null&&(f=0,o.replaceState({...o.state,idx:f},""));function m(){return(o.state||{idx:null}).idx}function g(){u="POP";let T=m(),R=T==null?null:T-f;f=T,d&&d({action:u,location:S.location,delta:R})}function v(T,R){u="PUSH";let D=ad(S.location,T,R);f=m()+1;let _=vp(D,f),O=S.createHref(D);try{o.pushState(_,"",O)}catch(C){if(C instanceof DOMException&&C.name==="DataCloneError")throw C;n.location.assign(O)}l&&d&&d({action:u,location:S.location,delta:1})}function E(T,R){u="REPLACE";let D=ad(S.location,T,R);f=m();let _=vp(D,f),O=S.createHref(D);o.replaceState(_,"",O),l&&d&&d({action:u,location:S.location,delta:0})}function y(T){return eT(T)}let S={get action(){return u},get location(){return r(n,o)},listen(T){if(d)throw new Error("A history only accepts one active listener");return n.addEventListener(yp,g),d=T,()=>{n.removeEventListener(yp,g),d=null}},createHref(T){return e(n,T)},createURL:y,encodeLocation(T){let R=y(T);return{pathname:R.pathname,search:R.search,hash:R.hash}},push:v,replace:E,go(T){return o.go(T)}};return S}function eT(r,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),st(t,"No window.location.(origin|href) available to create URL");let i=typeof r=="string"?r:Oa(r);return i=i.replace(/ $/,"%20"),!e&&i.startsWith("//")&&(i=t+i),new URL(i,t)}function cv(r,e,t="/"){return tT(r,e,t,!1)}function tT(r,e,t,i){let n=typeof e=="string"?xr(e):e,l=hs(n.pathname||"/",t);if(l==null)return null;let o=uv(r);iT(o);let u=null;for(let d=0;u==null&&d<o.length;++d){let f=hT(l);u=fT(o[d],f,i)}return u}function uv(r,e=[],t=[],i=""){let n=(l,o,u)=>{let d={relativePath:u===void 0?l.path||"":u,caseSensitive:l.caseSensitive===!0,childrenIndex:o,route:l};d.relativePath.startsWith("/")&&(st(d.relativePath.startsWith(i),`Absolute route path "${d.relativePath}" nested under path "${i}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),d.relativePath=d.relativePath.slice(i.length));let f=ds([i,d.relativePath]),m=t.concat(d);l.children&&l.children.length>0&&(st(l.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${f}".`),uv(l.children,e,m,f)),!(l.path==null&&!l.index)&&e.push({path:f,score:cT(f,l.index),routesMeta:m})};return r.forEach((l,o)=>{var u;if(l.path===""||!((u=l.path)!=null&&u.includes("?")))n(l,o);else for(let d of fv(l.path))n(l,o,d)}),e}function fv(r){let e=r.split("/");if(e.length===0)return[];let[t,...i]=e,n=t.endsWith("?"),l=t.replace(/\?$/,"");if(i.length===0)return n?[l,""]:[l];let o=fv(i.join("/")),u=[];return u.push(...o.map(d=>d===""?l:[l,d].join("/"))),n&&u.push(...o),u.map(d=>r.startsWith("/")&&d===""?"/":d)}function iT(r){r.sort((e,t)=>e.score!==t.score?t.score-e.score:uT(e.routesMeta.map(i=>i.childrenIndex),t.routesMeta.map(i=>i.childrenIndex)))}var sT=/^:[\w-]+$/,nT=3,rT=2,aT=1,lT=10,oT=-2,xp=r=>r==="*";function cT(r,e){let t=r.split("/"),i=t.length;return t.some(xp)&&(i+=oT),e&&(i+=rT),t.filter(n=>!xp(n)).reduce((n,l)=>n+(sT.test(l)?nT:l===""?aT:lT),i)}function uT(r,e){return r.length===e.length&&r.slice(0,-1).every((i,n)=>i===e[n])?r[r.length-1]-e[e.length-1]:0}function fT(r,e,t=!1){let{routesMeta:i}=r,n={},l="/",o=[];for(let u=0;u<i.length;++u){let d=i[u],f=u===i.length-1,m=l==="/"?e:e.slice(l.length)||"/",g=Fo({path:d.relativePath,caseSensitive:d.caseSensitive,end:f},m),v=d.route;if(!g&&f&&t&&!i[i.length-1].route.index&&(g=Fo({path:d.relativePath,caseSensitive:d.caseSensitive,end:!1},m)),!g)return null;Object.assign(n,g.params),o.push({params:n,pathname:ds([l,g.pathname]),pathnameBase:yT(ds([l,g.pathnameBase])),route:v}),g.pathnameBase!=="/"&&(l=ds([l,g.pathnameBase]))}return o}function Fo(r,e){typeof r=="string"&&(r={path:r,caseSensitive:!1,end:!0});let[t,i]=dT(r.path,r.caseSensitive,r.end),n=e.match(t);if(!n)return null;let l=n[0],o=l.replace(/(.)\/+$/,"$1"),u=n.slice(1);return{params:i.reduce((f,{paramName:m,isOptional:g},v)=>{if(m==="*"){let y=u[v]||"";o=l.slice(0,l.length-y.length).replace(/(.)\/+$/,"$1")}const E=u[v];return g&&!E?f[m]=void 0:f[m]=(E||"").replace(/%2F/g,"/"),f},{}),pathname:l,pathnameBase:o,pattern:r}}function dT(r,e=!1,t=!0){Ti(r==="*"||!r.endsWith("*")||r.endsWith("/*"),`Route path "${r}" will be treated as if it were "${r.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${r.replace(/\*$/,"/*")}".`);let i=[],n="^"+r.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,u,d)=>(i.push({paramName:u,isOptional:d!=null}),d?"/?([^\\/]+)?":"/([^\\/]+)"));return r.endsWith("*")?(i.push({paramName:"*"}),n+=r==="*"||r==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?n+="\\/*$":r!==""&&r!=="/"&&(n+="(?:(?=\\/|$))"),[new RegExp(n,e?void 0:"i"),i]}function hT(r){try{return r.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Ti(!1,`The URL path "${r}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),r}}function hs(r,e){if(e==="/")return r;if(!r.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,i=r.charAt(t);return i&&i!=="/"?null:r.slice(t)||"/"}function mT(r,e="/"){let{pathname:t,search:i="",hash:n=""}=typeof r=="string"?xr(r):r;return{pathname:t?t.startsWith("/")?t:gT(t,e):e,search:vT(i),hash:xT(n)}}function gT(r,e){let t=e.replace(/\/+$/,"").split("/");return r.split("/").forEach(n=>{n===".."?t.length>1&&t.pop():n!=="."&&t.push(n)}),t.length>1?t.join("/"):"/"}function Cf(r,e,t,i){return`Cannot include a '${r}' character in a manually specified \`to.${e}\` field [${JSON.stringify(i)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function pT(r){return r.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function dv(r){let e=pT(r);return e.map((t,i)=>i===e.length-1?t.pathname:t.pathnameBase)}function hv(r,e,t,i=!1){let n;typeof r=="string"?n=xr(r):(n={...r},st(!n.pathname||!n.pathname.includes("?"),Cf("?","pathname","search",n)),st(!n.pathname||!n.pathname.includes("#"),Cf("#","pathname","hash",n)),st(!n.search||!n.search.includes("#"),Cf("#","search","hash",n)));let l=r===""||n.pathname==="",o=l?"/":n.pathname,u;if(o==null)u=t;else{let g=e.length-1;if(!i&&o.startsWith("..")){let v=o.split("/");for(;v[0]==="..";)v.shift(),g-=1;n.pathname=v.join("/")}u=g>=0?e[g]:"/"}let d=mT(n,u),f=o&&o!=="/"&&o.endsWith("/"),m=(l||o===".")&&t.endsWith("/");return!d.pathname.endsWith("/")&&(f||m)&&(d.pathname+="/"),d}var ds=r=>r.join("/").replace(/\/\/+/g,"/"),yT=r=>r.replace(/\/+$/,"").replace(/^\/*/,"/"),vT=r=>!r||r==="?"?"":r.startsWith("?")?r:"?"+r,xT=r=>!r||r==="#"?"":r.startsWith("#")?r:"#"+r;function ET(r){return r!=null&&typeof r.status=="number"&&typeof r.statusText=="string"&&typeof r.internal=="boolean"&&"data"in r}var mv=["POST","PUT","PATCH","DELETE"];new Set(mv);var ST=["GET",...mv];new Set(ST);var Er=U.createContext(null);Er.displayName="DataRouter";var ic=U.createContext(null);ic.displayName="DataRouterState";var gv=U.createContext({isTransitioning:!1});gv.displayName="ViewTransition";var TT=U.createContext(new Map);TT.displayName="Fetchers";var bT=U.createContext(null);bT.displayName="Await";var Gi=U.createContext(null);Gi.displayName="Navigation";var Ga=U.createContext(null);Ga.displayName="Location";var Hi=U.createContext({outlet:null,matches:[],isDataRoute:!1});Hi.displayName="Route";var Fd=U.createContext(null);Fd.displayName="RouteError";function AT(r,{relative:e}={}){st(Ha(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:i}=U.useContext(Gi),{hash:n,pathname:l,search:o}=Va(r,{relative:e}),u=l;return t!=="/"&&(u=l==="/"?t:ds([t,l])),i.createHref({pathname:u,search:o,hash:n})}function Ha(){return U.useContext(Ga)!=null}function bi(){return st(Ha(),"useLocation() may be used only in the context of a <Router> component."),U.useContext(Ga).location}var pv="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function yv(r){U.useContext(Gi).static||U.useLayoutEffect(r)}function zs(){let{isDataRoute:r}=U.useContext(Hi);return r?UT():RT()}function RT(){st(Ha(),"useNavigate() may be used only in the context of a <Router> component.");let r=U.useContext(Er),{basename:e,navigator:t}=U.useContext(Gi),{matches:i}=U.useContext(Hi),{pathname:n}=bi(),l=JSON.stringify(dv(i)),o=U.useRef(!1);return yv(()=>{o.current=!0}),U.useCallback((d,f={})=>{if(Ti(o.current,pv),!o.current)return;if(typeof d=="number"){t.go(d);return}let m=hv(d,JSON.parse(l),n,f.relative==="path");r==null&&e!=="/"&&(m.pathname=m.pathname==="/"?e:ds([e,m.pathname])),(f.replace?t.replace:t.push)(m,f.state,f)},[e,t,l,n,r])}U.createContext(null);function vv(){let{matches:r}=U.useContext(Hi),e=r[r.length-1];return e?e.params:{}}function Va(r,{relative:e}={}){let{matches:t}=U.useContext(Hi),{pathname:i}=bi(),n=JSON.stringify(dv(t));return U.useMemo(()=>hv(r,JSON.parse(n),i,e==="path"),[r,n,i,e])}function LT(r,e){return xv(r,e)}function xv(r,e,t,i){var D;st(Ha(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:n,static:l}=U.useContext(Gi),{matches:o}=U.useContext(Hi),u=o[o.length-1],d=u?u.params:{},f=u?u.pathname:"/",m=u?u.pathnameBase:"/",g=u&&u.route;{let _=g&&g.path||"";Ev(f,!g||_.endsWith("*")||_.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${f}" (under <Route path="${_}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${_}"> to <Route path="${_==="/"?"*":`${_}/*`}">.`)}let v=bi(),E;if(e){let _=typeof e=="string"?xr(e):e;st(m==="/"||((D=_.pathname)==null?void 0:D.startsWith(m)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${m}" but pathname "${_.pathname}" was given in the \`location\` prop.`),E=_}else E=v;let y=E.pathname||"/",S=y;if(m!=="/"){let _=m.replace(/^\//,"").split("/");S="/"+y.replace(/^\//,"").split("/").slice(_.length).join("/")}let T=!l&&t&&t.matches&&t.matches.length>0?t.matches:cv(r,{pathname:S});Ti(g||T!=null,`No routes matched location "${E.pathname}${E.search}${E.hash}" `),Ti(T==null||T[T.length-1].route.element!==void 0||T[T.length-1].route.Component!==void 0||T[T.length-1].route.lazy!==void 0,`Matched leaf route at location "${E.pathname}${E.search}${E.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let R=CT(T&&T.map(_=>Object.assign({},_,{params:Object.assign({},d,_.params),pathname:ds([m,n.encodeLocation?n.encodeLocation(_.pathname).pathname:_.pathname]),pathnameBase:_.pathnameBase==="/"?m:ds([m,n.encodeLocation?n.encodeLocation(_.pathnameBase).pathname:_.pathnameBase])})),o,t,i);return e&&R?U.createElement(Ga.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...E},navigationType:"POP"}},R):R}function _T(){let r=PT(),e=ET(r)?`${r.status} ${r.statusText}`:r instanceof Error?r.message:JSON.stringify(r),t=r instanceof Error?r.stack:null,i="rgba(200,200,200, 0.5)",n={padding:"0.5rem",backgroundColor:i},l={padding:"2px 4px",backgroundColor:i},o=null;return console.error("Error handled by React Router default ErrorBoundary:",r),o=U.createElement(U.Fragment,null,U.createElement("p",null,"💿 Hey developer 👋"),U.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",U.createElement("code",{style:l},"ErrorBoundary")," or"," ",U.createElement("code",{style:l},"errorElement")," prop on your route.")),U.createElement(U.Fragment,null,U.createElement("h2",null,"Unexpected Application Error!"),U.createElement("h3",{style:{fontStyle:"italic"}},e),t?U.createElement("pre",{style:n},t):null,o)}var DT=U.createElement(_T,null),wT=class extends U.Component{constructor(r){super(r),this.state={location:r.location,revalidation:r.revalidation,error:r.error}}static getDerivedStateFromError(r){return{error:r}}static getDerivedStateFromProps(r,e){return e.location!==r.location||e.revalidation!=="idle"&&r.revalidation==="idle"?{error:r.error,location:r.location,revalidation:r.revalidation}:{error:r.error!==void 0?r.error:e.error,location:e.location,revalidation:r.revalidation||e.revalidation}}componentDidCatch(r,e){console.error("React Router caught the following error during render",r,e)}render(){return this.state.error!==void 0?U.createElement(Hi.Provider,{value:this.props.routeContext},U.createElement(Fd.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function IT({routeContext:r,match:e,children:t}){let i=U.useContext(Er);return i&&i.static&&i.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=e.route.id),U.createElement(Hi.Provider,{value:r},t)}function CT(r,e=[],t=null,i=null){if(r==null){if(!t)return null;if(t.errors)r=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)r=t.matches;else return null}let n=r,l=t==null?void 0:t.errors;if(l!=null){let d=n.findIndex(f=>f.route.id&&(l==null?void 0:l[f.route.id])!==void 0);st(d>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(l).join(",")}`),n=n.slice(0,Math.min(n.length,d+1))}let o=!1,u=-1;if(t)for(let d=0;d<n.length;d++){let f=n[d];if((f.route.HydrateFallback||f.route.hydrateFallbackElement)&&(u=d),f.route.id){let{loaderData:m,errors:g}=t,v=f.route.loader&&!m.hasOwnProperty(f.route.id)&&(!g||g[f.route.id]===void 0);if(f.route.lazy||v){o=!0,u>=0?n=n.slice(0,u+1):n=[n[0]];break}}}return n.reduceRight((d,f,m)=>{let g,v=!1,E=null,y=null;t&&(g=l&&f.route.id?l[f.route.id]:void 0,E=f.route.errorElement||DT,o&&(u<0&&m===0?(Ev("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),v=!0,y=null):u===m&&(v=!0,y=f.route.hydrateFallbackElement||null)));let S=e.concat(n.slice(0,m+1)),T=()=>{let R;return g?R=E:v?R=y:f.route.Component?R=U.createElement(f.route.Component,null):f.route.element?R=f.route.element:R=d,U.createElement(IT,{match:f,routeContext:{outlet:d,matches:S,isDataRoute:t!=null},children:R})};return t&&(f.route.ErrorBoundary||f.route.errorElement||m===0)?U.createElement(wT,{location:t.location,revalidation:t.revalidation,component:E,error:g,children:T(),routeContext:{outlet:null,matches:S,isDataRoute:!0}}):T()},null)}function jd(r){return`${r} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function OT(r){let e=U.useContext(Er);return st(e,jd(r)),e}function NT(r){let e=U.useContext(ic);return st(e,jd(r)),e}function kT(r){let e=U.useContext(Hi);return st(e,jd(r)),e}function $d(r){let e=kT(r),t=e.matches[e.matches.length-1];return st(t.route.id,`${r} can only be used on routes that contain a unique "id"`),t.route.id}function MT(){return $d("useRouteId")}function PT(){var i;let r=U.useContext(Fd),e=NT("useRouteError"),t=$d("useRouteError");return r!==void 0?r:(i=e.errors)==null?void 0:i[t]}function UT(){let{router:r}=OT("useNavigate"),e=$d("useNavigate"),t=U.useRef(!1);return yv(()=>{t.current=!0}),U.useCallback(async(n,l={})=>{Ti(t.current,pv),t.current&&(typeof n=="number"?r.navigate(n):await r.navigate(n,{fromRouteId:e,...l}))},[r,e])}var Ep={};function Ev(r,e,t){!e&&!Ep[r]&&(Ep[r]=!0,Ti(!1,t))}U.memo(BT);function BT({routes:r,future:e,state:t}){return xv(r,void 0,t,e)}function ki(r){st(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function FT({basename:r="/",children:e=null,location:t,navigationType:i="POP",navigator:n,static:l=!1}){st(!Ha(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let o=r.replace(/^\/*/,"/"),u=U.useMemo(()=>({basename:o,navigator:n,static:l,future:{}}),[o,n,l]);typeof t=="string"&&(t=xr(t));let{pathname:d="/",search:f="",hash:m="",state:g=null,key:v="default"}=t,E=U.useMemo(()=>{let y=hs(d,o);return y==null?null:{location:{pathname:y,search:f,hash:m,state:g,key:v},navigationType:i}},[o,d,f,m,g,v,i]);return Ti(E!=null,`<Router basename="${o}"> is not able to match the URL "${d}${f}${m}" because it does not start with the basename, so the <Router> won't render anything.`),E==null?null:U.createElement(Gi.Provider,{value:u},U.createElement(Ga.Provider,{children:e,value:E}))}function jT({children:r,location:e}){return LT(ld(r),e)}function ld(r,e=[]){let t=[];return U.Children.forEach(r,(i,n)=>{if(!U.isValidElement(i))return;let l=[...e,n];if(i.type===U.Fragment){t.push.apply(t,ld(i.props.children,l));return}st(i.type===ki,`[${typeof i.type=="string"?i.type:i.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),st(!i.props.index||!i.props.children,"An index route cannot have child routes.");let o={id:i.props.id||l.join("-"),caseSensitive:i.props.caseSensitive,element:i.props.element,Component:i.props.Component,index:i.props.index,path:i.props.path,loader:i.props.loader,action:i.props.action,hydrateFallbackElement:i.props.hydrateFallbackElement,HydrateFallback:i.props.HydrateFallback,errorElement:i.props.errorElement,ErrorBoundary:i.props.ErrorBoundary,hasErrorBoundary:i.props.hasErrorBoundary===!0||i.props.ErrorBoundary!=null||i.props.errorElement!=null,shouldRevalidate:i.props.shouldRevalidate,handle:i.props.handle,lazy:i.props.lazy};i.props.children&&(o.children=ld(i.props.children,l)),t.push(o)}),t}var Ao="get",Ro="application/x-www-form-urlencoded";function sc(r){return r!=null&&typeof r.tagName=="string"}function $T(r){return sc(r)&&r.tagName.toLowerCase()==="button"}function GT(r){return sc(r)&&r.tagName.toLowerCase()==="form"}function HT(r){return sc(r)&&r.tagName.toLowerCase()==="input"}function VT(r){return!!(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)}function zT(r,e){return r.button===0&&(!e||e==="_self")&&!VT(r)}function od(r=""){return new URLSearchParams(typeof r=="string"||Array.isArray(r)||r instanceof URLSearchParams?r:Object.keys(r).reduce((e,t)=>{let i=r[t];return e.concat(Array.isArray(i)?i.map(n=>[t,n]):[[t,i]])},[]))}function KT(r,e){let t=od(r);return e&&e.forEach((i,n)=>{t.has(n)||e.getAll(n).forEach(l=>{t.append(n,l)})}),t}var oo=null;function YT(){if(oo===null)try{new FormData(document.createElement("form"),0),oo=!1}catch{oo=!0}return oo}var qT=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Of(r){return r!=null&&!qT.has(r)?(Ti(!1,`"${r}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Ro}"`),null):r}function XT(r,e){let t,i,n,l,o;if(GT(r)){let u=r.getAttribute("action");i=u?hs(u,e):null,t=r.getAttribute("method")||Ao,n=Of(r.getAttribute("enctype"))||Ro,l=new FormData(r)}else if($T(r)||HT(r)&&(r.type==="submit"||r.type==="image")){let u=r.form;if(u==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let d=r.getAttribute("formaction")||u.getAttribute("action");if(i=d?hs(d,e):null,t=r.getAttribute("formmethod")||u.getAttribute("method")||Ao,n=Of(r.getAttribute("formenctype"))||Of(u.getAttribute("enctype"))||Ro,l=new FormData(u,r),!YT()){let{name:f,type:m,value:g}=r;if(m==="image"){let v=f?`${f}.`:"";l.append(`${v}x`,"0"),l.append(`${v}y`,"0")}else f&&l.append(f,g)}}else{if(sc(r))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=Ao,i=null,n=Ro,o=r}return l&&n==="text/plain"&&(o=l,l=void 0),{action:i,method:t.toLowerCase(),encType:n,formData:l,body:o}}function Gd(r,e){if(r===!1||r===null||typeof r>"u")throw new Error(e)}async function QT(r,e){if(r.id in e)return e[r.id];try{let t=await import(r.module);return e[r.id]=t,t}catch(t){return console.error(`Error loading route module \`${r.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function WT(r){return r==null?!1:r.href==null?r.rel==="preload"&&typeof r.imageSrcSet=="string"&&typeof r.imageSizes=="string":typeof r.rel=="string"&&typeof r.href=="string"}async function ZT(r,e,t){let i=await Promise.all(r.map(async n=>{let l=e.routes[n.route.id];if(l){let o=await QT(l,t);return o.links?o.links():[]}return[]}));return ib(i.flat(1).filter(WT).filter(n=>n.rel==="stylesheet"||n.rel==="preload").map(n=>n.rel==="stylesheet"?{...n,rel:"prefetch",as:"style"}:{...n,rel:"prefetch"}))}function Sp(r,e,t,i,n,l){let o=(d,f)=>t[f]?d.route.id!==t[f].route.id:!0,u=(d,f)=>{var m;return t[f].pathname!==d.pathname||((m=t[f].route.path)==null?void 0:m.endsWith("*"))&&t[f].params["*"]!==d.params["*"]};return l==="assets"?e.filter((d,f)=>o(d,f)||u(d,f)):l==="data"?e.filter((d,f)=>{var g;let m=i.routes[d.route.id];if(!m||!m.hasLoader)return!1;if(o(d,f)||u(d,f))return!0;if(d.route.shouldRevalidate){let v=d.route.shouldRevalidate({currentUrl:new URL(n.pathname+n.search+n.hash,window.origin),currentParams:((g=t[0])==null?void 0:g.params)||{},nextUrl:new URL(r,window.origin),nextParams:d.params,defaultShouldRevalidate:!0});if(typeof v=="boolean")return v}return!0}):[]}function JT(r,e,{includeHydrateFallback:t}={}){return eb(r.map(i=>{let n=e.routes[i.route.id];if(!n)return[];let l=[n.module];return n.clientActionModule&&(l=l.concat(n.clientActionModule)),n.clientLoaderModule&&(l=l.concat(n.clientLoaderModule)),t&&n.hydrateFallbackModule&&(l=l.concat(n.hydrateFallbackModule)),n.imports&&(l=l.concat(n.imports)),l}).flat(1))}function eb(r){return[...new Set(r)]}function tb(r){let e={},t=Object.keys(r).sort();for(let i of t)e[i]=r[i];return e}function ib(r,e){let t=new Set;return new Set(e),r.reduce((i,n)=>{let l=JSON.stringify(tb(n));return t.has(l)||(t.add(l),i.push({key:l,link:n})),i},[])}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var sb=new Set([100,101,204,205]);function nb(r,e){let t=typeof r=="string"?new URL(r,typeof window>"u"?"server://singlefetch/":window.location.origin):r;return t.pathname==="/"?t.pathname="_root.data":e&&hs(t.pathname,e)==="/"?t.pathname=`${e.replace(/\/$/,"")}/_root.data`:t.pathname=`${t.pathname.replace(/\/$/,"")}.data`,t}function Sv(){let r=U.useContext(Er);return Gd(r,"You must render this element inside a <DataRouterContext.Provider> element"),r}function rb(){let r=U.useContext(ic);return Gd(r,"You must render this element inside a <DataRouterStateContext.Provider> element"),r}var Hd=U.createContext(void 0);Hd.displayName="FrameworkContext";function Tv(){let r=U.useContext(Hd);return Gd(r,"You must render this element inside a <HydratedRouter> element"),r}function ab(r,e){let t=U.useContext(Hd),[i,n]=U.useState(!1),[l,o]=U.useState(!1),{onFocus:u,onBlur:d,onMouseEnter:f,onMouseLeave:m,onTouchStart:g}=e,v=U.useRef(null);U.useEffect(()=>{if(r==="render"&&o(!0),r==="viewport"){let S=R=>{R.forEach(D=>{o(D.isIntersecting)})},T=new IntersectionObserver(S,{threshold:.5});return v.current&&T.observe(v.current),()=>{T.disconnect()}}},[r]),U.useEffect(()=>{if(i){let S=setTimeout(()=>{o(!0)},100);return()=>{clearTimeout(S)}}},[i]);let E=()=>{n(!0)},y=()=>{n(!1),o(!1)};return t?r!=="intent"?[l,v,{}]:[l,v,{onFocus:Aa(u,E),onBlur:Aa(d,y),onMouseEnter:Aa(f,E),onMouseLeave:Aa(m,y),onTouchStart:Aa(g,E)}]:[!1,v,{}]}function Aa(r,e){return t=>{r&&r(t),t.defaultPrevented||e(t)}}function lb({page:r,...e}){let{router:t}=Sv(),i=U.useMemo(()=>cv(t.routes,r,t.basename),[t.routes,r,t.basename]);return i?U.createElement(cb,{page:r,matches:i,...e}):null}function ob(r){let{manifest:e,routeModules:t}=Tv(),[i,n]=U.useState([]);return U.useEffect(()=>{let l=!1;return ZT(r,e,t).then(o=>{l||n(o)}),()=>{l=!0}},[r,e,t]),i}function cb({page:r,matches:e,...t}){let i=bi(),{manifest:n,routeModules:l}=Tv(),{basename:o}=Sv(),{loaderData:u,matches:d}=rb(),f=U.useMemo(()=>Sp(r,e,d,n,i,"data"),[r,e,d,n,i]),m=U.useMemo(()=>Sp(r,e,d,n,i,"assets"),[r,e,d,n,i]),g=U.useMemo(()=>{if(r===i.pathname+i.search+i.hash)return[];let y=new Set,S=!1;if(e.forEach(R=>{var _;let D=n.routes[R.route.id];!D||!D.hasLoader||(!f.some(O=>O.route.id===R.route.id)&&R.route.id in u&&((_=l[R.route.id])!=null&&_.shouldRevalidate)||D.hasClientLoader?S=!0:y.add(R.route.id))}),y.size===0)return[];let T=nb(r,o);return S&&y.size>0&&T.searchParams.set("_routes",e.filter(R=>y.has(R.route.id)).map(R=>R.route.id).join(",")),[T.pathname+T.search]},[o,u,i,n,f,e,r,l]),v=U.useMemo(()=>JT(m,n),[m,n]),E=ob(m);return U.createElement(U.Fragment,null,g.map(y=>U.createElement("link",{key:y,rel:"prefetch",as:"fetch",href:y,...t})),v.map(y=>U.createElement("link",{key:y,rel:"modulepreload",href:y,...t})),E.map(({key:y,link:S})=>U.createElement("link",{key:y,...S})))}function ub(...r){return e=>{r.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var bv=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{bv&&(window.__reactRouterVersion="7.6.0")}catch{}function fb({basename:r,children:e,window:t}){let i=U.useRef();i.current==null&&(i.current=WS({window:t,v5Compat:!0}));let n=i.current,[l,o]=U.useState({action:n.action,location:n.location}),u=U.useCallback(d=>{U.startTransition(()=>o(d))},[o]);return U.useLayoutEffect(()=>n.listen(u),[n,u]),U.createElement(FT,{basename:r,children:e,location:l.location,navigationType:l.action,navigator:n})}var Av=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Ae=U.forwardRef(function({onClick:e,discover:t="render",prefetch:i="none",relative:n,reloadDocument:l,replace:o,state:u,target:d,to:f,preventScrollReset:m,viewTransition:g,...v},E){let{basename:y}=U.useContext(Gi),S=typeof f=="string"&&Av.test(f),T,R=!1;if(typeof f=="string"&&S&&(T=f,bv))try{let z=new URL(window.location.href),$=f.startsWith("//")?new URL(z.protocol+f):new URL(f),ae=hs($.pathname,y);$.origin===z.origin&&ae!=null?f=ae+$.search+$.hash:R=!0}catch{Ti(!1,`<Link to="${f}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let D=AT(f,{relative:n}),[_,O,C]=ab(i,v),B=gb(f,{replace:o,state:u,target:d,preventScrollReset:m,relative:n,viewTransition:g});function N(z){e&&e(z),z.defaultPrevented||B(z)}let F=U.createElement("a",{...v,...C,href:T||D,onClick:R||l?e:N,ref:ub(E,O),target:d,"data-discover":!S&&t==="render"?"true":void 0});return _&&!S?U.createElement(U.Fragment,null,F,U.createElement(lb,{page:D})):F});Ae.displayName="Link";var db=U.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:i="",end:n=!1,style:l,to:o,viewTransition:u,children:d,...f},m){let g=Va(o,{relative:f.relative}),v=bi(),E=U.useContext(ic),{navigator:y,basename:S}=U.useContext(Gi),T=E!=null&&Sb(g)&&u===!0,R=y.encodeLocation?y.encodeLocation(g).pathname:g.pathname,D=v.pathname,_=E&&E.navigation&&E.navigation.location?E.navigation.location.pathname:null;t||(D=D.toLowerCase(),_=_?_.toLowerCase():null,R=R.toLowerCase()),_&&S&&(_=hs(_,S)||_);const O=R!=="/"&&R.endsWith("/")?R.length-1:R.length;let C=D===R||!n&&D.startsWith(R)&&D.charAt(O)==="/",B=_!=null&&(_===R||!n&&_.startsWith(R)&&_.charAt(R.length)==="/"),N={isActive:C,isPending:B,isTransitioning:T},F=C?e:void 0,z;typeof i=="function"?z=i(N):z=[i,C?"active":null,B?"pending":null,T?"transitioning":null].filter(Boolean).join(" ");let $=typeof l=="function"?l(N):l;return U.createElement(Ae,{...f,"aria-current":F,className:z,ref:m,style:$,to:o,viewTransition:u},typeof d=="function"?d(N):d)});db.displayName="NavLink";var hb=U.forwardRef(({discover:r="render",fetcherKey:e,navigate:t,reloadDocument:i,replace:n,state:l,method:o=Ao,action:u,onSubmit:d,relative:f,preventScrollReset:m,viewTransition:g,...v},E)=>{let y=xb(),S=Eb(u,{relative:f}),T=o.toLowerCase()==="get"?"get":"post",R=typeof u=="string"&&Av.test(u),D=_=>{if(d&&d(_),_.defaultPrevented)return;_.preventDefault();let O=_.nativeEvent.submitter,C=(O==null?void 0:O.getAttribute("formmethod"))||o;y(O||_.currentTarget,{fetcherKey:e,method:C,navigate:t,replace:n,state:l,relative:f,preventScrollReset:m,viewTransition:g})};return U.createElement("form",{ref:E,method:T,action:S,onSubmit:i?d:D,...v,"data-discover":!R&&r==="render"?"true":void 0})});hb.displayName="Form";function mb(r){return`${r} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Rv(r){let e=U.useContext(Er);return st(e,mb(r)),e}function gb(r,{target:e,replace:t,state:i,preventScrollReset:n,relative:l,viewTransition:o}={}){let u=zs(),d=bi(),f=Va(r,{relative:l});return U.useCallback(m=>{if(zT(m,e)){m.preventDefault();let g=t!==void 0?t:Oa(d)===Oa(f);u(r,{replace:g,state:i,preventScrollReset:n,relative:l,viewTransition:o})}},[d,u,f,t,i,e,r,n,l,o])}function pb(r){Ti(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let e=U.useRef(od(r)),t=U.useRef(!1),i=bi(),n=U.useMemo(()=>KT(i.search,t.current?null:e.current),[i.search]),l=zs(),o=U.useCallback((u,d)=>{const f=od(typeof u=="function"?u(n):u);t.current=!0,l("?"+f,d)},[l,n]);return[n,o]}var yb=0,vb=()=>`__${String(++yb)}__`;function xb(){let{router:r}=Rv("useSubmit"),{basename:e}=U.useContext(Gi),t=MT();return U.useCallback(async(i,n={})=>{let{action:l,method:o,encType:u,formData:d,body:f}=XT(i,e);if(n.navigate===!1){let m=n.fetcherKey||vb();await r.fetch(m,t,n.action||l,{preventScrollReset:n.preventScrollReset,formData:d,body:f,formMethod:n.method||o,formEncType:n.encType||u,flushSync:n.flushSync})}else await r.navigate(n.action||l,{preventScrollReset:n.preventScrollReset,formData:d,body:f,formMethod:n.method||o,formEncType:n.encType||u,replace:n.replace,state:n.state,fromRouteId:t,flushSync:n.flushSync,viewTransition:n.viewTransition})},[r,e,t])}function Eb(r,{relative:e}={}){let{basename:t}=U.useContext(Gi),i=U.useContext(Hi);st(i,"useFormAction must be used inside a RouteContext");let[n]=i.matches.slice(-1),l={...Va(r||".",{relative:e})},o=bi();if(r==null){l.search=o.search;let u=new URLSearchParams(l.search),d=u.getAll("index");if(d.some(m=>m==="")){u.delete("index"),d.filter(g=>g).forEach(g=>u.append("index",g));let m=u.toString();l.search=m?`?${m}`:""}}return(!r||r===".")&&n.route.index&&(l.search=l.search?l.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(l.pathname=l.pathname==="/"?t:ds([t,l.pathname])),Oa(l)}function Sb(r,e={}){let t=U.useContext(gv);st(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:i}=Rv("useViewTransitionState"),n=Va(r,{relative:e.relative});if(!t.isTransitioning)return!1;let l=hs(t.currentLocation.pathname,i)||t.currentLocation.pathname,o=hs(t.nextLocation.pathname,i)||t.nextLocation.pathname;return Fo(n.pathname,o)!=null||Fo(n.pathname,l)!=null}[...sb];var Lv={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},Tp=Si.createContext&&Si.createContext(Lv),Tb=["attr","size","title"];function bb(r,e){if(r==null)return{};var t=Ab(r,e),i,n;if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(r);for(n=0;n<l.length;n++)i=l[n],!(e.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(r,i)&&(t[i]=r[i])}return t}function Ab(r,e){if(r==null)return{};var t={};for(var i in r)if(Object.prototype.hasOwnProperty.call(r,i)){if(e.indexOf(i)>=0)continue;t[i]=r[i]}return t}function jo(){return jo=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=t[i])}return r},jo.apply(this,arguments)}function bp(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);e&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(r,n).enumerable})),t.push.apply(t,i)}return t}function $o(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?bp(Object(t),!0).forEach(function(i){Rb(r,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):bp(Object(t)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(t,i))})}return r}function Rb(r,e,t){return e=Lb(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function Lb(r){var e=_b(r,"string");return typeof e=="symbol"?e:e+""}function _b(r,e){if(typeof r!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var i=t.call(r,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function _v(r){return r&&r.map((e,t)=>Si.createElement(e.tag,$o({key:t},e.attr),_v(e.child)))}function Pe(r){return e=>Si.createElement(Db,jo({attr:$o({},r.attr)},e),_v(r.child))}function Db(r){var e=t=>{var{attr:i,size:n,title:l}=r,o=bb(r,Tb),u=n||t.size||"1em",d;return t.className&&(d=t.className),r.className&&(d=(d?d+" ":"")+r.className),Si.createElement("svg",jo({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,i,o,{className:d,style:$o($o({color:r.color||t.color},t.style),r.style),height:u,width:u,xmlns:"http://www.w3.org/2000/svg"}),l&&Si.createElement("title",null,l),r.children)};return Tp!==void 0?Si.createElement(Tp.Consumer,null,t=>e(t)):e(Lv)}function wb(r){return Pe({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M524.531,69.836a1.5,1.5,0,0,0-.764-.7A485.065,485.065,0,0,0,404.081,32.03a1.816,1.816,0,0,0-1.923.91,337.461,337.461,0,0,0-14.9,30.6,447.848,447.848,0,0,0-134.426,0,309.541,309.541,0,0,0-15.135-30.6,1.89,1.89,0,0,0-1.924-.91A483.689,483.689,0,0,0,116.085,69.137a1.712,1.712,0,0,0-.788.676C39.068,183.651,18.186,294.69,28.43,404.354a2.016,2.016,0,0,0,.765,1.375A487.666,487.666,0,0,0,176.02,479.918a1.9,1.9,0,0,0,2.063-.676A348.2,348.2,0,0,0,208.12,430.4a1.86,1.86,0,0,0-1.019-2.588,321.173,321.173,0,0,1-45.868-21.853,1.885,1.885,0,0,1-.185-3.126c3.082-2.309,6.166-4.711,9.109-7.137a1.819,1.819,0,0,1,1.9-.256c96.229,43.917,200.41,43.917,295.5,0a1.812,1.812,0,0,1,1.924.233c2.944,2.426,6.027,4.851,9.132,7.16a1.884,1.884,0,0,1-.162,3.126,301.407,301.407,0,0,1-45.89,21.83,1.875,1.875,0,0,0-1,2.611,391.055,391.055,0,0,0,30.014,48.815,1.864,1.864,0,0,0,2.063.7A486.048,486.048,0,0,0,610.7,405.729a1.882,1.882,0,0,0,.765-1.352C623.729,277.594,590.933,167.465,524.531,69.836ZM222.491,337.58c-28.972,0-52.844-26.587-52.844-59.239S193.056,219.1,222.491,219.1c29.665,0,53.306,26.82,52.843,59.239C275.334,310.993,251.924,337.58,222.491,337.58Zm195.38,0c-28.971,0-52.843-26.587-52.843-59.239S388.437,219.1,417.871,219.1c29.667,0,53.307,26.82,52.844,59.239C470.715,310.993,447.538,337.58,417.871,337.58Z"},child:[]}]})(r)}function Ib(r){return Pe({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"},child:[]}]})(r)}function Cb(r){return Pe({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"},child:[]}]})(r)}function Ob(r){return Pe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"},child:[]}]})(r)}function Nb(r){return Pe({attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M143 352.3L7 216.3c-9.4-9.4-9.4-24.6 0-33.9l22.6-22.6c9.4-9.4 24.6-9.4 33.9 0l96.4 96.4 96.4-96.4c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9l-136 136c-9.2 9.4-24.4 9.4-33.8 0z"},child:[]}]})(r)}function kb(r){return Pe({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M257.5 445.1l-22.2 22.2c-9.4 9.4-24.6 9.4-33.9 0L7 273c-9.4-9.4-9.4-24.6 0-33.9L201.4 44.7c9.4-9.4 24.6-9.4 33.9 0l22.2 22.2c9.5 9.5 9.3 25-.4 34.3L136.6 216H424c13.3 0 24 10.7 24 24v32c0 13.3-10.7 24-24 24H136.6l120.5 114.8c9.8 9.3 10 24.8.4 34.3z"},child:[]}]})(r)}function Mb(r){return Pe({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M190.5 66.9l22.2-22.2c9.4-9.4 24.6-9.4 33.9 0L441 239c9.4 9.4 9.4 24.6 0 33.9L246.6 467.3c-9.4 9.4-24.6 9.4-33.9 0l-22.2-22.2c-9.5-9.5-9.3-25 .4-34.3L311.4 296H24c-13.3 0-24-10.7-24-24v-32c0-13.3 10.7-24 24-24h287.4L190.9 101.2c-9.8-9.3-10-24.8-.4-34.3z"},child:[]}]})(r)}function Ap(r){return Pe({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M0 512V48C0 21.49 21.49 0 48 0h288c26.51 0 48 21.49 48 48v464L192 400 0 512z"},child:[]}]})(r)}function Rp(r){return Pe({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M0 464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V192H0v272zm320-196c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zm0 128c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zM192 268c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zm0 128c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zM64 268c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H76c-6.6 0-12-5.4-12-12v-40zm0 128c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H76c-6.6 0-12-5.4-12-12v-40zM400 64h-48V16c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v48H160V16c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v48H48C21.5 64 0 85.5 0 112v48h448v-48c0-26.5-21.5-48-48-48z"},child:[]}]})(r)}function Pb(r){return Pe({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M207.029 381.476L12.686 187.132c-9.373-9.373-9.373-24.569 0-33.941l22.667-22.667c9.357-9.357 24.522-9.375 33.901-.04L224 284.505l154.745-154.021c9.379-9.335 24.544-9.317 33.901.04l22.667 22.667c9.373 9.373 9.373 24.569 0 33.941L240.971 381.476c-9.373 9.372-24.569 9.372-33.942 0z"},child:[]}]})(r)}function Dv(r){return Pe({attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M34.52 239.03L228.87 44.69c9.37-9.37 24.57-9.37 33.94 0l22.67 22.67c9.36 9.36 9.37 24.52.04 33.9L131.49 256l154.02 154.75c9.34 9.38 9.32 24.54-.04 33.9l-22.67 22.67c-9.37 9.37-24.57 9.37-33.94 0L34.52 272.97c-9.37-9.37-9.37-24.57 0-33.94z"},child:[]}]})(r)}function Vd(r){return Pe({attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"},child:[]}]})(r)}function Lp(r){return Pe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M256,8C119,8,8,119,8,256S119,504,256,504,504,393,504,256,393,8,256,8Zm92.49,313h0l-20,25a16,16,0,0,1-22.49,2.5h0l-67-49.72a40,40,0,0,1-15-31.23V112a16,16,0,0,1,16-16h32a16,16,0,0,1,16,16V256l58,42.5A16,16,0,0,1,348.49,321Z"},child:[]}]})(r)}function Ub(r){return Pe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M487.4 315.7l-42.6-24.6c4.3-23.2 4.3-47 0-70.2l42.6-24.6c4.9-2.8 7.1-8.6 5.5-14-11.1-35.6-30-67.8-54.7-94.6-3.8-4.1-10-5.1-14.8-2.3L380.8 110c-17.9-15.4-38.5-27.3-60.8-35.1V25.8c0-5.6-3.9-10.5-9.4-11.7-36.7-8.2-74.3-7.8-109.2 0-5.5 1.2-9.4 6.1-9.4 11.7V75c-22.2 7.9-42.8 19.8-60.8 35.1L88.7 85.5c-4.9-2.8-11-1.9-14.8 2.3-24.7 26.7-43.6 58.9-54.7 94.6-1.7 5.4.6 11.2 5.5 14L67.3 221c-4.3 23.2-4.3 47 0 70.2l-42.6 24.6c-4.9 2.8-7.1 8.6-5.5 14 11.1 35.6 30 67.8 54.7 94.6 3.8 4.1 10 5.1 14.8 2.3l42.6-24.6c17.9 15.4 38.5 27.3 60.8 35.1v49.2c0 5.6 3.9 10.5 9.4 11.7 36.7 8.2 74.3 7.8 109.2 0 5.5-1.2 9.4-6.1 9.4-11.7v-49.2c22.2-7.9 42.8-19.8 60.8-35.1l42.6 24.6c4.9 2.8 11 1.9 14.8-2.3 24.7-26.7 43.6-58.9 54.7-94.6 1.5-5.5-.7-11.3-5.6-14.1zM256 336c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z"},child:[]}]})(r)}function _p(r){return Pe({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M225.38 233.37c-12.5 12.5-12.5 32.76 0 45.25 12.49 12.5 32.76 12.5 45.25 0 12.5-12.5 12.5-32.76 0-45.25-12.5-12.49-32.76-12.49-45.25 0zM248 8C111.03 8 0 119.03 0 256s111.03 248 248 248 248-111.03 248-248S384.97 8 248 8zm126.14 148.05L308.17 300.4a31.938 31.938 0 0 1-15.77 15.77l-144.34 65.97c-16.65 7.61-33.81-9.55-26.2-26.2l65.98-144.35a31.938 31.938 0 0 1 15.77-15.77l144.34-65.97c16.65-7.6 33.8 9.55 26.19 26.2z"},child:[]}]})(r)}function wv(r){return Pe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V400c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5 0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"},child:[]}]})(r)}function cd(r){return Pe({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M320 400c-75.85 0-137.25-58.71-142.9-133.11L72.2 185.82c-13.79 17.3-26.48 35.59-36.72 55.59a32.35 32.35 0 0 0 0 29.19C89.71 376.41 197.07 448 320 448c26.91 0 52.87-4 77.89-10.46L346 397.39a144.13 144.13 0 0 1-26 2.61zm313.82 58.1l-110.55-85.44a331.25 331.25 0 0 0 81.25-102.07 32.35 32.35 0 0 0 0-29.19C550.29 135.59 442.93 64 320 64a308.15 308.15 0 0 0-147.32 37.7L45.46 3.37A16 16 0 0 0 23 6.18L3.37 31.45A16 16 0 0 0 6.18 53.9l588.36 454.73a16 16 0 0 0 22.46-2.81l19.64-25.27a16 16 0 0 0-2.82-22.45zm-183.72-142l-39.3-30.38A94.75 94.75 0 0 0 416 256a94.76 94.76 0 0 0-121.31-92.21A47.65 47.65 0 0 1 304 192a46.64 46.64 0 0 1-1.54 10l-73.61-56.89A142.31 142.31 0 0 1 320 112a143.92 143.92 0 0 1 144 144c0 21.63-5.29 41.79-13.9 60.11z"},child:[]}]})(r)}function ud(r){return Pe({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M572.52 241.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288 400a144 144 0 1 1 144-144 143.93 143.93 0 0 1-144 144zm0-240a95.31 95.31 0 0 0-25.31 3.79 47.85 47.85 0 0 1-66.9 66.9A95.78 95.78 0 1 0 288 160z"},child:[]}]})(r)}function Bb(r){return Pe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M487.976 0H24.028C2.71 0-8.047 25.866 7.058 40.971L192 225.941V432c0 7.831 3.821 15.17 10.237 19.662l80 55.98C298.02 518.69 320 507.493 320 487.98V225.941l184.947-184.97C520.021 25.896 509.338 0 487.976 0z"},child:[]}]})(r)}function Dp(r){return Pe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M504 255.531c.253 136.64-111.18 248.372-247.82 248.468-59.015.042-113.223-20.53-155.822-54.911-11.077-8.94-11.905-25.541-1.839-35.607l11.267-11.267c8.609-8.609 22.353-9.551 31.891-1.984C173.062 425.135 212.781 440 256 440c101.705 0 184-82.311 184-184 0-101.705-82.311-184-184-184-48.814 0-93.149 18.969-126.068 49.932l50.754 50.754c10.08 10.08 2.941 27.314-11.313 27.314H24c-8.837 0-16-7.163-16-16V38.627c0-14.254 17.234-21.393 27.314-11.314l49.372 49.372C129.209 34.136 189.552 8 256 8c136.81 0 247.747 110.78 248 247.531zm-180.912 78.784l9.823-12.63c8.138-10.463 6.253-25.542-4.21-33.679L288 256.349V152c0-13.255-10.745-24-24-24h-16c-13.255 0-24 10.745-24 24v135.651l65.409 50.874c10.463 8.137 25.541 6.253 33.679-4.21z"},child:[]}]})(r)}function wp(r){return Pe({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M280.37 148.26L96 300.11V464a16 16 0 0 0 16 16l112.06-.29a16 16 0 0 0 15.92-16V368a16 16 0 0 1 16-16h64a16 16 0 0 1 16 16v95.64a16 16 0 0 0 16 16.05L464 480a16 16 0 0 0 16-16V300L295.67 148.26a12.19 12.19 0 0 0-15.3 0zM571.6 251.47L488 182.56V44.05a12 12 0 0 0-12-12h-56a12 12 0 0 0-12 12v72.61L318.47 43a48 48 0 0 0-61 0L4.34 251.47a12 12 0 0 0-1.6 16.9l25.5 31A12 12 0 0 0 45.15 301l235.22-193.74a12.19 12.19 0 0 1 15.3 0L530.9 301a12 12 0 0 0 16.9-1.6l25.5-31a12 12 0 0 0-1.7-16.93z"},child:[]}]})(r)}function Fb(r){return Pe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M48 48a48 48 0 1 0 48 48 48 48 0 0 0-48-48zm0 160a48 48 0 1 0 48 48 48 48 0 0 0-48-48zm0 160a48 48 0 1 0 48 48 48 48 0 0 0-48-48zm448 16H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16z"},child:[]}]})(r)}function fd(r){return Pe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M80 368H16a16 16 0 0 0-16 16v64a16 16 0 0 0 16 16h64a16 16 0 0 0 16-16v-64a16 16 0 0 0-16-16zm0-320H16A16 16 0 0 0 0 64v64a16 16 0 0 0 16 16h64a16 16 0 0 0 16-16V64a16 16 0 0 0-16-16zm0 160H16a16 16 0 0 0-16 16v64a16 16 0 0 0 16 16h64a16 16 0 0 0 16-16v-64a16 16 0 0 0-16-16zm416 176H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16z"},child:[]}]})(r)}function dd(r){return Pe({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M400 224h-24v-72C376 68.2 307.8 0 224 0S72 68.2 72 152v72H48c-26.5 0-48 21.5-48 48v192c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V272c0-26.5-21.5-48-48-48zm-104 0H152v-72c0-39.7 32.3-72 72-72s72 32.3 72 72v72z"},child:[]}]})(r)}function Lo(r){return Pe({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M424.4 214.7L72.4 6.6C43.8-10.3 0 6.1 0 47.9V464c0 37.5 40.7 60.1 72.4 41.3l352-208c31.4-18.5 31.5-64.1 0-82.6z"},child:[]}]})(r)}function Iv(r){return Pe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"},child:[]}]})(r)}function Ip(r){return Pe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M416 448h-84c-6.6 0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h84c17.7 0 32-14.3 32-32V160c0-17.7-14.3-32-32-32h-84c-6.6 0-12-5.4-12-12V76c0-6.6 5.4-12 12-12h84c53 0 96 43 96 96v192c0 53-43 96-96 96zm-47-201L201 79c-15-15-41-4.5-41 17v96H24c-13.3 0-24 10.7-24 24v96c0 13.3 10.7 24 24 24h136v96c0 21.5 26 32 41 17l168-168c9.3-9.4 9.3-24.6 0-34z"},child:[]}]})(r)}function jb(r){return Pe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M497 273L329 441c-15 15-41 4.5-41-17v-96H152c-13.3 0-24-10.7-24-24v-96c0-13.3 10.7-24 24-24h136V88c0-21.4 25.9-32 41-17l168 168c9.3 9.4 9.3 24.6 0 34zM192 436v-40c0-6.6-5.4-12-12-12H96c-17.7 0-32-14.3-32-32V160c0-17.7 14.3-32 32-32h84c6.6 0 12-5.4 12-12V76c0-6.6-5.4-12-12-12H96c-53 0-96 43-96 96v192c0 53 43 96 96 96h84c6.6 0 12-5.4 12-12z"},child:[]}]})(r)}function $b(r){return Pe({attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M41 288h238c21.4 0 32.1 25.9 17 41L177 448c-9.4 9.4-24.6 9.4-33.9 0L24 329c-15.1-15.1-4.4-41 17-41zm255-105L177 64c-9.4-9.4-24.6-9.4-33.9 0L24 183c-15.1 15.1-4.4 41 17 41h238c21.4 0 32.1-25.9 17-41z"},child:[]}]})(r)}function Cv(r){return Pe({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"},child:[]}]})(r)}function Gb(r){return Pe({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M296 32h192c13.255 0 24 10.745 24 24v160c0 13.255-10.745 24-24 24H296c-13.255 0-24-10.745-24-24V56c0-13.255 10.745-24 24-24zm-80 0H24C10.745 32 0 42.745 0 56v160c0 13.255 10.745 24 24 24h192c13.255 0 24-10.745 24-24V56c0-13.255-10.745-24-24-24zM0 296v160c0 13.255 10.745 24 24 24h192c13.255 0 24-10.745 24-24V296c0-13.255-10.745-24-24-24H24c-13.255 0-24 10.745-24 24zm296 184h192c13.255 0 24-10.745 24-24V296c0-13.255-10.745-24-24-24H296c-13.255 0-24 10.745-24 24v160c0 13.255 10.745 24 24 24z"},child:[]}]})(r)}function Cp(r){return Pe({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M624 208h-64v-64c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v64h-64c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h64v64c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16v-64h64c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm-400 48c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"},child:[]}]})(r)}function Go(r){return Pe({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"},child:[]}]})(r)}const Hb=({items:r,autoPlayInterval:e=5e3})=>{const[t,i]=U.useState(0),[n,l]=U.useState("right"),[o,u]=U.useState(!1),[d,f]=U.useState({}),m=U.useRef([]);U.useEffect(()=>{if(r.length)return r.forEach((D,_)=>{const O=new Image;O.onload=()=>{f(C=>({...C,[_]:!0}))},O.src=D.bannerImage||D.coverImage,m.current[_]=O}),f({0:!0}),()=>{m.current.forEach(D=>{D&&(D.onload=null)})}},[r]);const g=D=>d[D]===!0,v=()=>{if(o)return;const D=(t+1)%r.length;if(!g(D)){const _=new Image;_.onload=()=>{f(O=>({...O,[D]:!0})),S("right",D)},_.src=r[D].bannerImage||r[D].coverImage;return}S("right",D)},E=()=>{if(o)return;const D=t===0?r.length-1:t-1;if(!g(D)){const _=new Image;_.onload=()=>{f(O=>({...O,[D]:!0})),S("left",D)},_.src=r[D].bannerImage||r[D].coverImage;return}S("left",D)},y=D=>{if(!(o||D===t)){if(!g(D)){const _=new Image;_.onload=()=>{f(O=>({...O,[D]:!0})),S(D>t?"right":"left",D)},_.src=r[D].bannerImage||r[D].coverImage;return}S(D>t?"right":"left",D)}},S=(D,_)=>{l(D),u(!0),setTimeout(()=>{i(_),u(!1)},300)};if(U.useEffect(()=>{if(!e||r.length<=1)return;const D=(t+1)%r.length;if(!g(D)){const O=new Image;O.onload=()=>{f(C=>({...C,[D]:!0}))},O.src=r[D].bannerImage||r[D].coverImage}const _=setInterval(()=>{!o&&g(D)&&v()},e);return()=>clearInterval(_)},[t,e,o,r]),!r.length)return null;const T=r[t],R=T.bannerImage||T.coverImage;return b.jsx("div",{className:"relative overflow-hidden",children:b.jsxs("div",{className:"relative h-[50vh] md:h-[70vh] w-full",children:[!g(t)&&b.jsx("div",{className:"absolute inset-0 bg-jet-black flex items-center justify-center z-10",children:b.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}),b.jsxs("div",{className:`absolute inset-0 transition-transform duration-300 ease-in-out ${o?n==="right"?"translate-x-full opacity-0":"-translate-x-full opacity-0":"translate-x-0 opacity-100"}`,children:[b.jsx("img",{src:R,alt:T.title,className:"w-full h-full object-cover transition-all duration-300 group-hover:scale-105"}),b.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-black/80 via-black/50 to-black/30"})]}),b.jsx("div",{className:`container relative h-full flex items-center z-10 transition-all duration-300 ${o?"opacity-0":"opacity-100"}`,children:b.jsxs("div",{className:"max-w-2xl px-4 py-8",children:[b.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-white mb-4",children:T.title}),b.jsxs("div",{className:"flex flex-wrap mb-4",children:[T.genres.map((D,_)=>b.jsx("span",{className:"text-xs text-white bg-primary-700 rounded-full px-2 py-0.5 mr-2 mb-2",children:D},_)),b.jsx("span",{className:"text-xs text-white bg-gray-700 rounded-full px-2 py-0.5 mr-2 mb-2",children:T.releaseYear}),b.jsx("span",{className:`text-xs text-white ${T.status==="ongoing"?"bg-green-700":"bg-blue-700"} rounded-full px-2 py-0.5 mb-2`,children:T.status==="ongoing"?"Ongoing":"Completed"})]}),b.jsx("p",{className:"text-gray-300 mb-6 line-clamp-3",children:T.description}),b.jsxs("div",{className:"flex space-x-4",children:[b.jsxs(Ae,{to:`/anime/${T.id}`,className:"flex items-center bg-primary-600 hover:bg-primary-700 text-white px-6 py-3 rounded-full transition duration-300",children:[b.jsx(Lo,{className:"mr-2"})," Watch Now"]}),b.jsx(Ae,{to:`/anime/${T.id}`,className:"flex items-center bg-jet-card hover:bg-jet-hover text-white px-6 py-3 rounded-full transition duration-300",children:"Details"})]})]})}),b.jsx("button",{className:"absolute left-4 top-1/2 -translate-y-1/2 bg-black/50 hover:bg-black/70 text-white p-2 rounded-full z-20 transition-transform duration-150 hover:scale-110",onClick:E,disabled:o,children:b.jsx(Dv,{className:"h-5 w-5"})}),b.jsx("button",{className:"absolute right-4 top-1/2 -translate-y-1/2 bg-black/50 hover:bg-black/70 text-white p-2 rounded-full z-20 transition-transform duration-150 hover:scale-110",onClick:v,disabled:o,children:b.jsx(Vd,{className:"h-5 w-5"})}),b.jsx("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 flex space-x-2 z-20",children:r.map((D,_)=>b.jsx("button",{onClick:()=>y(_),disabled:o,className:`w-3 h-3 rounded-full transition-all duration-300 ${_===t?"bg-primary-600 scale-110":"bg-gray-400/50 hover:bg-gray-300/70"}`},_))})]})})},Ov=({anime:r,className:e=""})=>b.jsxs(Ae,{to:`/anime/${r.id}`,className:`block group rounded-lg overflow-hidden bg-jet-card shadow-md hover:shadow-lg transition duration-300 transform hover:-translate-y-1 ${e}`,children:[b.jsxs("div",{className:"relative aspect-[2/3] overflow-hidden",children:[b.jsx("img",{src:r.coverImage,alt:r.title,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"}),b.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-black/30 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300",children:b.jsxs("div",{className:"absolute bottom-0 p-3 w-full",children:[b.jsxs("div",{className:"flex items-center mb-1",children:[b.jsx(Cv,{className:"text-yellow-400 mr-1"}),b.jsx("span",{className:"text-white text-sm font-medium",children:r.rating.toFixed(1)})]}),b.jsxs("div",{className:"flex flex-wrap",children:[r.genres.slice(0,2).map((t,i)=>b.jsx("span",{className:"text-xs text-white bg-primary-700 rounded-full px-2 py-0.5 mr-1 mb-1",children:t},i)),r.status==="ongoing"&&b.jsx("span",{className:"text-xs text-white bg-green-700 rounded-full px-2 py-0.5 mr-1 mb-1",children:"Ongoing"})]})]})})]}),b.jsxs("div",{className:"p-3",children:[b.jsx("h3",{className:"font-medium text-white truncate",children:r.title}),b.jsx("p",{className:"text-gray-400 text-sm mt-1",children:r.releaseYear})]})]}),Op=({title:r,animes:e,viewAllLink:t,className:i=""})=>e.length?b.jsx("section",{className:`py-8 ${i}`,children:b.jsxs("div",{className:"container mx-auto px-4",children:[b.jsxs("div",{className:"flex justify-between items-center mb-6",children:[b.jsx("h2",{className:"text-2xl font-bold text-white",children:r}),t&&b.jsxs(Ae,{to:t,className:"flex items-center text-primary-500 hover:text-primary-400 transition-colors",children:["View All ",b.jsx(Vd,{className:"ml-1 h-3 w-3"})]})]}),b.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4 md:gap-6",children:e.map(n=>b.jsx(Ov,{anime:n},n.id))})]})}):null;function Np(r){return Pe({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M11.9997 10.5865L16.9495 5.63672L18.3637 7.05093L13.4139 12.0007L18.3637 16.9504L16.9495 18.3646L11.9997 13.4149L7.04996 18.3646L5.63574 16.9504L10.5855 12.0007L5.63574 7.05093L7.04996 5.63672L11.9997 10.5865Z"},child:[]}]})(r)}function Vb(r){return Pe({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M3 4H21V6H3V4ZM3 11H21V13H3V11ZM3 18H21V20H3V18Z"},child:[]}]})(r)}const zb=()=>{const[r,e]=U.useState(!1),[t,i]=U.useState(""),[n,l]=U.useState(!1),[o,u]=U.useState(!1),[d,f]=U.useState(""),m=bi(),g=zs();U.useEffect(()=>{const S=()=>{const T=localStorage.getItem("isLoggedIn")==="true";u(T),T&&f(localStorage.getItem("username")||"User")};return S(),window.addEventListener("storage",S),()=>{window.removeEventListener("storage",S)}},[m.pathname]);const v=S=>{S.preventDefault(),t.trim()&&(g(`/browse?q=${encodeURIComponent(t)}`),e(!1))},E=()=>{localStorage.removeItem("isLoggedIn"),u(!1),g("/")},y=S=>m.pathname===S;return b.jsx("nav",{className:"bg-jet-black border-b border-jetblack-800 fixed w-full z-50",children:b.jsxs("div",{className:"container mx-auto px-4",children:[b.jsxs("div",{className:"flex items-center h-16",children:[b.jsx("div",{className:"flex-shrink-0 flex items-center w-3/10 justify-start",children:b.jsxs(Ae,{to:"/",className:"text-white font-bold text-xl flex items-center",children:[b.jsx("span",{className:"text-primary-400 mr-2",children:"Pixel"}),b.jsx("span",{className:"text-white",children:"Anime"})]})}),b.jsx("div",{className:"flex-1 flex justify-center w-4/10",children:b.jsxs("div",{className:"hidden md:flex space-x-8",children:[b.jsxs(Ae,{to:"/",className:`flex items-center px-3 py-2 rounded-md text-sm font-medium ${y("/")?"text-white bg-jet-card":"text-gray-300 hover:bg-jet-hover hover:text-white"}`,children:[b.jsx(wp,{className:"mr-2"})," Home"]}),b.jsxs(Ae,{to:"/browse",className:`flex items-center px-3 py-2 rounded-md text-sm font-medium ${y("/browse")?"text-white bg-jet-card":"text-gray-300 hover:bg-jet-hover hover:text-white"}`,children:[b.jsx(_p,{className:"mr-2"})," Browse"]}),b.jsxs(Ae,{to:"/categories",className:`flex items-center px-3 py-2 rounded-md text-sm font-medium ${y("/categories")?"text-white bg-jet-card":"text-gray-300 hover:bg-jet-hover hover:text-white"}`,children:[b.jsx(fd,{className:"mr-2"})," Categories"]})]})}),b.jsxs("div",{className:"flex items-center justify-end w-3/10 space-x-4",children:[b.jsx("div",{className:`relative ${r?"w-48":"w-auto"}`,children:r?b.jsxs("form",{onSubmit:v,className:"flex items-center",children:[b.jsx("input",{type:"text",placeholder:"Search...",className:"bg-jet-card text-white px-3 py-1.5 rounded-md w-full focus:outline-none focus:ring-1 focus:ring-primary-400 text-sm",value:t,onChange:S=>i(S.target.value),autoFocus:!0}),b.jsx("button",{type:"button",className:"absolute right-2 text-gray-400",onClick:()=>e(!1),children:b.jsx(Np,{className:"h-4 w-4"})})]}):b.jsx("button",{onClick:()=>e(!0),className:"text-gray-300 hover:text-white p-1.5 rounded-md hover:bg-jet-hover",children:b.jsx(Iv,{className:"h-4 w-4"})})}),b.jsx("div",{className:"relative hidden md:block",children:o?b.jsxs(Ae,{to:"/profile",className:`flex items-center px-3 py-2 rounded-md text-sm font-medium ${y("/profile")?"text-white bg-jet-card":"text-gray-300 hover:bg-jet-hover hover:text-white"}`,children:[b.jsx(Go,{className:"mr-2"})," ",d]}):b.jsx("div",{className:"flex space-x-2",children:b.jsxs(Ae,{to:"/login",className:"flex items-center px-3 py-1.5 bg-primary-600 hover:bg-primary-700 rounded-md text-sm font-medium text-white whitespace-nowrap",children:[b.jsx(Cp,{className:"mr-1.5"})," Login"]})})}),b.jsx("div",{className:"md:hidden flex",children:b.jsx("button",{onClick:()=>l(!n),className:"text-gray-300 hover:text-white p-1.5 rounded-md hover:bg-jet-hover",children:n?b.jsx(Np,{className:"h-5 w-5"}):b.jsx(Vb,{className:"h-5 w-5"})})})]})]}),n&&b.jsx("div",{className:"md:hidden absolute w-full left-0 bg-jet-black border-b border-jetblack-800 z-50",children:b.jsxs("div",{className:"px-2 pt-2 pb-3 space-y-1 sm:px-3",children:[b.jsxs(Ae,{to:"/",className:`flex items-center px-3 py-2 rounded-md text-sm font-medium ${y("/")?"text-white bg-jet-card":"text-gray-300 hover:bg-jet-hover hover:text-white"}`,onClick:()=>l(!1),children:[b.jsx(wp,{className:"mr-2"})," Home"]}),b.jsxs(Ae,{to:"/browse",className:`flex items-center px-3 py-2 rounded-md text-sm font-medium ${y("/browse")?"text-white bg-jet-card":"text-gray-300 hover:bg-jet-hover hover:text-white"}`,onClick:()=>l(!1),children:[b.jsx(_p,{className:"mr-2"})," Browse"]}),b.jsxs(Ae,{to:"/categories",className:`flex items-center px-3 py-2 rounded-md text-sm font-medium ${y("/categories")?"text-white bg-jet-card":"text-gray-300 hover:bg-jet-hover hover:text-white"}`,onClick:()=>l(!1),children:[b.jsx(fd,{className:"mr-2"})," Categories"]}),o?b.jsxs(b.Fragment,{children:[b.jsxs(Ae,{to:"/profile",className:`flex items-center px-3 py-2 rounded-md text-sm font-medium ${y("/profile")?"text-white bg-jet-card":"text-gray-300 hover:bg-jet-hover hover:text-white"}`,onClick:()=>l(!1),children:[b.jsx(Go,{className:"mr-2"})," Profile"]}),b.jsxs("button",{onClick:()=>{E(),l(!1)},className:"w-full flex items-center px-3 py-2 rounded-md text-sm font-medium text-gray-300 hover:bg-jet-hover hover:text-white",children:[b.jsx(Ip,{className:"mr-2"})," Logout"]})]}):b.jsxs(b.Fragment,{children:[b.jsxs(Ae,{to:"/login",className:`flex items-center px-3 py-2 rounded-md text-sm font-medium ${y("/login")?"text-white bg-jet-card":"text-gray-300 hover:bg-jet-hover hover:text-white"}`,onClick:()=>l(!1),children:[b.jsx(Ip,{className:"mr-2"})," Login"]}),b.jsxs(Ae,{to:"/register",className:`flex items-center px-3 py-2 rounded-md text-sm font-medium ${y("/register")?"text-white bg-jet-card":"text-primary-400 hover:bg-jet-hover hover:text-primary-300"}`,onClick:()=>l(!1),children:[b.jsx(Cp,{className:"mr-2"})," Sign Up"]})]})]})})]})})},Kb=()=>{const r=new Date().getFullYear();return b.jsx("footer",{className:"bg-jet-black border-t border-jetblack-800 py-8",children:b.jsxs("div",{className:"container mx-auto px-4",children:[b.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[b.jsxs("div",{children:[b.jsxs(Ae,{to:"/",className:"text-white font-bold text-xl flex items-center",children:[b.jsx("span",{className:"text-primary-400 mr-2",children:"Pixel"}),b.jsx("span",{className:"text-white",children:"Anime"})]}),b.jsx("p",{className:"mt-2 text-gray-400 text-sm",children:"Your ultimate destination for anime streaming. Watch your favorite anime series with high-quality video and a seamless experience on any device."})]}),b.jsxs("div",{children:[b.jsx("h3",{className:"text-white font-medium mb-4",children:"Quick Links"}),b.jsxs("ul",{className:"space-y-2",children:[b.jsx("li",{children:b.jsx(Ae,{to:"/",className:"text-gray-400 hover:text-primary-400 text-sm",children:"Home"})}),b.jsx("li",{children:b.jsx(Ae,{to:"/browse",className:"text-gray-400 hover:text-primary-400 text-sm",children:"Browse"})}),b.jsx("li",{children:b.jsx(Ae,{to:"/categories",className:"text-gray-400 hover:text-primary-400 text-sm",children:"Categories"})}),b.jsx("li",{children:b.jsx(Ae,{to:"/about",className:"text-gray-400 hover:text-primary-400 text-sm",children:"About Us"})}),b.jsx("li",{children:b.jsx(Ae,{to:"/contact",className:"text-gray-400 hover:text-primary-400 text-sm",children:"Contact"})})]})]}),b.jsxs("div",{children:[b.jsx("h3",{className:"text-white font-medium mb-4",children:"Connect With Us"}),b.jsxs("div",{className:"flex space-x-4 mb-4",children:[b.jsx("a",{href:"#",className:"text-gray-400 hover:text-primary-400",children:b.jsx(Ob,{className:"h-5 w-5"})}),b.jsx("a",{href:"#",className:"text-gray-400 hover:text-primary-400",children:b.jsx(wb,{className:"h-5 w-5"})}),b.jsx("a",{href:"#",className:"text-gray-400 hover:text-primary-400",children:b.jsx(Cb,{className:"h-5 w-5"})}),b.jsx("a",{href:"#",className:"text-gray-400 hover:text-primary-400",children:b.jsx(Ib,{className:"h-5 w-5"})})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsx(Ae,{to:"/terms",className:"block text-gray-400 hover:text-primary-400 text-sm",children:"Terms of Service"}),b.jsx(Ae,{to:"/privacy",className:"block text-gray-400 hover:text-primary-400 text-sm",children:"Privacy Policy"})]})]})]}),b.jsx("div",{className:"border-t border-jetblack-800 mt-8 pt-6 text-center",children:b.jsxs("p",{className:"text-gray-400 text-sm",children:["© ",r," PixelAnime. All Rights Reserved."]})})]})})},Mt=({children:r})=>b.jsxs("div",{className:"min-h-screen flex flex-col",children:[b.jsx(zb,{}),b.jsx("main",{className:"flex-grow pt-16",children:r}),b.jsx(Kb,{})]});function Nv(r,e){return function(){return r.apply(e,arguments)}}const{toString:Yb}=Object.prototype,{getPrototypeOf:zd}=Object,{iterator:nc,toStringTag:kv}=Symbol,rc=(r=>e=>{const t=Yb.call(e);return r[t]||(r[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),Ai=r=>(r=r.toLowerCase(),e=>rc(e)===r),ac=r=>e=>typeof e===r,{isArray:Sr}=Array,Na=ac("undefined");function qb(r){return r!==null&&!Na(r)&&r.constructor!==null&&!Na(r.constructor)&&zt(r.constructor.isBuffer)&&r.constructor.isBuffer(r)}const Mv=Ai("ArrayBuffer");function Xb(r){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(r):e=r&&r.buffer&&Mv(r.buffer),e}const Qb=ac("string"),zt=ac("function"),Pv=ac("number"),lc=r=>r!==null&&typeof r=="object",Wb=r=>r===!0||r===!1,_o=r=>{if(rc(r)!=="object")return!1;const e=zd(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(kv in r)&&!(nc in r)},Zb=Ai("Date"),Jb=Ai("File"),eA=Ai("Blob"),tA=Ai("FileList"),iA=r=>lc(r)&&zt(r.pipe),sA=r=>{let e;return r&&(typeof FormData=="function"&&r instanceof FormData||zt(r.append)&&((e=rc(r))==="formdata"||e==="object"&&zt(r.toString)&&r.toString()==="[object FormData]"))},nA=Ai("URLSearchParams"),[rA,aA,lA,oA]=["ReadableStream","Request","Response","Headers"].map(Ai),cA=r=>r.trim?r.trim():r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function za(r,e,{allOwnKeys:t=!1}={}){if(r===null||typeof r>"u")return;let i,n;if(typeof r!="object"&&(r=[r]),Sr(r))for(i=0,n=r.length;i<n;i++)e.call(null,r[i],i,r);else{const l=t?Object.getOwnPropertyNames(r):Object.keys(r),o=l.length;let u;for(i=0;i<o;i++)u=l[i],e.call(null,r[u],u,r)}}function Uv(r,e){e=e.toLowerCase();const t=Object.keys(r);let i=t.length,n;for(;i-- >0;)if(n=t[i],e===n.toLowerCase())return n;return null}const pn=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Bv=r=>!Na(r)&&r!==pn;function hd(){const{caseless:r}=Bv(this)&&this||{},e={},t=(i,n)=>{const l=r&&Uv(e,n)||n;_o(e[l])&&_o(i)?e[l]=hd(e[l],i):_o(i)?e[l]=hd({},i):Sr(i)?e[l]=i.slice():e[l]=i};for(let i=0,n=arguments.length;i<n;i++)arguments[i]&&za(arguments[i],t);return e}const uA=(r,e,t,{allOwnKeys:i}={})=>(za(e,(n,l)=>{t&&zt(n)?r[l]=Nv(n,t):r[l]=n},{allOwnKeys:i}),r),fA=r=>(r.charCodeAt(0)===65279&&(r=r.slice(1)),r),dA=(r,e,t,i)=>{r.prototype=Object.create(e.prototype,i),r.prototype.constructor=r,Object.defineProperty(r,"super",{value:e.prototype}),t&&Object.assign(r.prototype,t)},hA=(r,e,t,i)=>{let n,l,o;const u={};if(e=e||{},r==null)return e;do{for(n=Object.getOwnPropertyNames(r),l=n.length;l-- >0;)o=n[l],(!i||i(o,r,e))&&!u[o]&&(e[o]=r[o],u[o]=!0);r=t!==!1&&zd(r)}while(r&&(!t||t(r,e))&&r!==Object.prototype);return e},mA=(r,e,t)=>{r=String(r),(t===void 0||t>r.length)&&(t=r.length),t-=e.length;const i=r.indexOf(e,t);return i!==-1&&i===t},gA=r=>{if(!r)return null;if(Sr(r))return r;let e=r.length;if(!Pv(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=r[e];return t},pA=(r=>e=>r&&e instanceof r)(typeof Uint8Array<"u"&&zd(Uint8Array)),yA=(r,e)=>{const i=(r&&r[nc]).call(r);let n;for(;(n=i.next())&&!n.done;){const l=n.value;e.call(r,l[0],l[1])}},vA=(r,e)=>{let t;const i=[];for(;(t=r.exec(e))!==null;)i.push(t);return i},xA=Ai("HTMLFormElement"),EA=r=>r.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,i,n){return i.toUpperCase()+n}),kp=(({hasOwnProperty:r})=>(e,t)=>r.call(e,t))(Object.prototype),SA=Ai("RegExp"),Fv=(r,e)=>{const t=Object.getOwnPropertyDescriptors(r),i={};za(t,(n,l)=>{let o;(o=e(n,l,r))!==!1&&(i[l]=o||n)}),Object.defineProperties(r,i)},TA=r=>{Fv(r,(e,t)=>{if(zt(r)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const i=r[t];if(zt(i)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},bA=(r,e)=>{const t={},i=n=>{n.forEach(l=>{t[l]=!0})};return Sr(r)?i(r):i(String(r).split(e)),t},AA=()=>{},RA=(r,e)=>r!=null&&Number.isFinite(r=+r)?r:e;function LA(r){return!!(r&&zt(r.append)&&r[kv]==="FormData"&&r[nc])}const _A=r=>{const e=new Array(10),t=(i,n)=>{if(lc(i)){if(e.indexOf(i)>=0)return;if(!("toJSON"in i)){e[n]=i;const l=Sr(i)?[]:{};return za(i,(o,u)=>{const d=t(o,n+1);!Na(d)&&(l[u]=d)}),e[n]=void 0,l}}return i};return t(r,0)},DA=Ai("AsyncFunction"),wA=r=>r&&(lc(r)||zt(r))&&zt(r.then)&&zt(r.catch),jv=((r,e)=>r?setImmediate:e?((t,i)=>(pn.addEventListener("message",({source:n,data:l})=>{n===pn&&l===t&&i.length&&i.shift()()},!1),n=>{i.push(n),pn.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",zt(pn.postMessage)),IA=typeof queueMicrotask<"u"?queueMicrotask.bind(pn):typeof process<"u"&&process.nextTick||jv,CA=r=>r!=null&&zt(r[nc]),te={isArray:Sr,isArrayBuffer:Mv,isBuffer:qb,isFormData:sA,isArrayBufferView:Xb,isString:Qb,isNumber:Pv,isBoolean:Wb,isObject:lc,isPlainObject:_o,isReadableStream:rA,isRequest:aA,isResponse:lA,isHeaders:oA,isUndefined:Na,isDate:Zb,isFile:Jb,isBlob:eA,isRegExp:SA,isFunction:zt,isStream:iA,isURLSearchParams:nA,isTypedArray:pA,isFileList:tA,forEach:za,merge:hd,extend:uA,trim:cA,stripBOM:fA,inherits:dA,toFlatObject:hA,kindOf:rc,kindOfTest:Ai,endsWith:mA,toArray:gA,forEachEntry:yA,matchAll:vA,isHTMLForm:xA,hasOwnProperty:kp,hasOwnProp:kp,reduceDescriptors:Fv,freezeMethods:TA,toObjectSet:bA,toCamelCase:EA,noop:AA,toFiniteNumber:RA,findKey:Uv,global:pn,isContextDefined:Bv,isSpecCompliantForm:LA,toJSONObject:_A,isAsyncFn:DA,isThenable:wA,setImmediate:jv,asap:IA,isIterable:CA};function Re(r,e,t,i,n){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=r,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),i&&(this.request=i),n&&(this.response=n,this.status=n.status?n.status:null)}te.inherits(Re,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:te.toJSONObject(this.config),code:this.code,status:this.status}}});const $v=Re.prototype,Gv={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(r=>{Gv[r]={value:r}});Object.defineProperties(Re,Gv);Object.defineProperty($v,"isAxiosError",{value:!0});Re.from=(r,e,t,i,n,l)=>{const o=Object.create($v);return te.toFlatObject(r,o,function(d){return d!==Error.prototype},u=>u!=="isAxiosError"),Re.call(o,r.message,e,t,i,n),o.cause=r,o.name=r.name,l&&Object.assign(o,l),o};const OA=null;function md(r){return te.isPlainObject(r)||te.isArray(r)}function Hv(r){return te.endsWith(r,"[]")?r.slice(0,-2):r}function Mp(r,e,t){return r?r.concat(e).map(function(n,l){return n=Hv(n),!t&&l?"["+n+"]":n}).join(t?".":""):e}function NA(r){return te.isArray(r)&&!r.some(md)}const kA=te.toFlatObject(te,{},null,function(e){return/^is[A-Z]/.test(e)});function oc(r,e,t){if(!te.isObject(r))throw new TypeError("target must be an object");e=e||new FormData,t=te.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(S,T){return!te.isUndefined(T[S])});const i=t.metaTokens,n=t.visitor||m,l=t.dots,o=t.indexes,d=(t.Blob||typeof Blob<"u"&&Blob)&&te.isSpecCompliantForm(e);if(!te.isFunction(n))throw new TypeError("visitor must be a function");function f(y){if(y===null)return"";if(te.isDate(y))return y.toISOString();if(!d&&te.isBlob(y))throw new Re("Blob is not supported. Use a Buffer instead.");return te.isArrayBuffer(y)||te.isTypedArray(y)?d&&typeof Blob=="function"?new Blob([y]):Buffer.from(y):y}function m(y,S,T){let R=y;if(y&&!T&&typeof y=="object"){if(te.endsWith(S,"{}"))S=i?S:S.slice(0,-2),y=JSON.stringify(y);else if(te.isArray(y)&&NA(y)||(te.isFileList(y)||te.endsWith(S,"[]"))&&(R=te.toArray(y)))return S=Hv(S),R.forEach(function(_,O){!(te.isUndefined(_)||_===null)&&e.append(o===!0?Mp([S],O,l):o===null?S:S+"[]",f(_))}),!1}return md(y)?!0:(e.append(Mp(T,S,l),f(y)),!1)}const g=[],v=Object.assign(kA,{defaultVisitor:m,convertValue:f,isVisitable:md});function E(y,S){if(!te.isUndefined(y)){if(g.indexOf(y)!==-1)throw Error("Circular reference detected in "+S.join("."));g.push(y),te.forEach(y,function(R,D){(!(te.isUndefined(R)||R===null)&&n.call(e,R,te.isString(D)?D.trim():D,S,v))===!0&&E(R,S?S.concat(D):[D])}),g.pop()}}if(!te.isObject(r))throw new TypeError("data must be an object");return E(r),e}function Pp(r){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(r).replace(/[!'()~]|%20|%00/g,function(i){return e[i]})}function Kd(r,e){this._pairs=[],r&&oc(r,this,e)}const Vv=Kd.prototype;Vv.append=function(e,t){this._pairs.push([e,t])};Vv.toString=function(e){const t=e?function(i){return e.call(this,i,Pp)}:Pp;return this._pairs.map(function(n){return t(n[0])+"="+t(n[1])},"").join("&")};function MA(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function zv(r,e,t){if(!e)return r;const i=t&&t.encode||MA;te.isFunction(t)&&(t={serialize:t});const n=t&&t.serialize;let l;if(n?l=n(e,t):l=te.isURLSearchParams(e)?e.toString():new Kd(e,t).toString(i),l){const o=r.indexOf("#");o!==-1&&(r=r.slice(0,o)),r+=(r.indexOf("?")===-1?"?":"&")+l}return r}class Up{constructor(){this.handlers=[]}use(e,t,i){return this.handlers.push({fulfilled:e,rejected:t,synchronous:i?i.synchronous:!1,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){te.forEach(this.handlers,function(i){i!==null&&e(i)})}}const Kv={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},PA=typeof URLSearchParams<"u"?URLSearchParams:Kd,UA=typeof FormData<"u"?FormData:null,BA=typeof Blob<"u"?Blob:null,FA={isBrowser:!0,classes:{URLSearchParams:PA,FormData:UA,Blob:BA},protocols:["http","https","file","blob","url","data"]},Yd=typeof window<"u"&&typeof document<"u",gd=typeof navigator=="object"&&navigator||void 0,jA=Yd&&(!gd||["ReactNative","NativeScript","NS"].indexOf(gd.product)<0),$A=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",GA=Yd&&window.location.href||"http://localhost",HA=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Yd,hasStandardBrowserEnv:jA,hasStandardBrowserWebWorkerEnv:$A,navigator:gd,origin:GA},Symbol.toStringTag,{value:"Module"})),Ct={...HA,...FA};function VA(r,e){return oc(r,new Ct.classes.URLSearchParams,Object.assign({visitor:function(t,i,n,l){return Ct.isNode&&te.isBuffer(t)?(this.append(i,t.toString("base64")),!1):l.defaultVisitor.apply(this,arguments)}},e))}function zA(r){return te.matchAll(/\w+|\[(\w*)]/g,r).map(e=>e[0]==="[]"?"":e[1]||e[0])}function KA(r){const e={},t=Object.keys(r);let i;const n=t.length;let l;for(i=0;i<n;i++)l=t[i],e[l]=r[l];return e}function Yv(r){function e(t,i,n,l){let o=t[l++];if(o==="__proto__")return!0;const u=Number.isFinite(+o),d=l>=t.length;return o=!o&&te.isArray(n)?n.length:o,d?(te.hasOwnProp(n,o)?n[o]=[n[o],i]:n[o]=i,!u):((!n[o]||!te.isObject(n[o]))&&(n[o]=[]),e(t,i,n[o],l)&&te.isArray(n[o])&&(n[o]=KA(n[o])),!u)}if(te.isFormData(r)&&te.isFunction(r.entries)){const t={};return te.forEachEntry(r,(i,n)=>{e(zA(i),n,t,0)}),t}return null}function YA(r,e,t){if(te.isString(r))try{return(e||JSON.parse)(r),te.trim(r)}catch(i){if(i.name!=="SyntaxError")throw i}return(t||JSON.stringify)(r)}const Ka={transitional:Kv,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const i=t.getContentType()||"",n=i.indexOf("application/json")>-1,l=te.isObject(e);if(l&&te.isHTMLForm(e)&&(e=new FormData(e)),te.isFormData(e))return n?JSON.stringify(Yv(e)):e;if(te.isArrayBuffer(e)||te.isBuffer(e)||te.isStream(e)||te.isFile(e)||te.isBlob(e)||te.isReadableStream(e))return e;if(te.isArrayBufferView(e))return e.buffer;if(te.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let u;if(l){if(i.indexOf("application/x-www-form-urlencoded")>-1)return VA(e,this.formSerializer).toString();if((u=te.isFileList(e))||i.indexOf("multipart/form-data")>-1){const d=this.env&&this.env.FormData;return oc(u?{"files[]":e}:e,d&&new d,this.formSerializer)}}return l||n?(t.setContentType("application/json",!1),YA(e)):e}],transformResponse:[function(e){const t=this.transitional||Ka.transitional,i=t&&t.forcedJSONParsing,n=this.responseType==="json";if(te.isResponse(e)||te.isReadableStream(e))return e;if(e&&te.isString(e)&&(i&&!this.responseType||n)){const o=!(t&&t.silentJSONParsing)&&n;try{return JSON.parse(e)}catch(u){if(o)throw u.name==="SyntaxError"?Re.from(u,Re.ERR_BAD_RESPONSE,this,null,this.response):u}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ct.classes.FormData,Blob:Ct.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};te.forEach(["delete","get","head","post","put","patch"],r=>{Ka.headers[r]={}});const qA=te.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),XA=r=>{const e={};let t,i,n;return r&&r.split(`
`).forEach(function(o){n=o.indexOf(":"),t=o.substring(0,n).trim().toLowerCase(),i=o.substring(n+1).trim(),!(!t||e[t]&&qA[t])&&(t==="set-cookie"?e[t]?e[t].push(i):e[t]=[i]:e[t]=e[t]?e[t]+", "+i:i)}),e},Bp=Symbol("internals");function Ra(r){return r&&String(r).trim().toLowerCase()}function Do(r){return r===!1||r==null?r:te.isArray(r)?r.map(Do):String(r)}function QA(r){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let i;for(;i=t.exec(r);)e[i[1]]=i[2];return e}const WA=r=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(r.trim());function Nf(r,e,t,i,n){if(te.isFunction(i))return i.call(this,e,t);if(n&&(e=t),!!te.isString(e)){if(te.isString(i))return e.indexOf(i)!==-1;if(te.isRegExp(i))return i.test(e)}}function ZA(r){return r.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,i)=>t.toUpperCase()+i)}function JA(r,e){const t=te.toCamelCase(" "+e);["get","set","has"].forEach(i=>{Object.defineProperty(r,i+t,{value:function(n,l,o){return this[i].call(this,e,n,l,o)},configurable:!0})})}let Kt=class{constructor(e){e&&this.set(e)}set(e,t,i){const n=this;function l(u,d,f){const m=Ra(d);if(!m)throw new Error("header name must be a non-empty string");const g=te.findKey(n,m);(!g||n[g]===void 0||f===!0||f===void 0&&n[g]!==!1)&&(n[g||d]=Do(u))}const o=(u,d)=>te.forEach(u,(f,m)=>l(f,m,d));if(te.isPlainObject(e)||e instanceof this.constructor)o(e,t);else if(te.isString(e)&&(e=e.trim())&&!WA(e))o(XA(e),t);else if(te.isObject(e)&&te.isIterable(e)){let u={},d,f;for(const m of e){if(!te.isArray(m))throw TypeError("Object iterator must return a key-value pair");u[f=m[0]]=(d=u[f])?te.isArray(d)?[...d,m[1]]:[d,m[1]]:m[1]}o(u,t)}else e!=null&&l(t,e,i);return this}get(e,t){if(e=Ra(e),e){const i=te.findKey(this,e);if(i){const n=this[i];if(!t)return n;if(t===!0)return QA(n);if(te.isFunction(t))return t.call(this,n,i);if(te.isRegExp(t))return t.exec(n);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Ra(e),e){const i=te.findKey(this,e);return!!(i&&this[i]!==void 0&&(!t||Nf(this,this[i],i,t)))}return!1}delete(e,t){const i=this;let n=!1;function l(o){if(o=Ra(o),o){const u=te.findKey(i,o);u&&(!t||Nf(i,i[u],u,t))&&(delete i[u],n=!0)}}return te.isArray(e)?e.forEach(l):l(e),n}clear(e){const t=Object.keys(this);let i=t.length,n=!1;for(;i--;){const l=t[i];(!e||Nf(this,this[l],l,e,!0))&&(delete this[l],n=!0)}return n}normalize(e){const t=this,i={};return te.forEach(this,(n,l)=>{const o=te.findKey(i,l);if(o){t[o]=Do(n),delete t[l];return}const u=e?ZA(l):String(l).trim();u!==l&&delete t[l],t[u]=Do(n),i[u]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return te.forEach(this,(i,n)=>{i!=null&&i!==!1&&(t[n]=e&&te.isArray(i)?i.join(", "):i)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const i=new this(e);return t.forEach(n=>i.set(n)),i}static accessor(e){const i=(this[Bp]=this[Bp]={accessors:{}}).accessors,n=this.prototype;function l(o){const u=Ra(o);i[u]||(JA(n,o),i[u]=!0)}return te.isArray(e)?e.forEach(l):l(e),this}};Kt.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);te.reduceDescriptors(Kt.prototype,({value:r},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>r,set(i){this[t]=i}}});te.freezeMethods(Kt);function kf(r,e){const t=this||Ka,i=e||t,n=Kt.from(i.headers);let l=i.data;return te.forEach(r,function(u){l=u.call(t,l,n.normalize(),e?e.status:void 0)}),n.normalize(),l}function qv(r){return!!(r&&r.__CANCEL__)}function Tr(r,e,t){Re.call(this,r??"canceled",Re.ERR_CANCELED,e,t),this.name="CanceledError"}te.inherits(Tr,Re,{__CANCEL__:!0});function Xv(r,e,t){const i=t.config.validateStatus;!t.status||!i||i(t.status)?r(t):e(new Re("Request failed with status code "+t.status,[Re.ERR_BAD_REQUEST,Re.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function eR(r){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(r);return e&&e[1]||""}function tR(r,e){r=r||10;const t=new Array(r),i=new Array(r);let n=0,l=0,o;return e=e!==void 0?e:1e3,function(d){const f=Date.now(),m=i[l];o||(o=f),t[n]=d,i[n]=f;let g=l,v=0;for(;g!==n;)v+=t[g++],g=g%r;if(n=(n+1)%r,n===l&&(l=(l+1)%r),f-o<e)return;const E=m&&f-m;return E?Math.round(v*1e3/E):void 0}}function iR(r,e){let t=0,i=1e3/e,n,l;const o=(f,m=Date.now())=>{t=m,n=null,l&&(clearTimeout(l),l=null),r.apply(null,f)};return[(...f)=>{const m=Date.now(),g=m-t;g>=i?o(f,m):(n=f,l||(l=setTimeout(()=>{l=null,o(n)},i-g)))},()=>n&&o(n)]}const Ho=(r,e,t=3)=>{let i=0;const n=tR(50,250);return iR(l=>{const o=l.loaded,u=l.lengthComputable?l.total:void 0,d=o-i,f=n(d),m=o<=u;i=o;const g={loaded:o,total:u,progress:u?o/u:void 0,bytes:d,rate:f||void 0,estimated:f&&u&&m?(u-o)/f:void 0,event:l,lengthComputable:u!=null,[e?"download":"upload"]:!0};r(g)},t)},Fp=(r,e)=>{const t=r!=null;return[i=>e[0]({lengthComputable:t,total:r,loaded:i}),e[1]]},jp=r=>(...e)=>te.asap(()=>r(...e)),sR=Ct.hasStandardBrowserEnv?((r,e)=>t=>(t=new URL(t,Ct.origin),r.protocol===t.protocol&&r.host===t.host&&(e||r.port===t.port)))(new URL(Ct.origin),Ct.navigator&&/(msie|trident)/i.test(Ct.navigator.userAgent)):()=>!0,nR=Ct.hasStandardBrowserEnv?{write(r,e,t,i,n,l){const o=[r+"="+encodeURIComponent(e)];te.isNumber(t)&&o.push("expires="+new Date(t).toGMTString()),te.isString(i)&&o.push("path="+i),te.isString(n)&&o.push("domain="+n),l===!0&&o.push("secure"),document.cookie=o.join("; ")},read(r){const e=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(r){this.write(r,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function rR(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}function aR(r,e){return e?r.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):r}function Qv(r,e,t){let i=!rR(e);return r&&(i||t==!1)?aR(r,e):e}const $p=r=>r instanceof Kt?{...r}:r;function xn(r,e){e=e||{};const t={};function i(f,m,g,v){return te.isPlainObject(f)&&te.isPlainObject(m)?te.merge.call({caseless:v},f,m):te.isPlainObject(m)?te.merge({},m):te.isArray(m)?m.slice():m}function n(f,m,g,v){if(te.isUndefined(m)){if(!te.isUndefined(f))return i(void 0,f,g,v)}else return i(f,m,g,v)}function l(f,m){if(!te.isUndefined(m))return i(void 0,m)}function o(f,m){if(te.isUndefined(m)){if(!te.isUndefined(f))return i(void 0,f)}else return i(void 0,m)}function u(f,m,g){if(g in e)return i(f,m);if(g in r)return i(void 0,f)}const d={url:l,method:l,data:l,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:u,headers:(f,m,g)=>n($p(f),$p(m),g,!0)};return te.forEach(Object.keys(Object.assign({},r,e)),function(m){const g=d[m]||n,v=g(r[m],e[m],m);te.isUndefined(v)&&g!==u||(t[m]=v)}),t}const Wv=r=>{const e=xn({},r);let{data:t,withXSRFToken:i,xsrfHeaderName:n,xsrfCookieName:l,headers:o,auth:u}=e;e.headers=o=Kt.from(o),e.url=zv(Qv(e.baseURL,e.url,e.allowAbsoluteUrls),r.params,r.paramsSerializer),u&&o.set("Authorization","Basic "+btoa((u.username||"")+":"+(u.password?unescape(encodeURIComponent(u.password)):"")));let d;if(te.isFormData(t)){if(Ct.hasStandardBrowserEnv||Ct.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if((d=o.getContentType())!==!1){const[f,...m]=d?d.split(";").map(g=>g.trim()).filter(Boolean):[];o.setContentType([f||"multipart/form-data",...m].join("; "))}}if(Ct.hasStandardBrowserEnv&&(i&&te.isFunction(i)&&(i=i(e)),i||i!==!1&&sR(e.url))){const f=n&&l&&nR.read(l);f&&o.set(n,f)}return e},lR=typeof XMLHttpRequest<"u",oR=lR&&function(r){return new Promise(function(t,i){const n=Wv(r);let l=n.data;const o=Kt.from(n.headers).normalize();let{responseType:u,onUploadProgress:d,onDownloadProgress:f}=n,m,g,v,E,y;function S(){E&&E(),y&&y(),n.cancelToken&&n.cancelToken.unsubscribe(m),n.signal&&n.signal.removeEventListener("abort",m)}let T=new XMLHttpRequest;T.open(n.method.toUpperCase(),n.url,!0),T.timeout=n.timeout;function R(){if(!T)return;const _=Kt.from("getAllResponseHeaders"in T&&T.getAllResponseHeaders()),C={data:!u||u==="text"||u==="json"?T.responseText:T.response,status:T.status,statusText:T.statusText,headers:_,config:r,request:T};Xv(function(N){t(N),S()},function(N){i(N),S()},C),T=null}"onloadend"in T?T.onloadend=R:T.onreadystatechange=function(){!T||T.readyState!==4||T.status===0&&!(T.responseURL&&T.responseURL.indexOf("file:")===0)||setTimeout(R)},T.onabort=function(){T&&(i(new Re("Request aborted",Re.ECONNABORTED,r,T)),T=null)},T.onerror=function(){i(new Re("Network Error",Re.ERR_NETWORK,r,T)),T=null},T.ontimeout=function(){let O=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const C=n.transitional||Kv;n.timeoutErrorMessage&&(O=n.timeoutErrorMessage),i(new Re(O,C.clarifyTimeoutError?Re.ETIMEDOUT:Re.ECONNABORTED,r,T)),T=null},l===void 0&&o.setContentType(null),"setRequestHeader"in T&&te.forEach(o.toJSON(),function(O,C){T.setRequestHeader(C,O)}),te.isUndefined(n.withCredentials)||(T.withCredentials=!!n.withCredentials),u&&u!=="json"&&(T.responseType=n.responseType),f&&([v,y]=Ho(f,!0),T.addEventListener("progress",v)),d&&T.upload&&([g,E]=Ho(d),T.upload.addEventListener("progress",g),T.upload.addEventListener("loadend",E)),(n.cancelToken||n.signal)&&(m=_=>{T&&(i(!_||_.type?new Tr(null,r,T):_),T.abort(),T=null)},n.cancelToken&&n.cancelToken.subscribe(m),n.signal&&(n.signal.aborted?m():n.signal.addEventListener("abort",m)));const D=eR(n.url);if(D&&Ct.protocols.indexOf(D)===-1){i(new Re("Unsupported protocol "+D+":",Re.ERR_BAD_REQUEST,r));return}T.send(l||null)})},cR=(r,e)=>{const{length:t}=r=r?r.filter(Boolean):[];if(e||t){let i=new AbortController,n;const l=function(f){if(!n){n=!0,u();const m=f instanceof Error?f:this.reason;i.abort(m instanceof Re?m:new Tr(m instanceof Error?m.message:m))}};let o=e&&setTimeout(()=>{o=null,l(new Re(`timeout ${e} of ms exceeded`,Re.ETIMEDOUT))},e);const u=()=>{r&&(o&&clearTimeout(o),o=null,r.forEach(f=>{f.unsubscribe?f.unsubscribe(l):f.removeEventListener("abort",l)}),r=null)};r.forEach(f=>f.addEventListener("abort",l));const{signal:d}=i;return d.unsubscribe=()=>te.asap(u),d}},uR=function*(r,e){let t=r.byteLength;if(t<e){yield r;return}let i=0,n;for(;i<t;)n=i+e,yield r.slice(i,n),i=n},fR=async function*(r,e){for await(const t of dR(r))yield*uR(t,e)},dR=async function*(r){if(r[Symbol.asyncIterator]){yield*r;return}const e=r.getReader();try{for(;;){const{done:t,value:i}=await e.read();if(t)break;yield i}}finally{await e.cancel()}},Gp=(r,e,t,i)=>{const n=fR(r,e);let l=0,o,u=d=>{o||(o=!0,i&&i(d))};return new ReadableStream({async pull(d){try{const{done:f,value:m}=await n.next();if(f){u(),d.close();return}let g=m.byteLength;if(t){let v=l+=g;t(v)}d.enqueue(new Uint8Array(m))}catch(f){throw u(f),f}},cancel(d){return u(d),n.return()}},{highWaterMark:2})},cc=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Zv=cc&&typeof ReadableStream=="function",hR=cc&&(typeof TextEncoder=="function"?(r=>e=>r.encode(e))(new TextEncoder):async r=>new Uint8Array(await new Response(r).arrayBuffer())),Jv=(r,...e)=>{try{return!!r(...e)}catch{return!1}},mR=Zv&&Jv(()=>{let r=!1;const e=new Request(Ct.origin,{body:new ReadableStream,method:"POST",get duplex(){return r=!0,"half"}}).headers.has("Content-Type");return r&&!e}),Hp=64*1024,pd=Zv&&Jv(()=>te.isReadableStream(new Response("").body)),Vo={stream:pd&&(r=>r.body)};cc&&(r=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!Vo[e]&&(Vo[e]=te.isFunction(r[e])?t=>t[e]():(t,i)=>{throw new Re(`Response type '${e}' is not supported`,Re.ERR_NOT_SUPPORT,i)})})})(new Response);const gR=async r=>{if(r==null)return 0;if(te.isBlob(r))return r.size;if(te.isSpecCompliantForm(r))return(await new Request(Ct.origin,{method:"POST",body:r}).arrayBuffer()).byteLength;if(te.isArrayBufferView(r)||te.isArrayBuffer(r))return r.byteLength;if(te.isURLSearchParams(r)&&(r=r+""),te.isString(r))return(await hR(r)).byteLength},pR=async(r,e)=>{const t=te.toFiniteNumber(r.getContentLength());return t??gR(e)},yR=cc&&(async r=>{let{url:e,method:t,data:i,signal:n,cancelToken:l,timeout:o,onDownloadProgress:u,onUploadProgress:d,responseType:f,headers:m,withCredentials:g="same-origin",fetchOptions:v}=Wv(r);f=f?(f+"").toLowerCase():"text";let E=cR([n,l&&l.toAbortSignal()],o),y;const S=E&&E.unsubscribe&&(()=>{E.unsubscribe()});let T;try{if(d&&mR&&t!=="get"&&t!=="head"&&(T=await pR(m,i))!==0){let C=new Request(e,{method:"POST",body:i,duplex:"half"}),B;if(te.isFormData(i)&&(B=C.headers.get("content-type"))&&m.setContentType(B),C.body){const[N,F]=Fp(T,Ho(jp(d)));i=Gp(C.body,Hp,N,F)}}te.isString(g)||(g=g?"include":"omit");const R="credentials"in Request.prototype;y=new Request(e,{...v,signal:E,method:t.toUpperCase(),headers:m.normalize().toJSON(),body:i,duplex:"half",credentials:R?g:void 0});let D=await fetch(y);const _=pd&&(f==="stream"||f==="response");if(pd&&(u||_&&S)){const C={};["status","statusText","headers"].forEach(z=>{C[z]=D[z]});const B=te.toFiniteNumber(D.headers.get("content-length")),[N,F]=u&&Fp(B,Ho(jp(u),!0))||[];D=new Response(Gp(D.body,Hp,N,()=>{F&&F(),S&&S()}),C)}f=f||"text";let O=await Vo[te.findKey(Vo,f)||"text"](D,r);return!_&&S&&S(),await new Promise((C,B)=>{Xv(C,B,{data:O,headers:Kt.from(D.headers),status:D.status,statusText:D.statusText,config:r,request:y})})}catch(R){throw S&&S(),R&&R.name==="TypeError"&&/Load failed|fetch/i.test(R.message)?Object.assign(new Re("Network Error",Re.ERR_NETWORK,r,y),{cause:R.cause||R}):Re.from(R,R&&R.code,r,y)}}),yd={http:OA,xhr:oR,fetch:yR};te.forEach(yd,(r,e)=>{if(r){try{Object.defineProperty(r,"name",{value:e})}catch{}Object.defineProperty(r,"adapterName",{value:e})}});const Vp=r=>`- ${r}`,vR=r=>te.isFunction(r)||r===null||r===!1,ex={getAdapter:r=>{r=te.isArray(r)?r:[r];const{length:e}=r;let t,i;const n={};for(let l=0;l<e;l++){t=r[l];let o;if(i=t,!vR(t)&&(i=yd[(o=String(t)).toLowerCase()],i===void 0))throw new Re(`Unknown adapter '${o}'`);if(i)break;n[o||"#"+l]=i}if(!i){const l=Object.entries(n).map(([u,d])=>`adapter ${u} `+(d===!1?"is not supported by the environment":"is not available in the build"));let o=e?l.length>1?`since :
`+l.map(Vp).join(`
`):" "+Vp(l[0]):"as no adapter specified";throw new Re("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return i},adapters:yd};function Mf(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new Tr(null,r)}function zp(r){return Mf(r),r.headers=Kt.from(r.headers),r.data=kf.call(r,r.transformRequest),["post","put","patch"].indexOf(r.method)!==-1&&r.headers.setContentType("application/x-www-form-urlencoded",!1),ex.getAdapter(r.adapter||Ka.adapter)(r).then(function(i){return Mf(r),i.data=kf.call(r,r.transformResponse,i),i.headers=Kt.from(i.headers),i},function(i){return qv(i)||(Mf(r),i&&i.response&&(i.response.data=kf.call(r,r.transformResponse,i.response),i.response.headers=Kt.from(i.response.headers))),Promise.reject(i)})}const tx="1.9.0",uc={};["object","boolean","number","function","string","symbol"].forEach((r,e)=>{uc[r]=function(i){return typeof i===r||"a"+(e<1?"n ":" ")+r}});const Kp={};uc.transitional=function(e,t,i){function n(l,o){return"[Axios v"+tx+"] Transitional option '"+l+"'"+o+(i?". "+i:"")}return(l,o,u)=>{if(e===!1)throw new Re(n(o," has been removed"+(t?" in "+t:"")),Re.ERR_DEPRECATED);return t&&!Kp[o]&&(Kp[o]=!0,console.warn(n(o," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(l,o,u):!0}};uc.spelling=function(e){return(t,i)=>(console.warn(`${i} is likely a misspelling of ${e}`),!0)};function xR(r,e,t){if(typeof r!="object")throw new Re("options must be an object",Re.ERR_BAD_OPTION_VALUE);const i=Object.keys(r);let n=i.length;for(;n-- >0;){const l=i[n],o=e[l];if(o){const u=r[l],d=u===void 0||o(u,l,r);if(d!==!0)throw new Re("option "+l+" must be "+d,Re.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new Re("Unknown option "+l,Re.ERR_BAD_OPTION)}}const wo={assertOptions:xR,validators:uc},Oi=wo.validators;let yn=class{constructor(e){this.defaults=e||{},this.interceptors={request:new Up,response:new Up}}async request(e,t){try{return await this._request(e,t)}catch(i){if(i instanceof Error){let n={};Error.captureStackTrace?Error.captureStackTrace(n):n=new Error;const l=n.stack?n.stack.replace(/^.+\n/,""):"";try{i.stack?l&&!String(i.stack).endsWith(l.replace(/^.+\n.+\n/,""))&&(i.stack+=`
`+l):i.stack=l}catch{}}throw i}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=xn(this.defaults,t);const{transitional:i,paramsSerializer:n,headers:l}=t;i!==void 0&&wo.assertOptions(i,{silentJSONParsing:Oi.transitional(Oi.boolean),forcedJSONParsing:Oi.transitional(Oi.boolean),clarifyTimeoutError:Oi.transitional(Oi.boolean)},!1),n!=null&&(te.isFunction(n)?t.paramsSerializer={serialize:n}:wo.assertOptions(n,{encode:Oi.function,serialize:Oi.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),wo.assertOptions(t,{baseUrl:Oi.spelling("baseURL"),withXsrfToken:Oi.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o=l&&te.merge(l.common,l[t.method]);l&&te.forEach(["delete","get","head","post","put","patch","common"],y=>{delete l[y]}),t.headers=Kt.concat(o,l);const u=[];let d=!0;this.interceptors.request.forEach(function(S){typeof S.runWhen=="function"&&S.runWhen(t)===!1||(d=d&&S.synchronous,u.unshift(S.fulfilled,S.rejected))});const f=[];this.interceptors.response.forEach(function(S){f.push(S.fulfilled,S.rejected)});let m,g=0,v;if(!d){const y=[zp.bind(this),void 0];for(y.unshift.apply(y,u),y.push.apply(y,f),v=y.length,m=Promise.resolve(t);g<v;)m=m.then(y[g++],y[g++]);return m}v=u.length;let E=t;for(g=0;g<v;){const y=u[g++],S=u[g++];try{E=y(E)}catch(T){S.call(this,T);break}}try{m=zp.call(this,E)}catch(y){return Promise.reject(y)}for(g=0,v=f.length;g<v;)m=m.then(f[g++],f[g++]);return m}getUri(e){e=xn(this.defaults,e);const t=Qv(e.baseURL,e.url,e.allowAbsoluteUrls);return zv(t,e.params,e.paramsSerializer)}};te.forEach(["delete","get","head","options"],function(e){yn.prototype[e]=function(t,i){return this.request(xn(i||{},{method:e,url:t,data:(i||{}).data}))}});te.forEach(["post","put","patch"],function(e){function t(i){return function(l,o,u){return this.request(xn(u||{},{method:e,headers:i?{"Content-Type":"multipart/form-data"}:{},url:l,data:o}))}}yn.prototype[e]=t(),yn.prototype[e+"Form"]=t(!0)});let ER=class ix{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(l){t=l});const i=this;this.promise.then(n=>{if(!i._listeners)return;let l=i._listeners.length;for(;l-- >0;)i._listeners[l](n);i._listeners=null}),this.promise.then=n=>{let l;const o=new Promise(u=>{i.subscribe(u),l=u}).then(n);return o.cancel=function(){i.unsubscribe(l)},o},e(function(l,o,u){i.reason||(i.reason=new Tr(l,o,u),t(i.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=i=>{e.abort(i)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new ix(function(n){e=n}),cancel:e}}};function SR(r){return function(t){return r.apply(null,t)}}function TR(r){return te.isObject(r)&&r.isAxiosError===!0}const vd={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(vd).forEach(([r,e])=>{vd[e]=r});function sx(r){const e=new yn(r),t=Nv(yn.prototype.request,e);return te.extend(t,yn.prototype,e,{allOwnKeys:!0}),te.extend(t,e,null,{allOwnKeys:!0}),t.create=function(n){return sx(xn(r,n))},t}const ot=sx(Ka);ot.Axios=yn;ot.CanceledError=Tr;ot.CancelToken=ER;ot.isCancel=qv;ot.VERSION=tx;ot.toFormData=oc;ot.AxiosError=Re;ot.Cancel=ot.CanceledError;ot.all=function(e){return Promise.all(e)};ot.spread=SR;ot.isAxiosError=TR;ot.mergeConfig=xn;ot.AxiosHeaders=Kt;ot.formToJSON=r=>Yv(te.isHTMLForm(r)?new FormData(r):r);ot.getAdapter=ex.getAdapter;ot.HttpStatusCode=vd;ot.default=ot;const{Axios:Nw,AxiosError:kw,CanceledError:Mw,isCancel:Pw,CancelToken:Uw,VERSION:Bw,all:Fw,Cancel:jw,isAxiosError:$w,spread:Gw,toFormData:Hw,AxiosHeaders:Vw,HttpStatusCode:zw,formToJSON:Kw,getAdapter:Yw,mergeConfig:qw}=ot,bR="https://consumet-api-new.up.railway.app",Bs=ot.create({baseURL:bR,headers:{"Content-Type":"application/json"}}),AR=r=>{if(!r)return;const e=r.match(/\b(19|20)\d{2}\b/);return e?parseInt(e[0]):void 0},La=r=>({id:r.id,title:r.title,description:r.japaneseTitle||"",coverImage:r.image,genres:r.type?[r.type]:[],releaseYear:new Date().getFullYear(),status:r.episodes===0?"ongoing":"completed",rating:0,seasons:[]}),RR=r=>{var i,n;let e="ongoing";((i=r.status)==null?void 0:i.toLowerCase())==="completed"&&(e="completed");const t={id:"season-1",number:1,title:"Season 1",episodes:((n=r.episodes)==null?void 0:n.map(l=>{const o=r.image;return{id:l.id,number:l.number,title:l.title||`Episode ${l.number}`,thumbnail:o,duration:1440,videoUrl:l.url,releaseDate:new Date().toISOString()}}))||[]};return{id:r.id,title:r.title,description:r.description||"",coverImage:r.image,genres:r.genres||[],releaseYear:AR(r.season)||new Date().getFullYear(),status:e,rating:0,seasons:[t]}},kt={getTopAiring:async(r=1)=>{try{return(await Bs.get(`/anime/zoro/top-airing?page=${r}`)).data.results.map(La)}catch(e){return console.error("Error fetching top airing anime:",e),[]}},getMostPopular:async(r=1)=>{try{return(await Bs.get(`/anime/zoro/most-popular?page=${r}`)).data.results.map(La).slice(0,8)}catch(e){return console.error("Error fetching most popular anime:",e),[]}},getRecentlyAdded:async(r=1)=>{try{return(await Bs.get(`/anime/zoro/recent-added?page=${r}`)).data.results.map(La)}catch(e){return console.error("Error fetching recently added anime:",e),[]}},searchAnime:async(r,e=1)=>{if(!r)return[];try{return(await Bs.get(`/anime/zoro/${r}?page=${e}`)).data.results.map(La)}catch(t){return console.error("Error searching anime:",t),[]}},getAnimeInfo:async r=>{try{const e=await Bs.get(`/anime/zoro/info?id=${r}`);return RR(e.data)}catch(e){return console.error(`Error fetching anime info for ID ${r}:`,e),null}},getGenres:async()=>{try{return(await Bs.get("/anime/zoro/genre/list")).data}catch(r){return console.error("Error fetching genre list:",r),[]}},getAnimeByGenre:async(r,e=1)=>{try{return(await Bs.get(`/anime/zoro/genre/${r}?page=${e}`)).data.results.map(La)}catch(t){return console.error(`Error fetching anime for genre ${r}:`,t),[]}},getBrowseAnime:async(r={})=>{const{page:e=1,query:t,sort:i,genre:n}=r;try{return n?await kt.getAnimeByGenre(n,e):t?await kt.searchAnime(t,e):i==="trending"?await kt.getMostPopular(e):i==="recent"?await kt.getRecentlyAdded(e):await kt.getTopAiring(e)}catch(l){return console.error("Error fetching browse anime:",l),[]}},getVideoSources:async(r,e="vidcloud")=>{try{return(await Bs.get(`/anime/zoro/watch?episodeId=${r}&server=${e}`)).data}catch(t){return console.error(`Error fetching video sources for episode ${r}:`,t),null}}},Yp=()=>{const[r,e]=U.useState([]),[t,i]=U.useState([]),[n,l]=U.useState([]),[o,u]=U.useState(!0);return U.useEffect(()=>{(async()=>{try{u(!0);const[f,m,g]=await Promise.all([kt.getMostPopular(),kt.getTopAiring(),kt.getRecentlyAdded()]);e(f),i(m),l(g),u(!1)}catch(f){console.error("Error fetching data for homepage:",f),u(!1)}})()},[]),o?b.jsx(Mt,{children:b.jsx("div",{className:"flex justify-center items-center h-screen",children:b.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-500"})})}):b.jsxs(Mt,{children:[b.jsx(Hb,{items:r}),b.jsx(Op,{title:"Trending Now",animes:t,viewAllLink:"/browse?sort=trending"}),b.jsx(Op,{title:"Recently Added",animes:n,viewAllLink:"/browse?sort=recent"}),b.jsx("section",{className:"py-12 bg-gradient-to-r from-jetblack-900 to-jet-gray",children:b.jsxs("div",{className:"container mx-auto px-4 text-center",children:[b.jsx("h2",{className:"text-3xl font-bold text-white mb-4",children:"Discover Your Next Favorite Anime"}),b.jsx("p",{className:"text-gray-300 mb-8 max-w-2xl mx-auto",children:"With thousands of anime to choose from and new episodes added daily, there's always something exciting to watch."}),b.jsx("a",{href:"/browse",className:"inline-block bg-primary-700 hover:bg-primary-600 text-white font-medium rounded-md px-8 py-3 transition-colors",children:"Browse All Anime"})]})})]})},LR=()=>{const[r,e]=pb(),[t,i]=U.useState([]),[n,l]=U.useState([]),[o,u]=U.useState(!0),[d,f]=U.useState(!1),[m,g]=U.useState(1),[v,E]=U.useState([]),[y,S]=U.useState(1),[T,R]=U.useState([]),[D,_]=U.useState(""),[O,C]=U.useState(""),[B,N]=U.useState("");U.useEffect(()=>{const J=r.get("sort")||"",P=r.get("q")||"",W=r.get("status")||"",se=r.getAll("genre"),ee=parseInt(r.get("page")||"1",10);C(J),N(P),_(W),R(se),g(ee)},[r]),U.useEffect(()=>{(async()=>{try{const P=await kt.getGenres();E(P)}catch(P){console.error("Error fetching genres:",P)}})()},[]),U.useEffect(()=>{(async()=>{try{u(!0);let P=[];T.length>0?P=await kt.getAnimeByGenre(T[0],m):P=await kt.getBrowseAnime({page:m,query:B,sort:O}),i(P),S(W=>P.length<20?m:Math.max(W,m+1)),u(!1)}catch(P){console.error("Error fetching data for browse page:",P),u(!1)}})()},[m,B,O,T]),U.useEffect(()=>{let J=[...t];D&&(J=J.filter(P=>P.status===D)),T.length>1&&(J=J.filter(P=>T.every(W=>P.genres.includes(W)))),l(J)},[t,D,T]);const F=()=>{const J=new URLSearchParams;O&&J.set("sort",O),B&&J.set("q",B),D&&J.set("status",D),m>1&&J.set("page",m.toString()),T.forEach(P=>J.append("genre",P)),e(J)},z=()=>{R([]),_(""),C(""),N(""),g(1),e({})},$=J=>{R(P=>P.includes(J)?P.filter(W=>W!==J):[...P,J])},ae=J=>{J.preventDefault(),g(1),F()},ce=J=>{if(J<1||J>y||J===m)return;g(J),window.scrollTo(0,0);const P=new URLSearchParams(r);P.set("page",J.toString()),e(P)},ve=()=>{const J=[];if(y<=5)for(let W=1;W<=y;W++)J.push(W);else{J.push(1);let W=Math.max(2,m-1),se=Math.min(y-1,m+1);m<=2?se=4:m>=y-1&&(W=y-4+1),W>2&&J.push("...");for(let ee=W;ee<=se;ee++)J.push(ee);se<y-1&&J.push("..."),y>1&&J.push(y)}return J};if(o&&t.length===0)return b.jsx(Mt,{children:b.jsx("div",{className:"flex justify-center items-center h-screen",children:b.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})})});const he=v.length>0?v:Array.from(new Set(t.flatMap(J=>J.genres))).sort();return b.jsx(Mt,{children:b.jsxs("div",{className:"container mx-auto px-4 py-8",children:[b.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mb-8",children:[b.jsx("h1",{className:"text-3xl font-bold text-white mb-4 md:mb-0",children:"Browse Anime"}),b.jsx("div",{className:"w-full md:w-auto",children:b.jsxs("form",{onSubmit:ae,className:"flex",children:[b.jsx("input",{type:"text",placeholder:"Search anime...",className:"bg-jet-card text-white px-4 py-2 rounded-l-md w-full focus:outline-none focus:ring-2 focus:ring-primary-600",value:B,onChange:J=>N(J.target.value)}),b.jsx("button",{type:"submit",className:"bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-r-md",children:b.jsx(Iv,{})})]})})]}),b.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[b.jsxs("div",{className:"w-full md:w-64 bg-jet-card p-4 rounded-lg",children:[b.jsxs("div",{className:"flex justify-between items-center mb-4",children:[b.jsxs("h2",{className:"text-lg font-medium text-white flex items-center",children:[b.jsx(Bb,{className:"mr-2"})," Filters"]}),b.jsx("button",{className:"text-xs text-primary-400 hover:text-primary-300",onClick:z,children:"Reset All"})]}),b.jsx("button",{className:"w-full py-2 bg-gray-700 rounded-md text-white text-sm font-medium mb-4 md:hidden",onClick:()=>f(!d),children:d?"Hide Filters":"Show Filters"}),b.jsxs("div",{className:`${d?"":"hidden md:block"}`,children:[b.jsxs("div",{className:"mb-6",children:[b.jsxs("h3",{className:"text-white font-medium mb-2 flex items-center",children:[b.jsx($b,{className:"mr-2"})," Sort By"]}),b.jsxs("select",{className:"w-full bg-gray-700 text-white rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary-600",value:O,onChange:J=>{C(J.target.value),g(1),F()},children:[b.jsx("option",{value:"",children:"Default"}),b.jsx("option",{value:"trending",children:"Trending"}),b.jsx("option",{value:"recent",children:"Recently Added"})]})]}),b.jsxs("div",{className:"mb-6",children:[b.jsx("h3",{className:"text-white font-medium mb-2",children:"Status"}),b.jsxs("div",{className:"space-y-2",children:[b.jsxs("div",{className:"flex items-center",children:[b.jsx("input",{type:"radio",id:"status-all",name:"status",className:"mr-2",checked:D==="",onChange:()=>{_(""),F()}}),b.jsx("label",{htmlFor:"status-all",className:"text-gray-300",children:"All"})]}),b.jsxs("div",{className:"flex items-center",children:[b.jsx("input",{type:"radio",id:"status-ongoing",name:"status",className:"mr-2",checked:D==="ongoing",onChange:()=>{_("ongoing"),F()}}),b.jsx("label",{htmlFor:"status-ongoing",className:"text-gray-300",children:"Ongoing"})]}),b.jsxs("div",{className:"flex items-center",children:[b.jsx("input",{type:"radio",id:"status-completed",name:"status",className:"mr-2",checked:D==="completed",onChange:()=>{_("completed"),F()}}),b.jsx("label",{htmlFor:"status-completed",className:"text-gray-300",children:"Completed"})]})]})]}),he.length>0&&b.jsxs("div",{children:[b.jsx("h3",{className:"text-white font-medium mb-2",children:"Genres"}),b.jsx("div",{className:"space-y-2 max-h-72 overflow-y-auto pr-2",children:he.map(J=>b.jsxs("div",{className:"flex items-center",children:[b.jsx("input",{type:"checkbox",id:`genre-${J}`,className:"mr-2",checked:T.includes(J),onChange:()=>{$(J),F()}}),b.jsx("label",{htmlFor:`genre-${J}`,className:"text-gray-300",children:J})]},J))})]})]})]}),b.jsxs("div",{className:"flex-1",children:[b.jsx("div",{className:"mb-4",children:b.jsxs("p",{className:"text-gray-400",children:[n.length," ",n.length===1?"result":"results"," found"]})}),n.length>0?b.jsxs(b.Fragment,{children:[b.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 md:gap-6",children:n.map(J=>b.jsx(Ov,{anime:J},J.id))}),y>1&&b.jsx("div",{className:"mt-8 flex justify-center",children:b.jsxs("div",{className:"flex items-center bg-jet-card rounded-lg overflow-hidden shadow-lg",children:[b.jsx("button",{onClick:()=>ce(m-1),disabled:m===1||o,className:`flex items-center justify-center w-10 h-10 ${m===1||o?"text-gray-500 cursor-not-allowed":"text-white hover:bg-primary-700 hover:text-white"}`,"aria-label":"Previous Page",children:b.jsx(Dv,{size:14})}),b.jsx("div",{className:"hidden sm:flex",children:ve().map((J,P)=>b.jsx(Si.Fragment,{children:typeof J=="number"?b.jsx("button",{onClick:()=>ce(J),className:`w-10 h-10 flex items-center justify-center ${m===J?"bg-primary-600 text-white":"text-white hover:bg-gray-700"}`,children:J}):b.jsx("span",{className:"w-10 h-10 flex items-center justify-center text-gray-400",children:J})},P))}),b.jsxs("div",{className:"sm:hidden px-4 h-10 flex items-center justify-center text-white",children:["Page ",m," of ",y]}),b.jsx("button",{onClick:()=>ce(m+1),disabled:m===y||o,className:`flex items-center justify-center w-10 h-10 ${m===y||o?"text-gray-500 cursor-not-allowed":"text-white hover:bg-primary-700 hover:text-white"}`,"aria-label":"Next Page",children:b.jsx(Vd,{size:14})})]})})]}):b.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-center",children:[b.jsx("p",{className:"text-gray-300 text-lg mb-4",children:"No anime found matching your criteria"}),b.jsx("button",{className:"bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-md",onClick:z,children:"Reset Filters"})]})]})]})]})})},_R=()=>{const[r,e]=U.useState([]),[t,i]=U.useState(!0);if(U.useEffect(()=>{(async()=>{try{i(!0);const o=await kt.getGenres();e(o),i(!1)}catch(o){console.error("Error fetching genres:",o),i(!1)}})()},[]),t)return b.jsx(Mt,{children:b.jsx("div",{className:"flex justify-center items-center h-screen",children:b.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})})});const n={action:"https://www.pride.org.my/wp-content/uploads/2021/03/lgi39qi7kmzdipemivm1.jpg",adventure:"https://static1.srcdn.com/wordpress/wp-content/uploads/2023/10/the-main-cast-of-frieren.jpg",cars:"https://imgix.ranker.com/list_img_v2/19242/1839242/original/1839242-u3",comedy:"https://static1.colliderimages.com/wordpress/wp-content/uploads/2024/10/daily_lives_of_high_school_boys.jpg",dementia:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS0pjqPy-wo1FfCxHrmYD9n-bTVNxMPefUr4w&s",demons:"https://staticg.sportskeeda.com/editor/2023/11/44d5a-17002924082331-1920.jpg",drama:"https://imgix.ranker.com/list_img_v2/15115/2795115/original/best-drama-anime?auto=format&q=50&fit=crop&fm=pjpg&dpr=2&crop=faces&h=185.86387434554973&w=355",ecchi:"https://thecinemaholic.com/wp-content/uploads/2018/08/_d_improd_/sankarea_f_improf_900x506.jpg",game:"https://static1.dualshockersimages.com/wordpress/wp-content/uploads/2023/05/10-best-anime-about-gaming.jpg",harem:"https://imgix.ranker.com/list_img_v2/14804/1834804/original/1834804-u3?auto=format&q=50&fit=crop&fm=pjpg&dpr=2&crop=faces&h=185.86387434554973&w=355",historical:"https://a.storyblok.com/f/178900/960x540/8bb18b7440/the-elusive-samurai.jpg/m/filters:quality(95)format(webp)",fantasy:"https://static1.moviewebimages.com/wordpress/wp-content/uploads/2024/05/20-underrated-dark-fantasy-anime-you-should-watch.jpg",horror:"https://static1.srcdn.com/wordpress/wp-content/uploads/2023/10/horror-anime-featured.jpg",default:"https://image.tmdb.org/t/p/original/r0FLFaxe4vaIl8iv46OaJLBPDXf.jpg"};return b.jsx(Mt,{children:b.jsxs("div",{className:"container mx-auto px-4 py-8",children:[b.jsx("h1",{className:"text-3xl font-bold text-white mb-8",children:"Genres"}),b.jsx("p",{className:"text-gray-300 mb-8 max-w-3xl",children:"Explore anime by genre. From action-packed adventures to heartwarming romances, find your favorite genre and discover new titles to watch."}),b.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6",children:r.map(l=>b.jsx(Ae,{to:`/browse?genre=${encodeURIComponent(l)}`,className:"group",children:b.jsxs("div",{className:"relative rounded-lg overflow-hidden h-48 bg-jet-card",children:[b.jsx("img",{src:n[l]||n.default,alt:l,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"}),b.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-black/10 flex items-end",children:b.jsx("div",{className:"p-4",children:b.jsx("h3",{className:"text-xl font-bold text-white mb-1 capitalize",children:l})})})]})},l))})]})})},DR=()=>{var O;const{id:r}=vv(),e=zs(),[t,i]=U.useState(null),[n,l]=U.useState(null),[o,u]=U.useState(!0),[d,f]=U.useState([]),[m,g]=U.useState([]),[v,E]=U.useState("list"),[y,S]=U.useState(10);U.useEffect(()=>{(async()=>{if(r)try{u(!0);const B=await kt.getAnimeInfo(r);if(B){i(B),B.seasons.length>0&&l(B.seasons[0]);const F=await(await fetch(`https://consumet-api-new.up.railway.app/anime/zoro/info?id=${r}`)).json();f(F.relatedAnime||[]),g(F.recommendations||[])}u(!1)}catch(B){console.error(`Error fetching anime with id ${r}:`,B),u(!1)}})()},[r]),U.useEffect(()=>{S(10)},[n]),U.useEffect(()=>{const C=localStorage.getItem("episodesViewMode");(C==="grid"||C==="list")&&E(C)},[]);const T=()=>{const C=v==="list"?"grid":"list";E(C),localStorage.setItem("episodesViewMode",C)},R=()=>{if(!n)return;const C=Math.min(y+20,n.episodes.length);S(C)},D=()=>{n&&S(n.episodes.length)};if(o)return b.jsx(Mt,{children:b.jsx("div",{className:"flex justify-center items-center h-screen",children:b.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})})});if(!t)return b.jsx(Mt,{children:b.jsxs("div",{className:"container mx-auto px-4 py-16 text-center",children:[b.jsx("h1",{className:"text-3xl font-bold text-white mb-4",children:"Anime Not Found"}),b.jsx("p",{className:"text-gray-300 mb-8",children:"The anime you are looking for doesn't exist or has been removed."}),b.jsx("button",{onClick:()=>e(-1),className:"bg-primary-600 hover:bg-primary-700 text-white px-6 py-3 rounded-md font-medium",children:"Go Back"})]})});const _=C=>`${Math.floor(C/60)} min`;return b.jsxs(Mt,{children:[b.jsxs("div",{className:"relative h-[50vh] sm:h-[60vh] z-0",children:[b.jsxs("div",{className:"absolute inset-0",children:[b.jsx("img",{src:t.bannerImage||t.coverImage,alt:t.title,className:"w-full h-full object-cover"}),b.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black via-black/60 to-black/30"})]}),b.jsx("div",{className:"container mx-auto px-4 relative h-full flex items-end pb-8",children:b.jsxs("div",{className:"flex flex-col md:flex-row gap-8 w-full",children:[b.jsx("div",{className:"hidden md:block flex-shrink-0 w-32 sm:w-40 md:w-56 md:-mb-32 z-[5] mx-auto md:mx-0 -mb-16 sm:-mb-20",children:b.jsx("img",{src:t.coverImage,alt:t.title,className:"w-full rounded-lg shadow-lg border border-jetblack-800"})}),b.jsxs("div",{className:"flex-1 text-center md:text-left z-[5]",children:[b.jsx("h1",{className:"text-2xl sm:text-3xl md:text-4xl font-bold text-white mb-2 sm:mb-2 shadow-text",children:t.title}),b.jsxs("div",{className:"flex flex-wrap items-center justify-center md:justify-start gap-4 mb-3 sm:mb-4",children:[b.jsxs("div",{className:"flex items-center",children:[b.jsx(Cv,{className:"text-yellow-400 mr-1"}),b.jsx("span",{className:"text-white font-medium",children:t.rating.toFixed(1)})]}),b.jsxs("div",{className:"flex items-center",children:[b.jsx(Rp,{className:"text-gray-400 mr-1"}),b.jsx("span",{className:"text-gray-300",children:t.releaseYear})]}),b.jsx("span",{className:`text-xs text-white ${t.status==="ongoing"?"bg-green-700":"bg-blue-700"} rounded-full px-3 py-1`,children:t.status==="ongoing"?"Ongoing":"Completed"})]}),b.jsxs("div",{className:"flex flex-wrap justify-center md:justify-start gap-2 mb-4 max-w-full overflow-hidden",children:[t.genres.slice(0,4).map((C,B)=>b.jsx(Ae,{to:`/browse?genre=${encodeURIComponent(C)}`,className:"bg-jet-card hover:bg-jet-hover text-gray-300 text-sm rounded-full px-3 py-1 transition-colors",children:C},B)),t.genres.length>4&&b.jsxs("span",{className:"text-gray-300 text-sm",children:["+",t.genres.length-4," more"]})]}),((O=t.seasons[0])==null?void 0:O.episodes[0])&&b.jsx("div",{className:"flex justify-center md:justify-start",children:b.jsxs(Ae,{to:`/watch/${t.id}/${t.seasons[0].id}/${t.seasons[0].episodes[0].id}`,className:"inline-flex items-center bg-primary-600 hover:bg-primary-700 text-white px-4 sm:px-6 py-2 sm:py-3 rounded-full transition-colors font-medium",children:[b.jsx(Lo,{className:"mr-2"})," Watch Now"]})})]})]})})]}),b.jsx("div",{className:"container mx-auto px-4 py-12 mt-24 sm:mt-32 md:mt-16",children:b.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-8",children:[b.jsxs("div",{className:"md:col-span-2 lg:col-span-3",children:[b.jsxs("div",{className:"flex items-center justify-between mb-6",children:[b.jsx("h2",{className:"text-2xl font-bold text-white",children:"Episodes"}),b.jsxs("div",{className:"flex items-center space-x-2",children:[b.jsx("span",{className:"text-sm text-gray-400",children:"View:"}),b.jsx("button",{onClick:T,className:`p-2 rounded-md ${v==="list"?"bg-primary-600 text-white":"bg-jet-card text-gray-400 hover:bg-jet-hover"}`,title:"List View",children:b.jsx(fd,{size:16})}),b.jsx("button",{onClick:T,className:`p-2 rounded-md ${v==="grid"?"bg-primary-600 text-white":"bg-jet-card text-gray-400 hover:bg-jet-hover"}`,title:"Grid View",children:b.jsx(Gb,{size:16})})]})]}),t.seasons.length>1&&b.jsx("div",{className:"flex border-b border-gray-800 mb-6 overflow-x-auto",children:t.seasons.map(C=>b.jsx("button",{className:`px-4 py-2 font-medium ${(n==null?void 0:n.id)===C.id?"text-primary-500 border-b-2 border-primary-500":"text-gray-400 hover:text-white"}`,onClick:()=>l(C),children:C.title},C.id))}),n&&n.episodes.length>0&&b.jsxs("div",{className:"text-sm text-gray-400 mb-4",children:["Showing ",Math.min(y,n.episodes.length)," of ",n.episodes.length," episodes"]}),n&&b.jsxs(b.Fragment,{children:[v==="list"&&b.jsx("div",{className:"space-y-4",children:n.episodes.slice(0,y).map(C=>b.jsx(Ae,{to:`/watch/${t.id}/${n.id}/${C.id}`,className:"block bg-jet-card rounded-lg overflow-hidden hover:bg-jet-hover transition-colors border border-jetblack-800 group",children:b.jsxs("div",{className:"flex flex-col sm:flex-row",children:[b.jsxs("div",{className:"relative sm:w-60 h-36 overflow-hidden flex-shrink-0",children:[b.jsx("img",{src:C.thumbnail,alt:C.title,className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-105",style:{aspectRatio:"16/9",objectPosition:"center"}}),b.jsxs("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 to-transparent",children:[b.jsxs("div",{className:"absolute bottom-2 left-2 bg-primary-600 text-white text-xs px-2 py-1 rounded-full font-medium z-10 pointer-events-none",children:["Episode ",C.number]}),b.jsxs("div",{className:"absolute bottom-2 right-2 bg-black/70 text-white text-xs px-2 py-1 rounded flex items-center z-10 pointer-events-none",children:[b.jsx(Lp,{className:"mr-1 text-xs"}),_(C.duration)]}),b.jsx("div",{className:"absolute inset-0 bg-black/30 flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity",children:b.jsx("div",{className:"bg-primary-600/80 rounded-full p-3 transform hover:scale-110 transition-transform",children:b.jsx(Lo,{className:"text-white text-xl"})})})]})]}),b.jsxs("div",{className:"p-4 flex flex-col justify-between flex-grow",children:[b.jsxs("div",{children:[b.jsx("h3",{className:"font-medium text-white text-lg mb-2 line-clamp-1 hover:text-primary-400 transition-colors",children:C.title}),b.jsx("div",{className:"hidden sm:block text-gray-400 text-sm mb-3 line-clamp-2",children:`Watch episode ${C.number} of ${t.title} - ${C.title}`})]}),b.jsxs("div",{className:"flex justify-between items-center mt-2",children:[b.jsxs("div",{className:"text-gray-400 flex items-center text-sm",children:[b.jsx(Rp,{className:"mr-1"}),new Date(C.releaseDate).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})]}),b.jsx("span",{className:"text-primary-500 font-medium text-sm hover:underline",children:"Watch Now"})]})]})]})},C.id))}),v==="grid"&&b.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4",children:n.episodes.slice(0,y).map(C=>b.jsxs(Ae,{to:`/watch/${t.id}/${n.id}/${C.id}`,className:"bg-jet-card rounded-lg overflow-hidden hover:bg-jet-hover transition-colors border border-jetblack-800 group h-full flex flex-col",children:[b.jsxs("div",{className:"relative overflow-hidden",children:[b.jsx("img",{src:C.thumbnail,alt:C.title,className:"w-full aspect-video object-cover transition-transform duration-300 group-hover:scale-105"}),b.jsxs("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 to-transparent",children:[b.jsxs("div",{className:"absolute bottom-2 left-2 bg-primary-600 text-white text-xs px-2 py-1 rounded-full font-medium z-10 pointer-events-none",children:["Ep ",C.number]}),b.jsxs("div",{className:"absolute top-2 right-2 bg-black/70 text-white text-xs px-2 py-1 rounded flex items-center z-10 pointer-events-none",children:[b.jsx(Lp,{className:"mr-1 text-xs"}),_(C.duration)]}),b.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:b.jsx("div",{className:"bg-primary-600/80 rounded-full p-2 transform hover:scale-110 transition-transform",children:b.jsx(Lo,{className:"text-white"})})})]})]}),b.jsxs("div",{className:"p-3 flex flex-col flex-grow",children:[b.jsx("h3",{className:"font-medium text-white text-sm mb-1 line-clamp-1 group-hover:text-primary-400 transition-colors",children:C.title}),b.jsx("div",{className:"text-gray-400 text-xs mt-auto",children:new Date(C.releaseDate).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})})]})]},C.id))}),n.episodes.length>y&&b.jsxs("div",{className:"mt-6 text-center",children:[b.jsxs("button",{onClick:R,className:"bg-jet-card hover:bg-jet-hover text-white px-6 py-3 rounded-lg inline-flex items-center transition-colors",children:[b.jsx(Nb,{className:"mr-2"})," Show More Episodes"]}),b.jsx("button",{onClick:D,className:"ml-4 text-primary-500 hover:text-primary-400 transition-colors text-sm",children:"Show All"})]})]}),m.length>0&&b.jsxs("div",{className:"mt-12",children:[b.jsx("h2",{className:"text-2xl font-bold text-white mb-6",children:"You May Also Like"}),b.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4",children:m.slice(0,10).map((C,B)=>b.jsx(Ae,{to:`/anime/${C.id}`,className:"group",children:b.jsxs("div",{className:"bg-jet-card rounded-lg overflow-hidden hover:bg-jet-hover transition-colors h-full",children:[b.jsxs("div",{className:"relative aspect-[2/3] overflow-hidden",children:[b.jsx("img",{src:C.image,alt:C.title,className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"}),b.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"})]}),b.jsxs("div",{className:"p-3",children:[b.jsx("h3",{className:"text-white text-sm font-medium line-clamp-2 group-hover:text-primary-400 transition-colors",children:C.title}),b.jsxs("div",{className:"flex items-center justify-between mt-1",children:[b.jsx("span",{className:"text-xs text-gray-400",children:C.type}),C.episodes>0&&b.jsxs("span",{className:"text-xs text-gray-400",children:[C.episodes," eps"]})]})]})]})},B))})]})]}),b.jsxs("div",{children:[b.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"Synopsis"}),b.jsx("p",{className:"text-gray-300 mb-6",children:t.description}),b.jsxs("div",{className:"bg-jet-card rounded-lg p-4",children:[b.jsx("h3",{className:"text-lg font-medium text-white mb-3",children:"Details"}),b.jsxs("ul",{className:"space-y-2",children:[b.jsxs("li",{className:"flex justify-between",children:[b.jsx("span",{className:"text-gray-400",children:"Status:"}),b.jsx("span",{className:"text-white font-medium",children:t.status==="ongoing"?"Ongoing":"Completed"})]}),b.jsxs("li",{className:"flex justify-between",children:[b.jsx("span",{className:"text-gray-400",children:"Released:"}),b.jsx("span",{className:"text-white font-medium",children:t.releaseYear})]}),b.jsxs("li",{className:"flex justify-between",children:[b.jsx("span",{className:"text-gray-400",children:"Episodes:"}),b.jsx("span",{className:"text-white font-medium",children:t.seasons.reduce((C,B)=>C+B.episodes.length,0)})]}),b.jsxs("li",{className:"flex justify-between",children:[b.jsx("span",{className:"text-gray-400",children:"Seasons:"}),b.jsx("span",{className:"text-white font-medium",children:t.seasons.length})]})]})]}),d.length>0&&b.jsxs("div",{className:"mt-6",children:[b.jsx("h3",{className:"text-lg font-medium text-white mb-3",children:"Related Anime"}),b.jsx("div",{className:"space-y-3",children:d.map((C,B)=>b.jsxs(Ae,{to:`/anime/${C.id}`,className:"flex items-center gap-3 group",children:[b.jsx("div",{className:"w-16 h-16 rounded overflow-hidden flex-shrink-0",children:b.jsx("img",{src:C.image,alt:C.title,className:"w-full h-full object-cover"})}),b.jsxs("div",{children:[b.jsx("h4",{className:"text-white text-sm font-medium group-hover:text-primary-400 transition-colors line-clamp-1",children:C.title}),b.jsx("span",{className:"text-xs text-gray-400",children:C.type})]})]},B))})]})]})]})})]})},de=Number.isFinite||function(r){return typeof r=="number"&&isFinite(r)},wR=Number.isSafeInteger||function(r){return typeof r=="number"&&Math.abs(r)<=IR},IR=Number.MAX_SAFE_INTEGER||9007199254740991;let pe=function(r){return r.NETWORK_ERROR="networkError",r.MEDIA_ERROR="mediaError",r.KEY_SYSTEM_ERROR="keySystemError",r.MUX_ERROR="muxError",r.OTHER_ERROR="otherError",r}({}),q=function(r){return r.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",r.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",r.KEY_SYSTEM_NO_SESSION="keySystemNoSession",r.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",r.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",r.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",r.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",r.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",r.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",r.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",r.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",r.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",r.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",r.MANIFEST_LOAD_ERROR="manifestLoadError",r.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",r.MANIFEST_PARSING_ERROR="manifestParsingError",r.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",r.LEVEL_EMPTY_ERROR="levelEmptyError",r.LEVEL_LOAD_ERROR="levelLoadError",r.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",r.LEVEL_PARSING_ERROR="levelParsingError",r.LEVEL_SWITCH_ERROR="levelSwitchError",r.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",r.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",r.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",r.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",r.FRAG_LOAD_ERROR="fragLoadError",r.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",r.FRAG_DECRYPT_ERROR="fragDecryptError",r.FRAG_PARSING_ERROR="fragParsingError",r.FRAG_GAP="fragGap",r.REMUX_ALLOC_ERROR="remuxAllocError",r.KEY_LOAD_ERROR="keyLoadError",r.KEY_LOAD_TIMEOUT="keyLoadTimeOut",r.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",r.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",r.BUFFER_APPEND_ERROR="bufferAppendError",r.BUFFER_APPENDING_ERROR="bufferAppendingError",r.BUFFER_STALLED_ERROR="bufferStalledError",r.BUFFER_FULL_ERROR="bufferFullError",r.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",r.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",r.ASSET_LIST_LOAD_ERROR="assetListLoadError",r.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",r.ASSET_LIST_PARSING_ERROR="assetListParsingError",r.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",r.INTERNAL_EXCEPTION="internalException",r.INTERNAL_ABORTED="aborted",r.ATTACH_MEDIA_ERROR="attachMediaError",r.UNKNOWN="unknown",r}({}),A=function(r){return r.MEDIA_ATTACHING="hlsMediaAttaching",r.MEDIA_ATTACHED="hlsMediaAttached",r.MEDIA_DETACHING="hlsMediaDetaching",r.MEDIA_DETACHED="hlsMediaDetached",r.MEDIA_ENDED="hlsMediaEnded",r.STALL_RESOLVED="hlsStallResolved",r.BUFFER_RESET="hlsBufferReset",r.BUFFER_CODECS="hlsBufferCodecs",r.BUFFER_CREATED="hlsBufferCreated",r.BUFFER_APPENDING="hlsBufferAppending",r.BUFFER_APPENDED="hlsBufferAppended",r.BUFFER_EOS="hlsBufferEos",r.BUFFERED_TO_END="hlsBufferedToEnd",r.BUFFER_FLUSHING="hlsBufferFlushing",r.BUFFER_FLUSHED="hlsBufferFlushed",r.MANIFEST_LOADING="hlsManifestLoading",r.MANIFEST_LOADED="hlsManifestLoaded",r.MANIFEST_PARSED="hlsManifestParsed",r.LEVEL_SWITCHING="hlsLevelSwitching",r.LEVEL_SWITCHED="hlsLevelSwitched",r.LEVEL_LOADING="hlsLevelLoading",r.LEVEL_LOADED="hlsLevelLoaded",r.LEVEL_UPDATED="hlsLevelUpdated",r.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",r.LEVELS_UPDATED="hlsLevelsUpdated",r.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",r.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",r.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",r.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",r.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",r.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",r.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",r.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",r.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",r.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",r.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",r.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",r.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",r.CUES_PARSED="hlsCuesParsed",r.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",r.INIT_PTS_FOUND="hlsInitPtsFound",r.FRAG_LOADING="hlsFragLoading",r.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",r.FRAG_LOADED="hlsFragLoaded",r.FRAG_DECRYPTED="hlsFragDecrypted",r.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",r.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",r.FRAG_PARSING_METADATA="hlsFragParsingMetadata",r.FRAG_PARSED="hlsFragParsed",r.FRAG_BUFFERED="hlsFragBuffered",r.FRAG_CHANGED="hlsFragChanged",r.FPS_DROP="hlsFpsDrop",r.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",r.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",r.ERROR="hlsError",r.DESTROYING="hlsDestroying",r.KEY_LOADING="hlsKeyLoading",r.KEY_LOADED="hlsKeyLoaded",r.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",r.BACK_BUFFER_REACHED="hlsBackBufferReached",r.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",r.ASSET_LIST_LOADING="hlsAssetListLoading",r.ASSET_LIST_LOADED="hlsAssetListLoaded",r.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",r.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",r.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",r.INTERSTITIAL_STARTED="hlsInterstitialStarted",r.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",r.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",r.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",r.INTERSTITIAL_ENDED="hlsInterstitialEnded",r.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",r.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",r.EVENT_CUE_ENTER="hlsEventCueEnter",r}({});var Ce={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},ge={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class or{constructor(e,t=0,i=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=i}sample(e,t){const i=Math.pow(this.alpha_,e);this.estimate_=t*(1-i)+i*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class CR{constructor(e,t,i,n=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new or(e),this.fast_=new or(t),this.defaultTTFB_=n,this.ttfb_=new or(e)}update(e,t){const{slow_:i,fast_:n,ttfb_:l}=this;i.halfLife!==e&&(this.slow_=new or(e,i.getEstimate(),i.getTotalWeight())),n.halfLife!==t&&(this.fast_=new or(t,n.getEstimate(),n.getTotalWeight())),l.halfLife!==e&&(this.ttfb_=new or(e,l.getEstimate(),l.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const i=8*t,n=e/1e3,l=i/n;this.fast_.sample(n,l),this.slow_.sample(n,l)}sampleTTFB(e){const t=e/1e3,i=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(i,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function OR(r,e,t){return(e=kR(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function Ke(){return Ke=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)({}).hasOwnProperty.call(t,i)&&(r[i]=t[i])}return r},Ke.apply(null,arguments)}function qp(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(r);e&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(r,n).enumerable})),t.push.apply(t,i)}return t}function $e(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?qp(Object(t),!0).forEach(function(i){OR(r,i,t[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):qp(Object(t)).forEach(function(i){Object.defineProperty(r,i,Object.getOwnPropertyDescriptor(t,i))})}return r}function NR(r,e){if(typeof r!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var i=t.call(r,e);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function kR(r){var e=NR(r,"string");return typeof e=="symbol"?e:e+""}class ms{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const i=`[${e}]:`;this.trace=$s,this.debug=t.debug.bind(null,i),this.log=t.log.bind(null,i),this.warn=t.warn.bind(null,i),this.info=t.info.bind(null,i),this.error=t.error.bind(null,i)}}const $s=function(){},MR={trace:$s,debug:$s,log:$s,warn:$s,info:$s,error:$s};function xd(){return Ke({},MR)}function PR(r,e){const t=self.console[r];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${r}] >`):$s}function Xp(r,e,t){return e[r]?e[r].bind(e):PR(r,t)}const Ed=xd();function UR(r,e,t){const i=xd();if(typeof console=="object"&&r===!0||typeof r=="object"){const n=["debug","log","info","warn","error"];n.forEach(l=>{i[l]=Xp(l,r,t)});try{i.log(`Debug logs enabled for "${e}" in hls.js version 1.6.2`)}catch{return xd()}n.forEach(l=>{Ed[l]=Xp(l,r)})}else Ke(Ed,i);return i}const Me=Ed;function Hs(r=!0){return typeof self>"u"?void 0:(r||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function BR(r){return typeof self<"u"&&r===self.ManagedMediaSource}function nx(r,e){const t=Object.keys(r),i=Object.keys(e),n=t.length,l=i.length;return!n||!l||n===l&&!t.some(o=>i.indexOf(o)===-1)}function ti(r,e=!1){if(typeof TextDecoder<"u"){const f=new TextDecoder("utf-8").decode(r);if(e){const m=f.indexOf("\0");return m!==-1?f.substring(0,m):f}return f.replace(/\0/g,"")}const t=r.length;let i,n,l,o="",u=0;for(;u<t;){if(i=r[u++],i===0&&e)return o;if(i===0||i===3)continue;switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(i);break;case 12:case 13:n=r[u++],o+=String.fromCharCode((i&31)<<6|n&63);break;case 14:n=r[u++],l=r[u++],o+=String.fromCharCode((i&15)<<12|(n&63)<<6|(l&63)<<0);break}}return o}const Pi={hexDump:function(r){let e="";for(let t=0;t<r.length;t++){let i=r[t].toString(16);i.length<2&&(i="0"+i),e+=i}return e}};function FR(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Pf={exports:{}},Qp;function jR(){return Qp||(Qp=1,function(r,e){(function(t){var i=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,n=/^(?=([^\/?#]*))\1([^]*)$/,l=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,u={buildAbsoluteURL:function(d,f,m){if(m=m||{},d=d.trim(),f=f.trim(),!f){if(!m.alwaysNormalize)return d;var g=u.parseURL(d);if(!g)throw new Error("Error trying to parse base URL.");return g.path=u.normalizePath(g.path),u.buildURLFromParts(g)}var v=u.parseURL(f);if(!v)throw new Error("Error trying to parse relative URL.");if(v.scheme)return m.alwaysNormalize?(v.path=u.normalizePath(v.path),u.buildURLFromParts(v)):f;var E=u.parseURL(d);if(!E)throw new Error("Error trying to parse base URL.");if(!E.netLoc&&E.path&&E.path[0]!=="/"){var y=n.exec(E.path);E.netLoc=y[1],E.path=y[2]}E.netLoc&&!E.path&&(E.path="/");var S={scheme:E.scheme,netLoc:v.netLoc,path:null,params:v.params,query:v.query,fragment:v.fragment};if(!v.netLoc&&(S.netLoc=E.netLoc,v.path[0]!=="/"))if(!v.path)S.path=E.path,v.params||(S.params=E.params,v.query||(S.query=E.query));else{var T=E.path,R=T.substring(0,T.lastIndexOf("/")+1)+v.path;S.path=u.normalizePath(R)}return S.path===null&&(S.path=m.alwaysNormalize?u.normalizePath(v.path):v.path),u.buildURLFromParts(S)},parseURL:function(d){var f=i.exec(d);return f?{scheme:f[1]||"",netLoc:f[2]||"",path:f[3]||"",params:f[4]||"",query:f[5]||"",fragment:f[6]||""}:null},normalizePath:function(d){for(d=d.split("").reverse().join("").replace(l,"");d.length!==(d=d.replace(o,"")).length;);return d.split("").reverse().join("")},buildURLFromParts:function(d){return d.scheme+d.netLoc+d.path+d.params+d.query+d.fragment}};r.exports=u})()}(Pf)),Pf.exports}var qd=jR();class Xd{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var ze={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class rx{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,GR(this,"stats")}setByteRange(e,t){const i=e.split("@",2);let n;i.length===1?n=(t==null?void 0:t.byteRangeEndOffset)||0:n=parseInt(i[1]),this._byteRange=[n,parseInt(i[0])+n]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[ze.AUDIO]:null,[ze.VIDEO]:null,[ze.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new Xd),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=qd.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[ze.AUDIO]=null,e[ze.VIDEO]=null,e[ze.AUDIOVIDEO]=null}}function St(r){return r.sn!=="initSegment"}class Uf extends rx{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange){const e=this.byteRange[0],t=this.byteRange[1];if(de(e)&&de(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){const{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const t=this.levelkeys.identity;if(t)this._decryptdata=t.getDecryptData(this.sn);else{const i=Object.keys(this.levelkeys);if(i.length===1)return this._decryptdata=this.levelkeys[i[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=de(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){const t=Object.keys(this.levelkeys),i=t.length;if(i>1||i===1&&this.levelkeys[t[0]].encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!de(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return St(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){if(this.levelkeys){const t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,i,n,l,o=!1){const{elementaryStreams:u}=this,d=u[e];if(!d){u[e]={startPTS:t,endPTS:i,startDTS:n,endDTS:l,partial:o};return}d.startPTS=Math.min(d.startPTS,t),d.endPTS=Math.max(d.endPTS,i),d.startDTS=Math.min(d.startDTS,n),d.endDTS=Math.max(d.endDTS,l)}}class $R extends rx{constructor(e,t,i,n,l){super(i),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=n;const o=e.enumeratedString("BYTERANGE");o&&this.setByteRange(o,l),l&&(this.fragOffset=l.fragOffset+l.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function ax(r,e){const t=Object.getPrototypeOf(r);if(t){const i=Object.getOwnPropertyDescriptor(t,e);return i||ax(t,e)}}function GR(r,e){const t=ax(r,e);t&&(t.enumerable=!0,Object.defineProperty(r,e,t))}const zo=Math.pow(2,32)-1,HR=[].push,lx={video:1,audio:2,id3:3,text:4};function mt(r){return String.fromCharCode.apply(null,r)}function ox(r,e){const t=r[e]<<8|r[e+1];return t<0?65536+t:t}function xe(r,e){const t=cx(r,e);return t<0?4294967296+t:t}function Wp(r,e){let t=xe(r,e);return t*=Math.pow(2,32),t+=xe(r,e+4),t}function cx(r,e){return r[e]<<24|r[e+1]<<16|r[e+2]<<8|r[e+3]}function Bf(r,e,t){r[e]=t>>24,r[e+1]=t>>16&255,r[e+2]=t>>8&255,r[e+3]=t&255}function VR(r){const e=r.byteLength;for(let t=0;t<e;){const i=xe(r,t);if(i>8&&r[t+4]===109&&r[t+5]===111&&r[t+6]===111&&r[t+7]===102)return!0;t=i>1?t+i:e}return!1}function be(r,e){const t=[];if(!e.length)return t;const i=r.byteLength;for(let n=0;n<i;){const l=xe(r,n),o=mt(r.subarray(n+4,n+8)),u=l>1?n+l:i;if(o===e[0])if(e.length===1)t.push(r.subarray(n+8,u));else{const d=be(r.subarray(n+8,u),e.slice(1));d.length&&HR.apply(t,d)}n=u}return t}function zR(r){const e=[],t=r[0];let i=8;const n=xe(r,i);i+=4;let l=0,o=0;t===0?(l=xe(r,i),o=xe(r,i+4),i+=8):(l=Wp(r,i),o=Wp(r,i+8),i+=16),i+=2;let u=r.length+o;const d=ox(r,i);i+=2;for(let f=0;f<d;f++){let m=i;const g=xe(r,m);m+=4;const v=g&2147483647;if((g&2147483648)>>>31===1)return Me.warn("SIDX has hierarchical references (not supported)"),null;const y=xe(r,m);m+=4,e.push({referenceSize:v,subsegmentDuration:y,info:{duration:y/n,start:u,end:u+v-1}}),u+=v,m+=4,i=m}return{earliestPresentationTime:l,timescale:n,version:t,referencesCount:d,references:e}}function ux(r){const e=[],t=be(r,["moov","trak"]);for(let n=0;n<t.length;n++){const l=t[n],o=be(l,["tkhd"])[0];if(o){let u=o[0];const d=xe(o,u===0?12:20),f=be(l,["mdia","mdhd"])[0];if(f){u=f[0];const m=xe(f,u===0?12:20),g=be(l,["mdia","hdlr"])[0];if(g){const v=mt(g.subarray(8,12)),E={soun:ze.AUDIO,vide:ze.VIDEO}[v],y=be(l,["mdia","minf","stbl","stsd"])[0],S=KR(y);E?(e[d]={timescale:m,type:E,stsd:S},e[E]=$e({timescale:m,id:d},S)):e[d]={timescale:m,type:v,stsd:S}}}}}return be(r,["moov","mvex","trex"]).forEach(n=>{const l=xe(n,4),o=e[l];o&&(o.default={duration:xe(n,12),flags:xe(n,20)})}),e}function KR(r){const e=r.subarray(8),t=e.subarray(86),i=mt(e.subarray(4,8));let n=i,l;const o=i==="enca"||i==="encv";if(o){const f=be(e,[i])[0].subarray(i==="enca"?28:78);be(f,["sinf"]).forEach(g=>{const v=be(g,["schm"])[0];if(v){const E=mt(v.subarray(4,8));if(E==="cbcs"||E==="cenc"){const y=be(g,["frma"])[0];y&&(n=mt(y))}}})}const u=n;switch(n){case"avc1":case"avc2":case"avc3":case"avc4":{const d=be(t,["avcC"])[0];d&&d.length>3&&(n+="."+uo(d[1])+uo(d[2])+uo(d[3]),l=co(u==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const d=be(e,[i])[0],f=be(d.subarray(28),["esds"])[0];if(f&&f.length>7){let m=4;if(f[m++]!==3)break;m=Ff(f,m),m+=2;const g=f[m++];if(g&128&&(m+=2),g&64&&(m+=f[m++]),f[m++]!==4)break;m=Ff(f,m);const v=f[m++];if(v===64)n+="."+uo(v);else break;if(m+=12,f[m++]!==5)break;m=Ff(f,m);const E=f[m++];let y=(E&248)>>3;y===31&&(y+=1+((E&7)<<3)+((f[m]&224)>>5)),n+="."+y}break}case"hvc1":case"hev1":{const d=be(t,["hvcC"])[0];if(d&&d.length>12){const f=d[1],m=["","A","B","C"][f>>6],g=f&31,v=xe(d,2),E=(f&32)>>5?"H":"L",y=d[12],S=d.subarray(6,12);n+="."+m+g,n+="."+v.toString(16).toUpperCase(),n+="."+E+y;let T="";for(let R=S.length;R--;){const D=S[R];(D||T)&&(T="."+D.toString(16).toUpperCase()+T)}n+=T}l=co(u=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{n=co(n,t)||n;break}case"vp09":{const d=be(t,["vpcC"])[0];if(d&&d.length>6){const f=d[4],m=d[5],g=d[6]>>4&15;n+="."+Mi(f)+"."+Mi(m)+"."+Mi(g)}break}case"av01":{const d=be(t,["av1C"])[0];if(d&&d.length>2){const f=d[1]>>>5,m=d[1]&31,g=d[2]>>>7?"H":"M",v=(d[2]&64)>>6,E=(d[2]&32)>>5,y=f===2&&v?E?12:10:v?10:8,S=(d[2]&16)>>4,T=(d[2]&8)>>3,R=(d[2]&4)>>2,D=d[2]&3;n+="."+f+"."+Mi(m)+g+"."+Mi(y)+"."+S+"."+T+R+D+"."+Mi(1)+"."+Mi(1)+"."+Mi(1)+"."+0,l=co("dav1",t)}break}}return{codec:n,encrypted:o,supplemental:l}}function co(r,e){const t=be(e,["dvvC"]),i=t.length?t[0]:be(e,["dvcC"])[0];if(i){const n=i[2]>>1&127,l=i[2]<<5&32|i[3]>>3&31;return r+"."+Mi(n)+"."+Mi(l)}}function Ff(r,e){const t=e+5;for(;r[e++]&128&&e<t;);return e}function uo(r){return("0"+r.toString(16).toUpperCase()).slice(-2)}function Mi(r){return(r<10?"0":"")+r}function YR(r,e){if(!r||!e)return r;const t=e.keyId;return t&&e.isCommonEncryption&&be(r,["moov","trak"]).forEach(n=>{const o=be(n,["mdia","minf","stbl","stsd"])[0].subarray(8);let u=be(o,["enca"]);const d=u.length>0;d||(u=be(o,["encv"])),u.forEach(f=>{const m=d?f.subarray(28):f.subarray(78);be(m,["sinf"]).forEach(v=>{const E=fx(v);if(E){const y=E.subarray(8,24);y.some(S=>S!==0)||(Me.log(`[eme] Patching keyId in 'enc${d?"a":"v"}>sinf>>tenc' box: ${Pi.hexDump(y)} -> ${Pi.hexDump(t)}`),E.set(t,8))}})})}),r}function fx(r){const e=be(r,["schm"])[0];if(e){const t=mt(e.subarray(4,8));if(t==="cbcs"||t==="cenc")return be(r,["schi","tenc"])[0]}return null}function qR(r,e){return be(e,["moof","traf"]).reduce((t,i)=>{const n=be(i,["tfdt"])[0],l=n[0],o=be(i,["tfhd"]).reduce((u,d)=>{const f=xe(d,4),m=r[f];if(m){let g=xe(n,4);if(l===1){if(g===zo)return Me.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),u;g*=zo+1,g+=xe(n,8)}const v=m.timescale||9e4,E=g/v;if(de(E)&&(u===null||E<u))return E}return u},null);return o!==null&&de(o)&&(t===null||o<t)?o:t},null)}function XR(r,e){let t=0,i=0,n=0;const l=be(r,["moof","traf"]);for(let o=0;o<l.length;o++){const u=l[o],d=be(u,["tfhd"])[0],f=xe(d,4),m=e[f];if(!m)continue;const g=m.default,v=xe(d,0)|(g==null?void 0:g.flags);let E=g==null?void 0:g.duration;v&8&&(v&2?E=xe(d,12):E=xe(d,8));const y=m.timescale||9e4,S=be(u,["trun"]);for(let T=0;T<S.length;T++){if(t=QR(S[T]),!t&&E){const R=xe(S[T],4);t=E*R}m.type===ze.VIDEO?i+=t/y:m.type===ze.AUDIO&&(n+=t/y)}}if(i===0&&n===0){let o=1/0,u=0,d=0;const f=be(r,["sidx"]);for(let m=0;m<f.length;m++){const g=zR(f[m]);if(g!=null&&g.references){o=Math.min(o,g.earliestPresentationTime/g.timescale);const v=g.references.reduce((E,y)=>E+y.info.duration||0,0);u=Math.max(u,v+g.earliestPresentationTime/g.timescale),d=u-o}}if(d&&de(d))return d}return i||n}function QR(r){const e=xe(r,0);let t=8;e&1&&(t+=4),e&4&&(t+=4);let i=0;const n=xe(r,4);for(let l=0;l<n;l++){if(e&256){const o=xe(r,t);i+=o,t+=4}e&512&&(t+=4),e&1024&&(t+=4),e&2048&&(t+=4)}return i}function WR(r,e,t){be(e,["moof","traf"]).forEach(i=>{be(i,["tfhd"]).forEach(n=>{const l=xe(n,4),o=r[l];if(!o)return;const u=o.timescale||9e4;be(i,["tfdt"]).forEach(d=>{const f=d[0],m=t*u;if(m){let g=xe(d,4);if(f===0)g-=m,g=Math.max(g,0),Bf(d,4,g);else{g*=Math.pow(2,32),g+=xe(d,8),g-=m,g=Math.max(g,0);const v=Math.floor(g/(zo+1)),E=Math.floor(g%(zo+1));Bf(d,4,v),Bf(d,8,E)}}})})})}function ZR(r){const e={valid:null,remainder:null},t=be(r,["moof"]);if(t.length<2)return e.remainder=r,e;const i=t[t.length-1];return e.valid=r.slice(0,i.byteOffset-8),e.remainder=r.slice(i.byteOffset-8),e}function hi(r,e){const t=new Uint8Array(r.length+e.length);return t.set(r),t.set(e,r.length),t}function Zp(r,e){const t=[],i=e.samples,n=e.timescale,l=e.id;let o=!1;return be(i,["moof"]).map(d=>{const f=d.byteOffset-8;be(d,["traf"]).map(g=>{const v=be(g,["tfdt"]).map(E=>{const y=E[0];let S=xe(E,4);return y===1&&(S*=Math.pow(2,32),S+=xe(E,8)),S/n})[0];return v!==void 0&&(r=v),be(g,["tfhd"]).map(E=>{const y=xe(E,4),S=xe(E,0)&16777215,T=(S&1)!==0,R=(S&2)!==0,D=(S&8)!==0;let _=0;const O=(S&16)!==0;let C=0;const B=(S&32)!==0;let N=8;y===l&&(T&&(N+=8),R&&(N+=4),D&&(_=xe(E,N),N+=4),O&&(C=xe(E,N),N+=4),B&&(N+=4),e.type==="video"&&(o=fc(e.codec)),be(g,["trun"]).map(F=>{const z=F[0],$=xe(F,0)&16777215,ae=($&1)!==0;let ce=0;const ve=($&4)!==0,he=($&256)!==0;let J=0;const P=($&512)!==0;let W=0;const se=($&1024)!==0,ee=($&2048)!==0;let w=0;const k=xe(F,4);let K=8;ae&&(ce=xe(F,K),K+=4),ve&&(K+=4);let G=ce+f;for(let oe=0;oe<k;oe++){if(he?(J=xe(F,K),K+=4):J=_,P?(W=xe(F,K),K+=4):W=C,se&&(K+=4),ee&&(z===0?w=xe(F,K):w=cx(F,K),K+=4),e.type===ze.VIDEO){let fe=0;for(;fe<W;){const ue=xe(i,G);if(G+=4,JR(o,i[G])){const ke=i.subarray(G,G+ue);Qd(ke,o?2:1,r+w/n,t)}G+=ue,fe+=ue+4}}r+=J/n}}))})})}),t}function fc(r){if(!r)return!1;const e=r.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function JR(r,e){if(r){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function Qd(r,e,t,i){const n=dx(r);let l=0;l+=e;let o=0,u=0,d=0;for(;l<n.length;){o=0;do{if(l>=n.length)break;d=n[l++],o+=d}while(d===255);u=0;do{if(l>=n.length)break;d=n[l++],u+=d}while(d===255);const f=n.length-l;let m=l;if(u<f)l+=u;else if(u>f){Me.error(`Malformed SEI payload. ${u} is too small, only ${f} bytes left to parse.`);break}if(o===4){if(n[m++]===181){const v=ox(n,m);if(m+=2,v===49){const E=xe(n,m);if(m+=4,E===1195456820){const y=n[m++];if(y===3){const S=n[m++],T=31&S,R=64&S,D=R?2+T*3:0,_=new Uint8Array(D);if(R){_[0]=S;for(let O=1;O<D;O++)_[O]=n[m++]}i.push({type:y,payloadType:o,pts:t,bytes:_})}}}}}else if(o===5&&u>16){const g=[];for(let y=0;y<16;y++){const S=n[m++].toString(16);g.push(S.length==1?"0"+S:S),(y===3||y===5||y===7||y===9)&&g.push("-")}const v=u-16,E=new Uint8Array(v);for(let y=0;y<v;y++)E[y]=n[m++];i.push({payloadType:o,pts:t,uuid:g.join(""),userData:ti(E),userDataBytes:E})}}}function dx(r){const e=r.byteLength,t=[];let i=1;for(;i<e-2;)r[i]===0&&r[i+1]===0&&r[i+2]===3?(t.push(i+2),i+=2):i++;if(t.length===0)return r;const n=e-t.length,l=new Uint8Array(n);let o=0;for(i=0;i<n;o++,i++)o===t[0]&&(o++,t.shift()),l[i]=r[o];return l}function eL(r){const e=r[0];let t="",i="",n=0,l=0,o=0,u=0,d=0,f=0;if(e===0){for(;mt(r.subarray(f,f+1))!=="\0";)t+=mt(r.subarray(f,f+1)),f+=1;for(t+=mt(r.subarray(f,f+1)),f+=1;mt(r.subarray(f,f+1))!=="\0";)i+=mt(r.subarray(f,f+1)),f+=1;i+=mt(r.subarray(f,f+1)),f+=1,n=xe(r,12),l=xe(r,16),u=xe(r,20),d=xe(r,24),f=28}else if(e===1){f+=4,n=xe(r,f),f+=4;const g=xe(r,f);f+=4;const v=xe(r,f);for(f+=4,o=2**32*g+v,wR(o)||(o=Number.MAX_SAFE_INTEGER,Me.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),u=xe(r,f),f+=4,d=xe(r,f),f+=4;mt(r.subarray(f,f+1))!=="\0";)t+=mt(r.subarray(f,f+1)),f+=1;for(t+=mt(r.subarray(f,f+1)),f+=1;mt(r.subarray(f,f+1))!=="\0";)i+=mt(r.subarray(f,f+1)),f+=1;i+=mt(r.subarray(f,f+1)),f+=1}const m=r.subarray(f,r.byteLength);return{schemeIdUri:t,value:i,timeScale:n,presentationTime:o,presentationTimeDelta:l,eventDuration:u,id:d,payload:m}}function tL(r,...e){const t=e.length;let i=8,n=t;for(;n--;)i+=e[n].byteLength;const l=new Uint8Array(i);for(l[0]=i>>24&255,l[1]=i>>16&255,l[2]=i>>8&255,l[3]=i&255,l.set(r,4),n=0,i=8;n<t;n++)l.set(e[n],i),i+=e[n].byteLength;return l}function iL(r,e,t){if(r.byteLength!==16)throw new RangeError("Invalid system id");let i,n;i=0,n=new Uint8Array;let l;i>0?(l=new Uint8Array(4),e.length>0&&new DataView(l.buffer).setUint32(0,e.length,!1)):l=new Uint8Array;const o=new Uint8Array(4);return t&&t.byteLength>0&&new DataView(o.buffer).setUint32(0,t.byteLength,!1),tL([112,115,115,104],new Uint8Array([i,0,0,0]),r,l,n,o,t||new Uint8Array)}function sL(r){const e=[];if(r instanceof ArrayBuffer){const t=r.byteLength;let i=0;for(;i+32<t;){const n=new DataView(r,i),l=nL(n);e.push(l),i+=l.size}}return e}function nL(r){const e=r.getUint32(0),t=r.byteOffset,i=r.byteLength;if(i<e)return{offset:t,size:i};if(r.getUint32(4)!==1886614376)return{offset:t,size:e};const l=r.getUint32(8)>>>24;if(l!==0&&l!==1)return{offset:t,size:e};const o=r.buffer,u=Pi.hexDump(new Uint8Array(o,t+12,16)),d=r.getUint32(28);let f=null,m=null;if(l===0){if(e-32<d||d<22)return{offset:t,size:e};m=new Uint8Array(o,t+32,d)}else if(l===1){if(!d||i<t+32+d*16+16)return{offset:t,size:e};f=[];for(let g=0;g<d;g++)f.push(new Uint8Array(o,t+32+g*16,16))}return{version:l,systemId:u,kids:f,data:m,offset:t,size:e}}const hx=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),pr={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function mx(r,e){const t=pr[e];return!!t&&!!t[r.slice(0,4)]}function Sd(r,e,t=!0){return!r.split(",").some(i=>!gx(i,e,t))}function gx(r,e,t=!0){var i;const n=Hs(t);return(i=n==null?void 0:n.isTypeSupported(ka(r,e)))!=null?i:!1}function ka(r,e){return`${e}/mp4;codecs=${r}`}function Jp(r){if(r){const e=r.substring(0,4);return pr.video[e]}return 2}function Ko(r){const e=hx();return r.split(",").reduce((t,i)=>{const l=e&&fc(i)?9:pr.video[i];return l?(l*2+t)/(t?3:2):(pr.audio[i]+t)/(t?2:1)},0)}const jf={};function rL(r,e=!0){if(jf[r])return jf[r];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[r];for(let n=0;n<t.length;n++){var i;if(gx(t[n],"audio",e))return jf[r]=t[n],t[n];if(t[n]==="mp3"&&(i=Hs(e))!=null&&i.isTypeSupported("audio/mpeg"))return""}return r}const aL=/flac|opus|mp4a\.40\.34/i;function Yo(r,e=!0){return r.replace(aL,t=>rL(t.toLowerCase(),e))}function lL(r,e){const t=[];if(r){const i=r.split(",");for(let n=0;n<i.length;n++)mx(i[n],"video")||t.push(i[n])}return e&&t.push(e),t.join(",")}function Io(r,e){if(r&&(r.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(r)!==-1))return r;if(e){const t=e.split(",");if(t.length>1){if(r){for(let i=t.length;i--;)if(t[i].substring(0,4)===r.substring(0,4))return t[i]}return t[0]}}return e||r}function oL(r){const e=r.split(",");for(let t=0;t<e.length;t++){const i=e[t].split(".");if(i.length>2){let n=i.shift()+".";n+=parseInt(i.shift()).toString(16),n+=("000"+parseInt(i.shift()).toString(16)).slice(-4),e[t]=n}}return e.join(",")}function cL(r){if(r.startsWith("av01.")){const e=r.split("."),t=["0","111","01","01","01","0"];for(let i=e.length;i>4&&i<10;i++)e[i]=t[i-4];return e.join(".")}return r}function ey(r){const e=Hs(r)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function px(r){return r.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const yx={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]};function vx(r,e){return{supported:!1,configurations:e,decodingInfoResults:[{supported:!1,smooth:!1,powerEfficient:!1}],error:r}}const ty={};function uL(r,e,t,i,n,l){const o=r.audioCodec?r.audioGroups:null,u=l==null?void 0:l.audioCodec,d=l==null?void 0:l.channels,f=d?parseInt(d):u?1/0:2;let m=null;if(o!=null&&o.length)try{o.length===1&&o[0]?m=e.groups[o[0]].channels:m=o.reduce((g,v)=>{if(v){const E=e.groups[v];if(!E)throw new Error(`Audio track group ${v} not found`);Object.keys(E.channels).forEach(y=>{g[y]=(g[y]||0)+E.channels[y]})}return g},{2:0})}catch{return!0}return r.videoCodec!==void 0&&(r.width>1920&&r.height>1088||r.height>1920&&r.width>1088||r.frameRate>Math.max(i,30)||r.videoRange!=="SDR"&&r.videoRange!==t||r.bitrate>Math.max(n,8e6))||!!m&&de(f)&&Object.keys(m).some(g=>parseInt(g)>f)}function xx(r,e,t){const i=r.videoCodec,n=r.audioCodec;if(!i&&!n||!t)return Promise.resolve(yx);const l=[];if(i){const o={width:r.width,height:r.height,bitrate:Math.ceil(Math.max(r.bitrate*.9,r.averageBitrate)),framerate:r.frameRate||30},u=r.videoRange;u!=="SDR"&&(o.transferFunction=u.toLowerCase());const d=i.split(","),f=navigator.userAgent;if(d.some(m=>fc(m))&&hx())return Promise.resolve(vx(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent sting: (${f})`),l));l.push.apply(l,d.map(m=>({type:"media-source",video:$e($e({},o),{},{contentType:ka(cL(m),"video")})})))}return n&&r.audioGroups&&r.audioGroups.forEach(o=>{var u;o&&((u=e.groups[o])==null||u.tracks.forEach(d=>{if(d.groupId===o){const f=d.channels||"",m=parseFloat(f);de(m)&&m>2&&l.push.apply(l,n.split(",").map(g=>({type:"media-source",audio:{contentType:ka(g,"audio"),channels:""+m}})))}}))}),Promise.all(l.map(o=>{const u=fL(o);return ty[u]||(ty[u]=t.decodingInfo(o))})).then(o=>({supported:!o.some(u=>!u.supported),configurations:l,decodingInfoResults:o})).catch(o=>({supported:!1,configurations:l,decodingInfoResults:[],error:o}))}function fL(r){const{audio:e,video:t}=r,i=t||e;if(i){const n=px(i.contentType);if(t)return`r${t.height}x${t.width}f${Math.ceil(t.framerate)}${t.transferFunction||"sd"}_${n}_${Math.ceil(t.bitrate/1e5)}`;if(e)return`c${e.channels}${e.spatialRendering?"s":"n"}_${n}`}return""}const Td=["NONE","TYPE-0","TYPE-1",null];function dL(r){return Td.indexOf(r)>-1}const qo=["SDR","PQ","HLG"];function hL(r){return!!r&&qo.indexOf(r)>-1}var Co={No:"",Yes:"YES",v2:"v2"};function iy(r){const{canSkipUntil:e,canSkipDateRanges:t,age:i}=r,n=i<e/2;return e&&n?t?Co.v2:Co.Yes:Co.No}class sy{constructor(e,t,i){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=i}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class Ma{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(i=>!!i).map(i=>i.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const i=(t=e.supplemental)==null?void 0:t.videoCodec;i&&i!==e.videoCodec&&(this.codecSet+=`,${i.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return ny(this._audioGroups,e)}hasSubtitleGroup(e){return ny(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let i=this._audioGroups;i||(i=this._audioGroups=[]),i.indexOf(t)===-1&&i.push(t)}else if(e==="text"){let i=this._subtitleGroups;i||(i=this._subtitleGroups=[]),i.indexOf(t)===-1&&i.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function ny(r,e){return!e||!r?!1:r.indexOf(e)!==-1}function mL(){if(typeof matchMedia=="function"){const r=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(r.media!==e.media)return r.matches===!0}return!1}function gL(r,e){let t=!1,i=[];if(r&&(t=r!=="SDR",i=[r]),e){i=e.allowedVideoRanges||qo.slice(0);const n=i.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:n&&mL(),t||(i=["SDR"])}return{preferHDR:t,allowedVideoRanges:i}}const pL=r=>{const e=new WeakSet;return(t,i)=>{if(r&&(i=r(t,i)),typeof i=="object"&&i!==null){if(e.has(i))return;e.add(i)}return i}},et=(r,e)=>JSON.stringify(r,pL(e));function yL(r,e,t,i,n){const l=Object.keys(r),o=i==null?void 0:i.channels,u=i==null?void 0:i.audioCodec,d=n==null?void 0:n.videoCodec,f=o&&parseInt(o)===2;let m=!1,g=!1,v=1/0,E=1/0,y=1/0,S=1/0,T=0,R=[];const{preferHDR:D,allowedVideoRanges:_}=gL(e,n);for(let F=l.length;F--;){const z=r[l[F]];m||(m=z.channels[2]>0),v=Math.min(v,z.minHeight),E=Math.min(E,z.minFramerate),y=Math.min(y,z.minBitrate),_.filter(ae=>z.videoRanges[ae]>0).length>0&&(g=!0)}v=de(v)?v:0,E=de(E)?E:0;const O=Math.max(1080,v),C=Math.max(30,E);y=de(y)?y:t,t=Math.max(y,t),g||(e=void 0);const B=l.length>1;return{codecSet:l.reduce((F,z)=>{const $=r[z];if(z===F)return F;if(R=g?_.filter(ae=>$.videoRanges[ae]>0):[],B){if($.minBitrate>t)return Ni(z,`min bitrate of ${$.minBitrate} > current estimate of ${t}`),F;if(!$.hasDefaultAudio)return Ni(z,"no renditions with default or auto-select sound found"),F;if(u&&z.indexOf(u.substring(0,4))%5!==0)return Ni(z,`audio codec preference "${u}" not found`),F;if(o&&!f){if(!$.channels[o])return Ni(z,`no renditions with ${o} channel sound found (channels options: ${Object.keys($.channels)})`),F}else if((!u||f)&&m&&$.channels[2]===0)return Ni(z,"no renditions with stereo sound found"),F;if($.minHeight>O)return Ni(z,`min resolution of ${$.minHeight} > maximum of ${O}`),F;if($.minFramerate>C)return Ni(z,`min framerate of ${$.minFramerate} > maximum of ${C}`),F;if(!R.some(ae=>$.videoRanges[ae]>0))return Ni(z,`no variants with VIDEO-RANGE of ${et(R)} found`),F;if(d&&z.indexOf(d.substring(0,4))%5!==0)return Ni(z,`video codec preference "${d}" not found`),F;if($.maxScore<T)return Ni(z,`max score of ${$.maxScore} < selected max of ${T}`),F}return F&&(Ko(z)>=Ko(F)||$.fragmentError>r[F].fragmentError)?F:(S=$.minIndex,T=$.maxScore,z)},void 0),videoRanges:R,preferHDR:D,minFramerate:E,minBitrate:y,minIndex:S}}function Ni(r,e){Me.log(`[abr] start candidates with "${r}" ignored because ${e}`)}function Ex(r){return r.reduce((e,t)=>{let i=e.groups[t.groupId];i||(i=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),i.tracks.push(t);const n=t.channels||"2";return i.channels[n]=(i.channels[n]||0)+1,i.hasDefault=i.hasDefault||t.default,i.hasAutoSelect=i.hasAutoSelect||t.autoselect,i.hasDefault&&(e.hasDefaultAudio=!0),i.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function vL(r,e,t,i){return r.slice(t,i+1).reduce((n,l,o)=>{if(!l.codecSet)return n;const u=l.audioGroups;let d=n[l.codecSet];d||(n[l.codecSet]=d={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:o,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!u,fragmentError:0}),d.minBitrate=Math.min(d.minBitrate,l.bitrate);const f=Math.min(l.height,l.width);return d.minHeight=Math.min(d.minHeight,f),d.minFramerate=Math.min(d.minFramerate,l.frameRate),d.minIndex=Math.min(d.minIndex,o),d.maxScore=Math.max(d.maxScore,l.score),d.fragmentError+=l.fragmentError,d.videoRanges[l.videoRange]=(d.videoRanges[l.videoRange]||0)+1,u&&u.forEach(m=>{if(!m)return;const g=e.groups[m];g&&(d.hasDefaultAudio=d.hasDefaultAudio||e.hasDefaultAudio?g.hasDefault:g.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(g.channels).forEach(v=>{d.channels[v]=(d.channels[v]||0)+g.channels[v]}))}),n},{})}function ry(r){if(!r)return r;const{lang:e,assocLang:t,characteristics:i,channels:n,audioCodec:l}=r;return{lang:e,assocLang:t,characteristics:i,channels:n,audioCodec:l}}function Bi(r,e,t){if("attrs"in r){const i=e.indexOf(r);if(i!==-1)return i}for(let i=0;i<e.length;i++){const n=e[i];if(vn(r,n,t))return i}return-1}function vn(r,e,t){const{groupId:i,name:n,lang:l,assocLang:o,default:u}=r,d=r.forced;return(i===void 0||e.groupId===i)&&(n===void 0||e.name===n)&&(l===void 0||xL(l,e.lang))&&(l===void 0||e.assocLang===o)&&(u===void 0||e.default===u)&&(d===void 0||e.forced===d)&&(!("characteristics"in r)||EL(r.characteristics||"",e.characteristics))&&(t===void 0||t(r,e))}function xL(r,e="--"){return r.length===e.length?r===e:r.startsWith(e)||e.startsWith(r)}function EL(r,e=""){const t=r.split(","),i=e.split(",");return t.length===i.length&&!t.some(n=>i.indexOf(n)===-1)}function gn(r,e){const{audioCodec:t,channels:i}=r;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(i===void 0||i===(e.channels||"2"))}function SL(r,e,t,i,n){const l=e[i],u=e.reduce((v,E,y)=>{const S=E.uri;return(v[S]||(v[S]=[])).push(y),v},{})[l.uri];u.length>1&&(i=Math.max.apply(Math,u));const d=l.videoRange,f=l.frameRate,m=l.codecSet.substring(0,4),g=ay(e,i,v=>{if(v.videoRange!==d||v.frameRate!==f||v.codecSet.substring(0,4)!==m)return!1;const E=v.audioGroups,y=t.filter(S=>!E||E.indexOf(S.groupId)!==-1);return Bi(r,y,n)>-1});return g>-1?g:ay(e,i,v=>{const E=v.audioGroups,y=t.filter(S=>!E||E.indexOf(S.groupId)!==-1);return Bi(r,y,n)>-1})}function ay(r,e,t){for(let i=e;i>-1;i--)if(t(r[i]))return i;for(let i=e+1;i<r.length;i++)if(t(r[i]))return i;return-1}function Xo(r,e){var t;return!!r&&r!==((t=e.loadLevelObj)==null?void 0:t.uri)}class TL extends ms{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var i;const{fragCurrent:n,partCurrent:l,hls:o}=this,{autoLevelEnabled:u,media:d}=o;if(!n||!d)return;const f=performance.now(),m=l?l.stats:n.stats,g=l?l.duration:n.duration,v=f-m.loading.start,E=o.minAutoLevel,y=n.level,S=this._nextAutoLevel;if(m.aborted||m.loaded&&m.loaded===m.total||y<=E){this.clearTimer(),this._nextAutoLevel=-1;return}if(!u)return;const T=S>-1&&S!==y,R=!!t||T;if(!R&&(d.paused||!d.playbackRate||!d.readyState))return;const D=o.mainForwardBufferInfo;if(!R&&D===null)return;const _=this.bwEstimator.getEstimateTTFB(),O=Math.abs(d.playbackRate);if(v<=Math.max(_,1e3*(g/(O*2))))return;const C=D?D.len/O:0,B=m.loading.first?m.loading.first-m.loading.start:-1,N=m.loaded&&B>-1,F=this.getBwEstimate(),z=o.levels,$=z[y],ae=Math.max(m.loaded,Math.round(g*(n.bitrate||$.averageBitrate)/8));let ce=N?v-B:v;ce<1&&N&&(ce=Math.min(v,m.loaded*8/F));const ve=N?m.loaded*1e3/ce:0,he=_/1e3,J=ve?(ae-m.loaded)/ve:ae*8/F+he;if(J<=C)return;const P=ve?ve*8:F,W=((i=(t==null?void 0:t.details)||this.hls.latestLevelDetails)==null?void 0:i.live)===!0,se=this.hls.config.abrBandWidthUpFactor;let ee=Number.POSITIVE_INFINITY,w;for(w=y-1;w>E;w--){const oe=z[w].maxBitrate,fe=!z[w].details||W;if(ee=this.getTimeToLoadFrag(he,P,g*oe,fe),ee<Math.min(C,g+he))break}if(ee>=J||ee>g*10)return;N?this.bwEstimator.sample(v-Math.min(_,B),m.loaded):this.bwEstimator.sampleTTFB(v);const k=z[w].maxBitrate;this.getBwEstimate()*se>k&&this.resetEstimator(k);const K=this.findBestLevel(k,E,w,0,C,1,1);K>-1&&(w=K),this.warn(`Fragment ${n.sn}${l?" part "+l.index:""} of level ${y} is loading too slowly;
      Fragment duration: ${n.duration.toFixed(3)}
      Time to underbuffer: ${C.toFixed(3)} s
      Estimated load time for current fragment: ${J.toFixed(3)} s
      Estimated load time for down switch fragment: ${ee.toFixed(3)} s
      TTFB estimate: ${B|0} ms
      Current BW estimate: ${de(F)?F|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${w} @ ${k|0} bps`),o.nextLoadLevel=o.nextAutoLevel=w,this.clearTimer();const G=()=>{if(this.clearTimer(),this.fragCurrent===n&&this.hls.loadLevel===w&&w>0){const oe=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${w>0?"and switching down":""}
      Fragment duration: ${n.duration.toFixed(3)} s
      Time to underbuffer: ${oe.toFixed(3)} s`),n.abortRequests(),this.fragCurrent=this.partCurrent=null,w>E){let fe=this.findBestLevel(this.hls.levels[E].bitrate,E,w,0,oe,1,1);fe===-1&&(fe=E),this.hls.nextLoadLevel=this.hls.nextAutoLevel=fe,this.resetEstimator(this.hls.levels[fe].bitrate)}}};T||J>ee*2?G():this.timer=self.setInterval(G,ee*1e3),o.trigger(A.FRAG_LOAD_EMERGENCY_ABORTED,{frag:n,part:l,stats:m})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new CR(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.FRAG_LOADING,this.onFragLoading,this),e.on(A.FRAG_LOADED,this.onFragLoaded,this),e.on(A.FRAG_BUFFERED,this.onFragBuffered,this),e.on(A.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(A.LEVEL_LOADED,this.onLevelLoaded,this),e.on(A.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(A.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(A.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.FRAG_LOADING,this.onFragLoading,this),e.off(A.FRAG_LOADED,this.onFragLoaded,this),e.off(A.FRAG_BUFFERED,this.onFragBuffered,this),e.off(A.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(A.LEVEL_LOADED,this.onLevelLoaded,this),e.off(A.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(A.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(A.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const i=t.frag;if(!this.ignoreFragment(i)){if(!i.bitrateTest){var n;this.fragCurrent=i,this.partCurrent=(n=t.part)!=null?n:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case q.BUFFER_ADD_CODEC_ERROR:case q.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case q.FRAG_LOAD_TIMEOUT:{const i=t.frag,{fragCurrent:n,partCurrent:l}=this;if(i&&n&&i.sn===n.sn&&i.level===n.level){const o=performance.now(),u=l?l.stats:i.stats,d=o-u.loading.start,f=u.loading.first?u.loading.first-u.loading.start:-1;if(u.loaded&&f>-1){const g=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(d-Math.min(g,f),u.loaded)}else this.bwEstimator.sampleTTFB(d)}break}}}getTimeToLoadFrag(e,t,i,n){const l=e+i/t,o=n?e+this.lastLevelLoadSec:0;return l+o}onLevelLoaded(e,t){const i=this.hls.config,{loading:n}=t.stats,l=n.end-n.first;de(l)&&(this.lastLevelLoadSec=l/1e3),t.details.live?this.bwEstimator.update(i.abrEwmaSlowLive,i.abrEwmaFastLive):this.bwEstimator.update(i.abrEwmaSlowVoD,i.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:i}){const n=i?i.stats:t.stats;if(t.type===ge.MAIN&&this.bwEstimator.sampleTTFB(n.loading.first-n.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const l=i?i.duration:t.duration,o=this.hls.levels[t.level],u=(o.loaded?o.loaded.bytes:0)+n.loaded,d=(o.loaded?o.loaded.duration:0)+l;o.loaded={bytes:u,duration:d},o.realBitrate=Math.round(8*u/d)}if(t.bitrateTest){const l={stats:n,frag:t,part:i,id:t.type};this.onFragBuffered(A.FRAG_BUFFERED,l),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:i,part:n}=t,l=n!=null&&n.stats.loaded?n.stats:i.stats;if(l.aborted||this.ignoreFragment(i))return;const o=l.parsing.end-l.loading.start-Math.min(l.loading.first-l.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(o,l.loaded),l.bwEstimate=this.getBwEstimate(),i.bitrateTest?this.bitrateTestDelay=o/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==ge.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,i=this.getBwEstimate(),n=this.hls.config.maxStarvationDelay,l=this.findBestLevel(i,t,e,0,n,1,1);if(l>-1)return l;const o=this.hls.firstLevel,u=Math.min(Math.max(o,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${o} clamped to ${u}`),u}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,i=this.bwEstimator.canEstimate(),n=this.lastLoadedFragLevel>-1;if(e!==-1&&(!i||!n||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const l=i&&n?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const o=this.hls.levels;if(o.length>Math.max(e,l)&&o[e].loadError<=o[l].loadError)return e}return this._nextAutoLevel=l,this.nextAutoLevelKey=this.getAutoLevelKey(),l}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:i}=this;if(i.levels.length<=1)return i.loadLevel;const{maxAutoLevel:n,config:l,minAutoLevel:o}=i,u=t?t.duration:e?e.duration:0,d=this.getBwEstimate(),f=this.getStarvationDelay();let m=l.abrBandWidthFactor,g=l.abrBandWidthUpFactor;if(f){const T=this.findBestLevel(d,o,n,f,0,m,g);if(T>=0)return this.rebufferNotice=-1,T}let v=u?Math.min(u,l.maxStarvationDelay):l.maxStarvationDelay;if(!f){const T=this.bitrateTestDelay;T&&(v=(u?Math.min(u,l.maxLoadingDelay):l.maxLoadingDelay)-T,this.info(`bitrate test took ${Math.round(1e3*T)}ms, set first fragment max fetchDuration to ${Math.round(1e3*v)} ms`),m=g=1)}const E=this.findBestLevel(d,o,n,f,v,m,g);if(this.rebufferNotice!==E&&(this.rebufferNotice=E,this.info(`${f?"rebuffering expected":"buffer is empty"}, optimal quality level ${E}`)),E>-1)return E;const y=i.levels[o],S=i.loadLevelObj;return S&&(y==null?void 0:y.bitrate)<S.bitrate?o:i.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const i=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,n=e.mainForwardBufferInfo;return(n?n.len:0)/i}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,i,n,l,o,u){var d;const f=n+l,m=this.lastLoadedFragLevel,g=m===-1?this.hls.firstLevel:m,{fragCurrent:v,partCurrent:E}=this,{levels:y,allAudioTracks:S,loadLevel:T,config:R}=this.hls;if(y.length===1)return 0;const D=y[g],_=!!((d=this.hls.latestLevelDetails)!=null&&d.live),O=T===-1||m===-1;let C,B="SDR",N=(D==null?void 0:D.frameRate)||0;const{audioPreference:F,videoPreference:z}=R,$=this.audioTracksByGroup||(this.audioTracksByGroup=Ex(S));let ae=-1;if(O){if(this.firstSelection!==-1)return this.firstSelection;const P=this.codecTiers||(this.codecTiers=vL(y,$,t,i)),W=yL(P,B,e,F,z),{codecSet:se,videoRanges:ee,minFramerate:w,minBitrate:k,minIndex:K,preferHDR:G}=W;ae=K,C=se,B=G?ee[ee.length-1]:ee[0],N=w,e=Math.max(e,k),this.log(`picked start tier ${et(W)}`)}else C=D==null?void 0:D.codecSet,B=D==null?void 0:D.videoRange;const ce=E?E.duration:v?v.duration:0,ve=this.bwEstimator.getEstimateTTFB()/1e3,he=[];for(let P=i;P>=t;P--){var J;const W=y[P],se=P>g;if(!W)continue;if(R.useMediaCapabilities&&!W.supportedResult&&!W.supportedPromise){const fe=navigator.mediaCapabilities;typeof(fe==null?void 0:fe.decodingInfo)=="function"&&(uL(W,$,B,N,e,F)||fc(W.videoCodec))?(W.supportedPromise=xx(W,$,fe),W.supportedPromise.then(ue=>{if(!this.hls)return;W.supportedResult=ue;const ke=this.hls.levels,Le=ke.indexOf(W);ue.error?this.warn(`MediaCapabilities decodingInfo error: "${ue.error}" for level ${Le} ${et(ue)}`):ue.supported||(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${Le} ${et(ue)}`),Le>-1&&ke.length>1&&(this.log(`Removing unsupported level ${Le}`),this.hls.removeLevel(Le),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))})):W.supportedResult=yx}if((C&&W.codecSet!==C||B&&W.videoRange!==B||se&&N>W.frameRate||!se&&N>0&&N<W.frameRate||W.supportedResult&&!((J=W.supportedResult.decodingInfoResults)!=null&&J[0].smooth))&&(!O||P!==ae)){he.push(P);continue}const ee=W.details,w=(E?ee==null?void 0:ee.partTarget:ee==null?void 0:ee.averagetargetduration)||ce;let k;se?k=u*e:k=o*e;const K=ce&&n>=ce*2&&l===0?W.averageBitrate:W.maxBitrate,G=this.getTimeToLoadFrag(ve,k,K*w,ee===void 0);if(k>=K&&(P===m||W.loadError===0&&W.fragmentError===0)&&(G<=ve||!de(G)||_&&!this.bitrateTestDelay||G<f)){const fe=this.forcedAutoLevel;return P!==T&&(fe===-1||fe!==T)&&(he.length&&this.trace(`Skipped level(s) ${he.join(",")} of ${i} max with CODECS and VIDEO-RANGE:"${y[he[0]].codecs}" ${y[he[0]].videoRange}; not compatible with "${C}" ${B}`),this.info(`switch candidate:${g}->${P} adjustedbw(${Math.round(k)})-bitrate=${Math.round(k-K)} ttfb:${ve.toFixed(1)} avgDuration:${w.toFixed(1)} maxFetchDuration:${f.toFixed(1)} fetchDuration:${G.toFixed(1)} firstSelection:${O} codecSet:${W.codecSet} videoRange:${W.videoRange} hls.loadLevel:${T}`)),O&&(this.firstSelection=P),P}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:i}=this.hls;return Math.min(Math.max(e,i),t)}}const Wd={search:function(r,e){let t=0,i=r.length-1,n=null,l=null;for(;t<=i;){n=(t+i)/2|0,l=r[n];const o=e(l);if(o>0)t=n+1;else if(o<0)i=n-1;else return l}return null}};function bL(r,e,t){if(e===null||!Array.isArray(r)||!r.length||!de(e))return null;const i=r[0].programDateTime;if(e<(i||0))return null;const n=r[r.length-1].endProgramDateTime;if(e>=(n||0))return null;t=t||0;for(let l=0;l<r.length;++l){const o=r[l];if(RL(e,t,o))return o}return null}function En(r,e,t=0,i=0,n=.005){let l=null;if(r){l=e[1+r.sn-e[0].sn]||null;const u=r.endDTS-t;u>0&&u<15e-7&&(t+=15e-7),l&&r.level!==l.level&&l.end<=r.end&&(l=e[2+r.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(l=e[0]);if(l&&((!r||r.level===l.level)&&ly(t,i,l)===0||AL(l,r,Math.min(n,i))))return l;const o=Wd.search(e,ly.bind(null,t,i));return o&&(o!==r||!l)?o:l}function AL(r,e,t){if(e&&e.start===0&&e.level<r.level&&(e.endPTS||0)>0){const i=e.tagList.reduce((n,l)=>(l[0]==="INF"&&(n+=parseFloat(l[1])),n),t);return r.start<=i}return!1}function ly(r=0,e=0,t){if(t.start<=r&&t.start+t.duration>r)return 0;const i=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-i<=r?1:t.start-i>r&&t.start?-1:0}function RL(r,e,t){const i=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-i>r}function Sx(r,e){return Wd.search(r,t=>t.cc<e?1:t.cc>e?-1:0)}function LL(r,e,t){if(r&&r.startCC<=e&&r.endCC>=e){const i=t.start,n=t.end;let l=r.fragments;if(!t.relurl){const{fragmentHint:o}=r;o&&(l=l.concat(o))}return Wd.search(l,o=>o.cc<e||o.end<=i?1:o.cc>e||o.start>=n?-1:0)}return null}function Qo(r){switch(r.details){case q.FRAG_LOAD_TIMEOUT:case q.KEY_LOAD_TIMEOUT:case q.LEVEL_LOAD_TIMEOUT:case q.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function oy(r,e){const t=Qo(e);return r.default[`${t?"timeout":"error"}Retry`]}function Zd(r,e){const t=r.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*r.retryDelayMs,r.maxRetryDelayMs)}function cy(r){return $e($e({},r),{errorRetry:null,timeoutRetry:null})}function Wo(r,e,t,i){if(!r)return!1;const n=i==null?void 0:i.code,l=e<r.maxNumRetry&&(_L(n)||!!t);return r.shouldRetry?r.shouldRetry(r,e,t,i,l):l}function _L(r){return r===0&&navigator.onLine===!1||!!r&&(r<400||r>499)}var It={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},Ei={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2};class DL extends ms{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(A.ERROR,this.onError,this),e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(A.ERROR,this.onError,this),e.off(A.ERROR,this.onErrorOut,this),e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(e==null?void 0:e.type)===ge.MAIN?e.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(e,t){var i;if(t.fatal)return;const n=this.hls,l=t.context;switch(t.details){case q.FRAG_LOAD_ERROR:case q.FRAG_LOAD_TIMEOUT:case q.KEY_LOAD_ERROR:case q.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case q.FRAG_PARSING_ERROR:if((i=t.frag)!=null&&i.gap){t.errorAction=Pa();return}case q.FRAG_GAP:case q.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=It.SendAlternateToPenaltyBox;return}case q.LEVEL_EMPTY_ERROR:case q.LEVEL_PARSING_ERROR:{var o,u;const f=t.parent===ge.MAIN?t.level:n.loadLevel;t.details===q.LEVEL_EMPTY_ERROR&&((o=t.context)!=null&&(u=o.levelDetails)!=null&&u.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,f):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,f))}return;case q.LEVEL_LOAD_ERROR:case q.LEVEL_LOAD_TIMEOUT:typeof(l==null?void 0:l.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,l.level));return;case q.AUDIO_TRACK_LOAD_ERROR:case q.AUDIO_TRACK_LOAD_TIMEOUT:case q.SUBTITLE_LOAD_ERROR:case q.SUBTITLE_TRACK_LOAD_TIMEOUT:if(l){const f=n.loadLevelObj;if(f&&(l.type===Ce.AUDIO_TRACK&&f.hasAudioGroup(l.groupId)||l.type===Ce.SUBTITLE_TRACK&&f.hasSubtitleGroup(l.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,n.loadLevel),t.errorAction.action=It.SendAlternateToPenaltyBox,t.errorAction.flags=Ei.MoveAllAlternatesMatchingHost;return}}return;case q.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const f=n.loadLevelObj,m=f==null?void 0:f.attrs["HDCP-LEVEL"];m?t.errorAction={action:It.SendAlternateToPenaltyBox,flags:Ei.MoveAllAlternatesMatchingHDCP,hdcpLevel:m}:this.keySystemError(t)}return;case q.BUFFER_ADD_CODEC_ERROR:case q.REMUX_ALLOC_ERROR:case q.BUFFER_APPEND_ERROR:if(!t.errorAction){var d;t.errorAction=this.getLevelSwitchAction(t,(d=t.level)!=null?d:n.loadLevel)}return;case q.INTERNAL_EXCEPTION:case q.BUFFER_APPENDING_ERROR:case q.BUFFER_FULL_ERROR:case q.LEVEL_SWITCH_ERROR:case q.BUFFER_STALLED_ERROR:case q.BUFFER_SEEK_OVER_HOLE:case q.BUFFER_NUDGE_ON_STALL:t.errorAction=Pa();return}t.type===pe.KEY_SYSTEM_ERROR&&this.keySystemError(t)}keySystemError(e){const t=this.getVariantLevelIndex(e.frag);e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,t)}getPlaylistRetryOrSwitchAction(e,t){const i=this.hls,n=oy(i.config.playlistLoadPolicy,e),l=this.playlistError++;if(Wo(n,l,Qo(e),e.response))return{action:It.RetryRequest,flags:Ei.None,retryConfig:n,retryCount:l};const u=this.getLevelSwitchAction(e,t);return n&&(u.retryConfig=n,u.retryCount=l),u}getFragRetryOrSwitchAction(e){const t=this.hls,i=this.getVariantLevelIndex(e.frag),n=t.levels[i],{fragLoadPolicy:l,keyLoadPolicy:o}=t.config,u=oy(e.details.startsWith("key")?o:l,e),d=t.levels.reduce((m,g)=>m+g.fragmentError,0);if(n&&(e.details!==q.FRAG_GAP&&n.fragmentError++,Wo(u,d,Qo(e),e.response)))return{action:It.RetryRequest,flags:Ei.None,retryConfig:u,retryCount:d};const f=this.getLevelSwitchAction(e,i);return u&&(f.retryConfig=u,f.retryCount=d),f}getLevelSwitchAction(e,t){const i=this.hls;t==null&&(t=i.loadLevel);const n=this.hls.levels[t];if(n){var l,o;const f=e.details;n.loadError++,f===q.BUFFER_APPEND_ERROR&&n.fragmentError++;let m=-1;const{levels:g,loadLevel:v,minAutoLevel:E,maxAutoLevel:y}=i;i.autoLevelEnabled||(i.loadLevel=-1);const S=(l=e.frag)==null?void 0:l.type,R=(S===ge.AUDIO&&f===q.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(f===q.BUFFER_ADD_CODEC_ERROR||f===q.BUFFER_APPEND_ERROR))&&g.some(({audioCodec:B})=>n.audioCodec!==B),_=e.sourceBufferName==="video"&&(f===q.BUFFER_ADD_CODEC_ERROR||f===q.BUFFER_APPEND_ERROR)&&g.some(({codecSet:B,audioCodec:N})=>n.codecSet!==B&&n.audioCodec===N),{type:O,groupId:C}=(o=e.context)!=null?o:{};for(let B=g.length;B--;){const N=(B+v)%g.length;if(N!==v&&N>=E&&N<=y&&g[N].loadError===0){var u,d;const F=g[N];if(f===q.FRAG_GAP&&S===ge.MAIN&&e.frag){const z=g[N].details;if(z){const $=En(e.frag,z.fragments,e.frag.start);if($!=null&&$.gap)continue}}else{if(O===Ce.AUDIO_TRACK&&F.hasAudioGroup(C)||O===Ce.SUBTITLE_TRACK&&F.hasSubtitleGroup(C))continue;if(S===ge.AUDIO&&(u=n.audioGroups)!=null&&u.some(z=>F.hasAudioGroup(z))||S===ge.SUBTITLE&&(d=n.subtitleGroups)!=null&&d.some(z=>F.hasSubtitleGroup(z))||R&&n.audioCodec===F.audioCodec||!R&&n.audioCodec!==F.audioCodec||_&&n.codecSet===F.codecSet)continue}m=N;break}}if(m>-1&&i.loadLevel!==m)return e.levelRetry=!0,this.playlistError=0,{action:It.SendAlternateToPenaltyBox,flags:Ei.None,nextAutoLevel:m}}return{action:It.SendAlternateToPenaltyBox,flags:Ei.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var i;switch((i=t.errorAction)==null?void 0:i.action){case It.DoNothing:break;case It.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==q.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,i=e.errorAction;if(!i)return;const{flags:n,hdcpLevel:l,nextAutoLevel:o}=i;switch(n){case Ei.None:this.switchLevel(e,o);break;case Ei.MoveAllAlternatesMatchingHDCP:l&&(t.maxHdcpLevel=Td[Td.indexOf(l)-1],i.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}i.resolved||this.switchLevel(e,o)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===q.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const i=px(e.mimeType),n=this.hls.levels;for(let l=n.length;l--;)n[l][`${e.sourceBufferName}Codec`]===i&&this.hls.removeLevel(l)}}}function Pa(r){const e={action:It.DoNothing,flags:Ei.None};return r&&(e.resolved=!0),e}var gt={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class wL{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.BUFFER_APPENDED,this.onBufferAppended,this),e.on(A.FRAG_BUFFERED,this.onFragBuffered,this),e.on(A.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:e}=this;e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.BUFFER_APPENDED,this.onBufferAppended,this),e.off(A.FRAG_BUFFERED,this.onFragBuffered,this),e.off(A.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const i=this.activePartLists[t];if(i)for(let n=i.length;n--;){const l=i[n];if(!l)break;const o=l.end;if(l.start<=e&&o!==null&&e<=o)return l}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,i){const{fragments:n}=this,l=Object.keys(n);for(let o=l.length;o--;){const u=n[l[o]];if((u==null?void 0:u.body.type)===t&&(!i||u.buffered)){const d=u.body;if(d.start<=e&&e<=d.end)return d}}return null}detectEvictedFragments(e,t,i,n,l){this.timeRanges&&(this.timeRanges[e]=t);const o=(n==null?void 0:n.fragment.sn)||-1;Object.keys(this.fragments).forEach(u=>{const d=this.fragments[u];if(!d||o>=d.body.sn)return;if(!d.buffered&&(!d.loaded||l)){d.body.type===i&&this.removeFragment(d.body);return}const f=d.range[e];if(f){if(f.time.length===0){this.removeFragment(d.body);return}f.time.some(m=>{const g=!this.isTimeBuffered(m.startPTS,m.endPTS,t);return g&&this.removeFragment(d.body),g})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const i=e.frag,n=cr(i),l=this.fragments[n];if(!l||l.buffered&&i.gap)return;const o=!i.relurl;Object.keys(t).forEach(u=>{const d=i.elementaryStreams[u];if(!d)return;const f=t[u],m=o||d.partial===!0;l.range[u]=this.getBufferedTimes(i,e.part,m,f)}),l.loaded=null,Object.keys(l.range).length?(l.buffered=!0,(l.body.endList=i.endList||l.body.endList)&&(this.endListFragments[l.body.type]=l),fo(l)||this.removeParts(i.sn-1,i.type)):this.removeFragment(l.body)}removeParts(e,t){const i=this.activePartLists[t];i&&(this.activePartLists[t]=uy(i,n=>n.fragment.sn>=e))}fragBuffered(e,t){const i=cr(e);let n=this.fragments[i];!n&&t&&(n=this.fragments[i]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),n&&(n.loaded=null,n.buffered=!0)}getBufferedTimes(e,t,i,n){const l={time:[],partial:i},o=e.start,u=e.end,d=e.minEndPTS||u,f=e.maxStartPTS||o;for(let m=0;m<n.length;m++){const g=n.start(m)-this.bufferPadding,v=n.end(m)+this.bufferPadding;if(f>=g&&d<=v){l.time.push({startPTS:Math.max(o,n.start(m)),endPTS:Math.min(u,n.end(m))});break}else if(o<v&&u>g){const E=Math.max(o,n.start(m)),y=Math.min(u,n.end(m));y>E&&(l.partial=!0,l.time.push({startPTS:E,endPTS:y}))}else if(u<=g)break}return l}getPartialFragment(e){let t=null,i,n,l,o=0;const{bufferPadding:u,fragments:d}=this;return Object.keys(d).forEach(f=>{const m=d[f];m&&fo(m)&&(n=m.body.start-u,l=m.body.end+u,e>=n&&e<=l&&(i=Math.min(e-n,l-e),o<=i&&(t=m.body,o=i)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||fo(t))}getState(e){const t=cr(e),i=this.fragments[t];return i?i.buffered?fo(i)?gt.PARTIAL:gt.OK:gt.APPENDING:gt.NOT_LOADED}isTimeBuffered(e,t,i){let n,l;for(let o=0;o<i.length;o++){if(n=i.start(o)-this.bufferPadding,l=i.end(o)+this.bufferPadding,e>=n&&t<=l)return!0;if(t<=n)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const i=t.frag,n=t.part?null:t,l=cr(i);this.fragments[l]={body:i,appendedPTS:null,loaded:n,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:i,part:n,timeRanges:l,type:o}=t;if(i.sn==="initSegment")return;const u=i.type;if(n){let f=this.activePartLists[u];f||(this.activePartLists[u]=f=[]),f.push(n)}this.timeRanges=l;const d=l[o];this.detectEvictedFragments(o,d,u,n)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=cr(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,i=Object.keys(t);if(!e)return i.length>0;for(let n=i.length;n--;){const l=t[i[n]];if((l==null?void 0:l.body.type)===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,i,n,l){n&&!this.hasGaps||Object.keys(this.fragments).forEach(o=>{const u=this.fragments[o];if(!u)return;const d=u.body;d.type!==i||n&&!d.gap||d.start<t&&d.end>e&&(u.buffered||l)&&this.removeFragment(d)})}removeFragment(e){const t=cr(e);e.clearElementaryStreamInfo();const i=this.activePartLists[e.type];if(i){const n=e.sn;this.activePartLists[e.type]=uy(i,l=>l.fragment.sn!==n)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e,t;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const i=(e=this.hls)==null||(t=e.latestLevelDetails)==null?void 0:t.partList;i&&i.forEach(n=>n.clearElementaryStreamInfo())}}function fo(r){var e,t,i;return r.buffered&&(r.body.gap||((e=r.range.video)==null?void 0:e.partial)||((t=r.range.audio)==null?void 0:t.partial)||((i=r.range.audiovideo)==null?void 0:i.partial))}function cr(r){return`${r.type}_${r.level}_${r.sn}`}function uy(r,e){return r.filter(t=>{const i=e(t);return i||t.clearElementaryStreamInfo(),i})}var Vs={cbc:0,ctr:1};class IL{constructor(e,t,i){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=i}decrypt(e,t){switch(this.aesMode){case Vs.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case Vs.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function CL(r){const e=r.byteLength,t=e&&new DataView(r.buffer).getUint8(e-1);return t?r.slice(0,e-t):r}class OL{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),i=new Uint32Array(4);for(let n=0;n<4;n++)i[n]=t.getUint32(n*4);return i}initTable(){const e=this.sBox,t=this.invSBox,i=this.subMix,n=i[0],l=i[1],o=i[2],u=i[3],d=this.invSubMix,f=d[0],m=d[1],g=d[2],v=d[3],E=new Uint32Array(256);let y=0,S=0,T=0;for(T=0;T<256;T++)T<128?E[T]=T<<1:E[T]=T<<1^283;for(T=0;T<256;T++){let R=S^S<<1^S<<2^S<<3^S<<4;R=R>>>8^R&255^99,e[y]=R,t[R]=y;const D=E[y],_=E[D],O=E[_];let C=E[R]*257^R*16843008;n[y]=C<<24|C>>>8,l[y]=C<<16|C>>>16,o[y]=C<<8|C>>>24,u[y]=C,C=O*16843009^_*65537^D*257^y*16843008,f[R]=C<<24|C>>>8,m[R]=C<<16|C>>>16,g[R]=C<<8|C>>>24,v[R]=C,y?(y=D^E[E[E[O^D]]],S^=E[E[S]]):y=S=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let i=!0,n=0;for(;n<t.length&&i;)i=t[n]===this.key[n],n++;if(i)return;this.key=t;const l=this.keySize=t.length;if(l!==4&&l!==6&&l!==8)throw new Error("Invalid aes key size="+l);const o=this.ksRows=(l+6+1)*4;let u,d;const f=this.keySchedule=new Uint32Array(o),m=this.invKeySchedule=new Uint32Array(o),g=this.sBox,v=this.rcon,E=this.invSubMix,y=E[0],S=E[1],T=E[2],R=E[3];let D,_;for(u=0;u<o;u++){if(u<l){D=f[u]=t[u];continue}_=D,u%l===0?(_=_<<8|_>>>24,_=g[_>>>24]<<24|g[_>>>16&255]<<16|g[_>>>8&255]<<8|g[_&255],_^=v[u/l|0]<<24):l>6&&u%l===4&&(_=g[_>>>24]<<24|g[_>>>16&255]<<16|g[_>>>8&255]<<8|g[_&255]),f[u]=D=(f[u-l]^_)>>>0}for(d=0;d<o;d++)u=o-d,d&3?_=f[u]:_=f[u-4],d<4||u<=4?m[d]=_:m[d]=y[g[_>>>24]]^S[g[_>>>16&255]]^T[g[_>>>8&255]]^R[g[_&255]],m[d]=m[d]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,i){const n=this.keySize+6,l=this.invKeySchedule,o=this.invSBox,u=this.invSubMix,d=u[0],f=u[1],m=u[2],g=u[3],v=this.uint8ArrayToUint32Array_(i);let E=v[0],y=v[1],S=v[2],T=v[3];const R=new Int32Array(e),D=new Int32Array(R.length);let _,O,C,B,N,F,z,$,ae,ce,ve,he,J,P;const W=this.networkToHostOrderSwap;for(;t<R.length;){for(ae=W(R[t]),ce=W(R[t+1]),ve=W(R[t+2]),he=W(R[t+3]),N=ae^l[0],F=he^l[1],z=ve^l[2],$=ce^l[3],J=4,P=1;P<n;P++)_=d[N>>>24]^f[F>>16&255]^m[z>>8&255]^g[$&255]^l[J],O=d[F>>>24]^f[z>>16&255]^m[$>>8&255]^g[N&255]^l[J+1],C=d[z>>>24]^f[$>>16&255]^m[N>>8&255]^g[F&255]^l[J+2],B=d[$>>>24]^f[N>>16&255]^m[F>>8&255]^g[z&255]^l[J+3],N=_,F=O,z=C,$=B,J=J+4;_=o[N>>>24]<<24^o[F>>16&255]<<16^o[z>>8&255]<<8^o[$&255]^l[J],O=o[F>>>24]<<24^o[z>>16&255]<<16^o[$>>8&255]<<8^o[N&255]^l[J+1],C=o[z>>>24]<<24^o[$>>16&255]<<16^o[N>>8&255]<<8^o[F&255]^l[J+2],B=o[$>>>24]<<24^o[N>>16&255]<<16^o[F>>8&255]<<8^o[z&255]^l[J+3],D[t]=W(_^E),D[t+1]=W(B^y),D[t+2]=W(C^S),D[t+3]=W(O^T),E=ae,y=ce,S=ve,T=he,t=t+4}return D.buffer}}class NL{constructor(e,t,i){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=i}expandKey(){const e=kL(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function kL(r){switch(r){case Vs.cbc:return"AES-CBC";case Vs.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${r}`)}}const ML=16;class Jd{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const i=self.crypto;i&&(this.subtle=i.subtle||i.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const i=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?CL(i):i}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,i,n){return this.useSoftware?new Promise((l,o)=>{const u=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(u,t,i,n);const d=this.flush();d?l(d.buffer):o(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,i,n)}softwareDecrypt(e,t,i,n){const{currentIV:l,currentResult:o,remainderData:u}=this;if(n!==Vs.cbc||t.byteLength!==16)return Me.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),u&&(e=hi(u,e),this.remainderData=null);const d=this.getValidChunk(e);if(!d.length)return null;l&&(i=l);let f=this.softwareDecrypter;f||(f=this.softwareDecrypter=new OL),f.expandKey(t);const m=o;return this.currentResult=f.decrypt(d.buffer,0,i),this.currentIV=d.slice(-16).buffer,m||null}webCryptoDecrypt(e,t,i,n){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,i,n));this.key=t,this.fastAesKey=new NL(this.subtle,t,n)}return this.fastAesKey.expandKey().then(l=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new IL(this.subtle,new Uint8Array(i),n).decrypt(e.buffer,l)):Promise.reject(new Error("web crypto not initialized"))).catch(l=>(Me.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${l.name}: ${l.message}`),this.onWebCryptoError(e,t,i,n)))}onWebCryptoError(e,t,i,n){const l=this.enableSoftwareAES;if(l){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,i,n);const o=this.flush();if(o)return o.buffer}throw new Error("WebCrypto"+(l?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const i=e.length-e.length%ML;return i!==e.length&&(t=e.slice(0,i),this.remainderData=e.slice(i)),t}logOnce(e){this.logEnabled&&(Me.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const fy=Math.pow(2,17);class PL{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const i=e.url;if(!i)return Promise.reject(new cs({type:pe.NETWORK_ERROR,details:q.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${i?"part list":"url"}`),networkDetails:null}));this.abort();const n=this.config,l=n.fLoader,o=n.loader;return new Promise((u,d)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(y=>y[0]==="GAP")){d(hy(e));return}else e.gap=!1;const f=this.loader=l?new l(n):new o(n),m=dy(e);e.loader=f;const g=cy(n.fragLoadPolicy.default),v={loadPolicy:g,timeout:g.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:fy};e.stats=f.stats;const E={onSuccess:(y,S,T,R)=>{this.resetLoader(e,f);let D=y.data;T.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(D.slice(0,16)),D=D.slice(16)),u({frag:e,part:null,payload:D,networkDetails:R})},onError:(y,S,T,R)=>{this.resetLoader(e,f),d(new cs({type:pe.NETWORK_ERROR,details:q.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:$e({url:i,data:void 0},y),error:new Error(`HTTP Error ${y.code} ${y.text}`),networkDetails:T,stats:R}))},onAbort:(y,S,T)=>{this.resetLoader(e,f),d(new cs({type:pe.NETWORK_ERROR,details:q.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:T,stats:y}))},onTimeout:(y,S,T)=>{this.resetLoader(e,f),d(new cs({type:pe.NETWORK_ERROR,details:q.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${v.timeout}ms`),networkDetails:T,stats:y}))}};t&&(E.onProgress=(y,S,T,R)=>t({frag:e,part:null,payload:T,networkDetails:R})),f.load(m,v,E)})}loadPart(e,t,i){this.abort();const n=this.config,l=n.fLoader,o=n.loader;return new Promise((u,d)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){d(hy(e,t));return}const f=this.loader=l?new l(n):new o(n),m=dy(e,t);e.loader=f;const g=cy(n.fragLoadPolicy.default),v={loadPolicy:g,timeout:g.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:fy};t.stats=f.stats,f.load(m,v,{onSuccess:(E,y,S,T)=>{this.resetLoader(e,f),this.updateStatsFromPart(e,t);const R={frag:e,part:t,payload:E.data,networkDetails:T};i(R),u(R)},onError:(E,y,S,T)=>{this.resetLoader(e,f),d(new cs({type:pe.NETWORK_ERROR,details:q.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:$e({url:m.url,data:void 0},E),error:new Error(`HTTP Error ${E.code} ${E.text}`),networkDetails:S,stats:T}))},onAbort:(E,y,S)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,f),d(new cs({type:pe.NETWORK_ERROR,details:q.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:S,stats:E}))},onTimeout:(E,y,S)=>{this.resetLoader(e,f),d(new cs({type:pe.NETWORK_ERROR,details:q.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${v.timeout}ms`),networkDetails:S,stats:E}))}})})}updateStatsFromPart(e,t){const i=e.stats,n=t.stats,l=n.total;if(i.loaded+=n.loaded,l){const d=Math.round(e.duration/t.duration),f=Math.min(Math.round(i.loaded/l),d),g=(d-f)*Math.round(i.loaded/f);i.total=i.loaded+g}else i.total=Math.max(i.loaded,i.total);const o=i.loading,u=n.loading;o.start?o.first+=u.first-u.start:(o.start=u.start,o.first=u.first),o.end=u.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function dy(r,e=null){const t=e||r,i={frag:r,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},n=t.byteRangeStartOffset,l=t.byteRangeEndOffset;if(de(n)&&de(l)){var o;let u=n,d=l;if(r.sn==="initSegment"&&UL((o=r.decryptdata)==null?void 0:o.method)){const f=l-n;f%16&&(d=l+(16-f%16)),n!==0&&(i.resetIV=!0,u=n-16)}i.rangeStart=u,i.rangeEnd=d}return i}function hy(r,e){const t=new Error(`GAP ${r.gap?"tag":"attribute"} found`),i={type:pe.MEDIA_ERROR,details:q.FRAG_GAP,fatal:!1,frag:r,error:t,networkDetails:null};return e&&(i.part=e),(e||r).stats.aborted=!0,new cs(i)}function UL(r){return r==="AES-128"||r==="AES-256"}class cs extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class Tx extends ms{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class eh{constructor(e,t,i,n=0,l=-1,o=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=ho(),this.buffering={audio:ho(),video:ho(),audiovideo:ho()},this.level=e,this.sn=t,this.id=i,this.size=n,this.part=l,this.partial=o}}function ho(){return{start:0,executeStart:0,executeEnd:0,end:0}}const my={length:0,start:()=>0,end:()=>0};class De{static isBuffered(e,t){if(e){const i=De.getBuffered(e);for(let n=i.length;n--;)if(t>=i.start(n)&&t<=i.end(n))return!0}return!1}static bufferedRanges(e){if(e){const t=De.getBuffered(e);return De.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let i=0;i<e.length;i++)t.push({start:e.start(i),end:e.end(i)});return t}static bufferInfo(e,t,i){if(e){const n=De.bufferedRanges(e);if(n.length)return De.bufferedInfo(n,t,i)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,i){t=Math.max(0,t),e.length>1&&e.sort((m,g)=>m.start-g.start||g.end-m.end);let n=-1,l=[];if(i)for(let m=0;m<e.length;m++){t>=e[m].start&&t<=e[m].end&&(n=m);const g=l.length;if(g){const v=l[g-1].end;e[m].start-v<i?e[m].end>v&&(l[g-1].end=e[m].end):l.push(e[m])}else l.push(e[m])}else l=e;let o=0,u,d=t,f=t;for(let m=0;m<l.length;m++){const g=l[m].start,v=l[m].end;if(n===-1&&t>=g&&t<=v&&(n=m),t+i>=g&&t<v)d=g,f=v,o=f-t;else if(t+i<g){u=g;break}}return{len:o,start:d||0,end:f||0,nextStart:u,buffered:e,bufferedIndex:n}}static getBuffered(e){try{return e.buffered||my}catch(t){return Me.log("failed to get media.buffered",t),my}}}const bx=/\{\$([a-zA-Z0-9-_]+)\}/g;function gy(r){return bx.test(r)}function bd(r,e){if(r.variableList!==null||r.hasVariableRefs){const t=r.variableList;return e.replace(bx,i=>{const n=i.substring(2,i.length-1),l=t==null?void 0:t[n];return l===void 0?(r.playlistParsingError||(r.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${n}"`)),i):l})}return e}function py(r,e,t){let i=r.variableList;i||(r.variableList=i={});let n,l;if("QUERYPARAM"in e){n=e.QUERYPARAM;try{const o=new self.URL(t).searchParams;if(o.has(n))l=o.get(n);else throw new Error(`"${n}" does not match any query parameter in URI: "${t}"`)}catch(o){r.playlistParsingError||(r.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${o.message}`))}}else n=e.NAME,l=e.VALUE;n in i?r.playlistParsingError||(r.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${n}"`)):i[n]=l||""}function BL(r,e,t){const i=e.IMPORT;if(t&&i in t){let n=r.variableList;n||(r.variableList=n={}),n[i]=t[i]}else r.playlistParsingError||(r.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${i}"`))}const FL=/^(\d+)x(\d+)$/,yy=/(.+?)=(".*?"|.*?)(?:,|$)/g;class it{constructor(e,t){typeof e=="string"&&(e=it.parseAttrList(e,t)),Ke(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const i=new Uint8Array(t.length/2);for(let n=0;n<t.length/2;n++)i[n]=parseInt(t.slice(n*2,n*2+2),16);return i}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const i=this[e];return i?parseFloat(i):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const i=this[e];return(i?i.split(/[ ,]+/):[]).reduce((n,l)=>(n[l.toLowerCase()]=!0,n),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=FL.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let i;const n={},l='"';for(yy.lastIndex=0;(i=yy.exec(e))!==null;){const o=i[1].trim();let u=i[2];const d=u.indexOf(l)===0&&u.lastIndexOf(l)===u.length-1;let f=!1;if(d)u=u.slice(1,-1);else switch(o){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":f=!0}if(t&&(d||f))u=bd(t,u);else if(!f&&!d)switch(o){case"CLOSED-CAPTIONS":if(u==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":Me.warn(`${e}: attribute ${o} is missing quotes`)}n[o]=u}return n}}const jL="com.apple.hls.interstitial";function $L(r){return r!=="ID"&&r!=="CLASS"&&r!=="CUE"&&r!=="START-DATE"&&r!=="DURATION"&&r!=="END-DATE"&&r!=="END-ON-NEXT"}function GL(r){return r==="SCTE35-OUT"||r==="SCTE35-IN"||r==="SCTE35-CMD"}class Ax{constructor(e,t,i=0){var n;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(t==null?void 0:t.tagAnchor)||null,this.tagOrder=(n=t==null?void 0:t.tagOrder)!=null?n:i,t){const l=t.attr;for(const o in l)if(Object.prototype.hasOwnProperty.call(e,o)&&e[o]!==l[o]){Me.warn(`DATERANGE tag attribute: "${o}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=o;break}e=Ke(new it({}),l,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const l=(t==null?void 0:t.endDate)||new Date(this.attr["END-DATE"]);de(l.getTime())&&(this._endDate=l)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(Me.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(de(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===jL}get isValid(){return!!this.id&&!this._badValueForSameId&&de(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const HL=10;class VL{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,i=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!i||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&i>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}get hasProgramDateTime(){return this.fragments.length?de(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||HL}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var e;return(e=this.fragments)!=null&&e.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){var e;return(e=this.fragments)!=null&&e.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let i=e.length;i--;)if(e[i].index>t)return e[i].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function hr(r){return r==="AES-128"||r==="AES-256"||r==="AES-256-CTR"}function th(r){switch(r){case"AES-128":case"AES-256":return Vs.cbc;case"AES-256-CTR":return Vs.ctr;default:throw new Error(`invalid full segment method ${r}`)}}function ih(r){return Uint8Array.from(atob(r),e=>e.charCodeAt(0))}function Ad(r){return Uint8Array.from(unescape(encodeURIComponent(r)),e=>e.charCodeAt(0))}function zL(r){const e=Ad(r).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function KL(r){const e=function(i,n,l){const o=i[n];i[n]=i[l],i[l]=o};e(r,0,3),e(r,1,2),e(r,4,5),e(r,6,7)}function YL(r){const e=r.split(":");let t=null;if(e[0]==="data"&&e.length===2){const i=e[1].split(";"),n=i[i.length-1].split(",");if(n.length===2){const l=n[0]==="base64",o=n[1];l?(i.splice(-1,1),t=ih(o)):t=zL(o)}}return t}const Zo=typeof self<"u"?self:void 0;var Ge={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Vt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function $f(r){switch(r){case Vt.FAIRPLAY:return Ge.FAIRPLAY;case Vt.PLAYREADY:return Ge.PLAYREADY;case Vt.WIDEVINE:return Ge.WIDEVINE;case Vt.CLEARKEY:return Ge.CLEARKEY}}var mo={CENC:"1077efecc0b24d02ace33c1e52e2fb4b",CLEARKEY:"e2719d58a985b3c9781ab030af78d30e",PLAYREADY:"9a04f07998404286ab92e65be0885f95",WIDEVINE:"edef8ba979d64acea3c827dcd51d21ed"};function Gf(r){if(r===mo.WIDEVINE)return Ge.WIDEVINE;if(r===mo.PLAYREADY)return Ge.PLAYREADY;if(r===mo.CENC||r===mo.CLEARKEY)return Ge.CLEARKEY}function Hf(r){switch(r){case Ge.FAIRPLAY:return Vt.FAIRPLAY;case Ge.PLAYREADY:return Vt.PLAYREADY;case Ge.WIDEVINE:return Vt.WIDEVINE;case Ge.CLEARKEY:return Vt.CLEARKEY}}function go(r){const{drmSystems:e,widevineLicenseUrl:t}=r,i=e?[Ge.FAIRPLAY,Ge.WIDEVINE,Ge.PLAYREADY,Ge.CLEARKEY].filter(n=>!!e[n]):[];return!i[Ge.WIDEVINE]&&t&&i.push(Ge.WIDEVINE),i}const Rx=function(r){return Zo!=null&&(r=Zo.navigator)!=null&&r.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function qL(r,e,t,i){let n;switch(r){case Ge.FAIRPLAY:n=["cenc","sinf"];break;case Ge.WIDEVINE:case Ge.PLAYREADY:n=["cenc"];break;case Ge.CLEARKEY:n=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${r}`)}return XL(n,e,t,i)}function XL(r,e,t,i){return[{initDataTypes:r,persistentState:i.persistentState||"optional",distinctiveIdentifier:i.distinctiveIdentifier||"optional",sessionTypes:i.sessionTypes||[i.sessionType||"temporary"],audioCapabilities:e.map(l=>({contentType:`audio/mp4; codecs=${l}`,robustness:i.audioRobustness||"",encryptionScheme:i.audioEncryptionScheme||null})),videoCapabilities:t.map(l=>({contentType:`video/mp4; codecs=${l}`,robustness:i.videoRobustness||"",encryptionScheme:i.videoEncryptionScheme||null}))}]}function QL(r){var e;return r.sessionType==="persistent-license"||!!((e=r.sessionTypes)!=null&&e.some(t=>t==="persistent-license"))}function Lx(r){const e=new Uint16Array(r.buffer,r.byteOffset,r.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),i=t.substring(t.indexOf("<"),t.length),o=new DOMParser().parseFromString(i,"text/xml").getElementsByTagName("KID")[0];if(o){const u=o.childNodes[0]?o.childNodes[0].nodeValue:o.getAttribute("VALUE");if(u){const d=ih(u).subarray(0,16);return KL(d),d}}return null}let po={};class Ua{static clearKeyUriToKeyIdMap(){po={}}constructor(e,t,i,n=[1],l=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=i,this.keyFormatVersions=n,this.iv=l,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!hr(e)}isSupported(){if(this.method){if(hr(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case Vt.FAIRPLAY:case Vt.WIDEVINE:case Vt.PLAYREADY:case Vt.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if(hr(this.method)&&this.uri&&!this.iv){typeof e!="number"&&(Me.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0);const i=WL(e);return new Ua(this.method,this.uri,"identity",this.keyFormatVersions,i)}const t=YL(this.uri);if(t)switch(this.keyFormat){case Vt.WIDEVINE:this.pssh=t,t.length>=22&&(this.keyId=t.subarray(t.length-22,t.length-6));break;case Vt.PLAYREADY:{const i=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=iL(i,null,t),this.keyId=Lx(t);break}default:{let i=t.subarray(0,16);if(i.length!==16){const n=new Uint8Array(16);n.set(i,16-i.length),i=n}this.keyId=i;break}}if(!this.keyId||this.keyId.byteLength!==16){let i=po[this.uri];if(!i){const n=Object.keys(po).length%Number.MAX_SAFE_INTEGER;i=new Uint8Array(16),new DataView(i.buffer,12,4).setUint32(0,n),po[this.uri]=i}this.keyId=i}return this}}function WL(r){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=r>>8*(15-t)&255;return e}const vy=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,xy=/#EXT-X-MEDIA:(.*)/g,ZL=/^#EXT(?:INF|-X-TARGETDURATION):/m,Vf=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),JL=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Fi{static findGroup(e,t){for(let i=0;i<e.length;i++){const n=e[i];if(n.id===t)return n}}static resolve(e,t){return qd.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return ZL.test(e)}static parseMasterPlaylist(e,t){const i=gy(e),n={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:i},l=[];vy.lastIndex=0;let o;for(;(o=vy.exec(e))!=null;)if(o[1]){var u;const f=new it(o[1],n),m=bd(n,o[2]),g={attrs:f,bitrate:f.decimalInteger("BANDWIDTH")||f.decimalInteger("AVERAGE-BANDWIDTH"),name:f.NAME,url:Fi.resolve(m,t)},v=f.decimalResolution("RESOLUTION");v&&(g.width=v.width,g.height=v.height),Ty(f.CODECS,g);const E=f["SUPPLEMENTAL-CODECS"];E&&(g.supplemental={},Ty(E,g.supplemental)),(u=g.unknownCodecs)!=null&&u.length||l.push(g),n.levels.push(g)}else if(o[3]){const f=o[3],m=o[4];switch(f){case"SESSION-DATA":{const g=new it(m,n),v=g["DATA-ID"];v&&(n.sessionData===null&&(n.sessionData={}),n.sessionData[v]=g);break}case"SESSION-KEY":{const g=Ey(m,t,n);g.encrypted&&g.isSupported()?(n.sessionKeys===null&&(n.sessionKeys=[]),n.sessionKeys.push(g)):Me.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${m}"`);break}case"DEFINE":{{const g=new it(m,n);py(n,g,t)}break}case"CONTENT-STEERING":{const g=new it(m,n);n.contentSteering={uri:Fi.resolve(g["SERVER-URI"],t),pathwayId:g["PATHWAY-ID"]||"."};break}case"START":{n.startTimeOffset=Sy(m);break}}}const d=l.length>0&&l.length<n.levels.length;return n.levels=d?l:n.levels,n.levels.length===0&&(n.playlistParsingError=new Error("no levels found in manifest")),n}static parseMasterPlaylistMedia(e,t,i){let n;const l={},o=i.levels,u={AUDIO:o.map(f=>({id:f.attrs.AUDIO,audioCodec:f.audioCodec})),SUBTITLES:o.map(f=>({id:f.attrs.SUBTITLES,textCodec:f.textCodec})),"CLOSED-CAPTIONS":[]};let d=0;for(xy.lastIndex=0;(n=xy.exec(e))!==null;){const f=new it(n[1],i),m=f.TYPE;if(m){const g=u[m],v=l[m]||[];l[m]=v;const E=f.LANGUAGE,y=f["ASSOC-LANGUAGE"],S=f.CHANNELS,T=f.CHARACTERISTICS,R=f["INSTREAM-ID"],D={attrs:f,bitrate:0,id:d++,groupId:f["GROUP-ID"]||"",name:f.NAME||E||"",type:m,default:f.bool("DEFAULT"),autoselect:f.bool("AUTOSELECT"),forced:f.bool("FORCED"),lang:E,url:f.URI?Fi.resolve(f.URI,t):""};if(y&&(D.assocLang=y),S&&(D.channels=S),T&&(D.characteristics=T),R&&(D.instreamId=R),g!=null&&g.length){const _=Fi.findGroup(g,D.groupId)||g[0];by(D,_,"audioCodec"),by(D,_,"textCodec")}v.push(D)}}return l}static parseLevelPlaylist(e,t,i,n,l,o){var u;const d={url:t},f=new VL(t),m=f.fragments,g=[];let v=null,E=0,y=0,S=0,T=0,R=0,D=null,_=new Uf(n,d),O,C,B,N=-1,F=!1,z=null,$;if(Vf.lastIndex=0,f.m3u8=e,f.hasVariableRefs=gy(e),((u=Vf.exec(e))==null?void 0:u[0])!=="#EXTM3U")return f.playlistParsingError=new Error("Missing format identifier #EXTM3U"),f;for(;(O=Vf.exec(e))!==null;){F&&(F=!1,_=new Uf(n,d),_.playlistOffset=S,_.start=S,_.sn=E,_.cc=T,R&&(_.bitrate=R),_.level=i,v&&(_.initSegment=v,v.rawProgramDateTime&&(_.rawProgramDateTime=v.rawProgramDateTime,v.rawProgramDateTime=null),z&&(_.setByteRange(z),z=null)));const he=O[1];if(he){_.duration=parseFloat(he);const J=(" "+O[2]).slice(1);_.title=J||null,_.tagList.push(J?["INF",he,J]:["INF",he])}else if(O[3]){if(de(_.duration)){_.playlistOffset=S,_.start=S,B&&Ry(_,B,f),_.sn=E,_.level=i,_.cc=T,m.push(_);const J=(" "+O[3]).slice(1);_.relurl=bd(f,J),Rd(_,D,g),D=_,S+=_.duration,E++,y=0,F=!0}}else{if(O=O[0].match(JL),!O){Me.warn("No matches on slow regex match for level playlist!");continue}for(C=1;C<O.length&&O[C]===void 0;C++);const J=(" "+O[C]).slice(1),P=(" "+O[C+1]).slice(1),W=O[C+2]?(" "+O[C+2]).slice(1):null;switch(J){case"BYTERANGE":D?_.setByteRange(P,D):_.setByteRange(P);break;case"PROGRAM-DATE-TIME":_.rawProgramDateTime=P,_.tagList.push(["PROGRAM-DATE-TIME",P]),N===-1&&(N=m.length);break;case"PLAYLIST-TYPE":f.type&&ls(f,J,O),f.type=P.toUpperCase();break;case"MEDIA-SEQUENCE":f.startSN!==0?ls(f,J,O):m.length>0&&Ly(f,J,O),E=f.startSN=parseInt(P);break;case"SKIP":{f.skippedSegments&&ls(f,J,O);const se=new it(P,f),ee=se.decimalInteger("SKIPPED-SEGMENTS");if(de(ee)){f.skippedSegments+=ee;for(let k=ee;k--;)m.push(null);E+=ee}const w=se.enumeratedString("RECENTLY-REMOVED-DATERANGES");w&&(f.recentlyRemovedDateranges=(f.recentlyRemovedDateranges||[]).concat(w.split("	")));break}case"TARGETDURATION":f.targetduration!==0&&ls(f,J,O),f.targetduration=Math.max(parseInt(P),1);break;case"VERSION":f.version!==null&&ls(f,J,O),f.version=parseInt(P);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":f.live||ls(f,J,O),f.live=!1;break;case"#":(P||W)&&_.tagList.push(W?[P,W]:[P]);break;case"DISCONTINUITY":T++,_.tagList.push(["DIS"]);break;case"GAP":_.gap=!0,_.tagList.push([J]);break;case"BITRATE":_.tagList.push([J,P]),R=parseInt(P)*1e3,de(R)?_.bitrate=R:R=0;break;case"DATERANGE":{const se=new it(P,f),ee=new Ax(se,f.dateRanges[se.ID],f.dateRangeTagCount);f.dateRangeTagCount++,ee.isValid||f.skippedSegments?f.dateRanges[ee.id]=ee:Me.warn(`Ignoring invalid DATERANGE tag: "${P}"`),_.tagList.push(["EXT-X-DATERANGE",P]);break}case"DEFINE":{{const se=new it(P,f);"IMPORT"in se?BL(f,se,o):py(f,se,t)}break}case"DISCONTINUITY-SEQUENCE":f.startCC!==0?ls(f,J,O):m.length>0&&Ly(f,J,O),f.startCC=T=parseInt(P);break;case"KEY":{const se=Ey(P,t,f);if(se.isSupported()){if(se.method==="NONE"){B=void 0;break}B||(B={}),B[se.keyFormat]&&(B=Ke({},B)),B[se.keyFormat]=se}else Me.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${P}"`);break}case"START":f.startTimeOffset=Sy(P);break;case"MAP":{const se=new it(P,f);if(_.duration){const ee=new Uf(n,d);Ay(ee,se,i,B),v=ee,_.initSegment=v,v.rawProgramDateTime&&!_.rawProgramDateTime&&(_.rawProgramDateTime=v.rawProgramDateTime)}else{const ee=_.byteRangeEndOffset;if(ee){const w=_.byteRangeStartOffset;z=`${ee-w}@${w}`}else z=null;Ay(_,se,i,B),v=_,F=!0}v.cc=T;break}case"SERVER-CONTROL":{$&&ls(f,J,O),$=new it(P),f.canBlockReload=$.bool("CAN-BLOCK-RELOAD"),f.canSkipUntil=$.optionalFloat("CAN-SKIP-UNTIL",0),f.canSkipDateRanges=f.canSkipUntil>0&&$.bool("CAN-SKIP-DATERANGES"),f.partHoldBack=$.optionalFloat("PART-HOLD-BACK",0),f.holdBack=$.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{f.partTarget&&ls(f,J,O);const se=new it(P);f.partTarget=se.decimalFloatingPoint("PART-TARGET");break}case"PART":{let se=f.partList;se||(se=f.partList=[]);const ee=y>0?se[se.length-1]:void 0,w=y++,k=new it(P,f),K=new $R(k,_,d,w,ee);se.push(K),_.duration+=K.duration;break}case"PRELOAD-HINT":{const se=new it(P,f);f.preloadHint=se;break}case"RENDITION-REPORT":{const se=new it(P,f);f.renditionReports=f.renditionReports||[],f.renditionReports.push(se);break}default:Me.warn(`line parsed but not handled: ${O}`);break}}}D&&!D.relurl?(m.pop(),S-=D.duration,f.partList&&(f.fragmentHint=D)):f.partList&&(Rd(_,D,g),_.cc=T,f.fragmentHint=_,B&&Ry(_,B,f)),f.targetduration||(f.playlistParsingError=new Error("#EXT-X-TARGETDURATION is required"));const ae=m.length,ce=m[0],ve=m[ae-1];if(S+=f.skippedSegments*f.targetduration,S>0&&ae&&ve){f.averagetargetduration=S/ae;const he=ve.sn;f.endSN=he!=="initSegment"?he:0,f.live||(ve.endList=!0),ce&&f.startCC===void 0&&(f.startCC=ce.cc),N>0&&(t2(m,N),ce&&g.unshift(ce))}else f.endSN=0,f.startCC=0;return f.fragmentHint&&(S+=f.fragmentHint.duration),f.totalduration=S,g.length&&f.dateRangeTagCount&&ce&&_x(g,f),f.endCC=T,f}}function _x(r,e){const t=r.length,i=r[t-1],n=e.live?1/0:e.totalduration,l=Object.keys(e.dateRanges);for(let o=l.length;o--;){const u=e.dateRanges[l[o]],d=u.startDate.getTime();u.tagAnchor=i.ref;for(let f=t;f--;){const m=e2(e,d,r,f,n);if(m!==-1){u.tagAnchor=e.fragments[m].ref;break}}}}function e2(r,e,t,i,n){const l=t[i];if(l){const u=l.programDateTime;if(e>=u||i===0){var o;const d=(((o=t[i+1])==null?void 0:o.start)||n)-l.start;if(e<=u+d*1e3){const f=t[i].sn-r.startSN,m=r.fragments;if(m.length>t.length){const v=(t[i+1]||m[m.length-1]).sn-r.startSN;for(let E=v;E>f;E--){const y=m[E].programDateTime;if(e>=y&&e<y+m[E].duration*1e3)return E}}return f}}}return-1}function Ey(r,e,t){var i,n;const l=new it(r,t),o=(i=l.METHOD)!=null?i:"",u=l.URI,d=l.hexadecimalInteger("IV"),f=l.KEYFORMATVERSIONS,m=(n=l.KEYFORMAT)!=null?n:"identity";u&&l.IV&&!d&&Me.error(`Invalid IV: ${l.IV}`);const g=u?Fi.resolve(u,e):"",v=(f||"1").split("/").map(Number).filter(Number.isFinite);return new Ua(o,g,m,v,d)}function Sy(r){const t=new it(r).decimalFloatingPoint("TIME-OFFSET");return de(t)?t:null}function Ty(r,e){let t=(r||"").split(/[ ,]+/).filter(i=>i);["video","audio","text"].forEach(i=>{const n=t.filter(l=>mx(l,i));n.length&&(e[`${i}Codec`]=n.map(l=>l.split("/")[0]).join(","),t=t.filter(l=>n.indexOf(l)===-1))}),e.unknownCodecs=t}function by(r,e,t){const i=e[t];i&&(r[t]=i)}function t2(r,e){let t=r[e];for(let i=e;i--;){const n=r[i];if(!n)return;n.programDateTime=t.programDateTime-n.duration*1e3,t=n}}function Rd(r,e,t){r.rawProgramDateTime?t.push(r):e!=null&&e.programDateTime&&(r.programDateTime=e.endProgramDateTime)}function Ay(r,e,t,i){r.relurl=e.URI,e.BYTERANGE&&r.setByteRange(e.BYTERANGE),r.level=t,r.sn="initSegment",i&&(r.levelkeys=i),r.initSegment=null}function Ry(r,e,t){r.levelkeys=e;const{encryptedFragments:i}=t;(!i.length||i[i.length-1].levelkeys!==e)&&Object.keys(e).some(n=>e[n].isCommonEncryption)&&i.push(r)}function ls(r,e,t){r.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function Ly(r,e,t){r.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function zf(r,e){const t=e.startPTS;if(de(t)){let i=0,n;e.sn>r.sn?(i=t-r.start,n=r):(i=r.start-t,n=e),n.duration!==i&&n.setDuration(i)}else e.sn>r.sn?r.cc===e.cc&&r.minEndPTS?e.setStart(r.start+(r.minEndPTS-r.start)):e.setStart(r.start+r.duration):e.setStart(Math.max(r.start-e.duration,0))}function Dx(r,e,t,i,n,l){i-t<=0&&(Me.warn("Fragment should have a positive duration",e),i=t+e.duration,l=n+e.duration);let u=t,d=i;const f=e.startPTS,m=e.endPTS;if(de(f)){const T=Math.abs(f-t);de(e.deltaPTS)?e.deltaPTS=Math.max(T,e.deltaPTS):e.deltaPTS=T,u=Math.max(t,f),t=Math.min(t,f),n=Math.min(n,e.startDTS),d=Math.min(i,m),i=Math.max(i,m),l=Math.max(l,e.endDTS)}const g=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(i-e.start),e.startPTS=t,e.maxStartPTS=u,e.startDTS=n,e.endPTS=i,e.minEndPTS=d,e.endDTS=l;const v=e.sn;if(!r||v<r.startSN||v>r.endSN)return 0;let E;const y=v-r.startSN,S=r.fragments;for(S[y]=e,E=y;E>0;E--)zf(S[E],S[E-1]);for(E=y;E<S.length-1;E++)zf(S[E],S[E+1]);return r.fragmentHint&&zf(S[S.length-1],r.fragmentHint),r.PTSKnown=r.alignedSliding=!0,g}function i2(r,e){if(r===e)return;let t=null;const i=r.fragments;for(let d=i.length-1;d>=0;d--){const f=i[d].initSegment;if(f){t=f;break}}r.fragmentHint&&delete r.fragmentHint.endPTS;let n;r2(r,e,(d,f,m,g)=>{if(!e.startCC&&f.cc!==d.cc){var v,E;const y=d.cc-f.cc;for(let S=m;S<g.length;S++)g[S].cc+=y;e.startCC=(v=(E=Cx(r,e.startSN-1))==null?void 0:E.cc)!=null?v:g[0].cc,e.endCC=g[g.length-1].cc}de(d.startPTS)&&de(d.endPTS)&&(f.setStart(f.startPTS=d.startPTS),f.startDTS=d.startDTS,f.maxStartPTS=d.maxStartPTS,f.endPTS=d.endPTS,f.endDTS=d.endDTS,f.minEndPTS=d.minEndPTS,f.setDuration(d.endPTS-d.startPTS),f.duration&&(n=f),e.PTSKnown=e.alignedSliding=!0),d.hasStreams&&(f.elementaryStreams=d.elementaryStreams),f.loader=d.loader,d.hasStats&&(f.stats=d.stats),d.initSegment&&(f.initSegment=d.initSegment,t=d.initSegment)});const l=e.fragments,o=e.fragmentHint?l.concat(e.fragmentHint):l;if(t&&o.forEach(d=>{var f;d&&(!d.initSegment||d.initSegment.relurl===((f=t)==null?void 0:f.relurl))&&(d.initSegment=t)}),e.skippedSegments)if(e.deltaUpdateFailed=l.some(d=>!d),e.deltaUpdateFailed){Me.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let d=e.skippedSegments;d--;)l.shift();e.startSN=l[0].sn}else{e.endCC=l[l.length-1].cc,e.canSkipDateRanges&&(e.dateRanges=s2(r.dateRanges,e));const d=r.fragments.filter(f=>f.rawProgramDateTime);if(r.hasProgramDateTime&&!e.hasProgramDateTime)for(let f=1;f<o.length;f++)o[f].programDateTime===null&&Rd(o[f],o[f-1],d);_x(d,e)}n2(r.partList,e.partList,(d,f)=>{f.elementaryStreams=d.elementaryStreams,f.stats=d.stats}),n?Dx(e,n,n.startPTS,n.endPTS,n.startDTS,n.endDTS):wx(r,e),l.length&&(e.totalduration=e.edge-l[0].start),e.driftStartTime=r.driftStartTime,e.driftStart=r.driftStart;const u=e.advancedDateTime;if(e.advanced&&u){const d=e.edge;e.driftStart||(e.driftStartTime=u,e.driftStart=d),e.driftEndTime=u,e.driftEnd=d}else e.driftEndTime=r.driftEndTime,e.driftEnd=r.driftEnd,e.advancedDateTime=r.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=r.requestScheduled)}function s2(r,e){const{dateRanges:t,recentlyRemovedDateranges:i}=e,n=Ke({},r);i&&i.forEach(u=>{delete n[u]});const o=Object.keys(n).length;return o&&Object.keys(t).forEach(u=>{const d=n[u],f=new Ax(t[u].attr,d);f.isValid?(n[u]=f,d||(f.tagOrder+=o)):Me.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${et(t[u].attr)}"`)}),n}function n2(r,e,t){if(r&&e){let i=0;for(let n=0,l=r.length;n<=l;n++){const o=r[n],u=e[n+i];o&&u&&o.index===u.index&&o.fragment.sn===u.fragment.sn?t(o,u):i--}}}function r2(r,e,t){const i=e.skippedSegments,n=Math.max(r.startSN,e.startSN)-e.startSN,l=(r.fragmentHint?1:0)+(i?e.endSN:Math.min(r.endSN,e.endSN))-e.startSN,o=e.startSN-r.startSN,u=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,d=r.fragmentHint?r.fragments.concat(r.fragmentHint):r.fragments;for(let f=n;f<=l;f++){const m=d[o+f];let g=u[f];if(i&&!g&&m&&(g=e.fragments[f]=m),m&&g){if(t(m,g,f,u),m.url&&m.url!==g.url){e.playlistParsingError=_y(`media sequence mismatch ${g.sn}:`,r,e,m,g);return}else if(m.cc!==g.cc){e.playlistParsingError=_y(`discontinuity sequence mismatch (${m.cc}!=${g.cc})`,r,e,m,g);return}}}}function _y(r,e,t,i,n){return new Error(`${r} ${n.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function wx(r,e,t=!0){const i=e.startSN+e.skippedSegments-r.startSN,n=r.fragments,l=i>=0;let o=0;if(l&&i<n.length)o=n[i].start;else if(l&&e.startSN===r.endSN+1)o=r.fragmentEnd;else if(l&&t)o=r.fragmentStart+i*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)o=r.fragmentStart;else return;Ld(e,o)}function Ld(r,e){if(e){const t=r.fragments;for(let i=r.skippedSegments;i<t.length;i++)t[i].addStart(e);r.fragmentHint&&r.fragmentHint.addStart(e)}}function Ix(r,e=1/0){let t=1e3*r.targetduration;if(r.updated){const i=r.fragments;if(i.length&&t*4>e){const l=i[i.length-1].duration*1e3;l<t&&(t=l)}}else t/=2;return Math.round(t)}function Cx(r,e,t){if(!r)return null;let i=r.fragments[e-r.startSN];return i||(i=r.fragmentHint,i&&i.sn===e)?i:e<r.startSN&&t&&t.sn===e?t:null}function Dy(r,e,t){return r?Ox(r.partList,e,t):null}function Ox(r,e,t){if(r)for(let i=r.length;i--;){const n=r[i];if(n.index===t&&n.fragment.sn===e)return n}return null}function Nx(r){r.forEach((e,t)=>{var i;(i=e.details)==null||i.fragments.forEach(n=>{n.level=t,n.initSegment&&(n.initSegment.level=t)})})}function wa(r,e){for(let i=0,n=r.length;i<n;i++){var t;if(((t=r[i])==null?void 0:t.cc)===e)return r[i]}return null}function a2(r,e){return!!(r&&e.startCC<r.endCC&&e.endCC>r.startCC)}function wy(r,e){if(r){const t=r.start+e;r.start=r.startPTS=t,r.endPTS=t+r.duration}}function kx(r,e){const t=e.fragments;for(let i=0,n=t.length;i<n;i++)wy(t[i],r);e.fragmentHint&&wy(e.fragmentHint,r),e.alignedSliding=!0}function l2(r,e){r&&(Mx(e,r),!e.alignedSliding&&r&&Jo(e,r),!e.alignedSliding&&r&&!e.skippedSegments&&wx(r,e,!1))}function Mx(r,e){if(!a2(e,r))return;const t=Math.min(e.endCC,r.endCC),i=wa(e.fragments,t),n=wa(r.fragments,t);if(!i||!n)return;Me.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const l=i.start-n.start;kx(l,r)}function Jo(r,e){if(!r.hasProgramDateTime||!e.hasProgramDateTime)return;const t=r.fragments,i=e.fragments;if(!t.length||!i.length)return;let n,l;const o=Math.min(e.endCC,r.endCC);e.startCC<o&&r.startCC<o&&(n=wa(i,o),l=wa(t,o)),(!n||!l)&&(n=i[Math.floor(i.length/2)],l=wa(t,n.cc)||t[Math.floor(t.length/2)]);const u=n.programDateTime,d=l.programDateTime;if(!u||!d)return;const f=(d-u)/1e3-(l.start-n.start);kx(f,r)}const o2={toString:function(r){let e="";const t=r.length;for(let i=0;i<t;i++)e+=`[${r.start(i).toFixed(3)}-${r.end(i).toFixed(3)}]`;return e}},ne={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class sh extends Tx{constructor(e,t,i,n,l){super(n,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=ne.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:o,fragCurrent:u,media:d,mediaBuffer:f,state:m}=this,g=d?d.currentTime:0,v=De.bufferInfo(f||d,g,o.maxBufferHole);if(this.log(`media seeking to ${de(g)?g.toFixed(3):g}, state: ${m}`),this.state===ne.ENDED)this.resetLoadingState();else if(u){const E=o.maxFragLookUpTolerance,y=u.start-E,S=u.start+u.duration+E;if(!v.len||S<v.start||y>v.end){const T=g>S;(g<y||T)&&(T&&u.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),u.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(d){this.fragmentTracker.removeFragmentsInRange(g,1/0,this.playlistType,!0);const E=this.lastCurrentTime;if(g>E&&(this.lastCurrentTime=g),!this.loadingParts){const y=Math.max(v.end,g),S=this.shouldLoadParts(this.getLevelDetails(),y);S&&(this.log(`LL-Part loading ON after seeking to ${g.toFixed(2)} with buffer @${y.toFixed(2)}`),this.loadingParts=S)}}!this.hls.hasEnoughToStart&&!v.len&&(this.log(`setting startPosition to ${g} because of seek before start`),this.nextLoadPosition=this.startPosition=g),this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=l,this.hls=e,this.fragmentLoader=new PL(e.config),this.keyLoader=i,this.fragmentTracker=t,this.config=e.config,this.decrypter=new Jd(e.config)}registerListeners(){const{hls:e}=this;e.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(A.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(A.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===ne.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=ne.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const i=e.end||0,n=this.config.timelineOffset||0;if(i<=n)return!1;const l=e.nextStart;if(l&&l>n&&l<t.edge||this.media.currentTime<e.start)return!1;const u=t.partList;if(u!=null&&u.length){const f=u[u.length-1];return De.isBuffered(this.media,f.start+f.duration/2)}const d=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(d)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null){var e;return(e=this.levelLastLoaded)==null?void 0:e.details}}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const i=this.media=this.mediaBuffer=t.media;i.removeEventListener("seeking",this.onMediaSeeking),i.removeEventListener("ended",this.onMediaEnded),i.addEventListener("seeking",this.onMediaSeeking),i.addEventListener("ended",this.onMediaEnded);const n=this.config;this.levels&&n.autoStartLoad&&this.state===ne.STOPPED&&this.startLoad(n.startPosition)}onMediaDetaching(e,t){const i=!!t.transferMedia,n=this.media;if(n!==null){if(n.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),n.removeEventListener("seeking",this.onMediaSeeking),n.removeEventListener("ended",this.onMediaEnded),this.keyLoader&&!i&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,i){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=ne.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,i){this.startFragRequested=!0,this._loadFragForPlayback(e,t,i)}_loadFragForPlayback(e,t,i){const n=l=>{const o=l.frag;if(this.fragContextChanged(o)){this.warn(`${o.type} sn: ${o.sn}${l.part?" part: "+l.part.index:""} of ${this.fragInfo(o,!1,l.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(o);return}o.stats.chunkCount++,this._handleFragmentLoadProgress(l)};this._doFragLoad(e,t,i,n).then(l=>{if(!l)return;const o=this.state,u=l.frag;if(this.fragContextChanged(u)){(o===ne.FRAG_LOADING||!this.fragCurrent&&o===ne.PARSING)&&(this.fragmentTracker.removeFragment(u),this.state=ne.IDLE);return}"payload"in l&&(this.log(`Loaded ${u.type} sn: ${u.sn} of ${this.playlistLabel()} ${u.level}`),this.hls.trigger(A.FRAG_LOADED,l)),this._handleFragmentLoadComplete(l)}).catch(l=>{this.state===ne.STOPPED||this.state===ne.ERROR||(this.warn(`Frag error: ${(l==null?void 0:l.message)||l}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:i}=this;if(i.getState(e)===gt.APPENDING){const l=e.type,o=this.getFwdBufferInfo(this.mediaBuffer,l),u=Math.max(e.duration,o?o.len:this.config.maxBufferLength),d=this.backtrackFragment;((d?e.sn-d.sn:0)===1||this.reduceMaxBufferLength(u,e.duration))&&i.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?i.removeAllFragments():i.hasParts(e.type)&&(i.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),i.getState(e)===gt.PARTIAL&&i.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(t==null?void 0:t.live)&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,i=null){if(!(e-t))return;const n={startOffset:e,endOffset:t,type:i};this.hls.trigger(A.BUFFER_FLUSHING,n)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(i=>{const n=i==null?void 0:i.frag;if(!n||this.fragContextChanged(n)||!this.levels)throw new Error("init load aborted");return i}).then(i=>{const{hls:n}=this,{frag:l,payload:o}=i,u=l.decryptdata;if(o&&o.byteLength>0&&u!=null&&u.key&&u.iv&&hr(u.method)){const d=self.performance.now();return this.decrypter.decrypt(new Uint8Array(o),u.key.buffer,u.iv.buffer,th(u.method)).catch(f=>{throw n.trigger(A.ERROR,{type:pe.MEDIA_ERROR,details:q.FRAG_DECRYPT_ERROR,fatal:!1,error:f,reason:f.message,frag:l}),f}).then(f=>{const m=self.performance.now();return n.trigger(A.FRAG_DECRYPTED,{frag:l,payload:f,stats:{tstart:d,tdecrypt:m}}),i.payload=f,this.completeInitSegmentLoad(i)})}return this.completeInitSegmentLoad(i)}).catch(i=>{this.state===ne.STOPPED||this.state===ne.ERROR||(this.warn(i),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const i=e.frag.stats;this.state!==ne.STOPPED&&(this.state=ne.IDLE),e.frag.data=new Uint8Array(e.payload),i.parsing.start=i.buffering.start=self.performance.now(),i.parsing.end=i.buffering.end=self.performance.now(),this.tick()}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const i=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${i?o2.toString(De.getBuffered(i)):"(detached)"})`),St(e)){var n;if(e.type!==ge.SUBTITLE){const o=e.elementaryStreams;if(!Object.keys(o).some(u=>!!o[u])){this.state=ne.IDLE;return}}const l=(n=this.levels)==null?void 0:n[e.level];l!=null&&l.fragmentError&&(this.log(`Resetting level fragment error count of ${l.fragmentError} on frag buffered`),l.fragmentError=0)}this.state=ne.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:i,part:n,partsLoaded:l}=e,o=!l||l.length===0||l.some(d=>!d),u=new eh(i.level,i.sn,i.stats.chunkCount+1,0,n?n.index:-1,!o);t.flush(u)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,i=null,n){var l;this.fragCurrent=e;const o=t==null?void 0:t.details;if(!this.levels||!o)throw new Error(`frag load aborted, missing level${o?"":" detail"}s`);let u=null;e.encrypted&&!((l=e.decryptdata)!=null&&l.key)?(this.log(`Loading key for ${e.sn} of [${o.startSN}-${o.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=ne.KEY_LOADING,this.fragCurrent=e,u=this.keyLoader.load(e).then(g=>{if(!this.fragContextChanged(g.frag))return this.hls.trigger(A.KEY_LOADED,g),this.state===ne.KEY_LOADING&&(this.state=ne.IDLE),g}),this.hls.trigger(A.KEY_LOADING,{frag:e}),this.fragCurrent===null&&(u=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):!e.encrypted&&o.encryptedFragments.length&&this.keyLoader.loadClear(e,o.encryptedFragments);const d=this.fragPrevious;if(St(e)&&(!d||e.sn!==d.sn)){const g=this.shouldLoadParts(t.details,e.end);g!==this.loadingParts&&(this.log(`LL-Part loading ${g?"ON":"OFF"} loading sn ${d==null?void 0:d.sn}->${e.sn}`),this.loadingParts=g)}if(i=Math.max(e.start,i||0),this.loadingParts&&St(e)){const g=o.partList;if(g&&n){i>e.end&&o.fragmentHint&&(e=o.fragmentHint);const v=this.getNextPart(g,e,i);if(v>-1){const E=g[v];e=this.fragCurrent=E.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${E.index} (${v}/${g.length-1}) of ${this.fragInfo(e,!1,E)}) cc: ${e.cc} [${o.startSN}-${o.endSN}], target: ${parseFloat(i.toFixed(3))}`),this.nextLoadPosition=E.start+E.duration,this.state=ne.FRAG_LOADING;let y;return u?y=u.then(S=>!S||this.fragContextChanged(S.frag)?null:this.doFragPartsLoad(e,E,t,n)).catch(S=>this.handleFragLoadError(S)):y=this.doFragPartsLoad(e,E,t,n).catch(S=>this.handleFragLoadError(S)),this.hls.trigger(A.FRAG_LOADING,{frag:e,part:E,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):y}else if(!e.url||this.loadedEndOfParts(g,i))return Promise.resolve(null)}}if(St(e)&&this.loadingParts)this.log(`LL-Part loading OFF after next part miss @${i.toFixed(2)}`),this.loadingParts=!1;else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${o?"["+o.startSN+"-"+o.endSN+"]":""}, target: ${parseFloat(i.toFixed(3))}`),de(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=ne.FRAG_LOADING;const f=this.config.progressive;let m;return f&&u?m=u.then(g=>!g||this.fragContextChanged(g==null?void 0:g.frag)?null:this.fragmentLoader.load(e,n)).catch(g=>this.handleFragLoadError(g)):m=Promise.all([this.fragmentLoader.load(e,f?n:void 0),u]).then(([g])=>(!f&&g&&n&&n(g),g)).catch(g=>this.handleFragLoadError(g)),this.hls.trigger(A.FRAG_LOADING,{frag:e,targetBufferTime:i}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):m}doFragPartsLoad(e,t,i,n){return new Promise((l,o)=>{var u;const d=[],f=(u=i.details)==null?void 0:u.partList,m=g=>{this.fragmentLoader.loadPart(e,g,n).then(v=>{d[g.index]=v;const E=v.part;this.hls.trigger(A.FRAG_LOADED,v);const y=Dy(i.details,e.sn,g.index+1)||Ox(f,e.sn,g.index+1);if(y)m(y);else return l({frag:e,part:E,partsLoaded:d})}).catch(o)};m(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;e.data&&t.details===q.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(A.ERROR,t)}else this.hls.trigger(A.ERROR,{type:pe.OTHER_ERROR,details:q.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==ne.PARSING){!this.fragCurrent&&this.state!==ne.STOPPED&&this.state!==ne.ERROR&&(this.state=ne.IDLE);return}const{frag:i,part:n,level:l}=t,o=self.performance.now();i.stats.parsing.end=o,n&&(n.stats.parsing.end=o);const u=this.getLevelDetails(),f=u&&i.sn>u.endSN||this.shouldLoadParts(u,i.end);f!==this.loadingParts&&(this.log(`LL-Part loading ${f?"ON":"OFF"} after parsing segment ending @${i.end.toFixed(2)}`),this.loadingParts=f),this.updateLevelTiming(i,n,l,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e!=null&&e.partList){var i;const l=e.partList[0],o=l.end+(((i=e.fragmentHint)==null?void 0:i.duration)||0);if(t>=o){var n;if((this.hls.hasEnoughToStart?((n=this.media)==null?void 0:n.currentTime)||this.lastCurrentTime:this.getLoadPosition())>l.start-l.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:i}=this,{level:n,sn:l,part:o}=e;if(!(t!=null&&t[n]))return this.warn(`Levels object was unset while buffering fragment ${l} of ${this.playlistLabel()} ${n}. The current chunk will not be buffered.`),null;const u=t[n],d=u.details,f=o>-1?Dy(d,l,o):null,m=f?f.fragment:Cx(d,l,i);return m?(i&&i!==m&&(m.stats=i.stats),{frag:m,part:f,level:u}):null}bufferFragmentData(e,t,i,n,l){var o;if(!e||this.state!==ne.PARSING)return;const{data1:u,data2:d}=e;let f=u;if(u&&d&&(f=hi(u,d)),!((o=f)!=null&&o.length))return;const m={type:e.type,frag:t,part:i,chunkMeta:n,parent:t.type,data:f};if(this.hls.trigger(A.BUFFER_APPENDING,m),e.dropped&&e.independent&&!i){if(l)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!De.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const i=t.currentTime,n=De.bufferInfo(t,i,0),l=e.duration,o=Math.min(this.config.maxFragLookUpTolerance*2,l*.25),u=Math.max(Math.min(e.start-o,n.end-o),i+o);e.start-u>o&&this.flushMainBuffer(u,e.start)}getFwdBufferInfo(e,t){var i;const n=this.getLoadPosition();if(!de(n))return null;const o=this.lastCurrentTime>n||(i=this.media)!=null&&i.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,n,t,o)}getFwdBufferInfoAtPos(e,t,i,n){const l=De.bufferInfo(e,t,n);if(l.len===0&&l.nextStart!==void 0){const o=this.fragmentTracker.getBufferedFrag(t,i);if(o&&(l.nextStart<=o.end||o.gap)){const u=Math.max(Math.min(l.nextStart,o.end)-t,n);return De.bufferInfo(e,t,u)}}return l}getMaxBufferLength(e){const{config:t}=this;let i;return e?i=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):i=t.maxBufferLength,Math.min(i,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const i=this.config,n=Math.max(Math.min(e-t,i.maxBufferLength),t),l=Math.max(e-t*3,i.maxMaxBufferLength/2,n);return l>=n?(i.maxMaxBufferLength=l,this.warn(`Reduce max buffer length to ${l}s`),!0):!1}getAppendedFrag(e,t=ge.MAIN){var i;const n=(i=this.fragmentTracker)==null?void 0:i.getAppendedFrag(e,t);return n&&"fragment"in n?n.fragment:n}getNextFragment(e,t){const i=t.fragments,n=i.length;if(!n)return null;const{config:l}=this,o=i[0].start,u=l.lowLatencyMode&&!!t.partList;let d=null;if(t.live){const g=l.initialLiveManifestSize;if(n<g)return this.warn(`Not enough fragments to start playback (have: ${n}, need: ${g})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<o){var f;u&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),d=this.getInitialLiveFragment(t,i);const v=this.hls.startPosition,E=this.hls.liveSyncPosition,y=d?(v!==-1&&v>=o?v:E)||d.start:e;this.log(`Setting startPosition to ${y} to match start frag at live edge. mainStart: ${v} liveSyncPosition: ${E} frag.start: ${(f=d)==null?void 0:f.start}`),this.startPosition=this.nextLoadPosition=y}}else e<=o&&(d=i[0]);if(!d){const g=this.loadingParts?t.partEnd:t.fragmentEnd;d=this.getFragmentAtPosition(e,g,t)}let m=this.filterReplacedPrimary(d,t);if(!m&&d){const g=d.sn-t.startSN;m=this.filterReplacedPrimary(i[g+1]||null,t)}return this.mapToInitFragWhenRequired(m)}isLoopLoading(e,t){const i=this.fragmentTracker.getState(e);return(i===gt.OK||i===gt.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,i,n,l){let o=null;if(e.gap&&(o=this.getNextFragment(this.nextLoadPosition,t),o&&!o.gap&&i.nextStart)){const u=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,i.nextStart,n,0);if(u!==null&&i.len+u.len>=l){const d=o.sn;return this.loopSn!==d&&(this.log(`buffer full after gaps in "${n}" playlist starting at sn: ${d}`),this.loopSn=d),null}}return this.loopSn=void 0,o}get primaryPrefetch(){if(Iy(this.hls.config)){var e,t;if((e=this.hls.interstitialsManager)==null||(t=e.playingItem)==null?void 0:t.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(Iy(this.hls.config)&&e.type!==ge.SUBTITLE){const i=this.hls.interstitialsManager,n=i==null?void 0:i.bufferingItem;if(n){const o=n.event;if(o){if(o.appendInPlace||Math.abs(e.start-n.start)>1||n.start===0)return null}else if(e.end<=n.start&&(t==null?void 0:t.live)===!1||e.start>n.end&&n.nextEvent&&(n.nextEvent.appendInPlace||e.start-n.end>1))return null}const l=i==null?void 0:i.playerQueue;if(l)for(let o=l.length;o--;){const u=l[o].interstitial;if(u.appendInPlace&&e.start>=u.startTime&&e.end<=u.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!(e!=null&&e.initSegment.data)&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,i){let n=-1,l=!1,o=!0;for(let u=0,d=e.length;u<d;u++){const f=e[u];if(o=o&&!f.independent,n>-1&&i<f.start)break;const m=f.loaded;m?n=-1:(l||f.independent||o)&&f.fragment===t&&(n=u),l=m}return n}loadedEndOfParts(e,t){const i=e[e.length-1];return i&&t>i.start&&i.loaded}getInitialLiveFragment(e,t){const i=this.fragPrevious;let n=null;if(i){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${i.programDateTime}`),n=bL(t,i.endProgramDateTime,this.config.maxFragLookUpTolerance)),!n){const l=i.sn+1;if(l>=e.startSN&&l<=e.endSN){const o=t[l-e.startSN];i.cc===o.cc&&(n=o,this.log(`Live playlist, switching playlist, load frag with next SN: ${n.sn}`))}n||(n=Sx(t,i.cc),n&&this.log(`Live playlist, switching playlist, load frag with same CC: ${n.sn}`))}}else{const l=this.hls.liveSyncPosition;l!==null&&(n=this.getFragmentAtPosition(l,this.bitrateTest?e.fragmentEnd:e.edge,e))}return n}getFragmentAtPosition(e,t,i){const{config:n}=this;let{fragPrevious:l}=this,{fragments:o,endSN:u}=i;const{fragmentHint:d}=i,{maxFragLookUpTolerance:f}=n,m=i.partList,g=!!(this.loadingParts&&m!=null&&m.length&&d);g&&d&&!this.bitrateTest&&m[m.length-1].fragment.sn===d.sn&&(o=o.concat(d),u=d.sn);let v;if(e<t){var E;const S=e<this.lastCurrentTime||e>t-f||(E=this.media)!=null&&E.paused||!this.startFragRequested?0:f;v=En(l,o,e,S)}else v=o[o.length-1];if(v){const y=v.sn-i.startSN,S=this.fragmentTracker.getState(v);if((S===gt.OK||S===gt.PARTIAL&&v.gap)&&(l=v),l&&v.sn===l.sn&&(!g||m[0].fragment.sn>v.sn||!i.live&&!g)&&l&&v.level===l.level){const R=o[y+1];v.sn<u&&this.fragmentTracker.getState(R)!==gt.OK?v=R:v=null}}return v}alignPlaylists(e,t,i){const n=e.fragments.length;if(!n)return this.warn("No fragments in live playlist"),0;const l=e.fragmentStart,o=!t,u=e.alignedSliding&&de(l);if(o||!u&&!l){l2(i,e);const d=e.fragmentStart;return this.log(`Live playlist sliding: ${d.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${n}`),d}return l}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let i=this.startPosition;i<t&&(i=-1);const n=this.timelineOffset;if(i===-1){const l=this.startTimeOffset!==null,o=l?this.startTimeOffset:e.startTimeOffset;o!==null&&de(o)?(i=t+o,o<0&&(i+=e.edge),i=Math.min(Math.max(t,i),t+e.totalduration),this.log(`Setting startPosition to ${i} for start time offset ${o} found in ${l?"multivariant":"media"} playlist`),this.startPosition=i):e.live?(i=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${i}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=i=0),this.lastCurrentTime=i+n}this.nextLoadPosition=i+n}getLoadPosition(){var e;const{media:t}=this;let i=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?i=t.currentTime:this.nextLoadPosition>=0&&(i=this.nextLoadPosition),i}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&St(e)&&e.stats.aborted&&(this.warn(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==ne.FRAG_LOADING_WAITING_RETRY)&&(this.state=ne.IDLE)}onFragmentOrKeyLoadError(e,t){if(t.chunkMeta&&!t.frag){const y=this.getCurrentContext(t.chunkMeta);y&&(t.frag=y.frag)}const i=t.frag;if(!i||i.type!==e||!this.levels)return;if(this.fragContextChanged(i)){var n;this.warn(`Frag load error must match current frag to retry ${i.url} > ${(n=this.fragCurrent)==null?void 0:n.url}`);return}const l=t.details===q.FRAG_GAP;l&&this.fragmentTracker.fragBuffered(i,!0);const o=t.errorAction,{action:u,flags:d,retryCount:f=0,retryConfig:m}=o||{},g=!!o&&!!m,v=g&&u===It.RetryRequest,E=g&&!o.resolved&&d===Ei.MoveAllAlternatesMatchingHost;if(!v&&E&&St(i)&&!i.endList)this.resetFragmentErrors(e),this.treatAsGap(i),o.resolved=!0;else if((v||E)&&f<m.maxNumRetry){this.resetStartWhenNotLoaded(this.levelLastLoaded);const y=Zd(m,f);this.warn(`Fragment ${i.sn} of ${e} ${i.level} errored with ${t.details}, retrying loading ${f+1}/${m.maxNumRetry} in ${y}ms`),o.resolved=!0,this.retryDate=self.performance.now()+y,this.state=ne.FRAG_LOADING_WAITING_RETRY}else if(m&&o)if(this.resetFragmentErrors(e),f<m.maxNumRetry)!l&&u!==It.RemoveAlternatePermanently&&(o.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${f})`);return}else u===It.SendAlternateToPenaltyBox?this.state=ne.WAITING_LEVEL:this.state=ne.ERROR;this.tickImmediate()}reduceLengthAndFlushBuffer(e){if(this.state===ne.PARSING||this.state===ne.PARSED){const t=e.frag,i=e.parent,n=this.getFwdBufferInfo(this.mediaBuffer,i),l=n&&n.len>.5;l&&this.reduceMaxBufferLength(n.len,(t==null?void 0:t.duration)||10);const o=!l;return o&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${i} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),o}return!1}resetFragmentErrors(e){e===ge.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==ne.STOPPED&&(this.state=ne.IDLE)}afterBufferFlushed(e,t,i){if(!e)return;const n=De.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,n,i),this.state===ne.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==ne.STOPPED&&(this.state=ne.IDLE)}resetStartWhenNotLoaded(e){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.warn(`The loading context changed while buffering fragment ${e.sn} of ${this.playlistLabel()} ${e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,i,n){const l=i.details;if(!l){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((d,f)=>{const m=e.elementaryStreams[f];if(m){const g=m.endPTS-m.startPTS;if(g<=0)return this.warn(`Could not parse fragment ${e.sn} ${f} duration reliably (${g})`),d||!1;const v=n?0:Dx(l,e,m.startPTS,m.endPTS,m.startDTS,m.endDTS);return this.hls.trigger(A.LEVEL_PTS_UPDATED,{details:l,level:i,drift:v,type:f,frag:e,start:m.startPTS,end:m.endPTS}),!0}return d},!1)){var u;if(i.fragmentError===0&&this.treatAsGap(e,i),((u=this.transmuxer)==null?void 0:u.error)===null){const d=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(d.message),this.hls.trigger(A.ERROR,{type:pe.MEDIA_ERROR,details:q.FRAG_PARSING_ERROR,fatal:!1,error:d,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${i.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=ne.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(A.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===ge.MAIN?"level":"track"}fragInfo(e,t=!0,i){var n,l;return`${this.playlistLabel()} ${e.level} (${i?"part":"frag"}:[${((n=t&&!i?e.startPTS:(i||e).start)!=null?n:NaN).toFixed(3)}-${((l=t&&!i?e.endPTS:(i||e).end)!=null?l:NaN).toFixed(3)}]${i&&e.type==="main"?"INDEPENDENT="+(i.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function Iy(r){return!!r.interstitialsController&&r.enableInterstitialPlayback!==!1}class Px{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let i;if(e.length)e.length===1?i=e[0]:i=c2(e,t);else return new Uint8Array(0);return this.reset(),i}reset(){this.chunks.length=0,this.dataLength=0}}function c2(r,e){const t=new Uint8Array(e);let i=0;for(let n=0;n<r.length;n++){const l=r[n];t.set(l,i),i+=l.length}return t}var Kf={exports:{}},Cy;function u2(){return Cy||(Cy=1,function(r){var e=Object.prototype.hasOwnProperty,t="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(t=!1));function n(d,f,m){this.fn=d,this.context=f,this.once=m||!1}function l(d,f,m,g,v){if(typeof m!="function")throw new TypeError("The listener must be a function");var E=new n(m,g||d,v),y=t?t+f:f;return d._events[y]?d._events[y].fn?d._events[y]=[d._events[y],E]:d._events[y].push(E):(d._events[y]=E,d._eventsCount++),d}function o(d,f){--d._eventsCount===0?d._events=new i:delete d._events[f]}function u(){this._events=new i,this._eventsCount=0}u.prototype.eventNames=function(){var f=[],m,g;if(this._eventsCount===0)return f;for(g in m=this._events)e.call(m,g)&&f.push(t?g.slice(1):g);return Object.getOwnPropertySymbols?f.concat(Object.getOwnPropertySymbols(m)):f},u.prototype.listeners=function(f){var m=t?t+f:f,g=this._events[m];if(!g)return[];if(g.fn)return[g.fn];for(var v=0,E=g.length,y=new Array(E);v<E;v++)y[v]=g[v].fn;return y},u.prototype.listenerCount=function(f){var m=t?t+f:f,g=this._events[m];return g?g.fn?1:g.length:0},u.prototype.emit=function(f,m,g,v,E,y){var S=t?t+f:f;if(!this._events[S])return!1;var T=this._events[S],R=arguments.length,D,_;if(T.fn){switch(T.once&&this.removeListener(f,T.fn,void 0,!0),R){case 1:return T.fn.call(T.context),!0;case 2:return T.fn.call(T.context,m),!0;case 3:return T.fn.call(T.context,m,g),!0;case 4:return T.fn.call(T.context,m,g,v),!0;case 5:return T.fn.call(T.context,m,g,v,E),!0;case 6:return T.fn.call(T.context,m,g,v,E,y),!0}for(_=1,D=new Array(R-1);_<R;_++)D[_-1]=arguments[_];T.fn.apply(T.context,D)}else{var O=T.length,C;for(_=0;_<O;_++)switch(T[_].once&&this.removeListener(f,T[_].fn,void 0,!0),R){case 1:T[_].fn.call(T[_].context);break;case 2:T[_].fn.call(T[_].context,m);break;case 3:T[_].fn.call(T[_].context,m,g);break;case 4:T[_].fn.call(T[_].context,m,g,v);break;default:if(!D)for(C=1,D=new Array(R-1);C<R;C++)D[C-1]=arguments[C];T[_].fn.apply(T[_].context,D)}}return!0},u.prototype.on=function(f,m,g){return l(this,f,m,g,!1)},u.prototype.once=function(f,m,g){return l(this,f,m,g,!0)},u.prototype.removeListener=function(f,m,g,v){var E=t?t+f:f;if(!this._events[E])return this;if(!m)return o(this,E),this;var y=this._events[E];if(y.fn)y.fn===m&&(!v||y.once)&&(!g||y.context===g)&&o(this,E);else{for(var S=0,T=[],R=y.length;S<R;S++)(y[S].fn!==m||v&&!y[S].once||g&&y[S].context!==g)&&T.push(y[S]);T.length?this._events[E]=T.length===1?T[0]:T:o(this,E)}return this},u.prototype.removeAllListeners=function(f){var m;return f?(m=t?t+f:f,this._events[m]&&o(this,m)):(this._events=new i,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=t,u.EventEmitter=u,r.exports=u}(Kf)),Kf.exports}var f2=u2(),nh=FR(f2);const Ba="1.6.2",yr={};function d2(){return typeof __HLS_WORKER_BUNDLE__=="function"}function h2(){const r=yr[Ba];if(r)return r.clientCount++,r;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),n={worker:new self.Worker(t),objectURL:t,clientCount:1};return yr[Ba]=n,n}function m2(r){const e=yr[r];if(e)return e.clientCount++,e;const t=new self.URL(r,self.location.href).href,n={worker:new self.Worker(t),scriptURL:t,clientCount:1};return yr[r]=n,n}function g2(r){const e=yr[r||Ba];if(e&&e.clientCount--===1){const{worker:i,objectURL:n}=e;delete yr[r||Ba],n&&self.URL.revokeObjectURL(n),i.terminate()}}function Ux(r,e){return e+10<=r.length&&r[e]===51&&r[e+1]===68&&r[e+2]===73&&r[e+3]<255&&r[e+4]<255&&r[e+6]<128&&r[e+7]<128&&r[e+8]<128&&r[e+9]<128}function rh(r,e){return e+10<=r.length&&r[e]===73&&r[e+1]===68&&r[e+2]===51&&r[e+3]<255&&r[e+4]<255&&r[e+6]<128&&r[e+7]<128&&r[e+8]<128&&r[e+9]<128}function dc(r,e){let t=0;return t=(r[e]&127)<<21,t|=(r[e+1]&127)<<14,t|=(r[e+2]&127)<<7,t|=r[e+3]&127,t}function Fa(r,e){const t=e;let i=0;for(;rh(r,e);){i+=10;const n=dc(r,e+6);i+=n,Ux(r,e+10)&&(i+=10),e+=i}if(i>0)return r.subarray(t,t+i)}function p2(r,e,t,i){const n=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],l=e[t+2],o=l>>2&15;if(o>12){const E=new Error(`invalid ADTS sampling index:${o}`);r.emit(A.ERROR,A.ERROR,{type:pe.MEDIA_ERROR,details:q.FRAG_PARSING_ERROR,fatal:!0,error:E,reason:E.message});return}const u=(l>>6&3)+1,d=e[t+3]>>6&3|(l&1)<<2,f="mp4a.40."+u,m=n[o];let g=o;(u===5||u===29)&&(g-=3);const v=[u<<3|(g&14)>>1,(g&1)<<7|d<<3];return Me.log(`manifest codec:${i}, parsed codec:${f}, channels:${d}, rate:${m} (ADTS object type:${u} sampling index:${o})`),{config:v,samplerate:m,channelCount:d,codec:f,parsedCodec:f,manifestCodec:i}}function Bx(r,e){return r[e]===255&&(r[e+1]&246)===240}function Fx(r,e){return r[e+1]&1?7:9}function ah(r,e){return(r[e+3]&3)<<11|r[e+4]<<3|(r[e+5]&224)>>>5}function y2(r,e){return e+5<r.length}function ec(r,e){return e+1<r.length&&Bx(r,e)}function v2(r,e){return y2(r,e)&&Bx(r,e)&&ah(r,e)<=r.length-e}function x2(r,e){if(ec(r,e)){const t=Fx(r,e);if(e+t>=r.length)return!1;const i=ah(r,e);if(i<=t)return!1;const n=e+i;return n===r.length||ec(r,n)}return!1}function jx(r,e,t,i,n){if(!r.samplerate){const l=p2(e,t,i,n);if(!l)return;Ke(r,l)}}function $x(r){return 1024*9e4/r}function E2(r,e){const t=Fx(r,e);if(e+t<=r.length){const i=ah(r,e)-t;if(i>0)return{headerLength:t,frameLength:i}}}function Gx(r,e,t,i,n){const l=$x(r.samplerate),o=i+n*l,u=E2(e,t);let d;if(u){const{frameLength:g,headerLength:v}=u,E=v+g,y=Math.max(0,t+E-e.length);y?(d=new Uint8Array(E-v),d.set(e.subarray(t+v,e.length),0)):d=e.subarray(t+v,t+E);const S={unit:d,pts:o};return y||r.samples.push(S),{sample:S,length:E,missing:y}}const f=e.length-t;return d=new Uint8Array(f),d.set(e.subarray(t,e.length),0),{sample:{unit:d,pts:o},length:f,missing:-1}}function S2(r,e){return rh(r,e)&&dc(r,e+6)+10<=r.length-e}function T2(r){if(r.size<2)return;const e=ti(r.data,!0),t=new Uint8Array(r.data.subarray(e.length+1));return{key:r.type,info:e,data:t.buffer}}function b2(r){if(r.size<2)return;if(r.type==="TXXX"){let t=1;const i=ti(r.data.subarray(t),!0);t+=i.length+1;const n=ti(r.data.subarray(t));return{key:r.type,info:i,data:n}}const e=ti(r.data.subarray(1));return{key:r.type,info:"",data:e}}function A2(r){if(r.type==="WXXX"){if(r.size<2)return;let t=1;const i=ti(r.data.subarray(t),!0);t+=i.length+1;const n=ti(r.data.subarray(t));return{key:r.type,info:i,data:n}}const e=ti(r.data);return{key:r.type,info:"",data:e}}function R2(r){return btoa(String.fromCharCode(...r))}function Hx(r,e){if(r<0)return-Hx(-r,e);const t=Math.pow(10,e);if(Math.abs(r*t%1-.5)<Number.EPSILON){const n=Math.floor(r*t);return(n%2===0?n:n+1)/t}else return Math.round(r*t)/t}function L2(r,e){const t=new URL(r),i=new URL(e);if(t.origin!==i.origin)return r;const n=t.pathname.split("/").slice(1),l=i.pathname.split("/").slice(1,-1);for(;n[0]===l[0];)n.shift(),l.shift();for(;l.length;)l.shift(),n.unshift("..");return n.join("/")}function _2(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const l=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(n=="x"?l:l&3|8).toString(16)})}}}function D2(r){return r instanceof ArrayBuffer?r:r.byteOffset==0&&r.byteLength==r.buffer.byteLength?r.buffer:new Uint8Array(r).buffer}function Yf(r,e=0,t=1/0){return w2(r,e,t,Uint8Array)}function w2(r,e,t,i){const n=I2(r);let l=1;"BYTES_PER_ELEMENT"in i&&(l=i.BYTES_PER_ELEMENT);const o=C2(r)?r.byteOffset:0,u=(o+r.byteLength)/l,d=(o+e)/l,f=Math.floor(Math.max(0,Math.min(d,u))),m=Math.floor(Math.min(f+Math.max(t,0),u));return new i(n,f,m-f)}function I2(r){return r instanceof ArrayBuffer?r:r.buffer}function C2(r){return r&&r.buffer instanceof ArrayBuffer&&r.byteLength!==void 0&&r.byteOffset!==void 0}function O2(r){const e={key:r.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(r.size<2)return;if(r.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const i=r.data.subarray(1).indexOf(0);if(i===-1)return;const n=ti(Yf(r.data,1,i)),l=r.data[2+i],o=r.data.subarray(3+i).indexOf(0);if(o===-1)return;const u=ti(Yf(r.data,3+i,o));let d;return n==="-->"?d=ti(Yf(r.data,4+i+o)):d=D2(r.data.subarray(4+i+o)),e.mimeType=n,e.pictureType=l,e.description=u,e.data=d,e}function N2(r){return r.type==="PRIV"?T2(r):r.type[0]==="W"?A2(r):r.type==="APIC"?O2(r):b2(r)}function k2(r){const e=String.fromCharCode(r[0],r[1],r[2],r[3]),t=dc(r,4),i=10;return{type:e,size:t,data:r.subarray(i,i+t)}}const yo=10,M2=10;function Vx(r){let e=0;const t=[];for(;rh(r,e);){const i=dc(r,e+6);r[e+5]>>6&1&&(e+=yo),e+=yo;const n=e+i;for(;e+M2<n;){const l=k2(r.subarray(e)),o=N2(l);o&&t.push(o),e+=l.size+yo}Ux(r,e)&&(e+=yo)}return t}function zx(r){return r&&r.key==="PRIV"&&r.info==="com.apple.streaming.transportStreamTimestamp"}function P2(r){if(r.data.byteLength===8){const e=new Uint8Array(r.data),t=e[3]&1;let i=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return i/=45,t&&(i+=4772185884e-2),Math.round(i)}}function lh(r){const e=Vx(r);for(let t=0;t<e.length;t++){const i=e[t];if(zx(i))return P2(i)}}let ei=function(r){return r.audioId3="org.id3",r.dateRange="com.apple.quicktime.HLS",r.emsg="https://aomedia.org/emsg/ID3",r.misbklv="urn:misb:KLV:bin:1910.1",r}({});function Ui(r="",e=9e4){return{type:r,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class oh{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,i,n){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,i){}demux(e,t){this.cachedData&&(e=hi(this.cachedData,e),this.cachedData=null);let i=Fa(e,0),n=i?i.length:0,l;const o=this._audioTrack,u=this._id3Track,d=i?lh(i):void 0,f=e.length;for((this.basePTS===null||this.frameIndex===0&&de(d))&&(this.basePTS=U2(d,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),i&&i.length>0&&u.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:ei.audioId3,duration:Number.POSITIVE_INFINITY});n<f;){if(this.canParse(e,n)){const m=this.appendFrame(o,e,n);m?(this.frameIndex++,this.lastPTS=m.sample.pts,n+=m.length,l=n):n=f}else S2(e,n)?(i=Fa(e,n),u.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:i,type:ei.audioId3,duration:Number.POSITIVE_INFINITY}),n+=i.length,l=n):n++;if(n===f&&l!==f){const m=e.slice(l);this.cachedData?this.cachedData=hi(this.cachedData,m):this.cachedData=m}}return{audioTrack:o,videoTrack:Ui(),id3Track:u,textTrack:Ui()}}demuxSampleAes(e,t,i){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Ui(),id3Track:this._id3Track,textTrack:Ui()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const U2=(r,e,t)=>{if(de(r))return r*90;const i=t?t.baseTime*9e4/t.timescale:0;return e*9e4+i};let vo=null;const B2=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],F2=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],j2=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],$2=[0,1,1,4];function Kx(r,e,t,i,n){if(t+24>e.length)return;const l=Yx(e,t);if(l&&t+l.frameLength<=e.length){const o=l.samplesPerFrame*9e4/l.sampleRate,u=i+n*o,d={unit:e.subarray(t,t+l.frameLength),pts:u,dts:u};return r.config=[],r.channelCount=l.channelCount,r.samplerate=l.sampleRate,r.samples.push(d),{sample:d,length:l.frameLength,missing:0}}}function Yx(r,e){const t=r[e+1]>>3&3,i=r[e+1]>>1&3,n=r[e+2]>>4&15,l=r[e+2]>>2&3;if(t!==1&&n!==0&&n!==15&&l!==3){const o=r[e+2]>>1&1,u=r[e+3]>>6,d=t===3?3-i:i===3?3:4,f=B2[d*14+n-1]*1e3,g=F2[(t===3?0:t===2?1:2)*3+l],v=u===3?1:2,E=j2[t][i],y=$2[i],S=E*8*y,T=Math.floor(E*f/g+o)*y;if(vo===null){const _=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);vo=_?parseInt(_[1]):0}return!!vo&&vo<=87&&i===2&&f>=224e3&&u===0&&(r[e+3]=r[e+3]|128),{sampleRate:g,channelCount:v,frameLength:T,samplesPerFrame:S}}}function ch(r,e){return r[e]===255&&(r[e+1]&224)===224&&(r[e+1]&6)!==0}function qx(r,e){return e+1<r.length&&ch(r,e)}function G2(r,e){return ch(r,e)&&4<=r.length-e}function Xx(r,e){if(e+1<r.length&&ch(r,e)){const i=Yx(r,e);let n=4;i!=null&&i.frameLength&&(n=i.frameLength);const l=e+n;return l===r.length||qx(r,l)}return!1}class H2 extends oh{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,i,n){super.resetInitSegment(e,t,i,n),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:n,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const i=Fa(e,0);let n=(i==null?void 0:i.length)||0;if(Xx(e,n))return!1;for(let l=e.length;n<l;n++)if(x2(e,n))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return v2(e,t)}appendFrame(e,t,i){jx(e,this.observer,t,i,e.manifestCodec);const n=Gx(e,t,i,this.basePTS,this.frameIndex);if(n&&n.missing===0)return n}}const Qx=(r,e)=>{let t=0,i=5;e+=i;const n=new Uint32Array(1),l=new Uint32Array(1),o=new Uint8Array(1);for(;i>0;){o[0]=r[e];const u=Math.min(i,8),d=8-u;l[0]=4278190080>>>24+d<<d,n[0]=(o[0]&l[0])>>d,t=t?t<<u|n[0]:n[0],e+=1,i-=u}return t};class V2 extends oh{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,i,n){super.resetInitSegment(e,t,i,n),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:n,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,i){const n=Wx(e,t,i,this.basePTS,this.frameIndex);if(n!==-1)return{sample:e.samples[e.samples.length-1],length:n,missing:0}}static probe(e){if(!e)return!1;const t=Fa(e,0);if(!t)return!1;const i=t.length;return e[i]===11&&e[i+1]===119&&lh(t)!==void 0&&Qx(e,i)<16}}function Wx(r,e,t,i,n){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const l=e[t+4]>>6;if(l>=3)return-1;const u=[48e3,44100,32e3][l],d=e[t+4]&63,m=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][d*3+l]*2;if(t+m>e.length)return-1;const g=e[t+6]>>5;let v=0;g===2?v+=2:(g&1&&g!==1&&(v+=2),g&4&&(v+=2));const E=(e[t+6]<<8|e[t+7])>>12-v&1,S=[2,1,2,3,3,4,4,5][g]+E,T=e[t+5]>>3,R=e[t+5]&7,D=new Uint8Array([l<<6|T<<1|R>>2,(R&3)<<6|g<<3|E<<2|d>>4,d<<4&224]),_=1536/u*9e4,O=i+n*_,C=e.subarray(t,t+m);return r.config=D,r.channelCount=S,r.samplerate=u,r.samples.push({unit:C,pts:O}),m}class z2 extends oh{resetInitSegment(e,t,i,n){super.resetInitSegment(e,t,i,n),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:n,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=Fa(e,0);let i=(t==null?void 0:t.length)||0;if(t&&e[i]===11&&e[i+1]===119&&lh(t)!==void 0&&Qx(e,i)<=16)return!1;for(let n=e.length;i<n;i++)if(Xx(e,i))return Me.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return G2(e,t)}appendFrame(e,t,i){if(this.basePTS!==null)return Kx(e,t,i,this.basePTS,this.frameIndex)}}const K2=/\/emsg[-/]ID3/i;class Y2{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,i,n){const l=this.videoTrack=Ui("video",1),o=this.audioTrack=Ui("audio",1),u=this.txtTrack=Ui("text",1);if(this.id3Track=Ui("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const d=ux(e);if(d.video){const{id:f,timescale:m,codec:g,supplemental:v}=d.video;l.id=f,l.timescale=u.timescale=m,l.codec=g,l.supplemental=v}if(d.audio){const{id:f,timescale:m,codec:g}=d.audio;o.id=f,o.timescale=m,o.codec=g}u.id=lx.text,l.sampleDuration=0,l.duration=o.duration=n}resetContiguity(){this.remainderData=null}static probe(e){return VR(e)}demux(e,t){this.timeOffset=t;let i=e;const n=this.videoTrack,l=this.txtTrack;if(this.config.progressive){this.remainderData&&(i=hi(this.remainderData,e));const u=ZR(i);this.remainderData=u.remainder,n.samples=u.valid||new Uint8Array}else n.samples=i;const o=this.extractID3Track(n,t);return l.samples=Zp(t,n),{videoTrack:n,audioTrack:this.audioTrack,id3Track:o,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,i=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const n=this.extractID3Track(t,this.timeOffset);return i.samples=Zp(e,t),{videoTrack:t,audioTrack:Ui(),id3Track:n,textTrack:Ui()}}extractID3Track(e,t){const i=this.id3Track;if(e.samples.length){const n=be(e.samples,["emsg"]);n&&n.forEach(l=>{const o=eL(l);if(K2.test(o.schemeIdUri)){const u=Oy(o,t);let d=o.eventDuration===4294967295?Number.POSITIVE_INFINITY:o.eventDuration/o.timeScale;d<=.001&&(d=Number.POSITIVE_INFINITY);const f=o.payload;i.samples.push({data:f,len:f.byteLength,dts:u,pts:u,type:ei.emsg,duration:d})}else if(this.config.enableEmsgKLVMetadata&&o.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const u=Oy(o,t);i.samples.push({data:o.payload,len:o.payload.byteLength,dts:u,pts:u,type:ei.misbklv,duration:Number.POSITIVE_INFINITY})}})}return i}demuxSampleAes(e,t,i){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function Oy(r,e){return de(r.presentationTime)?r.presentationTime/r.timeScale:e+r.presentationTimeDelta/r.timeScale}class q2{constructor(e,t,i){this.keyData=void 0,this.decrypter=void 0,this.keyData=i,this.decrypter=new Jd(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,Vs.cbc)}decryptAacSample(e,t,i){const n=e[t].unit;if(n.length<=16)return;const l=n.subarray(16,n.length-n.length%16),o=l.buffer.slice(l.byteOffset,l.byteOffset+l.length);this.decryptBuffer(o).then(u=>{const d=new Uint8Array(u);n.set(d,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,i)})}decryptAacSamples(e,t,i){for(;;t++){if(t>=e.length){i();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,i),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,i=new Int8Array(t);let n=0;for(let l=32;l<e.length-16;l+=160,n+=16)i.set(e.subarray(l,l+16),n);return i}getAvcDecryptedUnit(e,t){const i=new Uint8Array(t);let n=0;for(let l=32;l<e.length-16;l+=160,n+=16)e.set(i.subarray(n,n+16),l);return e}decryptAvcSample(e,t,i,n,l){const o=dx(l.data),u=this.getAvcEncryptedData(o);this.decryptBuffer(u.buffer).then(d=>{l.data=this.getAvcDecryptedUnit(o,d),this.decrypter.isSync()||this.decryptAvcSamples(e,t,i+1,n)})}decryptAvcSamples(e,t,i,n){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,i=0){if(t>=e.length){n();return}const l=e[t].units;for(;!(i>=l.length);i++){const o=l[i];if(!(o.data.length<=48||o.type!==1&&o.type!==5)&&(this.decryptAvcSample(e,t,i,n,o),!this.decrypter.isSync()))return}}}}class Zx{constructor(){this.VideoSample=null}createVideoSample(e,t,i){return{key:e,frame:!1,pts:t,dts:i,units:[],length:0}}getLastNalUnit(e){var t;let i=this.VideoSample,n;if((!i||i.units.length===0)&&(i=e[e.length-1]),(t=i)!=null&&t.units){const l=i.units;n=l[l.length-1]}return n}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const i=t.samples,n=i.length;if(n){const l=i[n-1];e.pts=l.pts,e.dts=l.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,i){const n=t.byteLength;let l=e.naluState||0;const o=l,u=[];let d=0,f,m,g,v=-1,E=0;for(l===-1&&(v=0,E=this.getNALuType(t,0),l=0,d=1);d<n;){if(f=t[d++],!l){l=f?0:1;continue}if(l===1){l=f?0:2;continue}if(!f)l=3;else if(f===1){if(m=d-l-1,v>=0){const y={data:t.subarray(v,m),type:E};u.push(y)}else{const y=this.getLastNalUnit(e.samples);y&&(o&&d<=4-o&&y.state&&(y.data=y.data.subarray(0,y.data.byteLength-o)),m>0&&(y.data=hi(y.data,t.subarray(0,m)),y.state=0))}d<n?(g=this.getNALuType(t,d),v=d,E=g,l=0):l=-1}else l=0}if(v>=0&&l>=0){const y={data:t.subarray(v,n),type:E,state:l};u.push(y)}if(u.length===0){const y=this.getLastNalUnit(e.samples);y&&(y.data=hi(y.data,t))}return e.naluState=l,u}}class Ia{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,i=e.byteLength-t,n=new Uint8Array(4),l=Math.min(4,t);if(l===0)throw new Error("no bytes available");n.set(e.subarray(i,i+l)),this.word=new DataView(n.buffer).getUint32(0),this.bitsAvailable=l*8,this.bytesAvailable-=l}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const i=this.word>>>32-t;if(e>32&&Me.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?i<<t|this.readBits(t):i}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if((this.word&2147483648>>>e)!==0)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class Ny extends Zx{parsePES(e,t,i,n){const l=this.parseNALu(e,i.data,n);let o=this.VideoSample,u,d=!1;i.data=null,o&&l.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),l.forEach(f=>{var m,g;switch(f.type){case 1:{let S=!1;u=!0;const T=f.data;if(d&&T.length>4){const R=this.readSliceType(T);(R===2||R===4||R===7||R===9)&&(S=!0)}if(S){var v;(v=o)!=null&&v.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.frame=!0,o.key=S;break}case 5:u=!0,(m=o)!=null&&m.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.key=!0,o.frame=!0;break;case 6:{u=!0,Qd(f.data,1,i.pts,t.samples);break}case 7:{var E,y;u=!0,d=!0;const S=f.data,T=this.readSPS(S);if(!e.sps||e.width!==T.width||e.height!==T.height||((E=e.pixelRatio)==null?void 0:E[0])!==T.pixelRatio[0]||((y=e.pixelRatio)==null?void 0:y[1])!==T.pixelRatio[1]){e.width=T.width,e.height=T.height,e.pixelRatio=T.pixelRatio,e.sps=[S];const R=S.subarray(1,4);let D="avc1.";for(let _=0;_<3;_++){let O=R[_].toString(16);O.length<2&&(O="0"+O),D+=O}e.codec=D}break}case 8:u=!0,e.pps=[f.data];break;case 9:u=!0,e.audFound=!0,(g=o)!=null&&g.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts));break;case 12:u=!0;break;default:u=!1;break}o&&u&&o.units.push(f)}),n&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new Ia(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let i=8,n=8,l;for(let o=0;o<e;o++)n!==0&&(l=t.readEG(),n=(i+l+256)%256),i=n===0?i:n}readSPS(e){const t=new Ia(e);let i=0,n=0,l=0,o=0,u,d,f;const m=t.readUByte.bind(t),g=t.readBits.bind(t),v=t.readUEG.bind(t),E=t.readBoolean.bind(t),y=t.skipBits.bind(t),S=t.skipEG.bind(t),T=t.skipUEG.bind(t),R=this.skipScalingList.bind(this);m();const D=m();if(g(5),y(3),m(),T(),D===100||D===110||D===122||D===244||D===44||D===83||D===86||D===118||D===128){const F=v();if(F===3&&y(1),T(),T(),y(1),E())for(d=F!==3?8:12,f=0;f<d;f++)E()&&(f<6?R(16,t):R(64,t))}T();const _=v();if(_===0)v();else if(_===1)for(y(1),S(),S(),u=v(),f=0;f<u;f++)S();T(),y(1);const O=v(),C=v(),B=g(1);B===0&&y(1),y(1),E()&&(i=v(),n=v(),l=v(),o=v());let N=[1,1];if(E()&&E())switch(m()){case 1:N=[1,1];break;case 2:N=[12,11];break;case 3:N=[10,11];break;case 4:N=[16,11];break;case 5:N=[40,33];break;case 6:N=[24,11];break;case 7:N=[20,11];break;case 8:N=[32,11];break;case 9:N=[80,33];break;case 10:N=[18,11];break;case 11:N=[15,11];break;case 12:N=[64,33];break;case 13:N=[160,99];break;case 14:N=[4,3];break;case 15:N=[3,2];break;case 16:N=[2,1];break;case 255:{N=[m()<<8|m(),m()<<8|m()];break}}return{width:Math.ceil((O+1)*16-i*2-n*2),height:(2-B)*(C+1)*16-(B?2:4)*(l+o),pixelRatio:N}}}class ky extends Zx{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,i,n){const l=this.parseNALu(e,i.data,n);let o=this.VideoSample,u,d=!1;i.data=null,o&&l.length&&!e.audFound&&(this.pushAccessUnit(o,e),o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),l.forEach(f=>{var m,g;switch(f.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:o||(o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts)),o.frame=!0,u=!0;break;case 16:case 17:case 18:case 21:if(u=!0,d){var v;(v=o)!=null&&v.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null)}o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.key=!0,o.frame=!0;break;case 19:case 20:u=!0,(m=o)!=null&&m.frame&&!o.key&&(this.pushAccessUnit(o,e),o=this.VideoSample=null),o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.key=!0,o.frame=!0;break;case 39:u=!0,Qd(f.data,2,i.pts,t.samples);break;case 32:u=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=Ke(e.params,this.readVPS(f.data)),this.initVPS=f.data),e.vps=[f.data];break;case 33:if(u=!0,d=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],f.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const E=this.readSPS(f.data);e.width=E.width,e.height=E.height,e.pixelRatio=E.pixelRatio,e.codec=E.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const y in E.params)e.params[y]=E.params[y]}this.pushParameterSet(e.sps,f.data,e.vps),o||(o=this.VideoSample=this.createVideoSample(!0,i.pts,i.dts)),o.key=!0;break;case 34:if(u=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const E=this.readPPS(f.data);for(const y in E)e.params[y]=E[y]}this.pushParameterSet(e.pps,f.data,e.vps)}break;case 35:u=!0,e.audFound=!0,(g=o)!=null&&g.frame&&(this.pushAccessUnit(o,e),o=null),o||(o=this.VideoSample=this.createVideoSample(!1,i.pts,i.dts));break;default:u=!1;break}o&&u&&o.units.push(f)}),n&&o&&(this.pushAccessUnit(o,e),this.VideoSample=null)}pushParameterSet(e,t,i){(i&&i[0]===this.initVPS||!i&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let i=0;for(let n=0;n<e.byteLength;n++)n>=2&&e[n]===3&&e[n-1]===0&&e[n-2]===0||(t[i]=e[n],i++);return new Uint8Array(t.buffer,0,i)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new Ia(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const i=t.readBits(3),n=t.readBoolean();return{numTemporalLayers:i+1,temporalIdNested:n}}readSPS(e){const t=new Ia(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const i=t.readBits(3);t.readBoolean();const n=t.readBits(2),l=t.readBoolean(),o=t.readBits(5),u=t.readUByte(),d=t.readUByte(),f=t.readUByte(),m=t.readUByte(),g=t.readUByte(),v=t.readUByte(),E=t.readUByte(),y=t.readUByte(),S=t.readUByte(),T=t.readUByte(),R=t.readUByte(),D=[],_=[];for(let Ue=0;Ue<i;Ue++)D.push(t.readBoolean()),_.push(t.readBoolean());if(i>0)for(let Ue=i;Ue<8;Ue++)t.readBits(2);for(let Ue=0;Ue<i;Ue++)D[Ue]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),_[Ue]&&t.readUByte();t.readUEG();const O=t.readUEG();O==3&&t.skipBits(1);const C=t.readUEG(),B=t.readUEG(),N=t.readBoolean();let F=0,z=0,$=0,ae=0;N&&(F+=t.readUEG(),z+=t.readUEG(),$+=t.readUEG(),ae+=t.readUEG());const ce=t.readUEG(),ve=t.readUEG(),he=t.readUEG(),J=t.readBoolean();for(let Ue=J?0:i;Ue<=i;Ue++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let Qe=0;Qe<4;Qe++)for(let Pt=0;Pt<(Qe===3?2:6);Pt++)if(!t.readBoolean())t.readUEG();else{const Ut=Math.min(64,1<<4+(Qe<<1));Qe>1&&t.readEG();for(let mi=0;mi<Ut;mi++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const se=t.readUEG();let ee=0;for(let Ue=0;Ue<se;Ue++){let Qe=!1;if(Ue!==0&&(Qe=t.readBoolean()),Qe){Ue===se&&t.readUEG(),t.readBoolean(),t.readUEG();let Pt=0;for(let Ri=0;Ri<=ee;Ri++){const Ut=t.readBoolean();let mi=!1;Ut||(mi=t.readBoolean()),(Ut||mi)&&Pt++}ee=Pt}else{const Pt=t.readUEG(),Ri=t.readUEG();ee=Pt+Ri;for(let Ut=0;Ut<Pt;Ut++)t.readUEG(),t.readBoolean();for(let Ut=0;Ut<Ri;Ut++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const Ue=t.readUEG();for(let Qe=0;Qe<Ue;Qe++){for(let Pt=0;Pt<he+4;Pt++)t.readBits(1);t.readBits(1)}}let k=0,K=1,G=1,oe=!0,fe=1,ue=0;t.readBoolean(),t.readBoolean();let ke=!1;if(t.readBoolean()){if(t.readBoolean()){const zi=t.readUByte(),Ar=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],Tn=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];zi>0&&zi<16?(K=Ar[zi-1],G=Tn[zi-1]):zi===255&&(K=t.readBits(16),G=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),ke=t.readBoolean(),ke&&(F+=t.readUEG(),z+=t.readUEG(),$+=t.readUEG(),ae+=t.readUEG()),t.readBoolean()&&(fe=t.readBits(32),ue=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const Tn=t.readBoolean(),Ya=t.readBoolean();let gi=!1;(Tn||Ya)&&(gi=t.readBoolean(),gi&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),gi&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let Rt=0;Rt<=i;Rt++){oe=t.readBoolean();const Li=oe||t.readBoolean();let Lt=!1;Li?t.readEG():Lt=t.readBoolean();const qa=Lt?1:t.readUEG()+1;if(Tn)for(let qs=0;qs<qa;qs++)t.readUEG(),t.readUEG(),gi&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(Ya)for(let qs=0;qs<qa;qs++)t.readUEG(),t.readUEG(),gi&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),k=t.readUEG())}let ct=C,Vi=B;if(N||ke){let Ue=1,Qe=1;O===1?Ue=Qe=2:O==2&&(Ue=2),ct=C-Ue*z-Ue*F,Vi=B-Qe*ae-Qe*$}const Sn=n?["A","B","C"][n]:"",br=u<<24|d<<16|f<<8|m;let Ks=0;for(let Ue=0;Ue<32;Ue++)Ks=(Ks|(br>>Ue&1)<<31-Ue)>>>0;let Ys=Ks.toString(16);return o===1&&Ys==="2"&&(Ys="6"),{codecString:`hvc1.${Sn}${o}.${Ys}.${l?"H":"L"}${R}.B0`,params:{general_tier_flag:l,general_profile_idc:o,general_profile_space:n,general_profile_compatibility_flags:[u,d,f,m],general_constraint_indicator_flags:[g,v,E,y,S,T],general_level_idc:R,bit_depth:ce+8,bit_depth_luma_minus8:ce,bit_depth_chroma_minus8:ve,min_spatial_segmentation_idc:k,chroma_format_idc:O,frame_rate:{fixed:oe,fps:ue/fe}},width:ct,height:Vi,pixelRatio:[K,G]}}readPPS(e){const t=new Ia(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const n=t.readBoolean(),l=t.readBoolean();let o=1;return l&&n?o=0:l?o=3:n&&(o=2),{parallelismType:o}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const Et=188;class Gs{constructor(e,t,i,n){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=i,this.logger=n,this.videoParser=null}static probe(e,t){const i=Gs.syncOffset(e);return i>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${i}`),i!==-1}static syncOffset(e){const t=e.length;let i=Math.min(Et*5,t-Et)+1,n=0;for(;n<i;){let l=!1,o=-1,u=0;for(let d=n;d<t;d+=Et)if(e[d]===71&&(t-d===Et||e[d+Et]===71)){if(u++,o===-1&&(o=d,o!==0&&(i=Math.min(o+Et*99,e.length-Et)+1)),l||(l=_d(e,d)===0),l&&u>1&&(o===0&&u>2||d+Et>i))return o}else{if(u)return-1;break}n++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:lx[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,i,n){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=Gs.createTrack("video"),this._videoTrack.duration=n,this._audioTrack=Gs.createTrack("audio",n),this._id3Track=Gs.createTrack("id3"),this._txtTrack=Gs.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=i}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:i}=this;e&&(e.pesData=null),t&&(t.pesData=null),i&&(i.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,i=!1,n=!1){i||(this.sampleAes=null);let l;const o=this._videoTrack,u=this._audioTrack,d=this._id3Track,f=this._txtTrack;let m=o.pid,g=o.pesData,v=u.pid,E=d.pid,y=u.pesData,S=d.pesData,T=null,R=this.pmtParsed,D=this._pmtId,_=e.length;if(this.remainderData&&(e=hi(this.remainderData,e),_=e.length,this.remainderData=null),_<Et&&!n)return this.remainderData=e,{audioTrack:u,videoTrack:o,id3Track:d,textTrack:f};const O=Math.max(0,Gs.syncOffset(e));_-=(_-O)%Et,_<e.byteLength&&!n&&(this.remainderData=new Uint8Array(e.buffer,_,e.buffer.byteLength-_));let C=0;for(let N=O;N<_;N+=Et)if(e[N]===71){const F=!!(e[N+1]&64),z=_d(e,N),$=(e[N+3]&48)>>4;let ae;if($>1){if(ae=N+5+e[N+4],ae===N+Et)continue}else ae=N+4;switch(z){case m:if(F){if(g&&(l=ur(g,this.logger))){if(this.videoParser===null)switch(o.segmentCodec){case"avc":this.videoParser=new Ny;break;case"hevc":this.videoParser=new ky;break}this.videoParser!==null&&this.videoParser.parsePES(o,f,l,!1)}g={data:[],size:0}}g&&(g.data.push(e.subarray(ae,N+Et)),g.size+=N+Et-ae);break;case v:if(F){if(y&&(l=ur(y,this.logger)))switch(u.segmentCodec){case"aac":this.parseAACPES(u,l);break;case"mp3":this.parseMPEGPES(u,l);break;case"ac3":this.parseAC3PES(u,l);break}y={data:[],size:0}}y&&(y.data.push(e.subarray(ae,N+Et)),y.size+=N+Et-ae);break;case E:F&&(S&&(l=ur(S,this.logger))&&this.parseID3PES(d,l),S={data:[],size:0}),S&&(S.data.push(e.subarray(ae,N+Et)),S.size+=N+Et-ae);break;case 0:F&&(ae+=e[ae]+1),D=this._pmtId=X2(e,ae);break;case D:{F&&(ae+=e[ae]+1);const ce=Q2(e,ae,this.typeSupported,i,this.observer,this.logger);m=ce.videoPid,m>0&&(o.pid=m,o.segmentCodec=ce.segmentVideoCodec),v=ce.audioPid,v>0&&(u.pid=v,u.segmentCodec=ce.segmentAudioCodec),E=ce.id3Pid,E>0&&(d.pid=E),T!==null&&!R&&(this.logger.warn(`MPEG-TS PMT found at ${N} after unknown PID '${T}'. Backtracking to sync byte @${O} to parse all TS packets.`),T=null,N=O-188),R=this.pmtParsed=!0;break}case 17:case 8191:break;default:T=z;break}}else C++;C>0&&Dd(this.observer,new Error(`Found ${C} TS packet/s that do not start with 0x47`),void 0,this.logger),o.pesData=g,u.pesData=y,d.pesData=S;const B={audioTrack:u,videoTrack:o,id3Track:d,textTrack:f};return n&&this.extractRemainingSamples(B),B}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:i,id3Track:n,textTrack:l}=e,o=i.pesData,u=t.pesData,d=n.pesData;let f;if(o&&(f=ur(o,this.logger))){if(this.videoParser===null)switch(i.segmentCodec){case"avc":this.videoParser=new Ny;break;case"hevc":this.videoParser=new ky;break}this.videoParser!==null&&(this.videoParser.parsePES(i,l,f,!0),i.pesData=null)}else i.pesData=o;if(u&&(f=ur(u,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,f);break;case"mp3":this.parseMPEGPES(t,f);break;case"ac3":this.parseAC3PES(t,f);break}t.pesData=null}else u!=null&&u.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=u;d&&(f=ur(d,this.logger))?(this.parseID3PES(n,f),n.pesData=null):n.pesData=d}demuxSampleAes(e,t,i){const n=this.demux(e,i,!0,!this.config.progressive),l=this.sampleAes=new q2(this.observer,this.config,t);return this.decrypt(n,l)}decrypt(e,t){return new Promise(i=>{const{audioTrack:n,videoTrack:l}=e;n.samples&&n.segmentCodec==="aac"?t.decryptAacSamples(n.samples,0,()=>{l.samples?t.decryptAvcSamples(l.samples,0,0,()=>{i(e)}):i(e)}):l.samples&&t.decryptAvcSamples(l.samples,0,0,()=>{i(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let i=0;const n=this.aacOverFlow;let l=t.data;if(n){this.aacOverFlow=null;const g=n.missing,v=n.sample.unit.byteLength;if(g===-1)l=hi(n.sample.unit,l);else{const E=v-g;n.sample.unit.set(l.subarray(0,g),E),e.samples.push(n.sample),i=n.missing}}let o,u;for(o=i,u=l.length;o<u-1&&!ec(l,o);o++);if(o!==i){let g;const v=o<u-1;if(v?g=`AAC PES did not start with ADTS header,offset:${o}`:g="No ADTS header found in AAC PES",Dd(this.observer,new Error(g),v,this.logger),!v)return}jx(e,this.observer,l,o,this.audioCodec);let d;if(t.pts!==void 0)d=t.pts;else if(n){const g=$x(e.samplerate);d=n.sample.pts+g}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let f=0,m;for(;o<u;)if(m=Gx(e,l,o,d,f),o+=m.length,m.missing){this.aacOverFlow=m;break}else for(f++;o<u-1&&!ec(l,o);o++);}parseMPEGPES(e,t){const i=t.data,n=i.length;let l=0,o=0;const u=t.pts;if(u===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;o<n;)if(qx(i,o)){const d=Kx(e,i,o,u,l);if(d)o+=d.length,l++;else break}else o++}parseAC3PES(e,t){{const i=t.data,n=t.pts;if(n===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const l=i.length;let o=0,u=0,d;for(;u<l&&(d=Wx(e,i,u,n,o++))>0;)u+=d}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const i=Ke({},t,{type:this._videoTrack?ei.emsg:ei.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(i)}}function _d(r,e){return((r[e+1]&31)<<8)+r[e+2]}function X2(r,e){return(r[e+10]&31)<<8|r[e+11]}function Q2(r,e,t,i,n,l){const o={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},u=(r[e+1]&15)<<8|r[e+2],d=e+3+u-4,f=(r[e+10]&15)<<8|r[e+11];for(e+=12+f;e<d;){const m=_d(r,e),g=(r[e+3]&15)<<8|r[e+4];switch(r[e]){case 207:if(!i){qf("ADTS AAC",l);break}case 15:o.audioPid===-1&&(o.audioPid=m);break;case 21:o.id3Pid===-1&&(o.id3Pid=m);break;case 219:if(!i){qf("H.264",l);break}case 27:o.videoPid===-1&&(o.videoPid=m);break;case 3:case 4:!t.mpeg&&!t.mp3?l.log("MPEG audio found, not supported in this browser"):o.audioPid===-1&&(o.audioPid=m,o.segmentAudioCodec="mp3");break;case 193:if(!i){qf("AC-3",l);break}case 129:t.ac3?o.audioPid===-1&&(o.audioPid=m,o.segmentAudioCodec="ac3"):l.log("AC-3 audio found, not supported in this browser");break;case 6:if(o.audioPid===-1&&g>0){let v=e+5,E=g;for(;E>2;){switch(r[v]){case 106:t.ac3!==!0?l.log("AC-3 audio found, not supported in this browser for now"):(o.audioPid=m,o.segmentAudioCodec="ac3");break}const S=r[v+1]+2;v+=S,E-=S}}break;case 194:case 135:return Dd(n,new Error("Unsupported EC-3 in M2TS found"),void 0,l),o;case 36:o.videoPid===-1&&(o.videoPid=m,o.segmentVideoCodec="hevc",l.log("HEVC in M2TS found"));break}e+=g+5}return o}function Dd(r,e,t,i){i.warn(`parsing error: ${e.message}`),r.emit(A.ERROR,A.ERROR,{type:pe.MEDIA_ERROR,details:q.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function qf(r,e){e.log(`${r} with AES-128-CBC encryption found in unencrypted stream`)}function ur(r,e){let t=0,i,n,l,o,u;const d=r.data;if(!r||r.size===0)return null;for(;d[0].length<19&&d.length>1;)d[0]=hi(d[0],d[1]),d.splice(1,1);if(i=d[0],(i[0]<<16)+(i[1]<<8)+i[2]===1){if(n=(i[4]<<8)+i[5],n&&n>r.size-6)return null;const m=i[7];m&192&&(o=(i[9]&14)*536870912+(i[10]&255)*4194304+(i[11]&254)*16384+(i[12]&255)*128+(i[13]&254)/2,m&64?(u=(i[14]&14)*536870912+(i[15]&255)*4194304+(i[16]&254)*16384+(i[17]&255)*128+(i[18]&254)/2,o-u>60*9e4&&(e.warn(`${Math.round((o-u)/9e4)}s delta between PTS and DTS, align them`),o=u)):u=o),l=i[8];let g=l+9;if(r.size<=g)return null;r.size-=g;const v=new Uint8Array(r.size);for(let E=0,y=d.length;E<y;E++){i=d[E];let S=i.byteLength;if(g)if(g>S){g-=S;continue}else i=i.subarray(g),S-=g,g=0;v.set(i,t),t+=S}return n&&(n-=l+3),{data:v,pts:o,dts:u,len:n}}return null}class W2{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const Fs=Math.pow(2,32)-1;class V{static init(){V.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in V.types)V.types.hasOwnProperty(e)&&(V.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);V.HDLR_TYPES={video:t,audio:i};const n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),l=new Uint8Array([0,0,0,0,0,0,0,0]);V.STTS=V.STSC=V.STCO=l,V.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),V.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),V.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),V.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const o=new Uint8Array([105,115,111,109]),u=new Uint8Array([97,118,99,49]),d=new Uint8Array([0,0,0,1]);V.FTYP=V.box(V.types.ftyp,o,d,o,u),V.DINF=V.box(V.types.dinf,V.box(V.types.dref,n))}static box(e,...t){let i=8,n=t.length;const l=n;for(;n--;)i+=t[n].byteLength;const o=new Uint8Array(i);for(o[0]=i>>24&255,o[1]=i>>16&255,o[2]=i>>8&255,o[3]=i&255,o.set(e,4),n=0,i=8;n<l;n++)o.set(t[n],i),i+=t[n].byteLength;return o}static hdlr(e){return V.box(V.types.hdlr,V.HDLR_TYPES[e])}static mdat(e){return V.box(V.types.mdat,e)}static mdhd(e,t){t*=e;const i=Math.floor(t/(Fs+1)),n=Math.floor(t%(Fs+1));return V.box(V.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,i>>24,i>>16&255,i>>8&255,i&255,n>>24,n>>16&255,n>>8&255,n&255,85,196,0,0]))}static mdia(e){return V.box(V.types.mdia,V.mdhd(e.timescale||0,e.duration||0),V.hdlr(e.type),V.minf(e))}static mfhd(e){return V.box(V.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?V.box(V.types.minf,V.box(V.types.smhd,V.SMHD),V.DINF,V.stbl(e)):V.box(V.types.minf,V.box(V.types.vmhd,V.VMHD),V.DINF,V.stbl(e))}static moof(e,t,i){return V.box(V.types.moof,V.mfhd(e),V.traf(i,t))}static moov(e){let t=e.length;const i=[];for(;t--;)i[t]=V.trak(e[t]);return V.box.apply(null,[V.types.moov,V.mvhd(e[0].timescale||0,e[0].duration||0)].concat(i).concat(V.mvex(e)))}static mvex(e){let t=e.length;const i=[];for(;t--;)i[t]=V.trex(e[t]);return V.box.apply(null,[V.types.mvex,...i])}static mvhd(e,t){t*=e;const i=Math.floor(t/(Fs+1)),n=Math.floor(t%(Fs+1)),l=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,i>>24,i>>16&255,i>>8&255,i&255,n>>24,n>>16&255,n>>8&255,n&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return V.box(V.types.mvhd,l)}static sdtp(e){const t=e.samples||[],i=new Uint8Array(4+t.length);let n,l;for(n=0;n<t.length;n++)l=t[n].flags,i[n+4]=l.dependsOn<<4|l.isDependedOn<<2|l.hasRedundancy;return V.box(V.types.sdtp,i)}static stbl(e){return V.box(V.types.stbl,V.stsd(e),V.box(V.types.stts,V.STTS),V.box(V.types.stsc,V.STSC),V.box(V.types.stsz,V.STSZ),V.box(V.types.stco,V.STCO))}static avc1(e){let t=[],i=[],n,l,o;for(n=0;n<e.sps.length;n++)l=e.sps[n],o=l.byteLength,t.push(o>>>8&255),t.push(o&255),t=t.concat(Array.prototype.slice.call(l));for(n=0;n<e.pps.length;n++)l=e.pps[n],o=l.byteLength,i.push(o>>>8&255),i.push(o&255),i=i.concat(Array.prototype.slice.call(l));const u=V.box(V.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(i))),d=e.width,f=e.height,m=e.pixelRatio[0],g=e.pixelRatio[1];return V.box(V.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,d>>8&255,d&255,f>>8&255,f&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),u,V.box(V.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),V.box(V.types.pasp,new Uint8Array([m>>24,m>>16&255,m>>8&255,m&255,g>>24,g>>16&255,g>>8&255,g&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return V.box(V.types.mp4a,V.audioStsd(e),V.box(V.types.esds,V.esds(e)))}static mp3(e){return V.box(V.types[".mp3"],V.audioStsd(e))}static ac3(e){return V.box(V.types["ac-3"],V.audioStsd(e),V.box(V.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return V.box(V.types.stsd,V.STSD,V.mp4a(e));if(t==="ac3"&&e.config)return V.box(V.types.stsd,V.STSD,V.ac3(e));if(t==="mp3"&&e.codec==="mp3")return V.box(V.types.stsd,V.STSD,V.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return V.box(V.types.stsd,V.STSD,V.avc1(e));if(t==="hevc"&&e.vps)return V.box(V.types.stsd,V.STSD,V.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,i=(e.duration||0)*(e.timescale||0),n=e.width||0,l=e.height||0,o=Math.floor(i/(Fs+1)),u=Math.floor(i%(Fs+1));return V.box(V.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,o>>24,o>>16&255,o>>8&255,o&255,u>>24,u>>16&255,u>>8&255,u&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,n&255,0,0,l>>8&255,l&255,0,0]))}static traf(e,t){const i=V.sdtp(e),n=e.id,l=Math.floor(t/(Fs+1)),o=Math.floor(t%(Fs+1));return V.box(V.types.traf,V.box(V.types.tfhd,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,n&255])),V.box(V.types.tfdt,new Uint8Array([1,0,0,0,l>>24,l>>16&255,l>>8&255,l&255,o>>24,o>>16&255,o>>8&255,o&255])),V.trun(e,i.length+16+20+8+16+8+8),i)}static trak(e){return e.duration=e.duration||4294967295,V.box(V.types.trak,V.tkhd(e),V.mdia(e))}static trex(e){const t=e.id;return V.box(V.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const i=e.samples||[],n=i.length,l=12+16*n,o=new Uint8Array(l);let u,d,f,m,g,v;for(t+=8+l,o.set([e.type==="video"?1:0,0,15,1,n>>>24&255,n>>>16&255,n>>>8&255,n&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),u=0;u<n;u++)d=i[u],f=d.duration,m=d.size,g=d.flags,v=d.cts,o.set([f>>>24&255,f>>>16&255,f>>>8&255,f&255,m>>>24&255,m>>>16&255,m>>>8&255,m&255,g.isLeading<<2|g.dependsOn,g.isDependedOn<<6|g.hasRedundancy<<4|g.paddingValue<<1|g.isNonSync,g.degradPrio&61440,g.degradPrio&15,v>>>24&255,v>>>16&255,v>>>8&255,v&255],12+16*u);return V.box(V.types.trun,o)}static initSegment(e){V.types||V.init();const t=V.moov(e);return hi(V.FTYP,t)}static hvc1(e){const t=e.params,i=[e.vps,e.sps,e.pps],n=4,l=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),n-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),i.length]);let o=l.length;for(let y=0;y<i.length;y+=1){o+=3;for(let S=0;S<i[y].length;S+=1)o+=2+i[y][S].length}const u=new Uint8Array(o);u.set(l,0),o=l.length;const d=i.length-1;for(let y=0;y<i.length;y+=1){u.set(new Uint8Array([32+y|(y===d?128:0),0,i[y].length]),o),o+=3;for(let S=0;S<i[y].length;S+=1)u.set(new Uint8Array([i[y][S].length>>8,i[y][S].length&255]),o),o+=2,u.set(i[y][S],o),o+=i[y][S].length}const f=V.box(V.types.hvcC,u),m=e.width,g=e.height,v=e.pixelRatio[0],E=e.pixelRatio[1];return V.box(V.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,m>>8&255,m&255,g>>8&255,g&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),f,V.box(V.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),V.box(V.types.pasp,new Uint8Array([v>>24,v>>16&255,v>>8&255,v&255,E>>24,E>>16&255,E>>8&255,E&255])))}}V.types=void 0;V.HDLR_TYPES=void 0;V.STTS=void 0;V.STSC=void 0;V.STCO=void 0;V.STSZ=void 0;V.VMHD=void 0;V.SMHD=void 0;V.STSD=void 0;V.FTYP=void 0;V.DINF=void 0;const Jx=9e4;function uh(r,e,t=1,i=!1){const n=r*e*t;return i?Math.round(n):n}function Z2(r,e,t=1,i=!1){return uh(r,e,1/t,i)}function _a(r,e=!1){return uh(r,1e3,1/Jx,e)}function J2(r,e=1){return uh(r,Jx,1/e)}const e_=10*1e3,t_=1024,i_=1152,s_=1536;let fr=null,Xf=null;function My(r,e,t,i){return{duration:e,size:t,cts:i,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:r?2:1,isNonSync:r?0:1}}}class Oo{constructor(e,t,i,n){if(this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=i,this.logger=n,this.ISGenerated=!1,fr===null){const o=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);fr=o?parseInt(o[1]):0}if(Xf===null){const l=navigator.userAgent.match(/Safari\/(\d+)/i);Xf=l?parseInt(l[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){this.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const i=e[0].pts,n=e.reduce((l,o)=>{let u=o.pts,d=u-l;return d<-4294967296&&(t=!0,u=di(u,i),d=u-l),d>0?l:u},i);return t&&this.logger.debug("PTS rollover detected"),n}remux(e,t,i,n,l,o,u,d){let f,m,g,v,E,y,S=l,T=l;const R=e.pid>-1,D=t.pid>-1,_=t.samples.length,O=e.samples.length>0,C=u&&_>0||_>1;if((!R||O)&&(!D||C)||this.ISGenerated||u){if(this.ISGenerated){var N,F,z,$;const he=this.videoTrackConfig;(he&&(t.width!==he.width||t.height!==he.height||((N=t.pixelRatio)==null?void 0:N[0])!==((F=he.pixelRatio)==null?void 0:F[0])||((z=t.pixelRatio)==null?void 0:z[1])!==(($=he.pixelRatio)==null?void 0:$[1]))||!he&&C||this.nextAudioPts===null&&O)&&this.resetInitSegment()}this.ISGenerated||(g=this.generateIS(e,t,l,o));const ae=this.isVideoContiguous;let ce=-1,ve;if(C&&(ce=n_(t.samples),!ae&&this.config.forceKeyFrameOnDiscontinuity))if(y=!0,ce>0){this.logger.warn(`[mp4-remuxer]: Dropped ${ce} out of ${_} video samples due to a missing keyframe`);const he=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(ce),t.dropped+=ce,T+=(t.samples[0].pts-he)/t.inputTimeScale,ve=T}else ce===-1&&(this.logger.warn(`[mp4-remuxer]: No keyframe found out of ${_} video samples`),y=!1);if(this.ISGenerated){if(O&&C){const he=this.getVideoStartPts(t.samples),P=(di(e.samples[0].pts,he)-he)/t.inputTimeScale;S+=Math.max(0,P),T+=Math.max(0,-P)}if(O){if(e.samplerate||(this.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),g=this.generateIS(e,t,l,o)),m=this.remuxAudio(e,S,this.isAudioContiguous,o,D||C||d===ge.AUDIO?T:void 0),C){const he=m?m.endPTS-m.startPTS:0;t.inputTimeScale||(this.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),g=this.generateIS(e,t,l,o)),f=this.remuxVideo(t,T,ae,he)}}else C&&(f=this.remuxVideo(t,T,ae,0));f&&(f.firstKeyFrame=ce,f.independent=ce!==-1,f.firstKeyFramePTS=ve)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(i.samples.length&&(E=e1(i,l,this._initPTS,this._initDTS)),n.samples.length&&(v=t1(n,l,this._initPTS))),{audio:m,video:f,initSegment:g,independent:y,text:v,id3:E}}generateIS(e,t,i,n){const l=e.samples,o=t.samples,u=this.typeSupported,d={},f=this._initPTS;let m=!f||n,g="audio/mp4",v,E,y;if(m&&(v=E=1/0),e.config&&l.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":u.mpeg?(g="audio/mpeg",e.codec=""):u.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}d.audio={id:"audio",container:g,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&u.mpeg?new Uint8Array(0):V.initSegment([e]),metadata:{channelCount:e.channelCount}},m&&(y=e.inputTimeScale,!f||y!==f.timescale?v=E=l[0].pts-Math.round(y*i):m=!1)}if(t.sps&&t.pps&&o.length){if(t.timescale=t.inputTimeScale,d.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:V.initSegment([t]),metadata:{width:t.width,height:t.height}},m)if(y=t.inputTimeScale,!f||y!==f.timescale){const S=this.getVideoStartPts(o),T=Math.round(y*i);E=Math.min(E,di(o[0].dts,S)-T),v=Math.min(v,S-T)}else m=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(d).length)return this.ISGenerated=!0,m?(this._initPTS={baseTime:v,timescale:y},this._initDTS={baseTime:E,timescale:y}):v=y=void 0,{tracks:d,initPTS:v,timescale:y}}remuxVideo(e,t,i,n){const l=e.inputTimeScale,o=e.samples,u=[],d=o.length,f=this._initPTS;let m=this.nextAvcDts,g=8,v=this.videoSampleDuration,E,y,S=Number.POSITIVE_INFINITY,T=Number.NEGATIVE_INFINITY,R=!1;if(!i||m===null){const ee=t*l,w=o[0].pts-di(o[0].dts,o[0].pts);fr&&m!==null&&Math.abs(ee-w-m)<15e3?i=!0:m=ee-w}const D=f.baseTime*l/f.timescale;for(let ee=0;ee<d;ee++){const w=o[ee];w.pts=di(w.pts-D,m),w.dts=di(w.dts-D,m),w.dts<o[ee>0?ee-1:ee].dts&&(R=!0)}R&&o.sort(function(ee,w){const k=ee.dts-w.dts,K=ee.pts-w.pts;return k||K}),E=o[0].dts,y=o[o.length-1].dts;const _=y-E,O=_?Math.round(_/(d-1)):v||e.inputTimeScale/30;if(i){const ee=E-m,w=ee>O,k=ee<-1;if((w||k)&&(w?this.logger.warn(`${(e.segmentCodec||"").toUpperCase()}: ${_a(ee,!0)} ms (${ee}dts) hole between fragments detected at ${t.toFixed(3)}`):this.logger.warn(`${(e.segmentCodec||"").toUpperCase()}: ${_a(-ee,!0)} ms (${ee}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!k||m>=o[0].pts||fr)){E=m;const K=o[0].pts-ee;if(w)o[0].dts=E,o[0].pts=K;else{let G=!0;for(let oe=0;oe<o.length&&!(o[oe].dts>K&&G);oe++){const fe=o[oe].pts;if(o[oe].dts-=ee,o[oe].pts-=ee,oe<o.length-1){const ue=o[oe+1].pts,ke=o[oe].pts,Le=ue<=ke,ct=ue<=fe;G=Le==ct}}}this.logger.log(`Video: Initial PTS/DTS adjusted: ${_a(K,!0)}/${_a(E,!0)}, delta: ${_a(ee,!0)} ms`)}}E=Math.max(0,E);let C=0,B=0,N=E;for(let ee=0;ee<d;ee++){const w=o[ee],k=w.units,K=k.length;let G=0;for(let oe=0;oe<K;oe++)G+=k[oe].data.length;B+=G,C+=K,w.length=G,w.dts<N?(w.dts=N,N+=O/4|0||1):N=w.dts,S=Math.min(w.pts,S),T=Math.max(w.pts,T)}y=o[d-1].dts;const F=B+4*C+8;let z;try{z=new Uint8Array(F)}catch(ee){this.observer.emit(A.ERROR,A.ERROR,{type:pe.MUX_ERROR,details:q.REMUX_ALLOC_ERROR,fatal:!1,error:ee,bytes:F,reason:`fail allocating video mdat ${F}`});return}const $=new DataView(z.buffer);$.setUint32(0,F),z.set(V.types.mdat,4);let ae=!1,ce=Number.POSITIVE_INFINITY,ve=Number.POSITIVE_INFINITY,he=Number.NEGATIVE_INFINITY,J=Number.NEGATIVE_INFINITY;for(let ee=0;ee<d;ee++){const w=o[ee],k=w.units;let K=0;for(let fe=0,ue=k.length;fe<ue;fe++){const ke=k[fe],Le=ke.data,ct=ke.data.byteLength;$.setUint32(g,ct),g+=4,z.set(Le,g),g+=ct,K+=4+ct}let G;if(ee<d-1)v=o[ee+1].dts-w.dts,G=o[ee+1].pts-w.pts;else{const fe=this.config,ue=ee>0?w.dts-o[ee-1].dts:O;if(G=ee>0?w.pts-o[ee-1].pts:O,fe.stretchShortVideoTrack&&this.nextAudioPts!==null){const ke=Math.floor(fe.maxBufferHole*l),Le=(n?S+n*l:this.nextAudioPts)-w.pts;Le>ke?(v=Le-ue,v<0?v=ue:ae=!0,this.logger.log(`[mp4-remuxer]: It is approximately ${Le/90} ms to the next segment; using duration ${v/90} ms for the last video frame.`)):v=ue}else v=ue}const oe=Math.round(w.pts-w.dts);ce=Math.min(ce,v),he=Math.max(he,v),ve=Math.min(ve,G),J=Math.max(J,G),u.push(My(w.key,v,K,oe))}if(u.length){if(fr){if(fr<70){const ee=u[0].flags;ee.dependsOn=2,ee.isNonSync=0}}else if(Xf&&J-ve<he-ce&&O/he<.025&&u[0].cts===0){this.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let ee=E;for(let w=0,k=u.length;w<k;w++){const K=ee+u[w].duration,G=ee+u[w].cts;if(w<k-1){const oe=K+u[w+1].cts;u[w].duration=oe-G}else u[w].duration=w?u[w-1].duration:O;u[w].cts=0,ee=K}}}v=ae||!v?O:v,this.nextAvcDts=m=y+v,this.videoSampleDuration=v,this.isVideoContiguous=!0;const se={data1:V.moof(e.sequenceNumber++,E,Ke(e,{samples:u})),data2:z,startPTS:S/l,endPTS:(T+v)/l,startDTS:E/l,endDTS:m/l,type:"video",hasAudio:!1,hasVideo:!0,nb:u.length,dropped:e.dropped};return e.samples=[],e.dropped=0,se}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return i_;case"ac3":return s_;default:return t_}}remuxAudio(e,t,i,n,l){const o=e.inputTimeScale,u=e.samplerate?e.samplerate:o,d=o/u,f=this.getSamplesPerFrame(e),m=f*d,g=this._initPTS,v=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,E=[],y=l!==void 0;let S=e.samples,T=v?0:8,R=this.nextAudioPts||-1;const D=t*o,_=g.baseTime*o/g.timescale;if(this.isAudioContiguous=i=i||S.length&&R>0&&(n&&Math.abs(D-R)<9e3||Math.abs(di(S[0].pts-_,D)-R)<20*m),S.forEach(function(P){P.pts=di(P.pts-_,D)}),!i||R<0){if(S=S.filter(P=>P.pts>=0),!S.length)return;l===0?R=0:n&&!y?R=Math.max(0,D):R=S[0].pts}if(e.segmentCodec==="aac"){const P=this.config.maxAudioFramesDrift;for(let W=0,se=R;W<S.length;W++){const ee=S[W],w=ee.pts,k=w-se,K=Math.abs(1e3*k/o);if(k<=-P*m&&y)W===0&&(this.logger.warn(`Audio frame @ ${(w/o).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*k/o)} ms.`),this.nextAudioPts=R=se=w);else if(k>=P*m&&K<e_&&y){let G=Math.round(k/m);se=w-G*m,se<0&&(G--,se+=m),W===0&&(this.nextAudioPts=R=se),this.logger.warn(`[mp4-remuxer]: Injecting ${G} audio frame @ ${(se/o).toFixed(3)}s due to ${Math.round(1e3*k/o)} ms gap.`);for(let oe=0;oe<G;oe++){const fe=Math.max(se,0);let ue=W2.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);ue||(this.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),ue=ee.unit.subarray()),S.splice(W,0,{unit:ue,pts:fe}),se+=m,W++}}ee.pts=se,se+=m}}let O=null,C=null,B,N=0,F=S.length;for(;F--;)N+=S[F].unit.byteLength;for(let P=0,W=S.length;P<W;P++){const se=S[P],ee=se.unit;let w=se.pts;if(C!==null){const K=E[P-1];K.duration=Math.round((w-C)/d)}else if(i&&e.segmentCodec==="aac"&&(w=R),O=w,N>0){N+=T;try{B=new Uint8Array(N)}catch(K){this.observer.emit(A.ERROR,A.ERROR,{type:pe.MUX_ERROR,details:q.REMUX_ALLOC_ERROR,fatal:!1,error:K,bytes:N,reason:`fail allocating audio mdat ${N}`});return}v||(new DataView(B.buffer).setUint32(0,N),B.set(V.types.mdat,4))}else return;B.set(ee,T);const k=ee.byteLength;T+=k,E.push(My(!0,f,k,0)),C=w}const z=E.length;if(!z)return;const $=E[E.length-1];this.nextAudioPts=R=C+d*$.duration;const ae=v?new Uint8Array(0):V.moof(e.sequenceNumber++,O/d,Ke({},e,{samples:E}));e.samples=[];const ce=O/o,ve=R/o,J={data1:ae,data2:B,startPTS:ce,endPTS:ve,startDTS:ce,endDTS:ve,type:"audio",hasAudio:!0,hasVideo:!1,nb:z};return this.isAudioContiguous=!0,J}}function di(r,e){let t;if(e===null)return r;for(e<r?t=-8589934592:t=8589934592;Math.abs(r-e)>4294967296;)r+=t;return r}function n_(r){for(let e=0;e<r.length;e++)if(r[e].key)return e;return-1}function e1(r,e,t,i){const n=r.samples.length;if(!n)return;const l=r.inputTimeScale;for(let u=0;u<n;u++){const d=r.samples[u];d.pts=di(d.pts-t.baseTime*l/t.timescale,e*l)/l,d.dts=di(d.dts-i.baseTime*l/i.timescale,e*l)/l}const o=r.samples;return r.samples=[],{samples:o}}function t1(r,e,t){const i=r.samples.length;if(!i)return;const n=r.inputTimeScale;for(let o=0;o<i;o++){const u=r.samples[o];u.pts=di(u.pts-t.baseTime*n/t.timescale,e*n)/n}r.samples.sort((o,u)=>o.pts-u.pts);const l=r.samples;return r.samples=[],{samples:l}}class r_{constructor(e,t,i,n){this.logger=void 0,this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.logger=n}destroy(){}resetTimeStamp(e){this.initPTS=e,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(e,t,i,n){this.audioCodec=t,this.videoCodec=i,this.generateInitSegment(YR(e,n)),this.emitInitSegment=!0}generateInitSegment(e){let{audioCodec:t,videoCodec:i}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const n=this.initData=ux(e);n.audio&&(t=Py(n.audio,ze.AUDIO)),n.video&&(i=Py(n.video,ze.VIDEO));const l={};n.audio&&n.video?l.audiovideo={container:"video/mp4",codec:t+","+i,supplemental:n.video.supplemental,initSegment:e,id:"main"}:n.audio?l.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:n.video?l.video={container:"video/mp4",codec:i,supplemental:n.video.supplemental,initSegment:e,id:"main"}:this.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=l}remux(e,t,i,n,l,o){var u,d;let{initPTS:f,lastEndTime:m}=this;const g={audio:void 0,video:void 0,text:n,id3:i,initSegment:void 0};de(m)||(m=this.lastEndTime=l||0);const v=t.samples;if(!(v!=null&&v.length))return g;const E={initPTS:void 0,timescale:1};let y=this.initData;if((u=y)!=null&&u.length||(this.generateInitSegment(v),y=this.initData),!((d=y)!=null&&d.length))return this.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),g;this.emitInitSegment&&(E.tracks=this.initTracks,this.emitInitSegment=!1);const S=XR(v,y),T=qR(y,v),R=T===null?l:T;(o||!f)&&(a_(f,R,l,S)||E.timescale!==f.timescale)&&(E.initPTS=R-l,f&&f.timescale===1&&this.logger.warn(`Adjusting initPTS @${l} from ${f.baseTime/f.timescale} to ${E.initPTS}`),this.initPTS=f={baseTime:E.initPTS,timescale:1});const D=e?R-f.baseTime/f.timescale:m,_=D+S;WR(y,v,f.baseTime/f.timescale),S>0?this.lastEndTime=_:(this.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const O=!!y.audio,C=!!y.video;let B="";O&&(B+="audio"),C&&(B+="video");const N={data1:v,startPTS:D,startDTS:D,endPTS:_,endDTS:_,type:B,hasAudio:O,hasVideo:C,nb:1,dropped:0};return g.audio=N.type==="audio"?N:void 0,g.video=N.type!=="audio"?N:void 0,g.initSegment=E,g.id3=e1(i,l,f,f),n.samples.length&&(g.text=t1(n,l,f)),g}}function a_(r,e,t,i){if(r===null)return!0;const n=Math.max(i,1),l=e-r.baseTime/r.timescale;return Math.abs(l-t)>n}function Py(r,e){const t=r==null?void 0:r.codec;return t&&t.length>4?t:e===ze.AUDIO?t==="ec-3"||t==="ac-3"||t==="alac"?t:t==="fLaC"||t==="Opus"?Yo(t,!1):(Me.warn(`Unhandled audio codec "${t}" in mp4 MAP`),t||"mp4a"):(Me.warn(`Unhandled video codec "${t}" in mp4 MAP`),t||"avc1")}let us;try{us=self.performance.now.bind(self.performance)}catch{us=Date.now}const No=[{demux:Y2,remux:r_},{demux:Gs,remux:Oo},{demux:H2,remux:Oo},{demux:z2,remux:Oo}];No.splice(2,0,{demux:V2,remux:Oo});class Uy{constructor(e,t,i,n,l,o){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=i,this.id=l,this.logger=o}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,i,n){const l=i.transmuxing;l.executeStart=us();let o=new Uint8Array(e);const{currentTransmuxState:u,transmuxConfig:d}=this;n&&(this.currentTransmuxState=n);const{contiguous:f,discontinuity:m,trackSwitch:g,accurateTimeOffset:v,timeOffset:E,initSegmentChange:y}=n||u,{audioCodec:S,videoCodec:T,defaultInitPts:R,duration:D,initSegmentData:_}=d,O=l_(o,t);if(O&&hr(O.method)){const F=this.getDecrypter(),z=th(O.method);if(F.isSync()){let $=F.softwareDecrypt(o,O.key.buffer,O.iv.buffer,z);if(i.part>-1){const ce=F.flush();$=ce&&ce.buffer}if(!$)return l.executeEnd=us(),Qf(i);o=new Uint8Array($)}else return this.asyncResult=!0,this.decryptionPromise=F.webCryptoDecrypt(o,O.key.buffer,O.iv.buffer,z).then($=>{const ae=this.push($,null,i);return this.decryptionPromise=null,ae}),this.decryptionPromise}const C=this.needsProbing(m,g);if(C){const F=this.configureTransmuxer(o);if(F)return this.logger.warn(`[transmuxer] ${F.message}`),this.observer.emit(A.ERROR,A.ERROR,{type:pe.MEDIA_ERROR,details:q.FRAG_PARSING_ERROR,fatal:!1,error:F,reason:F.message}),l.executeEnd=us(),Qf(i)}(m||g||y||C)&&this.resetInitSegment(_,S,T,D,t),(m||y||C)&&this.resetInitialTimestamp(R),f||this.resetContiguity();const B=this.transmux(o,O,E,v,i);this.asyncResult=ja(B);const N=this.currentTransmuxState;return N.contiguous=!0,N.discontinuity=!1,N.trackSwitch=!1,l.executeEnd=us(),B}flush(e){const t=e.transmuxing;t.executeStart=us();const{decrypter:i,currentTransmuxState:n,decryptionPromise:l}=this;if(l)return this.asyncResult=!0,l.then(()=>this.flush(e));const o=[],{timeOffset:u}=n;if(i){const g=i.flush();g&&o.push(this.push(g.buffer,null,e))}const{demuxer:d,remuxer:f}=this;if(!d||!f){t.executeEnd=us();const g=[Qf(e)];return this.asyncResult?Promise.resolve(g):g}const m=d.flush(u);return ja(m)?(this.asyncResult=!0,m.then(g=>(this.flushRemux(o,g,e),o))):(this.flushRemux(o,m,e),this.asyncResult?Promise.resolve(o):o)}flushRemux(e,t,i){const{audioTrack:n,videoTrack:l,id3Track:o,textTrack:u}=t,{accurateTimeOffset:d,timeOffset:f}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${i.sn}${i.part>-1?" part: "+i.part:""} of ${this.id===ge.MAIN?"level":"track"} ${i.level}`);const m=this.remuxer.remux(n,l,o,u,f,d,!0,this.id);e.push({remuxResult:m,chunkMeta:i}),i.transmuxing.executeEnd=us()}resetInitialTimestamp(e){const{demuxer:t,remuxer:i}=this;!t||!i||(t.resetTimeStamp(e),i.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,i,n,l){const{demuxer:o,remuxer:u}=this;!o||!u||(o.resetInitSegment(e,t,i,n),u.resetInitSegment(e,t,i,l))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,i,n,l){let o;return t&&t.method==="SAMPLE-AES"?o=this.transmuxSampleAes(e,t,i,n,l):o=this.transmuxUnencrypted(e,i,n,l),o}transmuxUnencrypted(e,t,i,n){const{audioTrack:l,videoTrack:o,id3Track:u,textTrack:d}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(l,o,u,d,t,i,!1,this.id),chunkMeta:n}}transmuxSampleAes(e,t,i,n,l){return this.demuxer.demuxSampleAes(e,t,i).then(o=>({remuxResult:this.remuxer.remux(o.audioTrack,o.videoTrack,o.id3Track,o.textTrack,i,n,!1,this.id),chunkMeta:l}))}configureTransmuxer(e){const{config:t,observer:i,typeSupported:n}=this;let l;for(let g=0,v=No.length;g<v;g++){var o;if((o=No[g].demux)!=null&&o.probe(e,this.logger)){l=No[g];break}}if(!l)return new Error("Failed to find demuxer by probing fragment data");const u=this.demuxer,d=this.remuxer,f=l.remux,m=l.demux;(!d||!(d instanceof f))&&(this.remuxer=new f(i,t,n,this.logger)),(!u||!(u instanceof m))&&(this.demuxer=new m(i,t,n,this.logger),this.probe=m.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new Jd(this.config)),e}}function l_(r,e){let t=null;return r.byteLength>0&&(e==null?void 0:e.key)!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const Qf=r=>({remuxResult:{},chunkMeta:r});function ja(r){return"then"in r&&r.then instanceof Function}class o_{constructor(e,t,i,n,l){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=i,this.duration=n,this.defaultInitPts=l||null}}class c_{constructor(e,t,i,n,l,o){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=i,this.trackSwitch=n,this.timeOffset=l,this.initSegmentChange=o}}let By=0;class i1{constructor(e,t,i,n){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=By++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=d=>{const f=d.data,m=this.hls;if(!(!m||!(f!=null&&f.event)||f.instanceNo!==this.instanceNo))switch(f.event){case"init":{var g;const v=(g=this.workerContext)==null?void 0:g.objectURL;v&&self.URL.revokeObjectURL(v);break}case"transmuxComplete":{this.handleTransmuxComplete(f.data);break}case"flush":{this.onFlush(f.data);break}case"workerLog":{m.logger[f.data.logType]&&m.logger[f.data.logType](f.data.message);break}default:{f.data=f.data||{},f.data.frag=this.frag,f.data.part=this.part,f.data.id=this.id,m.trigger(f.event,f.data);break}}},this.onWorkerError=d=>{if(!this.hls)return;const f=new Error(`${d.message}  (${d.filename}:${d.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(A.ERROR,{type:pe.OTHER_ERROR,details:q.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:f})};const l=e.config;this.hls=e,this.id=t,this.useWorker=!!l.enableWorker,this.onTransmuxComplete=i,this.onFlush=n;const o=(d,f)=>{f=f||{},f.frag=this.frag||void 0,d===A.ERROR&&(f=f,f.parent=this.id,f.part=this.part,this.error=f.error),this.hls.trigger(d,f)};this.observer=new nh,this.observer.on(A.FRAG_DECRYPTED,o),this.observer.on(A.ERROR,o);const u=ey(l.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const d=this.hls.logger;if(l.workerPath||d2()){try{l.workerPath?(d.log(`loading Web Worker ${l.workerPath} for "${t}"`),this.workerContext=m2(l.workerPath)):(d.log(`injecting Web Worker for "${t}"`),this.workerContext=h2());const{worker:m}=this.workerContext;m.addEventListener("message",this.onWorkerMessage),m.addEventListener("error",this.onWorkerError),m.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:u,id:t,config:et(l)})}catch(m){d.warn(`Error setting up "${t}" Web Worker, fallback to inline`,m),this.terminateWorker(),this.error=null,this.transmuxer=new Uy(this.observer,u,l,"",t,e.logger)}return}}this.transmuxer=new Uy(this.observer,u,l,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=By++;const t=this.hls.config,i=ey(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:i,id:this.id,config:et(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),g2(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,i,n,l,o,u,d,f,m){var g,v;f.transmuxing.start=self.performance.now();const{instanceNo:E,transmuxer:y}=this,S=o?o.start:l.start,T=l.decryptdata,R=this.frag,D=!(R&&l.cc===R.cc),_=!(R&&f.level===R.level),O=R?f.sn-R.sn:-1,C=this.part?f.part-this.part.index:-1,B=O===0&&f.id>1&&f.id===(R==null?void 0:R.stats.chunkCount),N=!_&&(O===1||O===0&&(C===1||B&&C<=0)),F=self.performance.now();(_||O||l.stats.parsing.start===0)&&(l.stats.parsing.start=F),o&&(C||!N)&&(o.stats.parsing.start=F);const z=!(R&&((g=l.initSegment)==null?void 0:g.url)===((v=R.initSegment)==null?void 0:v.url)),$=new c_(D,N,d,_,S,z);if(!N||D||z){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${l.type} sn: ${f.sn}${f.part>-1?" part: "+f.part:""} ${this.id===ge.MAIN?"level":"track"}: ${f.level} id: ${f.id}
        discontinuity: ${D}
        trackSwitch: ${_}
        contiguous: ${N}
        accurateTimeOffset: ${d}
        timeOffset: ${S}
        initSegmentChange: ${z}`);const ae=new o_(i,n,t,u,m);this.configureTransmuxer(ae)}if(this.frag=l,this.part=o,this.workerContext)this.workerContext.worker.postMessage({instanceNo:E,cmd:"demux",data:e,decryptdata:T,chunkMeta:f,state:$},e instanceof ArrayBuffer?[e]:[]);else if(y){const ae=y.push(e,T,f,$);ja(ae)?ae.then(ce=>{this.handleTransmuxComplete(ce)}).catch(ce=>{this.transmuxerError(ce,f,"transmuxer-interface push error")}):this.handleTransmuxComplete(ae)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:i}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(i){const n=i.flush(e);ja(n)?n.then(l=>{this.handleFlushResult(l,e)}).catch(l=>{this.transmuxerError(l,e,"transmuxer-interface flush error")}):this.handleFlushResult(n,e)}}transmuxerError(e,t,i){this.hls&&(this.error=e,this.hls.trigger(A.ERROR,{type:pe.MEDIA_ERROR,details:q.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:i}))}handleFlushResult(e,t){e.forEach(i=>{this.handleTransmuxComplete(i)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:i}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):i&&i.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const Fy=100;class u_ extends sh{constructor(e,t,i){super(e,t,i,"audio-stream-controller",ge.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(A.LEVEL_LOADED,this.onLevelLoaded,this),e.on(A.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(A.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(A.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(A.BUFFER_RESET,this.onBufferReset,this),e.on(A.BUFFER_CREATED,this.onBufferCreated,this),e.on(A.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(A.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(A.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(A.FRAG_LOADING,this.onFragLoading,this),e.on(A.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(A.LEVEL_LOADED,this.onLevelLoaded,this),e.off(A.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(A.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(A.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(A.BUFFER_RESET,this.onBufferReset,this),e.off(A.BUFFER_CREATED,this.onBufferCreated,this),e.off(A.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(A.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(A.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(A.FRAG_LOADING,this.onFragLoading,this),e.off(A.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:i,initPTS:n,timescale:l}){if(i===ge.MAIN){const o=t.cc,u=this.fragCurrent;if(this.initPTS[o]={baseTime:n,timescale:l},this.log(`InitPTS for cc: ${o} found from main: ${n}/${l}`),this.mainAnchor=t,this.state===ne.WAITING_INIT_PTS){const d=this.waitingData;(!d&&!this.loadingParts||d&&d.frag.cc!==o)&&(this.nextLoadPosition=this.findSyncFrag(t).start),this.tick()}else!this.hls.hasEnoughToStart&&u&&u.cc!==o?(this.startFragRequested=!1,this.nextLoadPosition=this.findSyncFrag(t).start,u.abortRequests(),this.resetLoadingState()):this.state===ne.IDLE&&this.tick()}}findSyncFrag(e){const t=this.getLevelDetails(),i=e.cc;return LL(t,i,e)||t&&Sx(t.fragments,i)||e}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=ne.STOPPED;return}const i=this.lastCurrentTime;this.stopLoad(),this.setInterval(Fy),i>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${i.toFixed(3)}`),e=i,this.state=ne.IDLE):this.state=ne.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case ne.IDLE:this.doTickIdle();break;case ne.WAITING_TRACK:{const{levels:t,trackId:i}=this,n=t==null?void 0:t[i],l=n==null?void 0:n.details;if(l&&!this.waitForLive(n)){if(this.waitForCdnTuneIn(l))break;this.state=ne.WAITING_INIT_PTS}break}case ne.FRAG_LOADING_WAITING_RETRY:{var e;const t=performance.now(),i=this.retryDate;if(!i||t>=i||(e=this.media)!=null&&e.seeking){const{levels:n,trackId:l}=this;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded((n==null?void 0:n[l])||null),this.state=ne.IDLE}break}case ne.WAITING_INIT_PTS:{const t=this.waitingData;if(t){const{frag:i,part:n,cache:l,complete:o}=t,u=this.mainAnchor;if(this.initPTS[i.cc]!==void 0){this.waitingData=null,this.state=ne.FRAG_LOADING;const d=l.flush().buffer,f={frag:i,part:n,payload:d,networkDetails:null};this._handleFragmentLoadProgress(f),o&&super._handleFragmentLoadComplete(f)}else u&&u.cc!==t.frag.cc&&(this.log(`Waiting fragment cc (${i.cc}) cancelled because video is at cc ${u.cc}`),this.nextLoadPosition=this.findSyncFrag(u).start,this.clearWaitingFragment())}else this.state=ne.IDLE}}this.onTickEnd()}clearWaitingFragment(){const e=this.waitingData;e&&(this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.fragmentTracker.removeFragment(e.frag),this.waitingData=null,this.state!==ne.STOPPED&&(this.state=ne.IDLE))}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:i,media:n,trackId:l}=this,o=t.config;if(!this.buffering||!n&&!this.primaryPrefetch&&(this.startFragRequested||!o.startFragPrefetch)||!(i!=null&&i[l]))return;const u=i[l],d=u.details;if(!d||this.waitForLive(u)||this.waitForCdnTuneIn(d)){this.state=ne.WAITING_TRACK,this.startFragRequested=!1;return}const f=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&f&&(this.bufferFlushed=!1,this.afterBufferFlushed(f,ze.AUDIO,ge.AUDIO));const m=this.getFwdBufferInfo(f,ge.AUDIO);if(m===null)return;if(!this.switchingTrack&&this._streamEnded(m,d)){t.trigger(A.BUFFER_EOS,{type:"audio"}),this.state=ne.ENDED;return}const g=m.len,v=t.maxBufferLength,E=d.fragments,y=E[0].start,S=this.getLoadPosition(),T=this.flushing?S:m.end;if(this.switchingTrack&&n){const _=S;d.PTSKnown&&_<y&&(m.end>y||m.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),n.currentTime=y+.05)}if(g>=v&&!this.switchingTrack&&T<E[E.length-1].start)return;let R=this.getNextFragment(T,d);if(R&&this.isLoopLoading(R,T)&&(R=this.getNextFragmentLoopLoading(R,d,m,ge.MAIN,v)),!R){this.bufferFlushed=!0;return}let D=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&D&&St(R)&&!R.endList&&(!d.live||!this.loadingParts&&T<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(D)===gt.OK&&(this.mainFragLoading=D=null),D&&St(D))){if(R.start>D.end){const O=this.fragmentTracker.getFragAtPos(T,ge.MAIN);O&&O.end>D.end&&(D=O,this.mainFragLoading={frag:O,targetBufferTime:null})}if(R.start>D.end)return}this.loadFragment(R,u,T)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(i=>new Ma(i))}onAudioTrackSwitching(e,t){const i=!!t.url;this.trackId=t.id;const{fragCurrent:n}=this;n&&(n.abortRequests(),this.removeUnbufferedFrags(n.start)),this.resetLoadingState(),i?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==ne.STOPPED&&(this.setInterval(Fy),this.state=ne.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const i=this.cachedTrackLoadedData;i&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(A.AUDIO_TRACK_LOADED,i))}onAudioTrackLoaded(e,t){var i;const{levels:n}=this,{details:l,id:o,groupId:u,track:d}=t;if(!n){this.warn(`Audio tracks reset while loading track ${o} "${d.name}" of "${u}"`);return}const f=this.mainDetails;if(!f||l.endCC>f.endCC||f.expired){this.cachedTrackLoadedData=t,this.state!==ne.STOPPED&&(this.state=ne.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${o} "${d.name}" of "${u}" loaded [${l.startSN},${l.endSN}]${l.lastPartSn?`[part-${l.lastPartSn}-${l.lastPartIndex}]`:""},duration:${l.totalduration}`);const m=n[o];let g=0;if(l.live||(i=m.details)!=null&&i.live){if(this.checkLiveUpdate(l),l.deltaUpdateFailed)return;if(m.details){var v;g=this.alignPlaylists(l,m.details,(v=this.levelLastLoaded)==null?void 0:v.details)}l.alignedSliding||(Mx(l,f),l.alignedSliding||Jo(l,f),g=l.fragmentStart)}m.details=l,this.levelLastLoaded=m,this.startFragRequested||this.setStartPosition(f,g),this.hls.trigger(A.AUDIO_TRACK_UPDATED,{details:l,id:o,groupId:t.groupId}),this.state===ne.WAITING_TRACK&&!this.waitForCdnTuneIn(l)&&(this.state=ne.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const i=e.frag,{part:n,payload:l}=e,{config:o,trackId:u,levels:d}=this;if(!d){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}const f=d[u];if(!f){this.warn("Audio track is undefined on fragment load progress");return}const m=f.details;if(!m){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(i.start);return}const g=o.defaultAudioCodec||f.audioCodec||"mp4a.40.2";let v=this.transmuxer;v||(v=this.transmuxer=new i1(this.hls,ge.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const E=this.initPTS[i.cc],y=(t=i.initSegment)==null?void 0:t.data;if(E!==void 0){const T=n?n.index:-1,R=T!==-1,D=new eh(i.level,i.sn,i.stats.chunkCount,l.byteLength,T,R);v.push(l,y,g,"",i,n,m.totalduration,!1,D,E)}else{this.log(`Unknown video PTS for cc ${i.cc}, waiting for video PTS before demuxing audio frag ${i.sn} of [${m.startSN} ,${m.endSN}],track ${u}`);const{cache:S}=this.waitingData=this.waitingData||{frag:i,part:n,cache:new Px,complete:!1};S.push(new Uint8Array(l)),this.state!==ne.STOPPED&&(this.state=ne.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const i=t.tracks.audio;i&&(this.mediaBuffer=i.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===ge.MAIN&&St(t.frag)&&(this.mainFragLoading=t,this.state===ne.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:i,part:n}=t;if(i.type!==ge.AUDIO){!this.audioOnly&&i.type===ge.MAIN&&!i.elementaryStreams.video&&!i.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${n?" p: "+n.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(St(i)){this.fragPrevious=i;const l=this.switchingTrack;l&&(this.bufferedTrack=l,this.switchingTrack=null,this.hls.trigger(A.AUDIO_TRACK_SWITCHED,$e({},l)))}this.fragBufferedComplete(i,n),this.media&&this.tick()}onError(e,t){var i;if(t.fatal){this.state=ne.ERROR;return}switch(t.details){case q.FRAG_GAP:case q.FRAG_PARSING_ERROR:case q.FRAG_DECRYPT_ERROR:case q.FRAG_LOAD_ERROR:case q.FRAG_LOAD_TIMEOUT:case q.KEY_LOAD_ERROR:case q.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(ge.AUDIO,t);break;case q.AUDIO_TRACK_LOAD_ERROR:case q.AUDIO_TRACK_LOAD_TIMEOUT:case q.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===ne.WAITING_TRACK&&((i=t.context)==null?void 0:i.type)===Ce.AUDIO_TRACK&&(this.state=ne.IDLE);break;case q.BUFFER_ADD_CODEC_ERROR:case q.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.resetLoadingState();break;case q.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case q.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==ze.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==ze.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===ne.ENDED&&(this.state=ne.IDLE);const i=this.mediaBuffer||this.media;i&&(this.afterBufferFlushed(i,t,ge.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const i="audio",{hls:n}=this,{remuxResult:l,chunkMeta:o}=e,u=this.getCurrentContext(o);if(!u){this.resetWhenMissingContext(o);return}const{frag:d,part:f,level:m}=u,{details:g}=m,{audio:v,text:E,id3:y,initSegment:S}=l;if(this.fragContextChanged(d)||!g){this.fragmentTracker.removeFragment(d);return}if(this.state=ne.PARSING,this.switchingTrack&&v&&this.completeAudioSwitch(this.switchingTrack),S!=null&&S.tracks){const T=d.initSegment||d;this._bufferInitSegment(m,S.tracks,T,o),n.trigger(A.FRAG_PARSING_INIT_SEGMENT,{frag:T,id:i,tracks:S.tracks})}if(v){const{startPTS:T,endPTS:R,startDTS:D,endDTS:_}=v;f&&(f.elementaryStreams[ze.AUDIO]={startPTS:T,endPTS:R,startDTS:D,endDTS:_}),d.setElementaryStreamInfo(ze.AUDIO,T,R,D,_),this.bufferFragmentData(v,d,f,o)}if(y!=null&&(t=y.samples)!=null&&t.length){const T=Ke({id:i,frag:d,details:g},y);n.trigger(A.FRAG_PARSING_METADATA,T)}if(E){const T=Ke({id:i,frag:d,details:g},E);n.trigger(A.FRAG_PARSING_USERDATA,T)}}_bufferInitSegment(e,t,i,n){if(this.state!==ne.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const l=t.audio;l.id=ge.AUDIO;const o=e.audioCodec;this.log(`Init audio buffer, container:${l.container}, codecs[level/parsed]=[${o}/${l.codec}]`),o&&o.split(",").length===1&&(l.levelCodec=o),this.hls.trigger(A.BUFFER_CODECS,t);const u=l.initSegment;if(u!=null&&u.byteLength){const d={type:"audio",frag:i,part:null,chunkMeta:n,parent:i.type,data:u};this.hls.trigger(A.BUFFER_APPENDING,d)}this.tickImmediate()}loadFragment(e,t,i){const n=this.fragmentTracker.getState(e);if(this.switchingTrack||n===gt.NOT_LOADED||n===gt.PARTIAL){var l;if(!St(e))this._loadInitSegment(e,t);else if((l=t.details)!=null&&l.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=ne.WAITING_INIT_PTS;const o=this.mainDetails;o&&o.fragmentStart!==t.details.fragmentStart&&Jo(t.details,o)}else super.loadFragment(e,t,i)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:i,assocLang:n,characteristics:l,audioCodec:o,channels:u}=this.bufferedTrack;vn({name:t,lang:i,assocLang:n,characteristics:l,audioCodec:o,channels:u},e,gn)||(Xo(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(A.AUDIO_TRACK_SWITCHED,$e({},e))}}class fh extends ms{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,i){const n=t==null?void 0:t.renditionReports;if(n){let l=-1;for(let o=0;o<n.length;o++){const u=n[o];let d;try{d=new self.URL(u.URI,t.url).href}catch(f){this.warn(`Could not construct new URL for Rendition Report: ${f}`),d=u.URI||""}if(d===e){l=o;break}else d===e.substring(0,d.length)&&(l=o)}if(l!==-1){const o=n[l],u=parseInt(o["LAST-MSN"])||(t==null?void 0:t.lastPartSn);let d=parseInt(o["LAST-PART"])||(t==null?void 0:t.lastPartIndex);if(this.hls.config.lowLatencyMode){const m=Math.min(t.age-t.partTarget,t.targetduration);d>=0&&m>t.partTarget&&(d+=1)}const f=i&&iy(i);return new sy(u,d>=0?d:void 0,f)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(i){this.warn(`Could not construct new URL with HLS Delivery Directives: ${i}`)}return e}playlistLoaded(e,t,i){const{details:n,stats:l}=t,o=self.performance.now(),u=l.loading.first?Math.max(0,o-l.loading.first):0;n.advancedDateTime=Date.now()-u;const d=this.hls.config.timelineOffset;if(d!==n.appliedTimelineOffset){const m=Math.max(d||0,0);n.appliedTimelineOffset=m,n.fragments.forEach(g=>{g.start=g.playlistOffset+m})}if(n.live||i!=null&&i.live){const m="levelInfo"in t?t.levelInfo:t.track;if(n.reloaded(i),i&&n.fragments.length>0){i2(i,n);const D=n.playlistParsingError;if(D){this.warn(D);const _=this.hls;if(!_.config.ignorePlaylistParsingErrors){var f;const{networkDetails:O}=t;_.trigger(A.ERROR,{type:pe.NETWORK_ERROR,details:q.LEVEL_PARSING_ERROR,fatal:!1,url:n.url,error:D,reason:D.message,level:t.level||void 0,parent:(f=n.fragments[0])==null?void 0:f.type,networkDetails:O,stats:l});return}n.playlistParsingError=null}}n.requestScheduled===-1&&(n.requestScheduled=l.loading.start);const g=this.hls.mainForwardBufferInfo,v=g?g.end-g.len:0,E=(n.edge-v)*1e3,y=Ix(n,E);if(n.requestScheduled+y<o?n.requestScheduled=o:n.requestScheduled+=y,this.log(`live playlist ${e} ${n.advanced?"REFRESHED "+n.lastPartSn+"-"+n.lastPartIndex:n.updated?"UPDATED":"MISSED"}`),!this.canLoad||!n.live)return;let S,T,R;if(n.canBlockReload&&n.endSN&&n.advanced){const D=this.hls.config.lowLatencyMode,_=n.lastPartSn,O=n.endSN,C=n.lastPartIndex,B=C!==-1,N=_===O;B?N?(T=O+1,R=D?0:C):(T=_,R=D?C+1:n.maxPartIndex):T=O+1;const F=n.age,z=F+n.ageHeader;let $=Math.min(z-n.partTarget,n.targetduration*1.5);if($>0){if(z>n.targetduration*3)this.log(`Playlist last advanced ${F.toFixed(2)}s ago. Omitting segment and part directives.`),T=void 0,R=void 0;else if(i!=null&&i.tuneInGoal&&z-n.partTarget>i.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${i.tuneInGoal} to: ${$} with playlist age: ${n.age}`),$=0;else{const ae=Math.floor($/n.targetduration);if(T+=ae,R!==void 0){const ce=Math.round($%n.targetduration/n.partTarget);R+=ce}this.log(`CDN Tune-in age: ${n.ageHeader}s last advanced ${F.toFixed(2)}s goal: ${$} skip sn ${ae} to part ${R}`)}n.tuneInGoal=$}if(S=this.getDeliveryDirectives(n,t.deliveryDirectives,T,R),D||!N){n.requestScheduled=o,this.loadingPlaylist(m,S);return}}else(n.canBlockReload||n.canSkipUntil)&&(S=this.getDeliveryDirectives(n,t.deliveryDirectives,T,R));S&&T!==void 0&&n.canBlockReload&&(n.requestScheduled=l.loading.first+Math.max(y-u*2,y/2)),this.scheduleLoading(m,S,n)}else this.clearTimer()}scheduleLoading(e,t,i){const n=i||e.details;if(!n){this.loadingPlaylist(e,t);return}const l=self.performance.now(),o=n.requestScheduled;if(l>=o){this.loadingPlaylist(e,t);return}const u=o-l;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(u)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),u)}getDeliveryDirectives(e,t,i,n){let l=iy(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(i=t.msn,n=t.part,l=Co.No),new sy(i,n,l)}checkRetry(e){const t=e.details,i=Qo(e),n=e.errorAction,{action:l,retryCount:o=0,retryConfig:u}=n||{},d=!!n&&!!u&&(l===It.RetryRequest||!n.resolved&&l===It.SendAlternateToPenaltyBox);if(d){var f;if(o>=u.maxNumRetry)return!1;if(i&&(f=e.context)!=null&&f.deliveryDirectives)this.warn(`Retrying playlist loading ${o+1}/${u.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const m=Zd(u,o);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),m),this.warn(`Retrying playlist loading ${o+1}/${u.maxNumRetry} after "${t}" in ${m}ms`)}e.levelRetry=!0,n.resolved=!0}return d}}function s1(r,e){if(r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(!$a(r[t].attrs,e[t].attrs))return!1;return!0}function $a(r,e,t){const i=r["STABLE-RENDITION-ID"];return i&&!t?i===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(n=>r[n]!==e[n])}function wd(r,e){return e.label.toLowerCase()===r.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(r.lang||"").toLowerCase())}class f_ extends fh{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.MANIFEST_PARSED,this.onManifestParsed,this),e.on(A.LEVEL_LOADING,this.onLevelLoading,this),e.on(A.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(A.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(A.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.MANIFEST_PARSED,this.onManifestParsed,this),e.off(A.LEVEL_LOADING,this.onLevelLoading,this),e.off(A.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(A.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(A.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:i,groupId:n,details:l}=t,o=this.tracksInGroup[i];if(!o||o.groupId!==n){this.warn(`Audio track with id:${i} and group:${n} not found in active group ${o==null?void 0:o.groupId}`);return}const u=o.details;o.details=t.details,this.log(`Audio track ${i} "${o.name}" lang:${o.lang} group:${n} loaded [${l.startSN}-${l.endSN}]`),i===this.trackId&&this.playlistLoaded(i,t,u)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const i=t.audioGroups||null,n=this.groupIds;let l=this.currentTrack;if(!i||(n==null?void 0:n.length)!==(i==null?void 0:i.length)||i!=null&&i.some(u=>(n==null?void 0:n.indexOf(u))===-1)){this.groupIds=i,this.trackId=-1,this.currentTrack=null;const u=this.tracks.filter(v=>!i||i.indexOf(v.groupId)!==-1);if(u.length)this.selectDefaultTrack&&!u.some(v=>v.default)&&(this.selectDefaultTrack=!1),u.forEach((v,E)=>{v.id=E});else if(!l&&!this.tracksInGroup.length)return;this.tracksInGroup=u;const d=this.hls.config.audioPreference;if(!l&&d){const v=Bi(d,u,gn);if(v>-1)l=u[v];else{const E=Bi(d,this.tracks);l=this.tracks[E]}}let f=this.findTrackId(l);f===-1&&l&&(f=this.findTrackId(null));const m={audioTracks:u};this.log(`Updating audio tracks, ${u.length} track(s) found in group(s): ${i==null?void 0:i.join(",")}`),this.hls.trigger(A.AUDIO_TRACKS_UPDATED,m);const g=this.trackId;if(f!==-1&&g===-1)this.setAudioTrack(f);else if(u.length&&g===-1){var o;const v=new Error(`No audio track selected for current audio group-ID(s): ${(o=this.groupIds)==null?void 0:o.join(",")} track count: ${u.length}`);this.warn(v.message),this.hls.trigger(A.ERROR,{type:pe.MEDIA_ERROR,details:q.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:v})}}}onError(e,t){t.fatal||!t.context||t.context.type===Ce.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const i=this.allAudioTracks;if(this.selectDefaultTrack=!1,i.length){const n=this.currentTrack;if(n&&vn(e,n,gn))return n;const l=Bi(e,this.tracksInGroup,gn);if(l>-1){const o=this.tracksInGroup[l];return this.setAudioTrack(l),o}else if(n){let o=t.loadLevel;o===-1&&(o=t.firstAutoLevel);const u=SL(e,t.levels,i,o,gn);if(u===-1)return null;t.nextLoadLevel=u}if(e.channels||e.audioCodec){const o=Bi(e,i);if(o>-1)return i[o]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const i=this.currentTrack,n=t[e],l=n.details&&!n.details.live;if(e===this.trackId&&n===i&&l||(this.log(`Switching to audio-track ${e} "${n.name}" lang:${n.lang} group:${n.groupId} channels:${n.channels}`),this.trackId=e,this.currentTrack=n,this.hls.trigger(A.AUDIO_TRACK_SWITCHING,$e({},n)),l))return;const o=this.switchParams(n.url,i==null?void 0:i.details,n.details);this.loadPlaylist(o)}findTrackId(e){const t=this.tracksInGroup;for(let i=0;i<t.length;i++){const n=t[i];if(!(this.selectDefaultTrack&&!n.default)&&(!e||vn(e,n,gn)))return i}if(e){const{name:i,lang:n,assocLang:l,characteristics:o,audioCodec:u,channels:d}=e;for(let f=0;f<t.length;f++){const m=t[f];if(vn({name:i,lang:n,assocLang:l,characteristics:o,audioCodec:u,channels:d},m,gn))return f}for(let f=0;f<t.length;f++){const m=t[f];if($a(e.attrs,m.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return f}for(let f=0;f<t.length;f++){const m=t[f];if($a(e.attrs,m.attrs,["LANGUAGE"]))return f}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&Xo(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const i=e.id,n=e.groupId,l=this.getUrlWithDirectives(e.url,t),o=e.details,u=o==null?void 0:o.age;this.log(`Loading audio-track ${i} "${e.name}" lang:${e.lang} group:${n}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${u&&o.live?" age "+u.toFixed(1)+(o.type&&" "+o.type||""):""} ${l}`),this.hls.trigger(A.AUDIO_TRACK_LOADING,{url:l,id:i,groupId:n,deliveryDirectives:t||null,track:e})}}class d_{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,i){if(this.queues===null||this.tracks===null)return;const n=this.queues[t];n.push(e),n.length===1&&!i&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const i={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(i,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const i={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(i)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const i=(t=e[0])==null?void 0:t.label;(i==="async-blocker"||i==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const n=t[0];try{n.execute()}catch(l){var i;if(n.onError(l),this.queues===null||this.tracks===null)return;const o=(i=this.tracks[e])==null?void 0:i.buffer;o!=null&&o.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,i;return(t=this.queues)!=null&&t[e]||(i=this.tracks)!=null&&i[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const i=(t=this.tracks)==null?void 0:t[e],n=i==null?void 0:i.buffer;return n?`SourceBuffer${n.updating?" updating":""}${i.ended?" ended":""}${i.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(i=>i.label).join(", "))||""}}const jy=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,n1="HlsJsTrackRemovedError";class h_ extends Error{constructor(e){super(e),this.name=n1}}class m_ extends ms{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=i=>{var n;this.hls&&((n=this.mediaSource)==null?void 0:n.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=i=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=i=>{const{media:n,mediaSource:l}=this;i&&this.log("Media source opened"),!(!n||!l)&&(l.removeEventListener("sourceopen",this._onMediaSourceOpen),n.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(A.MEDIA_ATTACHED,{media:n,mediaSource:l}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:i,_objectUrl:n}=this;i!==n&&this.error(`Media element src was set while attaching MediaSource (${n} > ${i})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=BR(Hs(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.MANIFEST_PARSED,this.onManifestParsed,this),e.on(A.BUFFER_RESET,this.onBufferReset,this),e.on(A.BUFFER_APPENDING,this.onBufferAppending,this),e.on(A.BUFFER_CODECS,this.onBufferCodecs,this),e.on(A.BUFFER_EOS,this.onBufferEos,this),e.on(A.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(A.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(A.FRAG_PARSED,this.onFragParsed,this),e.on(A.FRAG_CHANGED,this.onFragChanged,this),e.on(A.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.MANIFEST_PARSED,this.onManifestParsed,this),e.off(A.BUFFER_RESET,this.onBufferReset,this),e.off(A.BUFFER_APPENDING,this.onBufferAppending,this),e.off(A.BUFFER_CODECS,this.onBufferCodecs,this),e.off(A.BUFFER_EOS,this.onBufferEos,this),e.off(A.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(A.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(A.FRAG_PARSED,this.onFragParsed,this),e.off(A.FRAG_CHANGED,this.onFragChanged,this),e.off(A.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const i={};if(this.operationQueue){const l=this.isUpdating();l||this.operationQueue.removeBlockers();const o=this.isQueued();(l||o)&&this.warn(`Transfering MediaSource with${o?" operations in queue":""}${l?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const n=this.transferData;return!this.sourceBufferCount&&n&&n.mediaSource===t?Ke(i,n.tracks):this.sourceBuffers.forEach(l=>{const[o]=l;o&&(i[o]=Ke({},this.tracks[o]),this.removeBuffer(o)),l[0]=l[1]=null}),{media:e,mediaSource:t,tracks:i}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var i;let n=2;(t.audio&&!t.video||!t.altAudio)&&(n=1),this.bufferCodecEventsTotal=n,this.log(`${n} bufferCodec event(s) expected.`),(i=this.transferData)!=null&&i.mediaSource&&this.sourceBufferCount&&n&&this.bufferCreated()}onMediaAttaching(e,t){const i=this.media=t.media,n=Hs(this.appendSource);if(this.transferData=this.overrides=void 0,i&&n){const l=!!t.mediaSource;(l||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const o=this.mediaSource=t.mediaSource||new n;if(this.assignMediaSource(o),l)this._objectUrl=i.src,this.attachTransferred();else{const u=this._objectUrl=self.URL.createObjectURL(o);if(this.appendSource)try{i.removeAttribute("src");const d=self.ManagedMediaSource;i.disableRemotePlayback=i.disableRemotePlayback||d&&o instanceof d,$y(i),g_(i,u),i.load()}catch{i.src=u}else i.src=u}i.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,i;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(i=e.constructor)==null?void 0:i.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const i=this.tracks,n=t.tracks,l=n?Object.keys(n):null,o=l?l.length:0,u=()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()};if(n&&l&&o){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${et(i,(d,f)=>d==="initSegment"?void 0:f)};
transfer tracks: ${et(n,(d,f)=>d==="initSegment"?void 0:f)}}`),!nx(n,i)){t.mediaSource=null,t.tracks=void 0;const d=e.currentTime,f=this.details,m=Math.max(d,(f==null?void 0:f.fragments[0].start)||0);if(m-d>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${d} -> ${m}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(n)}"->"${Object.keys(i)}") start time: ${m} currentTime: ${d}`),this.onMediaDetaching(A.MEDIA_DETACHING,{}),this.onMediaAttaching(A.MEDIA_ATTACHING,t),e.currentTime=m;return}this.transferData=void 0,l.forEach(d=>{const f=d,m=n[f];if(m){const g=m.buffer;if(g){const v=this.fragmentTracker,E=m.id;if(v.hasFragments(E)||v.hasParts(E)){const T=De.getBuffered(g);v.detectEvictedFragments(f,T,E,null,!0)}const y=Wf(f),S=[f,g];this.sourceBuffers[y]=S,g.updating&&this.operationQueue&&this.operationQueue.prependBlocker(f),this.trackSourceBuffer(f,m)}}}),u(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),u()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const i=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:n,mediaSource:l,_objectUrl:o}=this;if(l){if(this.log(`media source ${i?"transferring":"detaching"}`),i)this.sourceBuffers.forEach(([u])=>{u&&this.removeBuffer(u)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const u=l.readyState==="open";try{const d=l.sourceBuffers;for(let f=d.length;f--;)u&&d[f].abort(),l.removeSourceBuffer(d[f]);u&&l.endOfStream()}catch(d){this.warn(`onMediaDetaching: ${d.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}l.removeEventListener("sourceopen",this._onMediaSourceOpen),l.removeEventListener("sourceended",this._onMediaSourceEnded),l.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(l.removeEventListener("startstreaming",this._onStartStreaming),l.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}n&&(n.removeEventListener("emptied",this._onMediaEmptied),i||(o&&self.URL.revokeObjectURL(o),this.mediaSrc===o?(n.removeAttribute("src"),this.appendSource&&$y(n),n.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(A.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const i=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),i)try{var n;(n=this.mediaSource)!=null&&n.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(i)}catch(l){this.warn(`onBufferReset ${e}`,l)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[Wf(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new d_(this.tracks)}onBufferCodecs(e,t){const i=this.tracks,n=Object.keys(t);this.log(`BUFFER_CODECS: "${n}" (current SB count ${this.sourceBufferCount})`);const l="audiovideo"in t&&(i.audio||i.video)||i.audiovideo&&("audio"in t||"video"in t),o=!l&&this.sourceBufferCount&&this.media&&n.some(u=>!i[u]);if(l||o){this.warn(`Unsupported transition between "${Object.keys(i)}" and "${n}" SourceBuffers`);return}n.forEach(u=>{var d,f,m;const g=t[u],{id:v,codec:E,levelCodec:y,container:S,metadata:T,supplemental:R}=g;let D=i[u];const _=(d=this.transferData)==null||(f=d.tracks)==null?void 0:f[u],O=_!=null&&_.buffer?_:D,C=(O==null?void 0:O.pendingCodec)||(O==null?void 0:O.codec),B=O==null?void 0:O.levelCodec;D||(D=i[u]={buffer:void 0,listeners:[],codec:E,supplemental:R,container:S,levelCodec:y,metadata:T,id:v});const N=Io(C,B),F=N==null?void 0:N.replace(jy,"$1");let z=Io(E,y);const $=(m=z)==null?void 0:m.replace(jy,"$1");z&&N&&F!==$&&(u.slice(0,5)==="audio"&&(z=Yo(z,this.appendSource)),this.log(`switching codec ${C} to ${z}`),z!==(D.pendingCodec||D.codec)&&(D.pendingCodec=z),D.container=S,this.appendChangeType(u,S,z))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&this.mediaSourceOpenOrEnded&&this.checkPendingTracks()}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const i=this.tracks[t];return e[t]={id:i.id,container:i.container,codec:i.codec,levelCodec:i.levelCodec},e},{})}appendChangeType(e,t,i){const n=`${t};codecs=${i}`,l={label:`change-type=${n}`,execute:()=>{const o=this.tracks[e];if(o){const u=o.buffer;u!=null&&u.changeType&&(this.log(`changing ${e} sourceBuffer type to ${n}`),u.changeType(n),o.codec=i,o.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:o=>{this.warn(`Failed to change ${e} SourceBuffer type`,o)}};this.append(l,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const i=e.start,n=i+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(i,ge.MAIN))==null?void 0:t.gap)===!0)return;const o={label:"block-audio",execute:()=>{var u;const d=this.tracks.video;(this.lastVideoAppendEnd>n||d!=null&&d.buffer&&De.isBuffered(d.buffer,n)||((u=this.fragmentTracker.getAppendedFrag(n,ge.MAIN))==null?void 0:u.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:u=>{this.warn("Error executing block-audio operation",u)}};this.blockedAudioAppend={op:o,frag:e},this.append(o,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:i}=this,{data:n,type:l,parent:o,frag:u,part:d,chunkMeta:f}=t,m=f.buffering[l],g=u.sn,v=self.performance.now();m.start=v;const E=u.stats.buffering,y=d?d.stats.buffering:null;E.start===0&&(E.start=v),y&&y.start===0&&(y.start=v);const S=i.audio;let T=!1;l==="audio"&&(S==null?void 0:S.container)==="audio/mpeg"&&(T=!this.lastMpegAudioChunk||f.id===1||this.lastMpegAudioChunk.sn!==f.sn,this.lastMpegAudioChunk=f);const R=this.tracks.video,D=R==null?void 0:R.buffer;if(D&&g!=="initSegment"){const C=d||u,B=this.blockedAudioAppend;if(l==="audio"&&o!=="main"&&!this.blockedAudioAppend){const F=C.start+C.duration*.05,z=D.buffered,$=this.currentOp("video");!z.length&&!$?this.blockAudio(C):!$&&!De.isBuffered(D,F)&&this.lastVideoAppendEnd<F&&this.blockAudio(C)}else if(l==="video"){const N=C.end;if(B){const F=B.frag.start;(N>F||N<this.lastVideoAppendEnd||De.isBuffered(D,F))&&this.unblockAudio()}this.lastVideoAppendEnd=N}}const _=(d||u).start,O={label:`append-${l}`,execute:()=>{if(m.executeStart=self.performance.now(),T){const C=this.tracks[l];if(C){const B=C.buffer;if(B){const N=_-B.timestampOffset;Math.abs(N)>=.1&&(this.log(`Updating audio SourceBuffer timestampOffset to ${_} (delta: ${N}) sn: ${g})`),B.timestampOffset=_)}}}this.appendExecutor(n,l)},onStart:()=>{},onComplete:()=>{const C=self.performance.now();m.executeEnd=m.end=C,E.first===0&&(E.first=C),y&&y.first===0&&(y.first=C);const B={};this.sourceBuffers.forEach(([N,F])=>{N&&(B[N]=De.getBuffered(F))}),this.appendErrors[l]=0,l==="audio"||l==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(A.BUFFER_APPENDED,{type:l,frag:u,part:d,chunkMeta:f,parent:u.type,timeRanges:B})},onError:C=>{var B;const N={type:pe.MEDIA_ERROR,parent:u.type,details:q.BUFFER_APPEND_ERROR,sourceBufferName:l,frag:u,part:d,chunkMeta:f,error:C,err:C,fatal:!1},F=(B=this.media)==null?void 0:B.error;if(C.code===DOMException.QUOTA_EXCEEDED_ERR)N.details=q.BUFFER_FULL_ERROR;else if(C.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!F)N.errorAction=Pa(!0);else if(C.name===n1&&this.sourceBufferCount===0)N.errorAction=Pa(!0);else{const z=++this.appendErrors[l];this.warn(`Failed ${z}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${l}" sourceBuffer (${F||"no media error"})`),(z>=this.hls.config.appendErrorMaxRetry||F)&&(N.fatal=!0)}this.hls.trigger(A.ERROR,N)}};this.append(O,l,this.isPending(this.tracks[l]))}getFlushOp(e,t,i){return this.log(`queuing "${e}" remove ${t}-${i}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,i)},onStart:()=>{},onComplete:()=>{this.hls.trigger(A.BUFFER_FLUSHED,{type:e})},onError:n=>{this.warn(`Failed to remove ${t}-${i} from "${e}" SourceBuffer`,n)}}}onBufferFlushing(e,t){const{type:i,startOffset:n,endOffset:l}=t;i?this.append(this.getFlushOp(i,n,l),i):this.sourceBuffers.forEach(([o])=>{o&&this.append(this.getFlushOp(o,n,l),o)})}onFragParsed(e,t){const{frag:i,part:n}=t,l=[],o=n?n.elementaryStreams:i.elementaryStreams;o[ze.AUDIOVIDEO]?l.push("audiovideo"):(o[ze.AUDIO]&&l.push("audio"),o[ze.VIDEO]&&l.push("video"));const u=()=>{const d=self.performance.now();i.stats.buffering.end=d,n&&(n.stats.buffering.end=d);const f=n?n.stats:i.stats;this.hls.trigger(A.FRAG_BUFFERED,{frag:i,part:n,stats:f,id:i.type})};l.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${i.type} level: ${i.level} sn: ${i.sn}`),this.blockBuffers(u,l).catch(d=>{this.warn(`Fragment buffered callback ${d}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{var t,i;return e&&(!((t=this.tracks[e])!=null&&t.ended)||((i=this.tracks[e])==null?void 0:i.ending))})}onBufferEos(e,t){var i;this.sourceBuffers.forEach(([o])=>{if(o){const u=this.tracks[o];(!t.type||t.type===o)&&(u.ending=!0,u.ended||(u.ended=!0,this.log(`${o} buffer reached EOS`)))}});const n=((i=this.overrides)==null?void 0:i.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([o])=>{var u;return o&&!((u=this.tracks[o])!=null&&u.ended)})&&(n?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:o}=this;if(!o||o.readyState!=="open"){o&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${o.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),o.endOfStream(),this.hls.trigger(A.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(A.BUFFERED_TO_END,void 0)))}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){const e=this.getDurationAndRange();e&&this.blockUntilOpen(()=>this.updateMediaSource(e))}onError(e,t){if(t.details===q.BUFFER_APPEND_ERROR&&t.frag){var i;const n=(i=t.errorAction)==null?void 0:i.nextAutoLevel;de(n)&&n!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:i}=this;if(!i||t===null||!this.sourceBufferCount)return;const n=e.config,l=i.currentTime,o=t.levelTargetDuration,u=t.live&&n.liveBackBufferLength!==null?n.liveBackBufferLength:n.backBufferLength;if(de(u)&&u>=0){const d=Math.max(u,o),f=Math.floor(l/o)*o-d;this.flushBackBuffer(l,o,f)}if(de(n.frontBufferFlushThreshold)&&n.frontBufferFlushThreshold>0){const d=Math.max(n.maxBufferLength,n.frontBufferFlushThreshold),f=Math.max(d,o),m=Math.floor(l/o)*o+f;this.flushFrontBuffer(l,o,m)}}flushBackBuffer(e,t,i){this.sourceBuffers.forEach(([n,l])=>{if(l){const u=De.getBuffered(l);if(u.length>0&&i>u.start(0)){var o;this.hls.trigger(A.BACK_BUFFER_REACHED,{bufferEnd:i});const d=this.tracks[n];if((o=this.details)!=null&&o.live)this.hls.trigger(A.LIVE_BACK_BUFFER_REACHED,{bufferEnd:i});else if(d!=null&&d.ended){this.log(`Cannot flush ${n} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(A.BUFFER_FLUSHING,{startOffset:0,endOffset:i,type:n})}}})}flushFrontBuffer(e,t,i){this.sourceBuffers.forEach(([n,l])=>{if(l){const o=De.getBuffered(l),u=o.length;if(u<2)return;const d=o.start(u-1),f=o.end(u-1);if(i>d||e>=d&&e<=f)return;this.hls.trigger(A.BUFFER_FLUSHING,{startOffset:d,endOffset:1/0,type:n})}})}getDurationAndRange(){var e;const{details:t,mediaSource:i}=this;if(!t||!this.media||(i==null?void 0:i.readyState)!=="open")return null;const n=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&t.live&&i.setLiveSeekableRange){const f=Math.max(0,t.fragmentStart),m=Math.max(f,n);return{duration:1/0,start:f,end:m}}return{duration:1/0}}const l=(e=this.overrides)==null?void 0:e.duration;if(l)return de(l)?{duration:l}:null;const o=this.media.duration,u=de(i.duration)?i.duration:0;return n>u&&n>o||!de(o)?{duration:n}:null}updateMediaSource({duration:e,start:t,end:i}){const n=this.mediaSource;!this.media||!n||n.readyState!=="open"||(n.duration!==e&&(de(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),n.duration=e),t!==void 0&&i!==void 0&&(this.log(`MediaSource duration is set to ${n.duration}. Setting seekable range to ${t}-${i}.`),n.setLiveSeekableRange(t,i)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:i}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${et(i)}`),this.tracksReady){var n;const l=(n=this.transferData)==null?void 0:n.tracks;l&&Object.keys(l).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,i])=>{if(t){const n=this.tracks[t];e[t]={buffer:i,container:n.container,codec:n.codec,supplemental:n.supplemental,levelCodec:n.levelCodec,id:n.id,metadata:n.metadata}}}),this.hls.trigger(A.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(A.ERROR,{type:pe.MEDIA_ERROR,details:q.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:i}=this;if(!i)throw new Error("createSourceBuffers called when mediaSource was null");for(const l in e){const o=l,u=e[o];if(this.isPending(u)){const d=this.getTrackCodec(u,o),f=`${u.container};codecs=${d}`;u.codec=d,this.log(`creating sourceBuffer(${f})${this.currentOp(o)?" Queued":""} ${et(u)}`);try{const m=i.addSourceBuffer(f),g=Wf(o),v=[o,m];t[g]=v,u.buffer=m}catch(m){var n;this.error(`error while trying to add sourceBuffer: ${m.message}`),this.shiftAndExecuteNext(o),(n=this.operationQueue)==null||n.removeBlockers(),delete this.tracks[o],this.hls.trigger(A.ERROR,{type:pe.MEDIA_ERROR,details:q.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:m,sourceBufferName:o,mimeType:f,parent:u.id});return}this.trackSourceBuffer(o,u)}}this.bufferCreated()}getTrackCodec(e,t){const i=e.supplemental;let n=e.codec;i&&(t==="video"||t==="audiovideo")&&Sd(i,"video")&&(n=lL(n,i));const l=Io(n,e.levelCodec);return l?t.slice(0,5)==="audio"?Yo(l,this.appendSource):l:""}trackSourceBuffer(e,t){const i=t.buffer;if(!i)return;const n=this.getTrackCodec(t,e);this.tracks[e]={buffer:i,codec:n,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(l,o)=>{const u=o.removedRanges;u!=null&&u.length&&this.hls.trigger(A.BUFFER_FLUSHED,{type:l})})}get mediaSrc(){var e,t;const i=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return i==null?void 0:i.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const i=this.currentOp(e);i&&(i.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var i;const n=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(i=this.mediaSource)==null?void 0:i.readyState}`);this.error(`${n}`,t),this.hls.trigger(A.ERROR,{type:pe.MEDIA_ERROR,details:q.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:n,fatal:!1});const l=this.currentOp(e);l&&l.onError(n)}removeExecutor(e,t,i){const{media:n,mediaSource:l}=this,o=this.tracks[e],u=o==null?void 0:o.buffer;if(!n||!l||!u){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const d=de(n.duration)?n.duration:1/0,f=de(l.duration)?l.duration:1/0,m=Math.max(0,t),g=Math.min(i,d,f);g>m&&(!o.ending||o.ended)?(o.ended=!1,this.log(`Removing [${m},${g}] from the ${e} SourceBuffer`),u.remove(m,g)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const i=this.tracks[t],n=i==null?void 0:i.buffer;if(!n)throw new h_(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);i.ending=!1,i.ended=!1,n.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:i}=this,n=t.map(o=>this.appendBlocker(o));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(n).then(o=>{i===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var i;const n=(i=this.tracks[t])==null?void 0:i.buffer;!n||n.updating||this.shiftAndExecuteNext(t)})}append(e,t,i){this.operationQueue&&this.operationQueue.append(e,t,i)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,i){const n=this.tracks[e];if(!n)return;const l=n.buffer;if(!l)return;const o=i.bind(this,e);n.listeners.push({event:t,listener:o}),l.addEventListener(t,o)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const i=t.buffer;i&&(t.listeners.forEach(n=>{i.removeEventListener(n.event,n.listener)}),t.listeners.length=0)}}function $y(r){const e=r.querySelectorAll("source");[].slice.call(e).forEach(t=>{r.removeChild(t)})}function g_(r,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,r.appendChild(t)}function Wf(r){return r==="audio"?1:0}class dh{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(A.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(A.MANIFEST_PARSED,this.onManifestParsed,this),e.on(A.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(A.BUFFER_CODECS,this.onBufferCodecs,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(A.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(A.MANIFEST_PARSED,this.onManifestParsed,this),e.off(A.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(A.BUFFER_CODECS,this.onBufferCodecs,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const i=this.hls.levels[t.droppedLevel];this.isLevelAllowed(i)&&this.restrictedLevels.push({bitrate:i.bitrate,height:i.height,width:i.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const i=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,i.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&de(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,i=this.getMaxLevel(e.length-1);i!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${i}: ${e[i].height}p@${e[i].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=i,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const i=t.filter((n,l)=>this.isLevelAllowed(n)&&l<=e);return this.clientRect=null,dh.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const i=e.getBoundingClientRect();t.width=i.width,t.height=i.height,!t.width&&!t.height&&(t.width=i.right-i.left||e.width||0,t.height=i.bottom-i.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(i=>e.bitrate===i.bitrate&&e.width===i.width&&e.height===i.height)}static getMaxLevelByMediaSize(e,t,i){if(!(e!=null&&e.length))return-1;const n=(u,d)=>d?u.width!==d.width||u.height!==d.height:!0;let l=e.length-1;const o=Math.max(t,i);for(let u=0;u<e.length;u+=1){const d=e[u];if((d.width>=o||d.height>=o)&&n(d,e[u+1])){l=u;break}}return l}}const p_={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},Ht=p_,y_={HLS:"h"},v_=y_,x_="CMCD-Object",E_="CMCD-Request",S_="CMCD-Session",T_="CMCD-Status",Da={OBJECT:x_,REQUEST:E_,SESSION:S_,STATUS:T_},b_={[Da.OBJECT]:["br","d","ot","tb"],[Da.REQUEST]:["bl","dl","mtp","nor","nrr","su"],[Da.SESSION]:["cid","pr","sf","sid","st","v"],[Da.STATUS]:["bs","rtp"]};class vr{constructor(e,t){Array.isArray(e)&&(e=e.map(i=>i instanceof vr?i:new vr(i))),this.value=e,this.params=t}}const A_="Dict";function R_(r){return Array.isArray(r)?JSON.stringify(r):r instanceof Map?"Map{}":r instanceof Set?"Set{}":typeof r=="object"?JSON.stringify(r):String(r)}function L_(r,e,t,i){return new Error(`failed to ${r} "${R_(e)}" as ${t}`,{cause:i})}function $i(r,e,t){return L_("serialize",r,e,t)}class r1{constructor(e){this.description=e}}const Gy="Bare Item",__="Boolean";function D_(r){if(typeof r!="boolean")throw $i(r,__);return r?"?1":"?0"}const w_="Byte Sequence";function I_(r){if(ArrayBuffer.isView(r)===!1)throw $i(r,w_);return`:${R2(r)}:`}const C_="Integer";function O_(r){return r<-999999999999999||999999999999999<r}function a1(r){if(O_(r))throw $i(r,C_);return r.toString()}function N_(r){return`@${a1(r.getTime()/1e3)}`}const k_="Decimal";function M_(r){const e=Hx(r,3);if(Math.floor(Math.abs(e)).toString().length>12)throw $i(r,k_);const t=e.toString();return t.includes(".")?t:`${t}.0`}const P_="String",U_=/[\x00-\x1f\x7f]+/;function B_(r){if(U_.test(r))throw $i(r,P_);return`"${r.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function F_(r){return r.description||r.toString().slice(7,-1)}const j_="Token";function Hy(r){const e=F_(r);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw $i(e,j_);return e}function Id(r){switch(typeof r){case"number":if(!de(r))throw $i(r,Gy);return Number.isInteger(r)?a1(r):M_(r);case"string":return B_(r);case"symbol":return Hy(r);case"boolean":return D_(r);case"object":if(r instanceof Date)return N_(r);if(r instanceof Uint8Array)return I_(r);if(r instanceof r1)return Hy(r);default:throw $i(r,Gy)}}const $_="Key";function Cd(r){if(/^[a-z*][a-z0-9\-_.*]*$/.test(r)===!1)throw $i(r,$_);return r}function hh(r){return r==null?"":Object.entries(r).map(([e,t])=>t===!0?`;${Cd(e)}`:`;${Cd(e)}=${Id(t)}`).join("")}function l1(r){return r instanceof vr?`${Id(r.value)}${hh(r.params)}`:Id(r)}function G_(r){return`(${r.value.map(l1).join(" ")})${hh(r.params)}`}function H_(r,e={whitespace:!0}){if(typeof r!="object")throw $i(r,A_);const t=r instanceof Map?r.entries():Object.entries(r),i=e!=null&&e.whitespace?" ":"";return Array.from(t).map(([n,l])=>{l instanceof vr||(l=new vr(l));let o=Cd(n);return l.value===!0?o+=hh(l.params):(o+="=",Array.isArray(l.value)?o+=G_(l):o+=l1(l)),o}).join(`,${i}`)}function V_(r,e){return H_(r,e)}function z_(r){return r==="ot"||r==="sf"||r==="st"}function K_(r){return typeof r=="number"?de(r):r!=null&&r!==""&&r!==!1}const ko=r=>Math.round(r),Y_=(r,e)=>(e!=null&&e.baseUrl&&(r=L2(r,e.baseUrl)),encodeURIComponent(r)),xo=r=>ko(r/100)*100,q_={br:ko,d:ko,bl:xo,dl:xo,mtp:xo,nor:Y_,rtp:xo,tb:ko};function X_(r,e){const t={};if(r==null||typeof r!="object")return t;const i=Object.keys(r).sort(),n=Ke({},q_,e==null?void 0:e.formatters),l=e==null?void 0:e.filter;return i.forEach(o=>{if(l!=null&&l(o))return;let u=r[o];const d=n[o];d&&(u=d(u,e)),!(o==="v"&&u===1)&&(o=="pr"&&u===1||K_(u)&&(z_(o)&&typeof u=="string"&&(u=new r1(u)),t[o]=u))}),t}function o1(r,e={}){return r?V_(X_(r,e),Ke({whitespace:!1},e)):""}function Q_(r,e={}){const t={};if(!r)return t;const i=Object.entries(r),n=Object.entries(b_).concat(Object.entries((e==null?void 0:e.customHeaderMap)||{})),l=i.reduce((o,u)=>{var d,f;const[m,g]=u,v=((d=n.find(E=>E[1].includes(m)))===null||d===void 0?void 0:d[0])||Da.REQUEST;return(f=o[v])!==null&&f!==void 0||(o[v]={}),o[v][m]=g,o},{});return Object.entries(l).reduce((o,[u,d])=>(o[u]=o1(d,e),o),t)}function W_(r,e,t){return Ke(r,Q_(e,t))}const Z_="CMCD";function J_(r,e={}){if(!r)return"";const t=o1(r,e);return`${Z_}=${encodeURIComponent(t)}`}const Vy=/CMCD=[^&#]+/;function eD(r,e,t){const i=J_(e,t);if(!i)return r;if(Vy.test(r))return r.replace(Vy,i);const n=r.includes("?")?"&":"?";return`${r}${n}${i}`}class tD{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=n=>{try{this.apply(n,{ot:Ht.MANIFEST,su:!this.initialized})}catch(l){this.hls.logger.warn("Could not generate manifest CMCD data.",l)}},this.applyFragmentData=n=>{try{const{frag:l,part:o}=n,u=this.hls.levels[l.level],d=this.getObjectType(l),f={d:(o||l).duration*1e3,ot:d};(d===Ht.VIDEO||d===Ht.AUDIO||d==Ht.MUXED)&&(f.br=u.bitrate/1e3,f.tb=this.getTopBandwidth(d)/1e3,f.bl=this.getBufferLength(d));const m=o?this.getNextPart(o):this.getNextFrag(l);m!=null&&m.url&&m.url!==l.url&&(f.nor=m.url),this.apply(n,f)}catch(l){this.hls.logger.warn("Could not generate segment CMCD data.",l)}},this.hls=e;const t=this.config=e.config,{cmcd:i}=t;i!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=i.sessionId||e.sessionId,this.cid=i.contentId,this.useHeaders=i.useHeaders===!0,this.includeKeys=i.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(A.MEDIA_DETACHED,this.onMediaDetached,this),e.on(A.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(A.MEDIA_DETACHED,this.onMediaDetached,this),e.off(A.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var i,n;this.audioBuffer=(i=t.tracks.audio)==null?void 0:i.buffer,this.videoBuffer=(n=t.tracks.video)==null?void 0:n.buffer}createData(){var e;return{v:1,sf:v_.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){Ke(t,this.createData());const i=t.ot===Ht.INIT||t.ot===Ht.VIDEO||t.ot===Ht.MUXED;this.starved&&i&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:n}=this;n&&(t=Object.keys(t).reduce((o,u)=>(n.includes(u)&&(o[u]=t[u]),o),{}));const l={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),W_(e.headers,t,l)):e.url=eD(e.url,t,l)}getNextFrag(e){var t;const i=(t=this.hls.levels[e.level])==null?void 0:t.details;if(i){const n=e.sn-i.startSN;return i.fragments[n+1]}}getNextPart(e){var t,i;const{index:n,fragment:l}=e,o=(t=this.hls.levels[l.level])==null||(i=t.details)==null?void 0:i.partList;if(o){const{sn:u}=l;for(let d=o.length-1;d>=0;d--){const f=o[d];if(f.index===n&&f.fragment.sn===u)return o[d+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return Ht.TIMED_TEXT;if(e.sn==="initSegment")return Ht.INIT;if(t==="audio")return Ht.AUDIO;if(t==="main")return this.hls.audioTracks.length?Ht.VIDEO:Ht.MUXED}getTopBandwidth(e){let t=0,i;const n=this.hls;if(e===Ht.AUDIO)i=n.audioTracks;else{const l=n.maxAutoLevel,o=l>-1?l+1:n.levels.length;i=n.levels.slice(0,o)}for(const l of i)l.bitrate>t&&(t=l.bitrate);return t>0?t:NaN}getBufferLength(e){const t=this.media,i=e===Ht.AUDIO?this.audioBuffer:this.videoBuffer;return!i||!t?NaN:De.bufferInfo(i,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,i=e||this.config.loader;return class{constructor(l){this.loader=void 0,this.loader=new i(l)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(l,o,u){t(l),this.loader.load(l,o,u)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,i=e||this.config.loader;return class{constructor(l){this.loader=void 0,this.loader=new i(l)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(l,o,u){t(l),this.loader.load(l,o,u)}}}}const iD=3e5;class sD extends ms{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(A.MANIFEST_PARSED,this.onManifestParsed,this),e.on(A.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(A.MANIFEST_PARSED,this.onManifestParsed,this),e.off(A.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(i=>i!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:i}=t;i!==null&&(this.pathwayId=i.pathwayId,this.uri=i.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:i}=t;if((i==null?void 0:i.action)===It.SendAlternateToPenaltyBox&&i.flags===Ei.MoveAllAlternatesMatchingHost){const n=this.levels;let l=this._pathwayPriority,o=this.pathwayId;if(t.context){const{groupId:u,pathwayId:d,type:f}=t.context;u&&n?o=this.getPathwayForGroupId(u,f,o):d&&(o=d)}o in this.penalizedPathways||(this.penalizedPathways[o]=performance.now()),!l&&n&&(l=this.pathways()),l&&l.length>1&&(this.updatePathwayPriority(l),i.resolved=this.pathwayId!==o),i.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${o} levels: ${n&&n.length} priorities: ${et(l)} penalized: ${et(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const i=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${i}"`),t=this.getLevelsForPathway(i),this.pathwayId=i}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const i=this.penalizedPathways,n=performance.now();Object.keys(i).forEach(l=>{n-i[l]>iD&&delete i[l]});for(let l=0;l<e.length;l++){const o=e[l];if(o in i)continue;if(o===this.pathwayId)return;const u=this.hls.nextLoadLevel,d=this.hls.levels[u];if(t=this.getLevelsForPathway(o),t.length>0){this.log(`Setting Pathway to "${o}"`),this.pathwayId=o,Nx(t),this.hls.trigger(A.LEVELS_UPDATED,{levels:t});const f=this.hls.levels[u];d&&f&&this.levels&&(f.attrs["STABLE-VARIANT-ID"]!==d.attrs["STABLE-VARIANT-ID"]&&f.bitrate!==d.bitrate&&this.log(`Unstable Pathways change from bitrate ${d.bitrate} to ${f.bitrate}`),this.hls.nextLoadLevel=u);break}}}getPathwayForGroupId(e,t,i){const n=this.getLevelsForPathway(i).concat(this.levels||[]);for(let l=0;l<n.length;l++)if(t===Ce.AUDIO_TRACK&&n[l].hasAudioGroup(e)||t===Ce.SUBTITLE_TRACK&&n[l].hasSubtitleGroup(e))return n[l].pathwayId;return i}clonePathways(e){const t=this.levels;if(!t)return;const i={},n={};e.forEach(l=>{const{ID:o,"BASE-ID":u,"URI-REPLACEMENT":d}=l;if(t.some(m=>m.pathwayId===o))return;const f=this.getLevelsForPathway(u).map(m=>{const g=new it(m.attrs);g["PATHWAY-ID"]=o;const v=g.AUDIO&&`${g.AUDIO}_clone_${o}`,E=g.SUBTITLES&&`${g.SUBTITLES}_clone_${o}`;v&&(i[g.AUDIO]=v,g.AUDIO=v),E&&(n[g.SUBTITLES]=E,g.SUBTITLES=E);const y=c1(m.uri,g["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",d),S=new Ma({attrs:g,audioCodec:m.audioCodec,bitrate:m.bitrate,height:m.height,name:m.name,url:y,videoCodec:m.videoCodec,width:m.width});if(m.audioGroups)for(let T=1;T<m.audioGroups.length;T++)S.addGroupId("audio",`${m.audioGroups[T]}_clone_${o}`);if(m.subtitleGroups)for(let T=1;T<m.subtitleGroups.length;T++)S.addGroupId("text",`${m.subtitleGroups[T]}_clone_${o}`);return S});t.push(...f),zy(this.audioTracks,i,d,o),zy(this.subtitleTracks,n,d,o)})}loadSteeringManifest(e){const t=this.hls.config,i=t.loader;this.loader&&this.loader.destroy(),this.loader=new i(t);let n;try{n=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(n.protocol!=="data:"){const m=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;n.searchParams.set("_HLS_pathway",this.pathwayId),n.searchParams.set("_HLS_throughput",""+m)}const l={responseType:"json",url:n.href},o=t.steeringManifestLoadPolicy.default,u=o.errorRetry||o.timeoutRetry||{},d={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:u.maxNumRetry||0,retryDelay:u.retryDelayMs||0,maxRetryDelay:u.maxRetryDelayMs||0},f={onSuccess:(m,g,v,E)=>{this.log(`Loaded steering manifest: "${n}"`);const y=m.data;if((y==null?void 0:y.VERSION)!==1){this.log(`Steering VERSION ${y.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=y.TTL;const{"RELOAD-URI":S,"PATHWAY-CLONES":T,"PATHWAY-PRIORITY":R}=y;if(S)try{this.uri=new self.URL(S,n).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${S}`);return}this.scheduleRefresh(this.uri||v.url),T&&this.clonePathways(T);const D={steeringManifest:y,url:n.toString()};this.hls.trigger(A.STEERING_MANIFEST_LOADED,D),R&&this.updatePathwayPriority(R)},onError:(m,g,v,E)=>{if(this.log(`Error loading steering manifest: ${m.code} ${m.text} (${g.url})`),this.stopLoad(),m.code===410){this.enabled=!1,this.log(`Steering manifest ${g.url} no longer available`);return}let y=this.timeToLoad*1e3;if(m.code===429){const S=this.loader;if(typeof(S==null?void 0:S.getResponseHeader)=="function"){const T=S.getResponseHeader("Retry-After");T&&(y=parseFloat(T)*1e3)}this.log(`Steering manifest ${g.url} rate limited`);return}this.scheduleRefresh(this.uri||g.url,y)},onTimeout:(m,g,v)=>{this.log(`Timeout loading steering manifest (${g.url})`),this.scheduleRefresh(this.uri||g.url)}};this.log(`Requesting steering manifest: ${n}`),this.loader.load(l,d,f)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var i;const n=(i=this.hls)==null?void 0:i.media;if(n&&!n.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function zy(r,e,t,i){r&&Object.keys(e).forEach(n=>{const l=r.filter(o=>o.groupId===n).map(o=>{const u=Ke({},o);return u.details=void 0,u.attrs=new it(u.attrs),u.url=u.attrs.URI=c1(o.url,o.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),u.groupId=u.attrs["GROUP-ID"]=e[n],u.attrs["PATHWAY-ID"]=i,u});r.push(...l)})}function c1(r,e,t,i){const{HOST:n,PARAMS:l,[t]:o}=i;let u;e&&(u=o==null?void 0:o[e],u&&(r=u));const d=new self.URL(r);return n&&!u&&(d.host=n),l&&Object.keys(l).sort().forEach(f=>{f&&d.searchParams.set(f,l[f])}),d.href}class mr extends ms{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=mr.CDMCleanupPromise?[mr.CDMCleanupPromise]:[],this.onMediaEncrypted=t=>{const{initDataType:i,initData:n}=t,l=`"${t.type}" event: init data type: "${i}"`;if(this.debug(l),n!==null){if(!this.keyFormatPromise){let o=Object.keys(this.keySystemAccessPromises);o.length||(o=go(this.config));const u=o.map(Hf).filter(d=>!!d);this.keyFormatPromise=this.getKeyFormatPromise(u)}this.keyFormatPromise.then(o=>{const u=$f(o);let d,f;if(i==="sinf"){if(u!==Ge.FAIRPLAY){this.warn(`Ignoring unexpected "${t.type}" event with init data type: "${i}" for selected key-system ${u}`);return}const y=mt(new Uint8Array(n));try{const S=ih(JSON.parse(y).sinf),T=fx(S);if(!T)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");d=new Uint8Array(T.subarray(8,24)),f=Ge.FAIRPLAY}catch(S){this.warn(`${l} Failed to parse sinf: ${S}`);return}}else{if(u!==Ge.WIDEVINE&&u!==Ge.PLAYREADY){this.warn(`Ignoring unexpected "${t.type}" event with init data type: "${i}" for selected key-system ${u}`);return}const y=sL(n),S=y.filter(R=>!!R.systemId&&Gf(R.systemId)===u);S.length>1&&this.warn(`${l} Using first of ${S.length} pssh found for selected key-system ${u}`);const T=S[0];if(!T){y.length===0||y.some(R=>!R.systemId)?this.warn(`${l} contains incomplete or invalid pssh data`):this.log(`ignoring ${l} for ${y.map(R=>Gf(R.systemId)).join(",")} pssh data in favor of playlist keys`);return}if(f=Gf(T.systemId),T.version===0&&T.data)if(f===Ge.WIDEVINE){const R=T.data.length-22;d=new Uint8Array(T.data.subarray(R,R+16))}else f===Ge.PLAYREADY&&(d=Lx(T.data))}if(!f||!d)return;const m=Pi.hexDump(d),{keyIdToKeySessionPromise:g,mediaKeySessions:v}=this;let E=g[m];for(let y=0;y<v.length;y++){const S=v[y],T=S.decryptdata;if(!T.keyId)continue;const R=Pi.hexDump(T.keyId);if(m===R||T.uri.replace(/-/g,"").indexOf(m)!==-1){if(E=g[R],T.pssh)break;delete g[R],T.pssh=new Uint8Array(n),T.keyId=d,E=g[m]=E.then(()=>this.generateRequestWithPreferredKeySession(S,i,n,"encrypted-event-key-match")),E.catch(D=>this.handleError(D));break}}if(!E){if(f!==u){this.log(`Ignoring "${t.type}" event with ${f} init data for selected key-system ${u}`);return}E=g[m]=this.getKeySystemSelectionPromise([f]).then(({keySystem:y,mediaKeys:S})=>{var T;this.throwIfDestroyed();const R=new Ua("ISO-23001-7",m,(T=Hf(y))!=null?T:"");return R.pssh=new Uint8Array(n),R.keyId=d,this.attemptSetMediaKeys(y,S).then(()=>{this.throwIfDestroyed();const D=this.createMediaKeySessionContext({decryptdata:R,keySystem:y,mediaKeys:S});return this.generateRequestWithPreferredKeySession(D,i,n,"encrypted-event-no-match")})}),E.catch(y=>this.handleError(y))}})}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){const e=this.media;this.unregisterListeners(),this.onMediaDetached(),this._clear(e);const t=this.config;t.requestMediaKeySystemAccessFunc=null,t.licenseXhrSetup=t.licenseResponseCallback=void 0,t.drmSystems=t.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(A.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(A.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(A.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(A.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(A.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(A.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:i}=this.config,n=t[e];if(n)return n.licenseUrl;if(e===Ge.WIDEVINE&&i)return i}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,i=t[e];if(i)return i.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,i=(o,u,d)=>!!o&&d.indexOf(o)===u,n=t.map(o=>o.audioCodec).filter(i),l=t.map(o=>o.videoCodec).filter(i);return n.length+l.length===0&&l.push("avc1.42e01e"),new Promise((o,u)=>{const d=f=>{const m=f.shift();this.getMediaKeysPromise(m,n,l).then(g=>o({keySystem:m,mediaKeys:g})).catch(g=>{f.length?d(f):g instanceof fi?u(g):u(new fi({type:pe.KEY_SYSTEM_ERROR,details:q.KEY_SYSTEM_NO_ACCESS,error:g,fatal:!0},g.message))})};d(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:i}=this.config;if(typeof i!="function"){let n=`Configured requestMediaKeySystemAccess is not a function ${i}`;return Rx===null&&self.location.protocol==="http:"&&(n=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(n))}return i(e,t)}getMediaKeysPromise(e,t,i){const n=qL(e,t,i,this.config.drmSystemOptions),l=this.keySystemAccessPromises[e];let o=l==null?void 0:l.keySystemAccess;if(!o){this.log(`Requesting encrypted media "${e}" key-system access with config: ${et(n)}`),o=this.requestMediaKeySystemAccess(e,n);const u=this.keySystemAccessPromises[e]={keySystemAccess:o};return o.catch(d=>{this.log(`Failed to obtain access to key-system "${e}": ${d}`)}),o.then(d=>{this.log(`Access for key-system "${d.keySystem}" obtained`);const f=this.fetchServerCertificate(e);return this.log(`Create media-keys for "${e}"`),u.mediaKeys=d.createMediaKeys().then(m=>(this.log(`Media-keys created for "${e}"`),f.then(g=>g?this.setMediaKeysServerCertificate(m,e,g):m))),u.mediaKeys.catch(m=>{this.error(`Failed to create media-keys for "${e}"}: ${m}`)}),u.mediaKeys})}return o.then(()=>l.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:i}){this.log(`Creating key-system session "${t}" keyId: ${Pi.hexDump(e.keyId||[])}`);const n=i.createSession(),l={decryptdata:e,keySystem:t,mediaKeys:i,mediaKeysSession:n,keyStatus:"status-pending"};return this.mediaKeySessions.push(l),l}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const i=this.createMediaKeySessionContext(e),n=this.getKeyIdString(t),l="cenc";this.keyIdToKeySessionPromise[n]=this.generateRequestWithPreferredKeySession(i,l,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}getKeyIdString(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(e.keyId===null)throw new Error("keyId is null");return Pi.hexDump(e.keyId)}updateKeySession(e,t){var i;const n=e.mediaKeysSession;return this.log(`Updating key-session "${n.sessionId}" for keyID ${Pi.hexDump(((i=e.decryptdata)==null?void 0:i.keyId)||[])}
      } (data length: ${t&&t.byteLength})`),n.update(t)}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){return new Promise((t,i)=>{const n=go(this.config),l=e.map($f).filter(o=>!!o&&n.indexOf(o)!==-1);return this.getKeySystemSelectionPromise(l).then(({keySystem:o})=>{const u=Hf(o);u?t(u):i(new Error(`Unable to find format for key-system "${o}"`))}).catch(i)})}loadKey(e){const t=e.keyInfo.decryptdata,i=this.getKeyIdString(t),n=`(keyId: ${i} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${n}`);let l=this.keyIdToKeySessionPromise[i];return l||(l=this.getKeySystemForKeyPromise(t).then(({keySystem:u,mediaKeys:d})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${n}`),this.attemptSetMediaKeys(u,d).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:u,mediaKeys:d,decryptdata:t}))))),(this.keyIdToKeySessionPromise[i]=l.then(u=>{const d="cenc",f=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(u,d,f,"playlist-key")})).catch(u=>this.handleError(u))),l}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e){this.hls&&(this.error(e.message),e instanceof fi?this.hls.trigger(A.ERROR,e.data):this.hls.trigger(A.ERROR,{type:pe.KEY_SYSTEM_ERROR,details:q.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))}getKeySystemForKeyPromise(e){const t=this.getKeyIdString(e),i=this.keyIdToKeySessionPromise[t];if(!i){const n=$f(e.keyFormat),l=n?[n]:go(this.config);return this.attemptKeySystemAccess(l)}return i}getKeySystemSelectionPromise(e){if(e.length||(e=go(this.config)),e.length===0)throw new fi({type:pe.KEY_SYSTEM_ERROR,details:q.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${et({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){const i=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const n=Promise.all(i).then(()=>{if(!this.media)throw new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)});return this.setMediaKeysQueue.push(n),n.then(()=>{this.log(`Media-keys set for "${e}"`),i.push(n),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(l=>i.indexOf(l)===-1)})}generateRequestWithPreferredKeySession(e,t,i,n){var l,o;const u=(l=this.config.drmSystems)==null||(o=l[e.keySystem])==null?void 0:o.generateRequest;if(u)try{const y=u.call(this.hls,t,i,e);if(!y)throw new Error("Invalid response from configured generateRequest filter");t=y.initDataType,i=y.initData?y.initData:null,e.decryptdata.pssh=i?new Uint8Array(i):null}catch(y){var d;if(this.warn(y.message),(d=this.hls)!=null&&d.config.debug)throw y}if(i===null)return this.log(`Skipping key-session request for "${n}" (no initData)`),Promise.resolve(e);const f=this.getKeyIdString(e.decryptdata);this.log(`Generating key-session request for "${n}": ${f} (init data type: ${t} length: ${i?i.byteLength:null})`);const m=new nh,g=e._onmessage=y=>{const S=e.mediaKeysSession;if(!S){m.emit("error",new Error("invalid state"));return}const{messageType:T,message:R}=y;this.log(`"${T}" message event for session "${S.sessionId}" message size: ${R.byteLength}`),T==="license-request"||T==="license-renewal"?this.renewLicense(e,R).catch(D=>{m.eventNames().length?m.emit("error",D):this.handleError(D)}):T==="license-release"?e.keySystem===Ge.FAIRPLAY&&(this.updateKeySession(e,Ad("acknowledged")),this.removeSession(e)):this.warn(`unhandled media key message type "${T}"`)},v=e._onkeystatuseschange=y=>{if(!e.mediaKeysSession){m.emit("error",new Error("invalid state"));return}this.onKeyStatusChange(e);const T=e.keyStatus;m.emit("keyStatus",T),T==="expired"&&(this.warn(`${e.keySystem} expired for key ${f}`),this.renewKeySession(e))};e.mediaKeysSession.addEventListener("message",g),e.mediaKeysSession.addEventListener("keystatuseschange",v);const E=new Promise((y,S)=>{m.on("error",S),m.on("keyStatus",T=>{T.startsWith("usable")?y():T==="output-restricted"?S(new fi({type:pe.KEY_SYSTEM_ERROR,details:q.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):T==="internal-error"?S(new fi({type:pe.KEY_SYSTEM_ERROR,details:q.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${T}"`)):T==="expired"?S(new Error("key expired while generating request")):this.warn(`unhandled key status change "${T}"`)})});return e.mediaKeysSession.generateRequest(t,i).then(()=>{var y;this.log(`Request generated for key-session "${(y=e.mediaKeysSession)==null?void 0:y.sessionId}" keyId: ${f}`)}).catch(y=>{throw new fi({type:pe.KEY_SYSTEM_ERROR,details:q.KEY_SYSTEM_NO_SESSION,error:y,fatal:!1},`Error generating key-session request: ${y}`)}).then(()=>E).catch(y=>{throw m.removeAllListeners(),this.removeSession(e),y}).then(()=>(m.removeAllListeners(),e))}onKeyStatusChange(e){e.mediaKeysSession.keyStatuses.forEach((t,i)=>{if(typeof i=="string"&&typeof t=="object"){const n=i;i=t,t=n}this.log(`key status change "${t}" for keyStatuses keyId: ${Pi.hexDump("buffer"in i?new Uint8Array(i.buffer,i.byteOffset,i.byteLength):new Uint8Array(i))} session keyId: ${Pi.hexDump(new Uint8Array(e.decryptdata.keyId||[]))} uri: ${e.decryptdata.uri}`),e.keyStatus=t})}fetchServerCertificate(e){const t=this.config,i=t.loader,n=new i(t),l=this.getServerCertificateUrl(e);return l?(this.log(`Fetching server certificate for "${e}"`),new Promise((o,u)=>{const d={responseType:"arraybuffer",url:l},f=t.certLoadPolicy.default,m={loadPolicy:f,timeout:f.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},g={onSuccess:(v,E,y,S)=>{o(v.data)},onError:(v,E,y,S)=>{u(new fi({type:pe.KEY_SYSTEM_ERROR,details:q.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:y,response:$e({url:d.url,data:void 0},v)},`"${e}" certificate request failed (${l}). Status: ${v.code} (${v.text})`))},onTimeout:(v,E,y)=>{u(new fi({type:pe.KEY_SYSTEM_ERROR,details:q.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:y,response:{url:d.url,data:void 0}},`"${e}" certificate request timed out (${l})`))},onAbort:(v,E,y)=>{u(new Error("aborted"))}};n.load(d,m,g)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,i){return new Promise((n,l)=>{e.setServerCertificate(i).then(o=>{this.log(`setServerCertificate ${o?"success":"not supported by CDM"} (${i==null?void 0:i.byteLength}) on "${t}"`),n(e)}).catch(o=>{l(new fi({type:pe.KEY_SYSTEM_ERROR,details:q.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:o,fatal:!0},o.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(i=>this.updateKeySession(e,new Uint8Array(i)).catch(n=>{throw new fi({type:pe.KEY_SYSTEM_ERROR,details:q.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:n,fatal:!0},n.message)}))}unpackPlayReadyKeyMessage(e,t){const i=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!i.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const n=new DOMParser().parseFromString(i,"application/xml"),l=n.querySelectorAll("HttpHeader");if(l.length>0){let m;for(let g=0,v=l.length;g<v;g++){var o,u;m=l[g];const E=(o=m.querySelector("name"))==null?void 0:o.textContent,y=(u=m.querySelector("value"))==null?void 0:u.textContent;E&&y&&e.setRequestHeader(E,y)}}const d=n.querySelector("Challenge"),f=d==null?void 0:d.textContent;if(!f)throw new Error("Cannot find <Challenge> in key message");return Ad(atob(f))}setupLicenseXHR(e,t,i,n){const l=this.config.licenseXhrSetup;return l?Promise.resolve().then(()=>{if(!i.decryptdata)throw new Error("Key removed");return l.call(this.hls,e,t,i,n)}).catch(o=>{if(!i.decryptdata)throw o;return e.open("POST",t,!0),l.call(this.hls,e,t,i,n)}).then(o=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:o||n})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:n}))}requestLicense(e,t){const i=this.config.keyLoadPolicy.default;return new Promise((n,l)=>{const o=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${o}`);const u=new XMLHttpRequest;u.responseType="arraybuffer",u.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return l(new Error("invalid state"));if(u.readyState===4)if(u.status===200){this._requestLicenseFailureCount=0;let d=u.response;this.log(`License received ${d instanceof ArrayBuffer?d.byteLength:d}`);const f=this.config.licenseResponseCallback;if(f)try{d=f.call(this.hls,u,o,e)}catch(m){this.error(m)}n(d)}else{const d=i.errorRetry,f=d?d.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>f||u.status>=400&&u.status<500)l(new fi({type:pe.KEY_SYSTEM_ERROR,details:q.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:u,response:{url:o,data:void 0,code:u.status,text:u.statusText}},`License Request XHR failed (${o}). Status: ${u.status} (${u.statusText})`));else{const m=f-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${m} attempts left`),this.requestLicense(e,t).then(n,l)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=u,this.setupLicenseXHR(u,o,e,t).then(({xhr:d,licenseChallenge:f})=>{e.keySystem==Ge.PLAYREADY&&(f=this.unpackPlayReadyKeyMessage(d,f)),d.send(f)})})}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const i=t.media;this.media=i,i.removeEventListener("encrypted",this.onMediaEncrypted),i.removeEventListener("waitingforkey",this.onWaitingForKey),i.addEventListener("encrypted",this.onMediaEncrypted),i.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){const e=this.media;e&&(e.removeEventListener("encrypted",this.onMediaEncrypted),e.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null)}_clear(e){var t;const i=this.mediaKeySessions;this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},Ua.clearKeyUriToKeyIdMap();const n=i.length;mr.CDMCleanupPromise=Promise.all(i.map(l=>this.removeSession(l)).concat(e==null||(t=e.setMediaKeys(null))==null?void 0:t.catch(l=>{var o;this.log(`Could not clear media keys: ${l}`),(o=this.hls)==null||o.trigger(A.ERROR,{type:pe.OTHER_ERROR,details:q.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${l}`)})}))).then(()=>{n&&(this.log("finished closing key sessions and clearing media keys"),i.length=0)}).catch(l=>{var o;this.log(`Could not close sessions and clear media keys: ${l}`),(o=this.hls)==null||o.trigger(A.ERROR,{type:pe.OTHER_ERROR,details:q.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${l}`)})})}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const i=t.reduce((n,l)=>(n.indexOf(l.keyFormat)===-1&&n.push(l.keyFormat),n),[]);this.log(`Selecting key-system from session-keys ${i.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(i)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:i}=e;if(t){this.log(`Remove licenses and keys and close session ${t.sessionId}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),i&&i.readyState!==XMLHttpRequest.DONE&&i.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const n=this.mediaKeySessions.indexOf(e);n>-1&&this.mediaKeySessions.splice(n,1);const{drmSystemOptions:l}=this.config;return(QL(l)?new Promise((u,d)=>{self.setTimeout(()=>d(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(u)}):Promise.resolve()).catch(u=>{var d;this.log(`Could not remove session: ${u}`),(d=this.hls)==null||d.trigger(A.ERROR,{type:pe.OTHER_ERROR,details:q.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${u}`)})}).then(()=>t.close()).catch(u=>{var d;this.log(`Could not close session: ${u}`),(d=this.hls)==null||d.trigger(A.ERROR,{type:pe.OTHER_ERROR,details:q.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${u}`)})})}}}mr.CDMCleanupPromise=void 0;class fi extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}class nD{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(A.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(A.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(A.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(A.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const i=this.hls.config;if(i.capLevelOnFPSDrop){const n=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=n,n&&typeof n.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),i.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,i){const n=performance.now();if(t){if(this.lastTime){const l=n-this.lastTime,o=i-this.lastDroppedFrames,u=t-this.lastDecodedFrames,d=1e3*o/l,f=this.hls;if(f.trigger(A.FPS_DROP,{currentDropped:o,currentDecoded:u,totalDroppedFrames:i}),d>0&&o>f.config.fpsDroppedMonitoringThreshold*u){let m=f.currentLevel;f.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+m),m>0&&(f.autoLevelCapping===-1||f.autoLevelCapping>=m)&&(m=m-1,f.trigger(A.FPS_DROP_LEVEL_CAPPING,{level:m,droppedLevel:f.currentLevel}),f.autoLevelCapping=m,this.streamController.nextLevelSwitch())}}this.lastTime=n,this.lastDroppedFrames=i,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function u1(r,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=r,e.dispatchEvent(t)}function f1(r,e){const t=r.mode;if(t==="disabled"&&(r.mode="hidden"),r.cues&&!r.cues.getCueById(e.id))try{if(r.addCue(e),!r.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(i){Me.debug(`[texttrack-utils]: ${i}`);try{const n=new self.TextTrackCue(e.startTime,e.endTime,e.text);n.id=e.id,r.addCue(n)}catch(n){Me.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${n}`)}}t==="disabled"&&(r.mode=t)}function dr(r,e){const t=r.mode;if(t==="disabled"&&(r.mode="hidden"),r.cues)for(let i=r.cues.length;i--;)e&&r.cues[i].removeEventListener("enter",e),r.removeCue(r.cues[i]);t==="disabled"&&(r.mode=t)}function Od(r,e,t,i){const n=r.mode;if(n==="disabled"&&(r.mode="hidden"),r.cues&&r.cues.length>0){const l=aD(r.cues,e,t);for(let o=0;o<l.length;o++)(!i||i(l[o]))&&r.removeCue(l[o])}n==="disabled"&&(r.mode=n)}function rD(r,e){if(e<=r[0].startTime)return 0;const t=r.length-1;if(e>r[t].endTime)return-1;let i=0,n=t,l;for(;i<=n;)if(l=Math.floor((n+i)/2),e<r[l].startTime)n=l-1;else if(e>r[l].startTime&&i<t)i=l+1;else return l;return r[i].startTime-e<e-r[n].startTime?i:n}function aD(r,e,t){const i=[],n=rD(r,e);if(n>-1)for(let l=n,o=r.length;l<o;l++){const u=r[l];if(u.startTime>=e&&u.endTime<=t)i.push(u);else if(u.startTime>t)return i}return i}function Mo(r){const e=[];for(let t=0;t<r.length;t++){const i=r[t];(i.kind==="subtitles"||i.kind==="captions")&&i.label&&e.push(r[t])}return e}class lD extends fh{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const i=Mo(this.media.textTracks);for(let l=0;l<i.length;l++)if(i[l].mode==="hidden")t=i[l];else if(i[l].mode==="showing"){t=i[l];break}const n=this.findTrackForTextTrack(t);this.subtitleTrack!==n&&this.setSubtitleTrack(n)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.MANIFEST_PARSED,this.onManifestParsed,this),e.on(A.LEVEL_LOADING,this.onLevelLoading,this),e.on(A.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(A.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(A.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.MANIFEST_PARSED,this.onManifestParsed,this),e.off(A.LEVEL_LOADING,this.onLevelLoading,this),e.off(A.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(A.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(A.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const i=this.media;if(!i)return;const n=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||i.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,n)return;Mo(i.textTracks).forEach(o=>{dr(o)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:i,groupId:n,details:l}=t,o=this.tracksInGroup[i];if(!o||o.groupId!==n){this.warn(`Subtitle track with id:${i} and group:${n} not found in active group ${o==null?void 0:o.groupId}`);return}const u=o.details;o.details=t.details,this.log(`Subtitle track ${i} "${o.name}" lang:${o.lang} group:${n} loaded [${l.startSN}-${l.endSN}]`),i===this.trackId&&this.playlistLoaded(i,t,u)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const i=t.subtitleGroups||null,n=this.groupIds;let l=this.currentTrack;if(!i||(n==null?void 0:n.length)!==(i==null?void 0:i.length)||i!=null&&i.some(o=>(n==null?void 0:n.indexOf(o))===-1)){this.groupIds=i,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(m=>!i||i.indexOf(m.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(m=>m.default)&&(this.selectDefaultTrack=!1),o.forEach((m,g)=>{m.id=g});else if(!l&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const u=this.hls.config.subtitlePreference;if(!l&&u){this.selectDefaultTrack=!1;const m=Bi(u,o);if(m>-1)l=o[m];else{const g=Bi(u,this.tracks);l=this.tracks[g]}}let d=this.findTrackId(l);d===-1&&l&&(d=this.findTrackId(null));const f={subtitleTracks:o};this.log(`Updating subtitle tracks, ${o.length} track(s) found in "${i==null?void 0:i.join(",")}" group-id`),this.hls.trigger(A.SUBTITLE_TRACKS_UPDATED,f),d!==-1&&this.trackId===-1&&this.setSubtitleTrack(d)}}findTrackId(e){const t=this.tracksInGroup,i=this.selectDefaultTrack;for(let n=0;n<t.length;n++){const l=t[n];if(!(i&&!l.default||!i&&!e)&&(!e||vn(l,e)))return n}if(e){for(let n=0;n<t.length;n++){const l=t[n];if($a(e.attrs,l.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return n}for(let n=0;n<t.length;n++){const l=t[n];if($a(e.attrs,l.attrs,["LANGUAGE"]))return n}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let i=0;i<t.length;i++){const n=t[i];if(wd(n,e))return i}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===Ce.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const i=this.currentTrack;if(i&&vn(e,i))return i;const n=Bi(e,this.tracksInGroup);if(n>-1){const l=this.tracksInGroup[n];return this.setSubtitleTrack(n),l}else{if(i)return null;{const l=Bi(e,t);if(l>-1)return t[l]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const i=e.id,n=e.groupId,l=this.getUrlWithDirectives(e.url,t),o=e.details,u=o==null?void 0:o.age;this.log(`Loading subtitle ${i} "${e.name}" lang:${e.lang} group:${n}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${u&&o.live?" age "+u.toFixed(1)+(o.type&&" "+o.type||""):""} ${l}`),this.hls.trigger(A.SUBTITLE_TRACK_LOADING,{url:l,id:i,groupId:n,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=Mo(e.textTracks),i=this.currentTrack;let n;if(i&&(n=t.filter(l=>wd(i,l))[0],n||this.warn(`Unable to find subtitle TextTrack with name "${i.name}" and language "${i.lang}"`)),[].slice.call(t).forEach(l=>{l.mode!=="disabled"&&l!==n&&(l.mode="disabled")}),n){const l=this.subtitleDisplay?"showing":"hidden";n.mode!==l&&(n.mode=l)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!de(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const i=this.currentTrack,n=t[e]||null;if(this.trackId=e,this.currentTrack=n,this.toggleTrackModes(),!n){this.hls.trigger(A.SUBTITLE_TRACK_SWITCH,{id:e});return}const l=!!n.details&&!n.details.live;if(e===this.trackId&&n===i&&l)return;this.log(`Switching to subtitle-track ${e}`+(n?` "${n.name}" lang:${n.lang} group:${n.groupId}`:""));const{id:o,groupId:u="",name:d,type:f,url:m}=n;this.hls.trigger(A.SUBTITLE_TRACK_SWITCH,{id:o,groupId:u,name:d,type:f,url:m});const g=this.switchParams(n.url,i==null?void 0:i.details,n.details);this.loadPlaylist(g)}}function Ca(r){let e=5381,t=r.length;for(;t;)e=e*33^r.charCodeAt(--t);return(e>>>0).toString()}const gr=.025;let tc=function(r){return r[r.Point=0]="Point",r[r.Range=1]="Range",r}({});function oD(r,e,t){return`${r.identifier}-${t+1}-${Ca(e)}`}class cD{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){if(e>=this.assetList.length)return!0;const t=this.playoutLimit;return e<=0||isNaN(t)?!1:this.assetList[e].startOffset>t}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return Zf(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,i=Zf(t,e);return t-i<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=de(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return Zf(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<gr))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?tc.Range:tc.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return uD(this)}}function Zf(r,e){return r-e.start<e.duration/2&&!(Math.abs(r-(e.start+e.duration))<gr)?e.start:e.start+e.duration}function d1(r,e,t){const i=new self.URL(r,t);return i.protocol!=="data:"&&i.searchParams.set("_HLS_primary_id",e),i}function uD(r){return`["${r.identifier}" ${r.cue.pre?"<pre>":r.cue.post?"<post>":""}${r.timelineStart.toFixed(2)}-${r.resumeTime.toFixed(2)}]`}function Nd(r){const e=r.timelineStart,t=r.duration||0;return`["${r.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class fD{constructor(e,t,i,n){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{const f=this.interstitial.playoutLimit,m=this.currentTime;this.startOffset+m>=f&&this.hls.trigger(A.PLAYOUT_LIMIT_REACHED,{})};const l=this.hls=new e(t);this.interstitial=i,this.assetItem=n;let o=n.uri;try{o=d1(o,l.sessionId).href}catch{}l.loadSource(o);const u=()=>{this.hasDetails=!0};l.once(A.LEVEL_LOADED,u),l.once(A.AUDIO_TRACK_LOADED,u),l.once(A.SUBTITLE_TRACK_LOADED,u),l.on(A.MEDIA_ATTACHING,(d,{media:f})=>{this.removeMediaListeners(),this.mediaAttached=f,this.interstitial.playoutLimit&&f.addEventListener("timeupdate",this.checkPlayout)})}bufferedInPlaceToEnd(e){var t;if(!this.interstitial.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e||!this._bufferedEosTime)return!1;const i=this.timelineOffset,n=De.bufferInfo(e,i,0);return this.getAssetTime(n.end)>=this._bufferedEosTime-.02}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=De.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;return e||0}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const i=e-t;if(Math.abs(i)>1/9e4){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,i=this.duration;return Math.min(Math.max(0,e-t),i)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls.destroy(),this.hls=this.interstitial=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){this.hls.attachMedia(e)}detachMedia(){this.removeMediaListeners(),this.mediaAttached=null,this.hls.detachMedia()}resumeBuffering(){this.hls.resumeBuffering()}pauseBuffering(){this.hls.pauseBuffering()}transferMedia(){return this.bufferSnapShot(),this.hls.transferMedia()}on(e,t,i){this.hls.on(e,t)}once(e,t,i){this.hls.once(e,t)}off(e,t,i){this.hls.off(e,t)}toString(){var e,t;return`HlsAssetPlayer: ${Nd(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${(t=this.interstitial)!=null&&t.appendInPlace?"append-in-place":""}`}}const Ky=.033;class dD extends ms{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((i,n)=>e<=n.startOffset&&t>n.startOffset?(delete n.error,i+1):i,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let i=-1;e.nextEvent?i=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(i=this.findEventIndex(e.previousEvent.identifier)+1);const n=this.items;if(n)for(n[i]||(t===void 0&&(t=e.start),i=this.findItemIndexAtTime(t));i>=0&&(l=n[i])!=null&&l.event;){var l;i--}return i}findItemIndexAtTime(e,t){const i=this.items;if(i)for(let n=0;n<i.length;n++){let l=i[n];if(t&&t!=="primary"&&(l=l[t]),e===l.start||e>l.start&&e<l.end)return n}return-1}findJumpRestrictedIndex(e,t){const i=this.items;if(i)for(let n=e;n<=t&&i[n];n++){const l=i[n].event;if(l!=null&&l.restrictions.jump&&!l.appendInPlace)return n}return-1}findEventIndex(e){const t=this.items;if(t)for(let n=t.length;n--;){var i;if(((i=t[n].event)==null?void 0:i.identifier)===e)return n}return-1}findAssetIndex(e,t){const i=e.assetList,n=i.length;if(n>1)for(let l=0;l<n;l++){const o=i[l];if(!o.error){const u=o.timelineStart;if(t===u||t>u&&t<u+(o.duration||0))return l}}return 0}get assetIdAtEnd(){var e,t;const i=(e=this.items)==null||(t=e[this.length-1])==null?void 0:t.event;if(i){const n=i.assetList,l=n[n.length-1];if(l)return l.identifier}return null}parseInterstitialDateRanges(e,t){const i=e.main.details,{dateRanges:n}=i,l=this.events,o=this.parseDateRanges(n,{url:i.url},t),u=Object.keys(n),d=l?l.filter(f=>!u.includes(f.identifier)):[];o.length&&o.sort((f,m)=>{const g=f.cue.pre,v=f.cue.post,E=m.cue.pre,y=m.cue.post;if(g&&!E)return-1;if(E&&!g||v&&!y)return 1;if(y&&!v)return-1;if(!g&&!E&&!v&&!y){const S=f.startTime,T=m.startTime;if(S!==T)return S-T}return f.dateRange.tagOrder-m.dateRange.tagOrder}),this.events=o,d.forEach(f=>{this.removeEvent(f)}),this.updateSchedule(e,d)}updateSchedule(e,t=[]){const i=this.events||[];if(i.length||t.length||this.length<2){const n=this.items,l=this.parseSchedule(i,e);(t.length||(n==null?void 0:n.length)!==l.length||l.some((u,d)=>Math.abs(u.playout.start-n[d].playout.start)>.005||Math.abs(u.playout.end-n[d].playout.end)>.005))&&(this.items=l,this.onScheduleUpdate(t,n))}}parseDateRanges(e,t,i){const n=[],l=Object.keys(e);for(let o=0;o<l.length;o++){const u=l[o],d=e[u];if(d.isInterstitial){let f=this.eventMap[u];f?f.setDateRange(d):(f=new cD(d,t),this.eventMap[u]=f,i===!1&&(f.appendInPlace=i)),n.push(f)}}return n}parseSchedule(e,t){const i=[],n=t.main.details,l=n.live?1/0:n.edge;let o=0;if(e=e.filter(d=>!d.error&&!(d.cue.once&&d.hasPlayed)),e.length){this.resolveOffsets(e,t);let d=0,f=0;if(e.forEach((m,g)=>{const v=m.cue.pre,E=m.cue.post,y=e[g-1]||null,S=m.appendInPlace,T=E?l:m.startOffset,R=m.duration,D=m.timelineOccupancy===tc.Range?R:0,_=m.resumptionOffset,O=(y==null?void 0:y.startTime)===T,C=T+m.cumulativeDuration;let B=S?C+R:T+_;if(v||!E&&T<=0){const F=f;f+=D,m.timelineStart=C;const z=o;o+=R,i.push({event:m,start:C,end:B,playout:{start:z,end:o},integrated:{start:F,end:f}})}else if(T<=l){if(!O){const $=T-d;if($>Ky){const ae=d,ce=f;f+=$;const ve=o;o+=$;const he={previousEvent:e[g-1]||null,nextEvent:m,start:ae,end:ae+$,playout:{start:ve,end:o},integrated:{start:ce,end:f}};i.push(he)}else $>0&&y&&(y.cumulativeDuration+=$,i[i.length-1].end=T)}E&&(B=C),m.timelineStart=C;const F=f;f+=D;const z=o;o+=R,i.push({event:m,start:C,end:B,playout:{start:z,end:o},integrated:{start:F,end:f}})}else return;const N=m.resumeTime;E||N>l?d=l:d=N}),d<l){var u;const m=d,g=f,v=l-d;f+=v;const E=o;o+=v,i.push({previousEvent:((u=i[i.length-1])==null?void 0:u.event)||null,nextEvent:null,start:d,end:m+v,playout:{start:E,end:o},integrated:{start:g,end:f}})}this.setDurations(l,o,f)}else i.push({previousEvent:null,nextEvent:null,start:0,end:l,playout:{start:0,end:l},integrated:{start:0,end:l}}),this.setDurations(l,l,l);return i}setDurations(e,t,i){this.durations={primary:e,playout:t,integrated:i}}resolveOffsets(e,t){const i=t.main.details,n=i.live?1/0:i.edge;let l=0,o=-1;e.forEach((u,d)=>{const f=u.cue.pre,m=u.cue.post,g=f?0:m?n:u.startTime;this.updateAssetDurations(u),o===g?u.cumulativeDuration=l:(l=0,o=g),!m&&u.snapOptions.in&&(u.resumeAnchor=En(null,i.fragments,u.startOffset+u.resumptionOffset,0,0)||void 0),u.appendInPlace&&!u.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(u,t)||(u.appendInPlace=!1)),!u.appendInPlace&&d+1<e.length&&e[d+1].startTime-e[d].resumeTime<Ky&&(e[d+1].appendInPlace=!1,e[d+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${u}`));const E=de(u.resumeOffset)?u.resumeOffset:u.duration;l+=E})}primaryCanResumeInPlaceAt(e,t){const i=e.resumeTime,n=e.startTime+e.resumptionOffset;return Math.abs(i-n)>gr?(this.log(`"${e.identifier}" resumption ${i} not aligned with estimated timeline end ${n}`),!1):t?!Object.keys(t).some(o=>{const u=t[o].details,d=u.edge;if(i>=d)return this.log(`"${e.identifier}" resumption ${i} past ${o} playlist end ${d}`),!1;const f=En(null,u.fragments,i);if(!f)return this.log(`"${e.identifier}" resumption ${i} does not align with any fragments in ${o} playlist (${u.fragStart}-${u.fragmentEnd})`),!0;const m=o==="audio"?.175:0;return Math.abs(f.start-i)<gr+m||Math.abs(f.end-i)<gr+m?!1:(this.log(`"${e.identifier}" resumption ${i} not aligned with ${o} fragment bounds (${f.start}-${f.end} sn: ${f.sn} cc: ${f.cc})`),!0)}):(this.log(`"${e.identifier}" resumption ${i} can not be aligned with media (none selected)`),!1)}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let i=0,n=!1,l=!1;e.assetList.forEach((o,u)=>{const d=t+i;o.startOffset=i,o.timelineStart=d,n||(n=o.duration===null),l||(l=!!o.error);const f=o.error?0:o.duration||0;i+=f}),n&&!l?e.duration=Math.max(i,e.duration):e.duration=i}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function js(r){return`[${r.event?'"'+r.event.identifier+'"':"primary"}: ${r.start.toFixed(2)}-${r.end.toFixed(2)}]`}class hD{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const i=e.assetListUrl;let n;try{n=d1(i,this.hls.sessionId,e.baseUrl)}catch(v){const E=this.assignAssetListError(e,q.ASSET_LIST_LOAD_ERROR,v,i);this.hls.trigger(A.ERROR,E);return}t&&n.protocol!=="data:"&&n.searchParams.set("_HLS_start_offset",""+t);const l=this.hls.config,o=l.loader,u=new o(l),d={responseType:"json",url:n.href},f=l.interstitialAssetListLoadPolicy.default,m={loadPolicy:f,timeout:f.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},g={onSuccess:(v,E,y,S)=>{const T=v.data,R=T==null?void 0:T.ASSETS;if(!Array.isArray(R)){const D=this.assignAssetListError(e,q.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),y.url,E,S);this.hls.trigger(A.ERROR,D);return}e.assetListResponse=T,this.hls.trigger(A.ASSET_LIST_LOADED,{event:e,assetListResponse:T,networkDetails:S})},onError:(v,E,y,S)=>{const T=this.assignAssetListError(e,q.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${v.code} ${v.text} (${E.url})`),E.url,S,y);this.hls.trigger(A.ERROR,T)},onTimeout:(v,E,y)=>{const S=this.assignAssetListError(e,q.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${E.url})`),E.url,v,y);this.hls.trigger(A.ERROR,S)}};return u.load(d,m,g),this.hls.trigger(A.ASSET_LIST_LOADING,{event:e}),u}assignAssetListError(e,t,i,n,l,o){return e.error=i,{type:pe.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:n,error:i,networkDetails:o,stats:l}}}function fs(r,e,t){ji(r,e,t),r.addEventListener(e,t)}function ji(r,e,t){r.removeEventListener(e,t)}function Yy(r){r==null||r.play().catch(()=>{})}class mD extends ms{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const i=this.currentTime;if(i===void 0||this.playbackDisabled)return;const n=i-this.timelinePos;if(Math.abs(n)<1/7056e5)return;const o=n<=-.01;this.timelinePos=i,this.bufferedPos=i;const u=this.playingItem;if(!u){this.checkBuffer();return}if(o&&this.schedule.resetErrorsInRange(i,i-n)&&this.updateSchedule(),this.checkBuffer(),o&&i<u.start||i>=u.end){var d;const v=this.schedule.findItemIndexAtTime(this.timelinePos);if(!this.isInterstitial(u)&&(d=this.media)!=null&&d.paused&&(this.shouldPlay=!1),!o){const E=this.findItemIndex(u);if(v>E){const y=this.schedule.findJumpRestrictedIndex(E+1,v);if(y>E){this.setSchedulePosition(y);return}}}this.setSchedulePosition(v);return}const f=this.playingAsset;if(!f){if(this.playingLastItem&&this.isInterstitial(u)){const v=u.event.assetList[0];v&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(i,v))}return}const m=f.timelineStart,g=f.duration||0;(o&&i<m||i>=m+g)&&this.setScheduleToAssetAtTime(i,f)},this.onTimeupdate=()=>{const i=this.currentTime;if(i===void 0||this.playbackDisabled)return;if(i>this.timelinePos)this.timelinePos=i,i>this.bufferedPos&&this.checkBuffer();else return;const n=this.playingItem;if(!n||this.playingLastItem)return;if(i>=n.end){this.timelinePos=n.end;const u=this.findItemIndex(n);this.setSchedulePosition(u+1)}const l=this.playingAsset;if(!l)return;const o=l.timelineStart+(l.duration||0);i>=o&&this.setScheduleToAssetAtTime(i,l)},this.onScheduleUpdate=(i,n)=>{const l=this.schedule,o=this.playingItem,u=l.events||[],d=l.items||[],f=l.durations,m=i.map(E=>E.identifier),g=!!(u.length||m.length);if(g&&this.log(`INTERSTITIALS_UPDATED (${u.length}): ${u}
Schedule: ${d.map(E=>js(E))}`),m.length&&this.log(`Removed events ${m}`),this.playerQueue.forEach(E=>{if(E.interstitial.appendInPlace){const y=E.assetItem.timelineStart,S=E.timelineOffset-y;if(S)try{E.timelineOffset=y}catch(T){Math.abs(S)>gr&&this.warn(`${T} ("${E.assetId}" ${E.timelineOffset}->${y})`)}}}),o){const E=this.updateItem(o,this.timelinePos);this.itemsMatch(o,E)&&(this.playingItem=E,this.waitingItem=this.endedItem=null)}else this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const v=this.bufferingItem;if(v){const E=this.updateItem(v,this.bufferedPos);this.itemsMatch(v,E)?this.bufferingItem=E:v.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(v.event,null))}if(i.forEach(E=>{E.assetList.forEach(y=>{this.clearAssetPlayer(y.identifier,null)})}),g||n){if(this.hls.trigger(A.INTERSTITIALS_UPDATED,{events:u.slice(0),schedule:d.slice(0),durations:f,removedIds:m}),this.isInterstitial(o)&&m.includes(o.event.identifier)){this.warn(`Interstitial "${o.event.identifier}" removed while playing`),this.primaryFallback(o.event);return}this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new hD(e),this.schedule=new dD(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e.on(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(A.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(A.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(A.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(A.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(A.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(A.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(A.BUFFER_APPENDED,this.onBufferAppended,this),e.on(A.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(A.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(A.MEDIA_ENDED,this.onMediaEnded,this),e.on(A.ERROR,this.onError,this),e.on(A.DESTROYING,this.onDestroying,this)}unregisterListeners(){const e=this.hls;e&&(e.off(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(A.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(A.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(A.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(A.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(A.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(A.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(A.BUFFER_CODECS,this.onBufferCodecs,this),e.off(A.BUFFER_APPENDED,this.onBufferAppended,this),e.off(A.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(A.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(A.MEDIA_ENDED,this.onMediaEnded,this),e.off(A.ERROR,this.onError,this),e.off(A.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.manager=null,this.hls=this.HlsPlayerClass=this.schedule=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){ji(e,"play",this.onPlay),ji(e,"pause",this.onPause),ji(e,"seeking",this.onSeeking),ji(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const i=this.media=t.media;fs(i,"seeking",this.onSeeking),fs(i,"timeupdate",this.onTimeupdate),fs(i,"play",this.onPlay),fs(i,"pause",this.onPause)}onMediaAttached(e,t){const i=this.effectivePlayingItem,n=this.detachedData;if(this.detachedData=null,i===null)this.checkStart();else if(!n){this.clearScheduleState();const l=this.findItemIndex(i);this.setSchedulePosition(l)}}clearScheduleState(){this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const i=!!t.transferMedia,n=this.media;if(this.media=null,!i&&(n&&this.removeMediaListeners(n),this.detachedData)){const l=this.getBufferingPlayer();l&&(this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,l.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.manager){if(!this.hls)return null;const e=this,t=()=>e.bufferingItem||e.waitingItem,i=g=>g&&e.getAssetPlayer(g.identifier),n=(g,v,E,y,S)=>{if(g){let T=g[v].start;const R=g.event;if(R){if(v==="playout"||R.timelineOccupancy!==tc.Point){const D=i(E);(D==null?void 0:D.interstitial)===R&&(T+=D.assetItem.startOffset+D[S])}}else{const D=y==="bufferedPos"?o():e[y];T+=D-g.start}return T}return 0},l=(g,v)=>{if(g!==0&&v!=="primary"&&e.schedule.length){var E;const y=e.schedule.findItemIndexAtTime(g),S=(E=e.schedule.items)==null?void 0:E[y];if(S){const T=S[v].start-S.start;return g+T}}return g},o=()=>{const g=e.bufferedPos;return g===Number.MAX_VALUE?u("primary"):Math.max(g,0)},u=g=>{var v;return(v=e.primaryDetails)!=null&&v.live?e.primaryDetails.edge:e.schedule.durations[g]},d=(g,v)=>{var E,y;const S=e.effectivePlayingItem;if(S!=null&&(E=S.event)!=null&&E.restrictions.skip)return;e.log(`seek to ${g} "${v}"`);const T=e.effectivePlayingItem,R=e.schedule.findItemIndexAtTime(g,v),D=(y=e.schedule.items)==null?void 0:y[R],_=e.getBufferingPlayer(),O=_==null?void 0:_.interstitial,C=O==null?void 0:O.appendInPlace,B=T&&e.itemsMatch(T,D);if(T&&(C||B)){const F=i(e.playingAsset),z=(F==null?void 0:F.media)||e.primaryMedia;if(z){const $=v==="primary"?z.currentTime:n(T,v,e.playingAsset,"timelinePos","currentTime"),ae=g-$,ce=(C?$:z.currentTime)+ae;if(ce>=0&&(!F||C||ce<=F.duration)){z.currentTime=ce;return}}}if(D){let F=g;if(v!=="primary"){const $=D[v].start,ae=g-$;F=D.start+ae}const z=!e.isInterstitial(D);if((!e.isInterstitial(T)||T.event.appendInPlace)&&(z||D.event.appendInPlace)){const $=e.media||(C?_==null?void 0:_.media:null);$&&($.currentTime=F)}else if(T){const $=e.findItemIndex(T);if(R>$){const ce=e.schedule.findJumpRestrictedIndex($+1,R);if(ce>$){e.setSchedulePosition(ce);return}}let ae=0;if(z)e.timelinePos=F,e.checkBuffer();else{var N;const ce=D==null||(N=D.event)==null?void 0:N.assetList;if(ce){const ve=g-(D[v]||D).start;for(let he=ce.length;he--;){const J=ce[he];if(J.duration&&ve>=J.startOffset&&ve<J.startOffset+J.duration){ae=he;break}}}}e.setSchedulePosition(R,ae)}}},f=()=>{const g=e.effectivePlayingItem;if(e.isInterstitial(g))return g;const v=t();return e.isInterstitial(v)?v:null},m={get currentTime(){const g=f(),v=e.effectivePlayingItem;return v&&v===g?n(v,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-v.playout.start:0},set currentTime(g){const v=f(),E=e.effectivePlayingItem;E&&E===v&&d(g+E.playout.start,"playout")},get duration(){const g=f();return g?g.playout.end-g.playout.start:0},get assetPlayers(){var g;const v=(g=f())==null?void 0:g.event.assetList;return v?v.map(E=>e.getAssetPlayer(E.identifier)):[]},get playingIndex(){var g;const v=(g=f())==null?void 0:g.event;return v&&e.effectivePlayingAsset?v.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return f()}};this.manager={get events(){var g,v;return((g=e.schedule)==null||(v=g.events)==null?void 0:v.slice(0))||[]},get schedule(){var g,v;return((g=e.schedule)==null||(v=g.items)==null?void 0:v.slice(0))||[]},get interstitialPlayer(){return f()?m:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const g=t();return e.findItemIndex(g)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const g=e.effectivePlayingItem;return e.findItemIndex(g)},primary:{get bufferedEnd(){return o()},get currentTime(){const g=e.timelinePos;return g>0?g:0},set currentTime(g){d(g,"primary")},get duration(){return u("primary")},get seekableStart(){var g;return((g=e.primaryDetails)==null?void 0:g.fragmentStart)||0}},integrated:{get bufferedEnd(){return n(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return n(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(g){d(g,"integrated")},get duration(){return u("integrated")},get seekableStart(){var g;return l(((g=e.primaryDetails)==null?void 0:g.fragmentStart)||0,"integrated")}},skip:()=>{const g=e.effectivePlayingItem,v=g==null?void 0:g.event;if(v&&!v.restrictions.skip){const E=e.findItemIndex(g);if(v.appendInPlace){const y=g.playout.start+g.event.duration;d(y+.001,"playout")}else e.advanceAfterAssetEnded(v,E,1/0)}}}}return this.manager}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,i=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!i?!1:this.findItemIndex(t)===i.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t,i;if(this.mediaSelection===null)return;const n=this.waitingItem||this.playingItem;if(this.isInterstitial(n)&&!n.event.appendInPlace)return;let l=this.media;!l&&(e=this.bufferingItem)!=null&&(t=e.event)!=null&&t.appendInPlace&&(l=this.primaryMedia);const o=(i=l)==null?void 0:i.currentTime;if(!(o===void 0||!de(o)))return o}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const i=this.getAssetPlayer(e);i&&this.transferMediaFromPlayer(i,t)}transferMediaFromPlayer(e,t){const i=e.interstitial.appendInPlace,n=e.media;if(i&&n===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&n){this.detachedData={media:n};return}const l=e.transferMedia();this.log(`transfer MediaSource from ${e} ${et(l)}`),this.detachedData=l}else t&&n&&(this.shouldPlay||(this.shouldPlay=!n.paused))}transferMediaTo(e,t){var i,n;if(e.media===t)return;let l=null;const o=this.hls,u=e!==o,d=u&&e.interstitial.appendInPlace,f=(i=this.detachedData)==null?void 0:i.mediaSource;let m;if(o.media)d&&(l=o.transferMedia(),this.detachedData=l),m="Primary";else if(f){const E=this.getBufferingPlayer();E?(l=E.transferMedia(),m=`${E}`):m="detached MediaSource"}else m="detached media";if(!l){if(f)l=this.detachedData,this.log(`using detachedData: MediaSource ${et(l)}`);else if(!this.detachedData||o.media===t){const E=this.playerQueue;E.length>1&&E.forEach(y=>{if(u&&y.interstitial.appendInPlace!==d){const S=y.interstitial;this.clearInterstitial(y.interstitial,null),S.appendInPlace=!1,S.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${S}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const g=l&&"mediaSource"in l&&((n=l.mediaSource)==null?void 0:n.readyState)!=="closed",v=g&&l?l:t;if(this.log(`${g?"transfering MediaSource":"attaching media"} to ${u?e:"Primary"} from ${m}`),v===l){const E=u&&e.assetId===this.schedule.assetIdAtEnd;v.overrides={duration:this.schedule.duration,endOfStream:!u||E,cueRemoval:!u}}e.attachMedia(v)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const i=this.timelinePos,n=this.effectivePlayingItem;if(i===-1){const l=this.hls.startPosition;if(this.timelinePos=l,t.length&&t[0].cue.pre){const o=e.findEventIndex(t[0].identifier);this.setSchedulePosition(o)}else if(l>=0||!this.primaryLive){const o=this.timelinePos=l>0?l:0,u=e.findItemIndexAtTime(o);this.setSchedulePosition(u)}}else if(n&&!this.playingItem){const l=e.findItemIndex(n);this.setSchedulePosition(l)}}advanceAfterAssetEnded(e,t,i){const n=i+1;if(!e.isAssetPastPlayoutLimit(n)&&!e.assetList[n].error)this.setSchedulePosition(t,n);else{const l=this.schedule.items;if(l){const o=t+1,u=l.length;if(o>=u){this.setSchedulePosition(-1);return}const d=e.resumeTime;this.timelinePos<d&&(this.timelinePos=d,this.checkBuffer()),this.setSchedulePosition(o)}}}setScheduleToAssetAtTime(e,t){const i=this.schedule,n=t.parentIdentifier,l=i.getEvent(n);if(l){const o=i.findEventIndex(n),u=i.findAssetIndex(l,e);this.setSchedulePosition(o,u)}}setSchedulePosition(e,t){const i=this.schedule.items;if(!i||this.playbackDisabled)return;this.log(`setSchedulePosition ${e}, ${t}`);const n=e>=0?i[e]:null,l=this.playingItem,o=this.playingLastItem;if(this.isInterstitial(l)){var u;const f=l.event,m=this.playingAsset,g=m==null?void 0:m.identifier,v=g?this.getAssetPlayer(g):null;if(v&&g&&(!this.eventItemsMatch(l,n)||t!==void 0&&g!==((u=f.assetList)==null?void 0:u[t].identifier))){var d;const E=f.findAssetIndex(m);this.log(`INTERSTITIAL_ASSET_ENDED ${E+1}/${f.assetList.length} ${Nd(m)}`),this.endedAsset=m,this.playingAsset=null,this.hls.trigger(A.INTERSTITIAL_ASSET_ENDED,{asset:m,assetListIndex:E,event:f,schedule:i.slice(0),scheduleIndex:e,player:v}),this.retreiveMediaSource(g,n),v.media&&!((d=this.detachedData)!=null&&d.mediaSource)&&v.detachMedia()}if(!this.eventItemsMatch(l,n)&&(this.endedItem=l,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${f} ${js(l)}`),f.hasPlayed=!0,this.hls.trigger(A.INTERSTITIAL_ENDED,{event:f,schedule:i.slice(0),scheduleIndex:e}),f.cue.once)){this.updateSchedule();const E=this.schedule.items;if(n&&E){const y=this.schedule.findItemIndex(n);this.advanceSchedule(y,E,t,l,o)}return}}this.advanceSchedule(e,i,t,l,o)}advanceSchedule(e,t,i,n,l){const o=e>=0?t[e]:null,u=this.primaryMedia,d=this.playerQueue;if(d.length&&d.forEach(f=>{const m=f.interstitial,g=this.schedule.findEventIndex(m.identifier);(g<e||g>e+1)&&this.clearInterstitial(m,o)}),this.isInterstitial(o)){this.timelinePos=Math.min(Math.max(this.timelinePos,o.start),o.end);const f=o.event;i===void 0&&(i=this.schedule.findAssetIndex(f,this.timelinePos));const m=this.waitingItem;this.assetsBuffered(o,u)||this.setBufferingItem(o);let g=this.preloadAssets(f,i);if(this.eventItemsMatch(o,m||n)||(this.waitingItem=o,this.log(`INTERSTITIAL_STARTED ${js(o)} ${f.appendInPlace?"append in place":""}`),this.hls.trigger(A.INTERSTITIAL_STARTED,{event:f,schedule:t.slice(0),scheduleIndex:e})),!f.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${f}`);return}if(f.assetListLoader&&(f.assetListLoader.destroy(),f.assetListLoader=void 0),!u){this.log(`Waiting for attachMedia to start Interstitial ${f}`);return}this.waitingItem=this.endedItem=null,this.playingItem=o;const v=f.assetList[i];if(!v){const E=t[e+1],y=this.media;E&&y&&!this.isInterstitial(E)&&y.currentTime<E.start&&(y.currentTime=this.timelinePos=E.start),this.advanceAfterAssetEnded(f,e,i||0);return}if(g||(g=this.getAssetPlayer(v.identifier)),g===null||g.destroyed){const E=f.assetList.length;this.warn(`asset ${i+1}/${E} player destroyed ${f}`),g=this.createAssetPlayer(f,v,i)}if(!this.eventItemsMatch(o,this.bufferingItem)&&f.appendInPlace&&this.isAssetBuffered(v))return;this.startAssetPlayer(g,i,t,e,u),this.shouldPlay&&Yy(g.media)}else o!==null?(this.resumePrimary(o,e,n),this.shouldPlay&&Yy(this.hls.media)):l&&this.isInterstitial(n)&&(this.endedItem=null,this.playingItem=n,n.event.appendInPlace||this.attachPrimary(this.schedule.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e,t;return(e=this.mediaSelection)==null||(t=e.main)==null?void 0:t.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,i){var n;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${js(e)}`),!((n=this.detachedData)!=null&&n.mediaSource)){let o=this.timelinePos;(o<e.start||o>=e.end)&&(o=this.getPrimaryResumption(e,t),this.timelinePos=o),this.attachPrimary(o,e)}if(!i)return;const l=this.schedule.items;l&&(this.log(`resumed ${js(e)}`),this.hls.trigger(A.INTERSTITIALS_PRIMARY_RESUMED,{schedule:l.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const i=e.start;if(this.primaryLive){const n=this.primaryDetails;if(t===0)return this.hls.startPosition;if(n&&(i<n.fragmentStart||i>n.edge))return this.hls.liveSyncPosition||-1}return i}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:De.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,i){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const n=this.primaryMedia;if(!n)return;const l=this.hls;l.media?this.checkBuffer():(this.transferMediaTo(l,n),i&&this.startLoadingPrimaryAt(e,i)),i||(this.timelinePos=e,this.startLoadingPrimaryAt(e,i))}startLoadingPrimaryAt(e,t){var i;const n=this.hls;!n.loadingEnabled||!n.media||Math.abs((((i=n.mainForwardBufferInfo)==null?void 0:i.start)||n.media.currentTime)-e)>.5?n.startLoad(e,t):n.bufferingEnabled||n.resumeBuffering()}onManifestLoading(){this.stopLoad(),this.schedule.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(A.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(A.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1)return;const i=this.hls.levels[t.level],n=$e($e({},this.mediaSelection||this.altSelection),{},{main:i});this.mediaSelection=n,this.schedule.parseInterstitialDateRanges(n,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const i=this.hls.audioTracks[t.id],n=this.mediaSelection;if(!n){this.altSelection=$e($e({},this.altSelection),{},{audio:i});return}const l=$e($e({},n),{},{audio:i});this.mediaSelection=l}onSubtitleTrackUpdated(e,t){const i=this.hls.subtitleTracks[t.id],n=this.mediaSelection;if(!n){this.altSelection=$e($e({},this.altSelection),{},{subtitles:i});return}const l=$e($e({},n),{},{subtitles:i});this.mediaSelection=l}onAudioTrackSwitching(e,t){const i=ry(t);this.playerQueue.forEach(n=>n.hls.setAudioOption(t)||n.hls.setAudioOption(i))}onSubtitleTrackSwitch(e,t){const i=ry(t);this.playerQueue.forEach(n=>n.hls.setSubtitleOption(t)||t.id!==-1&&n.hls.setSubtitleOption(i))}onBufferCodecs(e,t){const i=t.tracks;i&&(this.requiredTracks=i)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const i=this.playingItem;if(i&&!this.itemsMatch(i,this.bufferingItem)&&!this.isInterstitial(i)){const n=this.timelinePos;this.bufferedPos=n,this.checkBuffer()}}onBufferedToEnd(e){const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let n=0;n<t.length;n++){const l=t[n];if(l.cue.post){var i;const o=this.schedule.findEventIndex(l.identifier),u=(i=this.schedule.items)==null?void 0:i[o];this.isInterstitial(u)&&this.eventItemsMatch(u,this.bufferingItem)&&this.bufferedToItem(u,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const i=this.findItemIndex(t);this.setSchedulePosition(i+1)}else this.shouldPlay=!1}updateItem(e,t){const i=this.schedule.items;if(e&&i){const n=this.findItemIndex(e,t);return i[n]||null}return null}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var i;return!!t&&(e===t||e.event.identifier===((i=t.event)==null?void 0:i.identifier))}findItemIndex(e,t){return e?this.schedule.findItemIndex(e,t):-1}updateSchedule(){const e=this.mediaSelection;e&&this.schedule.updateSchedule(e,[])}checkBuffer(e){const t=this.schedule.items;if(!t)return;const i=De.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=i.len<1),this.updateBufferedPos(i.end,t,e)}updateBufferedPos(e,t,i){const n=this.schedule,l=this.bufferingItem;if(this.bufferedPos>e)return;if(t.length===1&&this.itemsMatch(t[0],l)){this.bufferedPos=e;return}const o=this.playingItem,u=this.findItemIndex(o);let d=n.findItemIndexAtTime(e);if(this.bufferedPos<e){var f,m;const g=this.findItemIndex(l),v=Math.min(g+1,t.length-1),E=t[v];if((d===-1&&l&&e>=l.end||(f=E.event)!=null&&f.appendInPlace&&e+.01>=E.start)&&(d=v),v-u>1&&(l==null||(m=l.event)==null?void 0:m.appendInPlace)===!1)return;if(this.bufferedPos=e,d>g&&d>u)this.bufferedToItem(E);else{const y=this.primaryDetails;this.primaryLive&&y&&e>y.edge-y.targetduration&&E.start<y.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(E)&&this.preloadAssets(E.event,0)}}else i&&o&&!this.itemsMatch(o,l)&&(d===u?this.bufferedToItem(o):d===u+1&&this.bufferedToItem(t[d]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(n=>{const l=this.getAssetPlayer(n.identifier);return!(l!=null&&l.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,i=this.schedule;if(this.itemsMatch(e,t))this.bufferingItem!==e&&(this.bufferingItem=e);else{const{items:n,events:l}=i;if(!n||!l)return t;const o=this.isInterstitial(e),u=this.getBufferingPlayer();if(this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos)),!this.playbackDisabled){const d=u?u.remaining:t?t.end-this.timelinePos:0;this.log(`buffered to boundary ${js(e)}`+(t?` (${d.toFixed(2)} remaining)`:"")),o?e.event.assetList.forEach(f=>{const m=this.getAssetPlayer(f.identifier);m&&m.resumeBuffering()}):(this.hls.resumeBuffering(),this.playerQueue.forEach(f=>f.pauseBuffering()))}this.hls.trigger(A.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:l.slice(0),schedule:n.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}return t}bufferedToItem(e,t=0){const i=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(i!==null){this.bufferingAsset=null;const n=this.detachedData;n?n.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),i=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(i)}bufferedToEvent(e,t){const i=e.event,n=i.assetList.length===0&&!i.assetListLoader,l=i.cue.once;if(n||!l){const o=this.preloadAssets(i,t);if(o!=null&&o.interstitial.appendInPlace){const u=i.assetList[t],d=this.primaryMedia;u&&d&&this.bufferAssetPlayer(o,d)}}}preloadAssets(e,t){const i=e.assetUrl,n=e.assetList.length,l=n===0&&!e.assetListLoader,o=e.cue.once;if(l){const d=e.timelineStart;if(e.appendInPlace){var u;const v=this.playingItem;!this.isInterstitial(v)&&(v==null||(u=v.nextEvent)==null?void 0:u.identifier)===e.identifier&&this.flushFrontBuffer(d+.25)}let f,m=0;if(!this.playingItem&&this.primaryLive&&(m=this.hls.startPosition,m===-1&&(m=this.hls.liveSyncPosition||0)),m&&!(e.cue.pre||e.cue.post)){const v=m-d;v>0&&(f=Math.round(v*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${i?1:n} ${e}${f?` live-start: ${m} start-offset: ${f}`:""}`),i)return this.createAsset(e,0,0,d,e.duration,i);const g=this.assetListLoader.loadAssetList(e,f);g&&(e.assetListLoader=g)}else if(!o&&n){for(let d=t;d<n;d++){const f=e.assetList[d],m=this.getAssetPlayerQueueIndex(f.identifier);(m===-1||this.playerQueue[m].destroyed)&&!f.error&&this.createAssetPlayer(e,f,d)}return this.getAssetPlayer(e.assetList[t].identifier)}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(n=>{this.hls.trigger(A.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:n})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let i=0;i<t.length;i++)if(e===t[i].assetId)return i;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let i=0;i<e.length;i++)if(e[i].media===t)return e[i]}return null}createAsset(e,t,i,n,l,o){const u={parentIdentifier:e.identifier,identifier:oD(e,o,t),duration:l,startOffset:i,timelineStart:n,uri:o};return this.createAssetPlayer(e,u,t)}createAssetPlayer(e,t,i){this.log(`create HLSAssetPlayer for ${Nd(t)}`);const n=this.hls,l=n.userConfig;let o=l.videoPreference;const u=n.loadLevelObj||n.levels[n.currentLevel];(o||u)&&(o=Ke({},o),u.videoCodec&&(o.videoCodec=u.videoCodec),u.videoRange&&(o.allowedVideoRanges=[u.videoRange]));const d=n.audioTracks[n.audioTrack],f=n.subtitleTracks[n.subtitleTrack];let m=0;if(this.primaryLive||e.appendInPlace){const _=this.timelinePos-t.timelineStart;if(_>1){const O=t.duration;O&&_<O&&(m=_)}}const g=t.identifier,v=$e($e({},l),{},{autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:n.sessionId,assetPlayerId:g,abrEwmaDefaultEstimate:n.bandwidthEstimate,interstitialsController:void 0,startPosition:m,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:o,audioPreference:d||l.audioPreference,subtitlePreference:f||l.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(v.timelineOffset=t.timelineStart));const E=v.cmcd;E!=null&&E.sessionId&&E.contentId&&(v.cmcd=Ke({},E,{contentId:Ca(t.uri)})),this.getAssetPlayer(g)&&this.warn(`Duplicate date range identifier ${e} and asset ${g}`);const y=new fD(this.HlsPlayerClass,v,e,t);this.playerQueue.push(y),e.assetList[i]=t;const S=_=>{if(_.live){const B=new Error(`Interstitials MUST be VOD assets ${e}`),N={fatal:!0,type:pe.OTHER_ERROR,details:q.INTERSTITIAL_ASSET_ITEM_ERROR,error:B};this.handleAssetItemError(N,e,this.schedule.findEventIndex(e.identifier),i,B.message);return}const O=_.edge-_.fragmentStart,C=t.duration;(C===null||O>C)&&(this.log(`Interstitial asset "${g}" duration change ${C} > ${O}`),t.duration=O,this.updateSchedule())};y.on(A.LEVEL_UPDATED,(_,{details:O})=>S(O)),y.on(A.LEVEL_PTS_UPDATED,(_,{details:O})=>S(O));const T=(_,O)=>{const C=this.getAssetPlayer(g);if(C&&O.tracks){C.off(A.BUFFER_CODECS,T),C.tracks=O.tracks;const B=this.primaryMedia;this.bufferingAsset===C.assetItem&&B&&!C.media&&this.bufferAssetPlayer(C,B)}};y.on(A.BUFFER_CODECS,T);const R=()=>{var _;const O=this.getAssetPlayer(g);if(this.log(`buffered to end of asset ${O}`),!O)return;const C=this.schedule.findEventIndex(e.identifier),B=e.findAssetIndex(t),N=B+1,F=(_=this.schedule.items)==null?void 0:_[C];if(this.isInterstitial(F))if(B!==-1&&!e.isAssetPastPlayoutLimit(N)&&!e.assetList[N].error)this.bufferedToItem(F,N);else{var z;const $=(z=this.schedule.items)==null?void 0:z[C+1];$&&this.bufferedToItem($)}};y.on(A.BUFFERED_TO_END,R);const D=_=>()=>{if(!this.getAssetPlayer(g))return;this.shouldPlay=!0;const C=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,C,_)};return y.once(A.MEDIA_ENDED,D(i)),y.once(A.PLAYOUT_LIMIT_REACHED,D(1/0)),y.on(A.ERROR,(_,O)=>{const C=this.getAssetPlayer(g);if(O.details===q.BUFFER_STALLED_ERROR){if(C!=null&&C.media){const B=C.currentTime,N=C.duration-B;B&&e.appendInPlace&&N/C.media.playbackRate<.5?(this.log(`Advancing buffer past end of asset ${g} ${e} at ${C.media.currentTime}`),R()):(this.warn(`Stalled at ${B} of ${B+N} in asset ${g} ${e}`),this.onTimeupdate(),this.checkBuffer(!0))}return}this.handleAssetItemError(O,e,this.schedule.findEventIndex(e.identifier),i,`Asset player error ${O.error} ${e}`)}),y.on(A.DESTROYING,()=>{if(!this.getAssetPlayer(g))return;const O=new Error(`Asset player destroyed unexpectedly ${g}`),C={fatal:!0,type:pe.OTHER_ERROR,details:q.INTERSTITIAL_ASSET_ITEM_ERROR,error:O};this.handleAssetItemError(C,e,this.schedule.findEventIndex(e.identifier),i,O.message)}),this.hls.trigger(A.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:i,event:e,player:y}),y}clearInterstitial(e,t){e.assetList.forEach(i=>{this.clearAssetPlayer(i.identifier,t)}),e.reset()}clearAssetPlayer(e,t){const i=this.getAssetPlayerQueueIndex(e);if(i!==-1){this.log(`clearAssetPlayer "${e}" toSegment: ${t&&js(t)}`);const n=this.playerQueue[i];this.transferMediaFromPlayer(n,t),this.playerQueue.splice(i,1),n.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,i,n,l){const{interstitial:o,assetItem:u,assetId:d}=e,f=o.assetList.length,m=this.playingAsset;this.endedAsset=null,this.playingAsset=u,(!m||m.identifier!==d)&&(m&&(this.clearAssetPlayer(m.identifier,i[n]),delete m.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${f} ${e}`),this.hls.trigger(A.INTERSTITIAL_ASSET_STARTED,{asset:u,assetListIndex:t,event:o,schedule:i.slice(0),scheduleIndex:n,player:e})),this.bufferAssetPlayer(e,l)}bufferAssetPlayer(e,t){var i,n;const{interstitial:l,assetItem:o,assetId:u}=e,d=this.schedule.findEventIndex(l.identifier),f=(i=this.schedule.items)==null?void 0:i[d];if(!f)return;this.setBufferingItem(f),this.bufferingAsset=o;const m=this.getBufferingPlayer();if(m===e)return;const g=l.appendInPlace;if(g&&(m==null?void 0:m.interstitial.appendInPlace)===!1)return;const v=(m==null?void 0:m.tracks)||((n=this.detachedData)==null?void 0:n.tracks)||this.requiredTracks;if(g&&o!==this.playingAsset){if(!e.tracks)return;if(v&&!nx(v,e.tracks)){const E=new Error(`Asset "${u}" SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(v)}')`),y={fatal:!0,type:pe.OTHER_ERROR,details:q.INTERSTITIAL_ASSET_ITEM_ERROR,error:E},S=l.findAssetIndex(o);this.handleAssetItemError(y,l,d,S,E.message);return}}this.transferMediaTo(e,t)}handleAssetItemError(e,t,i,n,l){if(e.details===q.BUFFER_STALLED_ERROR)return;const o=t.assetList[n]||null;let u=null;if(o){const g=this.getAssetPlayerQueueIndex(o.identifier);u=this.playerQueue[g]||null}const d=this.schedule.items,f=Ke({},e,{fatal:!1,errorAction:Pa(!0),asset:o,assetListIndex:n,event:t,schedule:d,scheduleIndex:i,player:u});if(this.warn(`Asset item error: ${e.error}`),this.hls.trigger(A.INTERSTITIAL_ASSET_ERROR,f),!e.fatal)return;const m=new Error(l);o&&(this.playingAsset!==o&&this.clearAssetPlayer(o.identifier,null),o.error=m),t.assetList.some(g=>!g.error)?t.appendInPlace&&(t.error=m):t.error=m,this.primaryFallback(t)}primaryFallback(e){const t=e.timelineStart,i=this.effectivePlayingItem;if(this.updateSchedule(),i){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${this.timelinePos} playing: ${i?js(i):"<none>"} error: ${e.error}`),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t));let n=this.timelinePos;n===-1&&(n=this.hls.startPosition);const l=this.updateItem(i,n);if(this.itemsMatch(i,l))this.clearInterstitial(e,null);else{const o=this.schedule.findItemIndexAtTime(n);this.setSchedulePosition(o)}}else this.checkStart()}onAssetListLoaded(e,t){var i;const n=t.event,l=n.identifier,o=t.assetListResponse.ASSETS;if(!this.schedule.hasEvent(l))return;const u=n.timelineStart,d=n.duration;let f=0;o.forEach((y,S)=>{const T=parseFloat(y.DURATION);this.createAsset(n,S,f,u+f,T,y.URI),f+=T}),n.duration=f,this.log(`Loaded asset-list with duration: ${f} (was: ${d}) ${n}`);const m=this.waitingItem,g=(m==null?void 0:m.event.identifier)===l;this.updateSchedule();const v=(i=this.bufferingItem)==null?void 0:i.event;if(g){var E;const y=this.schedule.findEventIndex(l),S=(E=this.schedule.items)==null?void 0:E[y];if(S){if(!this.playingItem&&this.timelinePos>S.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==y){n.error=new Error(`Interstitial no longer within playback range ${this.timelinePos} ${n}`),this.primaryFallback(n);return}this.setBufferingItem(S)}this.setSchedulePosition(y)}else if((v==null?void 0:v.identifier)===l&&v.appendInPlace){const y=n.assetList[0],S=this.getAssetPlayer(y.identifier),T=this.primaryMedia;y&&S&&T&&this.bufferAssetPlayer(S,T)}}onError(e,t){switch(t.details){case q.ASSET_LIST_PARSING_ERROR:case q.ASSET_LIST_LOAD_ERROR:case q.ASSET_LIST_LOAD_TIMEOUT:{const i=t.interstitial;i&&this.primaryFallback(i);break}case q.BUFFER_STALLED_ERROR:{this.onTimeupdate(),this.checkBuffer(!0);break}}}}const qy=500;class gD extends sh{constructor(e,t,i){super(e,t,i,"subtitle-stream-controller",ge.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(A.LEVEL_LOADED,this.onLevelLoaded,this),e.on(A.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(A.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(A.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(A.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(A.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(A.LEVEL_LOADED,this.onLevelLoaded,this),e.off(A.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(A.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(A.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(A.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(A.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=ne.IDLE,this.setInterval(qy),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:i,success:n}=t;if(St(i)&&(this.fragPrevious=i),this.state=ne.IDLE,!n)return;const l=this.tracksBuffered[this.currentTrackId];if(!l)return;let o;const u=i.start;for(let f=0;f<l.length;f++)if(u>=l[f].start&&u<=l[f].end){o=l[f];break}const d=i.start+i.duration;o?o.end=d:(o={start:u,end:d},l.push(o)),this.fragmentTracker.fragBuffered(i),this.fragBufferedComplete(i,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:i,endOffset:n}=t;if(i===0&&n!==Number.POSITIVE_INFINITY){const l=n-1;if(l<=0)return;t.endOffsetSubtitles=Math.max(0,l),this.tracksBuffered.forEach(o=>{for(let u=0;u<o.length;){if(o[u].end<=l){o.shift();continue}else if(o[u].start<l)o[u].start=l;else break;u++}}),this.fragmentTracker.removeFragmentsInRange(i,l,ge.SUBTITLE)}}onError(e,t){const i=t.frag;(i==null?void 0:i.type)===ge.SUBTITLE&&(t.details===q.FRAG_GAP&&this.fragmentTracker.fragBuffered(i,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==ne.STOPPED&&(this.state=ne.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&s1(this.levels,t)){this.levels=t.map(i=>new Ma(i));return}this.tracksBuffered=[],this.levels=t.map(i=>{const n=new Ma(i);return this.tracksBuffered[n.id]=[],n}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,ge.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var i;if(this.currentTrackId=t.id,!((i=this.levels)!=null&&i.length)||this.currentTrackId===-1){this.clearInterval();return}const n=this.levels[this.currentTrackId];n!=null&&n.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,n&&this.state!==ne.STOPPED&&this.setInterval(qy)}onSubtitleTrackLoaded(e,t){var i;const{currentTrackId:n,levels:l}=this,{details:o,id:u}=t;if(!l){this.warn(`Subtitle tracks were reset while loading level ${u}`);return}const d=l[u];if(u>=l.length||!d)return;this.log(`Subtitle track ${u} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""},duration:${o.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let f=0;if(o.live||(i=d.details)!=null&&i.live){const g=this.mainDetails;if(o.deltaUpdateFailed||!g)return;const v=g.fragments[0];if(!d.details)o.hasProgramDateTime&&g.hasProgramDateTime?(Jo(o,g),f=o.fragmentStart):v&&(f=v.start,Ld(o,f));else{var m;f=this.alignPlaylists(o,d.details,(m=this.levelLastLoaded)==null?void 0:m.details),f===0&&v&&(f=v.start,Ld(o,f))}}d.details=o,this.levelLastLoaded=d,u===n&&(this.hls.trigger(A.SUBTITLE_TRACK_UPDATED,{details:o,id:u,groupId:t.groupId}),this.tick(),o.live&&!this.fragCurrent&&this.media&&this.state===ne.IDLE&&(En(null,o.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),d.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:i}=e,n=t.decryptdata,l=this.hls;if(!this.fragContextChanged(t)&&i&&i.byteLength>0&&n!=null&&n.key&&n.iv&&hr(n.method)){const o=performance.now();this.decrypter.decrypt(new Uint8Array(i),n.key.buffer,n.iv.buffer,th(n.method)).catch(u=>{throw l.trigger(A.ERROR,{type:pe.MEDIA_ERROR,details:q.FRAG_DECRYPT_ERROR,fatal:!1,error:u,reason:u.message,frag:t}),u}).then(u=>{const d=performance.now();l.trigger(A.FRAG_DECRYPTED,{frag:t,payload:u,stats:{tstart:o,tdecrypt:d}})}).catch(u=>{this.warn(`${u.name}: ${u.message}`),this.state=ne.IDLE})}}doTick(){if(!this.media){this.state=ne.IDLE;return}if(this.state===ne.IDLE){const{currentTrackId:e,levels:t}=this,i=t==null?void 0:t[e];if(!i||!t.length||!i.details||this.waitForLive(i))return;const{config:n}=this,l=this.getLoadPosition(),o=De.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],l,n.maxBufferHole),{end:u,len:d}=o,f=i.details,m=this.hls.maxBufferLength+f.levelTargetDuration;if(d>m)return;const g=f.fragments,v=g.length,E=f.edge;let y=null;const S=this.fragPrevious;if(u<E){const D=n.maxFragLookUpTolerance,_=u>E-D?0:D;y=En(S,g,Math.max(g[0].start,u),_),!y&&S&&S.start<g[0].start&&(y=g[0])}else y=g[v-1];if(y=this.filterReplacedPrimary(y,i.details),!y)return;const T=y.sn-f.startSN,R=g[T-1];if(R&&R.cc===y.cc&&this.fragmentTracker.getState(R)===gt.NOT_LOADED&&(y=R),this.fragmentTracker.getState(y)===gt.NOT_LOADED){const D=this.mapToInitFragWhenRequired(y);D&&this.loadFragment(D,i,u)}}}loadFragment(e,t,i){St(e)?super.loadFragment(e,t,i):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new pD(this.tracksBuffered[this.currentTrackId]||[])}}class pD{constructor(e){this.buffered=void 0;const t=(i,n,l)=>{if(n=n>>>0,n>l-1)throw new DOMException(`Failed to execute '${i}' on 'TimeRanges': The index provided (${n}) is greater than the maximum bound (${l})`);return e[n][i]};this.buffered={get length(){return e.length},end(i){return t("end",i,e.length)},start(i){return t("start",i,e.length)}}}}const yD={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},h1=r=>String.fromCharCode(yD[r]||r),xi=15,os=100,vD={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},xD={17:2,18:4,21:6,22:8,23:10,19:13,20:15},ED={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},SD={25:2,26:4,29:6,30:8,31:10,27:13,28:15},TD=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class bD{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const i=typeof t=="function"?t():t;Me.log(`${this.time} [${e}] ${i}`)}}}const mn=function(e){const t=[];for(let i=0;i<e.length;i++)t.push(e[i].toString(16));return t};class m1{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let i=0;i<t.length;i++){const n=t[i];e.hasOwnProperty(n)&&(this[n]=e[n])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class AD{constructor(){this.uchar=" ",this.penState=new m1}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class RD{constructor(e){this.chars=[],this.pos=0,this.currPenState=new m1,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<os;t++)this.chars.push(new AD);this.logger=e}equals(e){for(let t=0;t<os;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<os;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<os;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>os&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=os)}moveCursor(e){const t=this.pos+e;if(e>1)for(let i=this.pos+1;i<t+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=h1(e);if(this.pos>=os){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<os;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let i=0;i<os;i++){const n=this.chars[i].uchar;n!==" "&&(t=!1),e.push(n)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class Jf{constructor(e){this.rows=[],this.currRow=xi-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<xi;t++)this.rows.push(new RD(e));this.logger=e}reset(){for(let e=0;e<xi;e++)this.rows[e].clear();this.currRow=xi-1}equals(e){let t=!0;for(let i=0;i<xi;i++)if(!this.rows[i].equals(e.rows[i])){t=!1;break}return t}copy(e){for(let t=0;t<xi;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<xi;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+et(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let u=0;u<xi;u++)this.rows[u].clear();const l=this.currRow+1-this.nrRollUpRows,o=this.lastOutputScreen;if(o){const u=o.rows[l].cueStartTime,d=this.logger.time;if(u!==null&&d!==null&&u<d)for(let f=0;f<this.nrRollUpRows;f++)this.rows[t-this.nrRollUpRows+f+1].copy(o.rows[l+f])}}this.currRow=t;const i=this.rows[this.currRow];if(e.indent!==null){const l=e.indent,o=Math.max(l-1,0);i.setCursor(e.indent),e.color=i.chars[o].penState.foreground}const n={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(n)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+et(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let i="",n=-1;for(let l=0;l<xi;l++){const o=this.rows[l].getTextString();o&&(n=l+1,e?t.push("Row "+n+": '"+o+"'"):t.push(o.trim()))}return t.length>0&&(e?i="["+t.join(" | ")+"]":i=t.join(`
`)),i}getTextAndFormat(){return this.rows}}class Xy{constructor(e,t,i){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Jf(i),this.nonDisplayedMemory=new Jf(i),this.lastOutputScreen=new Jf(i),this.currRollUpRow=this.displayedMemory.rows[xi-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=i}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[xi-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let i=0;i<e.length;i++)this.writeScreen.insertChar(e[i]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const i=Math.floor(e/2)-16,n=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=n[i]}this.logger.log(2,"MIDROW: "+et(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class Qy{constructor(e,t,i){this.channels=void 0,this.currentChannel=0,this.cmdHistory=_D(),this.logger=void 0;const n=this.logger=new bD;this.channels=[null,new Xy(e,t,n),new Xy(e+1,i,n)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let i=0;i<t.length;i+=2){const n=t[i]&127,l=t[i+1]&127;let o=!1,u=null;if(n===0&&l===0)continue;this.logger.log(3,()=>"["+mn([t[i],t[i+1]])+"] -> ("+mn([n,l])+")");const d=this.cmdHistory;if(n>=16&&n<=31){if(LD(n,l,d)){Eo(null,null,d),this.logger.log(3,()=>"Repeated command ("+mn([n,l])+") is dropped");continue}Eo(n,l,this.cmdHistory),o=this.parseCmd(n,l),o||(o=this.parseMidrow(n,l)),o||(o=this.parsePAC(n,l)),o||(o=this.parseBackgroundAttributes(n,l))}else Eo(null,null,d);if(!o&&(u=this.parseChars(n,l),u)){const m=this.currentChannel;m&&m>0?this.channels[m].insertChars(u):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!o&&!u&&this.logger.log(2,()=>"Couldn't parse cleaned data "+mn([n,l])+" orig: "+mn([t[i],t[i+1]]))}}parseCmd(e,t){const i=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,n=(e===23||e===31)&&t>=33&&t<=35;if(!(i||n))return!1;const l=e===20||e===21||e===23?1:2,o=this.channels[l];return e===20||e===21||e===28||e===29?t===32?o.ccRCL():t===33?o.ccBS():t===34?o.ccAOF():t===35?o.ccAON():t===36?o.ccDER():t===37?o.ccRU(2):t===38?o.ccRU(3):t===39?o.ccRU(4):t===40?o.ccFON():t===41?o.ccRDC():t===42?o.ccTR():t===43?o.ccRTD():t===44?o.ccEDM():t===45?o.ccCR():t===46?o.ccENM():t===47&&o.ccEOC():o.ccTO(t-32),this.currentChannel=l,!0}parseMidrow(e,t){let i=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?i=1:i=2,i!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const n=this.channels[i];return n?(n.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+mn([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let i;const n=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,l=(e===16||e===24)&&t>=64&&t<=95;if(!(n||l))return!1;const o=e<=23?1:2;t>=64&&t<=95?i=o===1?vD[e]:ED[e]:i=o===1?xD[e]:SD[e];const u=this.channels[o];return u?(u.setPAC(this.interpretPAC(i,t)),this.currentChannel=o,!0):!1}interpretPAC(e,t){let i;const n={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?i=t-96:i=t-64,n.underline=(i&1)===1,i<=13?n.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(n.italics=!0,n.color="white"):n.indent=Math.floor((i-16)/2)*4,n}parseChars(e,t){let i,n=null,l=null;if(e>=25?(i=2,l=e-8):(i=1,l=e),l>=17&&l<=19){let o;l===17?o=t+80:l===18?o=t+112:o=t+144,this.logger.log(2,()=>"Special char '"+h1(o)+"' in channel "+i),n=[o]}else e>=32&&e<=127&&(n=t===0?[e]:[e,t]);return n&&this.logger.log(3,()=>"Char codes =  "+mn(n).join(",")),n}parseBackgroundAttributes(e,t){const i=(e===16||e===24)&&t>=32&&t<=47,n=(e===23||e===31)&&t>=45&&t<=47;if(!(i||n))return!1;let l;const o={};e===16||e===24?(l=Math.floor((t-32)/2),o.background=TD[l],t%2===1&&(o.background=o.background+"_semi")):t===45?o.background="transparent":(o.foreground="black",t===47&&(o.underline=!0));const u=e<=23?1:2;return this.channels[u].setBkgData(o),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}Eo(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const i=this.channels[t];i&&i.cueSplitAtTime(e)}}}function Eo(r,e,t){t.a=r,t.b=e}function LD(r,e,t){return t.a===r&&t.b===e}function _D(){return{a:null,b:null}}var mh=function(){if(Zo!=null&&Zo.VTTCue)return self.VTTCue;const r=["","lr","rl"],e=["start","middle","end","left","right"];function t(u,d){if(typeof d!="string"||!Array.isArray(u))return!1;const f=d.toLowerCase();return~u.indexOf(f)?f:!1}function i(u){return t(r,u)}function n(u){return t(e,u)}function l(u,...d){let f=1;for(;f<arguments.length;f++){const m=arguments[f];for(const g in m)u[g]=m[g]}return u}function o(u,d,f){const m=this,g={enumerable:!0};m.hasBeenReset=!1;let v="",E=!1,y=u,S=d,T=f,R=null,D="",_=!0,O="auto",C="start",B=50,N="middle",F=50,z="middle";Object.defineProperty(m,"id",l({},g,{get:function(){return v},set:function($){v=""+$}})),Object.defineProperty(m,"pauseOnExit",l({},g,{get:function(){return E},set:function($){E=!!$}})),Object.defineProperty(m,"startTime",l({},g,{get:function(){return y},set:function($){if(typeof $!="number")throw new TypeError("Start time must be set to a number.");y=$,this.hasBeenReset=!0}})),Object.defineProperty(m,"endTime",l({},g,{get:function(){return S},set:function($){if(typeof $!="number")throw new TypeError("End time must be set to a number.");S=$,this.hasBeenReset=!0}})),Object.defineProperty(m,"text",l({},g,{get:function(){return T},set:function($){T=""+$,this.hasBeenReset=!0}})),Object.defineProperty(m,"region",l({},g,{get:function(){return R},set:function($){R=$,this.hasBeenReset=!0}})),Object.defineProperty(m,"vertical",l({},g,{get:function(){return D},set:function($){const ae=i($);if(ae===!1)throw new SyntaxError("An invalid or illegal string was specified.");D=ae,this.hasBeenReset=!0}})),Object.defineProperty(m,"snapToLines",l({},g,{get:function(){return _},set:function($){_=!!$,this.hasBeenReset=!0}})),Object.defineProperty(m,"line",l({},g,{get:function(){return O},set:function($){if(typeof $!="number"&&$!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");O=$,this.hasBeenReset=!0}})),Object.defineProperty(m,"lineAlign",l({},g,{get:function(){return C},set:function($){const ae=n($);if(!ae)throw new SyntaxError("An invalid or illegal string was specified.");C=ae,this.hasBeenReset=!0}})),Object.defineProperty(m,"position",l({},g,{get:function(){return B},set:function($){if($<0||$>100)throw new Error("Position must be between 0 and 100.");B=$,this.hasBeenReset=!0}})),Object.defineProperty(m,"positionAlign",l({},g,{get:function(){return N},set:function($){const ae=n($);if(!ae)throw new SyntaxError("An invalid or illegal string was specified.");N=ae,this.hasBeenReset=!0}})),Object.defineProperty(m,"size",l({},g,{get:function(){return F},set:function($){if($<0||$>100)throw new Error("Size must be between 0 and 100.");F=$,this.hasBeenReset=!0}})),Object.defineProperty(m,"align",l({},g,{get:function(){return z},set:function($){const ae=n($);if(!ae)throw new SyntaxError("An invalid or illegal string was specified.");z=ae,this.hasBeenReset=!0}})),m.displayState=void 0}return o.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},o}();class DD{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function g1(r){function e(i,n,l,o){return(i|0)*3600+(n|0)*60+(l|0)+parseFloat(o||0)}const t=r.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class wD{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,i){return i?this.has(e)?this.values[e]:t[i]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,i){for(let n=0;n<i.length;++n)if(t===i[n]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const i=parseFloat(t);if(i>=0&&i<=100)return this.set(e,i),!0}return!1}}function p1(r,e,t,i){const n=i?r.split(i):[r];for(const l in n){if(typeof n[l]!="string")continue;const o=n[l].split(t);if(o.length!==2)continue;const u=o[0],d=o[1];e(u,d)}}const kd=new mh(0,0,""),So=kd.align==="middle"?"middle":"center";function ID(r,e,t){const i=r;function n(){const u=g1(r);if(u===null)throw new Error("Malformed timestamp: "+i);return r=r.replace(/^[^\sa-zA-Z-]+/,""),u}function l(u,d){const f=new wD;p1(u,function(v,E){let y;switch(v){case"region":for(let S=t.length-1;S>=0;S--)if(t[S].id===E){f.set(v,t[S].region);break}break;case"vertical":f.alt(v,E,["rl","lr"]);break;case"line":y=E.split(","),f.integer(v,y[0]),f.percent(v,y[0])&&f.set("snapToLines",!1),f.alt(v,y[0],["auto"]),y.length===2&&f.alt("lineAlign",y[1],["start",So,"end"]);break;case"position":y=E.split(","),f.percent(v,y[0]),y.length===2&&f.alt("positionAlign",y[1],["start",So,"end","line-left","line-right","auto"]);break;case"size":f.percent(v,E);break;case"align":f.alt(v,E,["start",So,"end","left","right"]);break}},/:/,/\s/),d.region=f.get("region",null),d.vertical=f.get("vertical","");let m=f.get("line","auto");m==="auto"&&kd.line===-1&&(m=-1),d.line=m,d.lineAlign=f.get("lineAlign","start"),d.snapToLines=f.get("snapToLines",!0),d.size=f.get("size",100),d.align=f.get("align",So);let g=f.get("position","auto");g==="auto"&&kd.position===50&&(g=d.align==="start"||d.align==="left"?0:d.align==="end"||d.align==="right"?100:50),d.position=g}function o(){r=r.replace(/^\s+/,"")}if(o(),e.startTime=n(),o(),r.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+i);r=r.slice(3),o(),e.endTime=n(),o(),l(r,e)}function y1(r){return r.replace(/<br(?: \/)?>/gi,`
`)}class CD{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new DD,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function i(){let l=t.buffer,o=0;for(l=y1(l);o<l.length&&l[o]!=="\r"&&l[o]!==`
`;)++o;const u=l.slice(0,o);return l[o]==="\r"&&++o,l[o]===`
`&&++o,t.buffer=l.slice(o),u}function n(l){p1(l,function(o,u){},/:/)}try{let l="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;l=i();const u=l.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!(u!=null&&u[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let o=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(o?o=!1:l=i(),t.state){case"HEADER":/:/.test(l)?n(l):l||(t.state="ID");continue;case"NOTE":l||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(l)){t.state="NOTE";break}if(!l)continue;if(t.cue=new mh(0,0,""),t.state="CUE",l.indexOf("-->")===-1){t.cue.id=l;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{ID(l,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const u=l.indexOf("-->")!==-1;if(!l||u&&(o=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=l}continue;case"BADCUE":l||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const OD=/\r\n|\n\r|\n|\r/g,ed=function(e,t,i=0){return e.slice(i,i+t.length)===t},ND=function(e){let t=parseInt(e.slice(-3));const i=parseInt(e.slice(-6,-4)),n=parseInt(e.slice(-9,-7)),l=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!de(t)||!de(i)||!de(n)||!de(l))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*i,t+=60*1e3*n,t+=60*60*1e3*l,t};function gh(r,e,t){return Ca(r.toString())+Ca(e.toString())+Ca(t)}const kD=function(e,t,i){let n=e[t],l=e[n.prevCC];if(!l||!l.new&&n.new){e.ccOffset=e.presentationOffset=n.start,n.new=!1;return}for(;(o=l)!=null&&o.new;){var o;e.ccOffset+=n.start-l.start,n.new=!1,n=l,l=e[n.prevCC]}e.presentationOffset=i};function MD(r,e,t,i,n,l,o){const u=new CD,d=ti(new Uint8Array(r)).trim().replace(OD,`
`).split(`
`),f=[],m=e?J2(e.baseTime,e.timescale):0;let g="00:00.000",v=0,E=0,y,S=!0;u.oncue=function(T){const R=t[i];let D=t.ccOffset;const _=(v-m)/9e4;if(R!=null&&R.new&&(E!==void 0?D=t.ccOffset=R.start:kD(t,i,_)),_){if(!e){y=new Error("Missing initPTS for VTT MPEGTS");return}D=_-t.presentationOffset}const O=T.endTime-T.startTime,C=di((T.startTime+D-E)*9e4,n*9e4)/9e4;T.startTime=Math.max(C,0),T.endTime=Math.max(C+O,0);const B=T.text.trim();T.text=decodeURIComponent(encodeURIComponent(B)),T.id||(T.id=gh(T.startTime,T.endTime,B)),T.endTime>0&&f.push(T)},u.onparsingerror=function(T){y=T},u.onflush=function(){if(y){o(y);return}l(f)},d.forEach(T=>{if(S)if(ed(T,"X-TIMESTAMP-MAP=")){S=!1,T.slice(16).split(",").forEach(R=>{ed(R,"LOCAL:")?g=R.slice(6):ed(R,"MPEGTS:")&&(v=parseInt(R.slice(7)))});try{E=ND(g)/1e3}catch(R){y=R}return}else T===""&&(S=!1);u.parse(T+`
`)}),u.flush()}const td="stpp.ttml.im1t",v1=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,x1=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,PD={left:"start",center:"center",right:"end",start:"start",end:"end"};function Wy(r,e,t,i){const n=be(new Uint8Array(r),["mdat"]);if(n.length===0){i(new Error("Could not parse IMSC1 mdat"));return}const l=n.map(u=>ti(u)),o=Z2(e.baseTime,1,e.timescale);try{l.forEach(u=>t(UD(u,o)))}catch(u){i(u)}}function UD(r,e){const n=new DOMParser().parseFromString(r,"text/xml").getElementsByTagName("tt")[0];if(!n)throw new Error("Invalid ttml");const l={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},o=Object.keys(l).reduce((g,v)=>(g[v]=n.getAttribute(`ttp:${v}`)||l[v],g),{}),u=n.getAttribute("xml:space")!=="preserve",d=Zy(id(n,"styling","style")),f=Zy(id(n,"layout","region")),m=id(n,"body","[begin]");return[].map.call(m,g=>{const v=E1(g,u);if(!v||!g.hasAttribute("begin"))return null;const E=nd(g.getAttribute("begin"),o),y=nd(g.getAttribute("dur"),o);let S=nd(g.getAttribute("end"),o);if(E===null)throw Jy(g);if(S===null){if(y===null)throw Jy(g);S=E+y}const T=new mh(E-e,S-e,v);T.id=gh(T.startTime,T.endTime,T.text);const R=f[g.getAttribute("region")],D=d[g.getAttribute("style")],_=BD(R,D,d),{textAlign:O}=_;if(O){const C=PD[O];C&&(T.lineAlign=C),T.align=O}return Ke(T,_),T}).filter(g=>g!==null)}function id(r,e,t){const i=r.getElementsByTagName(e)[0];return i?[].slice.call(i.querySelectorAll(t)):[]}function Zy(r){return r.reduce((e,t)=>{const i=t.getAttribute("xml:id");return i&&(e[i]=t),e},{})}function E1(r,e){return[].slice.call(r.childNodes).reduce((t,i,n)=>{var l;return i.nodeName==="br"&&n?t+`
`:(l=i.childNodes)!=null&&l.length?E1(i,e):e?t+i.textContent.trim().replace(/\s+/g," "):t+i.textContent},"")}function BD(r,e,t){const i="http://www.w3.org/ns/ttml#styling";let n=null;const l=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],o=r!=null&&r.hasAttribute("style")?r.getAttribute("style"):null;return o&&t.hasOwnProperty(o)&&(n=t[o]),l.reduce((u,d)=>{const f=sd(e,i,d)||sd(r,i,d)||sd(n,i,d);return f&&(u[d]=f),u},{})}function sd(r,e,t){return r&&r.hasAttributeNS(e,t)?r.getAttributeNS(e,t):null}function Jy(r){return new Error(`Could not parse ttml timestamp ${r}`)}function nd(r,e){if(!r)return null;let t=g1(r);return t===null&&(v1.test(r)?t=FD(r,e):x1.test(r)&&(t=jD(r,e))),t}function FD(r,e){const t=v1.exec(r),i=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+i/e.frameRate}function jD(r,e){const t=x1.exec(r),i=Number(t[1]);switch(t[2]){case"h":return i*3600;case"m":return i*60;case"ms":return i*1e3;case"f":return i/e.frameRate;case"t":return i/e.tickRate}return i}class To{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,i){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=i,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class $D{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=tv(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(A.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(A.FRAG_LOADING,this.onFragLoading,this),e.on(A.FRAG_LOADED,this.onFragLoaded,this),e.on(A.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(A.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(A.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(A.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(A.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(A.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(A.FRAG_LOADING,this.onFragLoading,this),e.off(A.FRAG_LOADED,this.onFragLoaded,this),e.off(A.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(A.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(A.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(A.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(A.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new To(this,"textTrack1"),t=new To(this,"textTrack2"),i=new To(this,"textTrack3"),n=new To(this,"textTrack4");this.cea608Parser1=new Qy(1,e,t),this.cea608Parser2=new Qy(3,i,n)}addCues(e,t,i,n,l){let o=!1;for(let u=l.length;u--;){const d=l[u],f=GD(d[0],d[1],t,i);if(f>=0&&(d[0]=Math.min(d[0],t),d[1]=Math.max(d[1],i),o=!0,f/(i-t)>.5))return}if(o||l.push([t,i]),this.config.renderTextTracksNatively){const u=this.captionsTracks[e];this.Cues.newCue(u,t,i,n)}else{const u=this.Cues.newCue(null,t,i,n);this.hls.trigger(A.CUES_PARSED,{type:"captions",cues:u,track:e})}}onInitPtsFound(e,{frag:t,id:i,initPTS:n,timescale:l}){const{unparsedVttFrags:o}=this;i===ge.MAIN&&(this.initPTS[t.cc]={baseTime:n,timescale:l}),o.length&&(this.unparsedVttFrags=[],o.forEach(u=>{this.onFragLoaded(A.FRAG_LOADED,u)}))}getExistingTrack(e,t){const{media:i}=this;if(i)for(let n=0;n<i.textTracks.length;n++){const l=i.textTracks[n];if(ev(l,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return l}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:i,media:n}=this,{label:l,languageCode:o}=t[e],u=this.getExistingTrack(l,o);if(u)i[e]=u,dr(i[e]),u1(i[e],n);else{const d=this.createTextTrack("captions",l,o);d&&(d[e]=!0,i[e]=d)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const i=t.label,n={_id:e,label:i,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=n,this.hls.trigger(A.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[n]})}createTextTrack(e,t,i){const n=this.media;if(n)return n.addTextTrack(e,t,i)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const i=!!t.transferMedia;if(this.media=null,i)return;const{captionsTracks:n}=this;Object.keys(n).forEach(l=>{dr(n[l]),delete n[l]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=tv(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let i=0;i<t.length;i++)dr(t[i])}onSubtitleTracksUpdated(e,t){const i=t.subtitleTracks||[],n=i.some(l=>l.textCodec===td);if(this.config.enableWebVTT||n&&this.config.enableIMSC1){if(s1(this.tracks,i)){this.tracks=i;return}if(this.textTracks=[],this.tracks=i,this.config.renderTextTracksNatively){const o=this.media,u=o?Mo(o.textTracks):null;if(this.tracks.forEach((d,f)=>{let m;if(u){let g=null;for(let v=0;v<u.length;v++)if(u[v]&&ev(u[v],d)){g=u[v],u[v]=null;break}g&&(m=g)}if(m)dr(m);else{const g=S1(d);m=this.createTextTrack(g,d.name,d.lang),m&&(m.mode="disabled")}m&&this.textTracks.push(m)}),u!=null&&u.length){const d=u.filter(f=>f!==null).map(f=>f.label);d.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${d.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const o=this.tracks.map(u=>({label:u.name,kind:u.type.toLowerCase(),default:u.default,subtitleTrack:u}));this.hls.trigger(A.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:o})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(i=>{const n=/(?:CC|SERVICE)([1-4])/.exec(i.instreamId);if(!n)return;const l=`textTrack${n[1]}`,o=this.captionsProperties[l];o&&(o.label=i.name,i.lang&&(o.languageCode=i.lang),o.media=i)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===ge.MAIN){var i,n;const{cea608Parser1:l,cea608Parser2:o,lastSn:u}=this,{cc:d,sn:f}=t.frag,m=(i=(n=t.part)==null?void 0:n.index)!=null?i:-1;l&&o&&(f!==u+1||f===u&&m!==this.lastPartIndex+1||d!==this.lastCc)&&(l.reset(),o.reset()),this.lastCc=d,this.lastSn=f,this.lastPartIndex=m}}onFragLoaded(e,t){const{frag:i,payload:n}=t;if(i.type===ge.SUBTITLE)if(n.byteLength){const l=i.decryptdata,o="stats"in t;if(l==null||!l.encrypted||o){const u=this.tracks[i.level],d=this.vttCCs;d[i.cc]||(d[i.cc]={start:i.start,prevCC:this.prevCC,new:!0},this.prevCC=i.cc),u&&u.textCodec===td?this._parseIMSC1(i,n):this._parseVTTs(t)}}else this.hls.trigger(A.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const i=this.hls;Wy(t,this.initPTS[e.cc],n=>{this._appendCues(n,e.level),i.trigger(A.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},n=>{i.logger.log(`Failed to parse IMSC1: ${n}`),i.trigger(A.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:n})})}_parseVTTs(e){var t;const{frag:i,payload:n}=e,{initPTS:l,unparsedVttFrags:o}=this,u=l.length-1;if(!l[i.cc]&&u===-1){o.push(e);return}const d=this.hls,f=(t=i.initSegment)!=null&&t.data?hi(i.initSegment.data,new Uint8Array(n)).buffer:n;MD(f,this.initPTS[i.cc],this.vttCCs,i.cc,i.start,m=>{this._appendCues(m,i.level),d.trigger(A.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:i})},m=>{const g=m.message==="Missing initPTS for VTT MPEGTS";g?o.push(e):this._fallbackToIMSC1(i,n),d.logger.log(`Failed to parse VTT cue: ${m}`),!(g&&u>i.cc)&&d.trigger(A.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:m})})}_fallbackToIMSC1(e,t){const i=this.tracks[e.level];i.textCodec||Wy(t,this.initPTS[e.cc],()=>{i.textCodec=td,this._parseIMSC1(e,t)},()=>{i.textCodec="wvtt"})}_appendCues(e,t){const i=this.hls;if(this.config.renderTextTracksNatively){const n=this.textTracks[t];if(!n||n.mode==="disabled")return;e.forEach(l=>f1(n,l))}else{const n=this.tracks[t];if(!n)return;const l=n.default?"default":"subtitles"+t;i.trigger(A.CUES_PARSED,{type:"subtitles",cues:e,track:l})}}onFragDecrypted(e,t){const{frag:i}=t;i.type===ge.SUBTITLE&&this.onFragLoaded(A.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:i,samples:n}=t;if(!(i.type===ge.MAIN&&this.closedCaptionsForLevel(i)==="NONE"))for(let l=0;l<n.length;l++){const o=n[l].bytes;if(o){this.cea608Parser1||this.initCea608Parsers();const u=this.extractCea608Data(o);this.cea608Parser1.addData(n[l].pts,u[0]),this.cea608Parser2.addData(n[l].pts,u[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:i,endOffsetSubtitles:n,type:l}){const{media:o}=this;if(!(!o||o.currentTime<i)){if(!l||l==="video"){const{captionsTracks:u}=this;Object.keys(u).forEach(d=>Od(u[d],t,i))}if(this.config.renderTextTracksNatively&&t===0&&n!==void 0){const{textTracks:u}=this;Object.keys(u).forEach(d=>Od(u[d],t,n))}}}extractCea608Data(e){const t=[[],[]],i=e[0]&31;let n=2;for(let l=0;l<i;l++){const o=e[n++],u=127&e[n++],d=127&e[n++];if(u===0&&d===0)continue;if((4&o)!==0){const m=3&o;(m===0||m===1)&&(t[m].push(u),t[m].push(d))}}return t}}function S1(r){return r.characteristics&&/transcribes-spoken-dialog/gi.test(r.characteristics)&&/describes-music-and-sound/gi.test(r.characteristics)?"captions":"subtitles"}function ev(r,e){return!!r&&r.kind===S1(e)&&wd(e,r)}function GD(r,e,t,i){return Math.min(e,i)-Math.max(r,t)}function tv(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const HD=/\s/,VD={newCue(r,e,t,i){const n=[];let l,o,u,d,f;const m=self.VTTCue||self.TextTrackCue;for(let v=0;v<i.rows.length;v++)if(l=i.rows[v],u=!0,d=0,f="",!l.isEmpty()){var g;for(let S=0;S<l.chars.length;S++)HD.test(l.chars[S].uchar)&&u?d++:(f+=l.chars[S].uchar,u=!1);l.cueStartTime=e,e===t&&(t+=1e-4),d>=16?d--:d++;const E=y1(f.trim()),y=gh(e,t,E);r!=null&&(g=r.cues)!=null&&g.getCueById(y)||(o=new m(e,t,E),o.id=y,o.line=v+1,o.align="left",o.position=10+Math.min(80,Math.floor(d*8/32)*10),n.push(o))}return r&&n.length&&(n.sort((v,E)=>v.line==="auto"||E.line==="auto"?0:v.line>8&&E.line>8?E.line-v.line:v.line-E.line),n.forEach(v=>f1(r,v))),n}};function zD(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const KD=/(\d+)-(\d+)\/(\d+)/;class iv{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||QD,this.controller=new self.AbortController,this.stats=new Xd}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,i){const n=this.stats;if(n.loading.start)throw new Error("Loader can only be used once.");n.loading.start=self.performance.now();const l=YD(e,this.controller.signal),o=e.responseType==="arraybuffer",u=o?"byteLength":"length",{maxTimeToFirstByteMs:d,maxLoadTimeMs:f}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=i,this.request=this.fetchSetup(e,l),self.clearTimeout(this.requestTimeout),t.timeout=d&&de(d)?d:f,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(n,e,this.response))},t.timeout),(ja(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(g=>{var v;this.response=this.loader=g;const E=Math.max(self.performance.now(),n.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=f,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(n,e,this.response))},f-(E-n.loading.start)),!g.ok){const{status:S,statusText:T}=g;throw new WD(T||"fetch, bad network response",S,g)}n.loading.first=E,n.total=XD(g.headers)||n.total;const y=(v=this.callbacks)==null?void 0:v.onProgress;return y&&de(t.highWaterMark)?this.loadProgressively(g,n,e,t.highWaterMark,y):o?g.arrayBuffer():e.responseType==="json"?g.json():g.text()}).then(g=>{var v,E;const y=this.response;if(!y)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),n.loading.end=Math.max(self.performance.now(),n.loading.first);const S=g[u];S&&(n.loaded=n.total=S);const T={url:y.url,data:g,code:y.status},R=(v=this.callbacks)==null?void 0:v.onProgress;R&&!de(t.highWaterMark)&&R(n,e,g,y),(E=this.callbacks)==null||E.onSuccess(T,n,e,y)}).catch(g=>{var v;if(self.clearTimeout(this.requestTimeout),n.aborted)return;const E=g&&g.code||0,y=g?g.message:null;(v=this.callbacks)==null||v.onError({code:E,text:y},e,g?g.details:null,n)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,i,n=0,l){const o=new Px,u=e.body.getReader(),d=()=>u.read().then(f=>{if(f.done)return o.dataLength&&l(t,i,o.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const m=f.value,g=m.length;return t.loaded+=g,g<n||o.dataLength?(o.push(m),o.dataLength>=n&&l(t,i,o.flush().buffer,e)):l(t,i,m.buffer,e),d()}).catch(()=>Promise.reject());return d()}}function YD(r,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(Ke({},r.headers))};return r.rangeEnd&&t.headers.set("Range","bytes="+r.rangeStart+"-"+String(r.rangeEnd-1)),t}function qD(r){const e=KD.exec(r);if(e)return parseInt(e[2])-parseInt(e[1])+1}function XD(r){const e=r.get("Content-Range");if(e){const i=qD(e);if(de(i))return i}const t=r.get("Content-Length");if(t)return parseInt(t)}function QD(r,e){return new self.Request(r.url,e)}class WD extends Error{constructor(e,t,i){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=i}}const ZD=/^age:\s*[\d.]+\s*$/im;class T1{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new Xd,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,i){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=i,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const i=this.loader=new self.XMLHttpRequest,n=this.stats;n.loading.first=0,n.loaded=0,n.aborted=!1;const l=this.xhrSetup;l?Promise.resolve().then(()=>{if(!(this.loader!==i||this.stats.aborted))return l(i,t.url)}).catch(o=>{if(!(this.loader!==i||this.stats.aborted))return i.open("GET",t.url,!0),l(i,t.url)}).then(()=>{this.loader!==i||this.stats.aborted||this.openAndSendXhr(i,t,e)}).catch(o=>{var u;(u=this.callbacks)==null||u.onError({code:i.status,text:o.message},t,i,n)}):this.openAndSendXhr(i,t,e)}openAndSendXhr(e,t,i){e.readyState||e.open("GET",t.url,!0);const n=t.headers,{maxTimeToFirstByteMs:l,maxLoadTimeMs:o}=i.loadPolicy;if(n)for(const u in n)e.setRequestHeader(u,n[u]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),i.timeout=l&&de(l)?l:o,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:i}=this;if(!e||!t)return;const n=t.readyState,l=this.config;if(!i.aborted&&n>=2&&(i.loading.first===0&&(i.loading.first=Math.max(self.performance.now(),i.loading.start),l.timeout!==l.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),l.timeout=l.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),l.loadPolicy.maxLoadTimeMs-(i.loading.first-i.loading.start)))),n===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const f=t.status,m=t.responseType==="text"?t.responseText:null;if(f>=200&&f<300){const y=m??t.response;if(y!=null){var o,u;i.loading.end=Math.max(self.performance.now(),i.loading.first);const S=t.responseType==="arraybuffer"?y.byteLength:y.length;i.loaded=i.total=S,i.bwEstimate=i.total*8e3/(i.loading.end-i.loading.first);const T=(o=this.callbacks)==null?void 0:o.onProgress;T&&T(i,e,y,t);const R={url:t.responseURL,data:y,code:f};(u=this.callbacks)==null||u.onSuccess(R,i,e,t);return}}const g=l.loadPolicy.errorRetry,v=i.retry,E={url:e.url,data:void 0,code:f};if(Wo(g,v,!1,E))this.retry(g);else{var d;Me.error(`${f} while loading ${e.url}`),(d=this.callbacks)==null||d.onError({code:f,text:t.statusText},e,t,i)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(Wo(e,t,!0))this.retry(e);else{var i;Me.warn(`timeout while loading ${(i=this.context)==null?void 0:i.url}`);const n=this.callbacks;n&&(this.abortInternal(),n.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:i}=this;this.retryDelay=Zd(e,i.retry),i.retry++,Me.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t==null?void 0:t.url}, retrying ${i.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&ZD.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const JD={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},ew=$e($e({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:T1,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:TL,bufferController:m_,capLevelController:dh,errorController:DL,fpsController:nD,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:Rx,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,certLoadPolicy:{default:JD},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},tw()),{},{subtitleStreamController:gD,subtitleTrackController:lD,timelineController:$D,audioStreamController:u_,audioTrackController:f_,emeController:mr,cmcdController:tD,contentSteeringController:sD,interstitialsController:mD});function tw(){return{cueHandler:VD,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function iw(r,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const i=Md(r),n=["manifest","level","frag"],l=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return n.forEach(o=>{const u=`${o==="level"?"playlist":o}LoadPolicy`,d=e[u]===void 0,f=[];l.forEach(m=>{const g=`${o}Loading${m}`,v=e[g];if(v!==void 0&&d){f.push(g);const E=i[u].default;switch(e[u]={default:E},m){case"TimeOut":E.maxLoadTimeMs=v,E.maxTimeToFirstByteMs=v;break;case"MaxRetry":E.errorRetry.maxNumRetry=v,E.timeoutRetry.maxNumRetry=v;break;case"RetryDelay":E.errorRetry.retryDelayMs=v,E.timeoutRetry.retryDelayMs=v;break;case"MaxRetryTimeout":E.errorRetry.maxRetryDelayMs=v,E.timeoutRetry.maxRetryDelayMs=v;break}}}),f.length&&t.warn(`hls.js config: "${f.join('", "')}" setting(s) are deprecated, use "${u}": ${et(e[u])}`)}),$e($e({},i),e)}function Md(r){return r&&typeof r=="object"?Array.isArray(r)?r.map(Md):Object.keys(r).reduce((e,t)=>(e[t]=Md(r[t]),e),{}):r}function sw(r,e){const t=r.loader;t!==iv&&t!==T1?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),r.progressive=!1):zD()&&(r.loader=iv,r.progressive=!0,r.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const Po=2,nw=.1,rw=.05,aw=100;class lw extends Tx{constructor(e,t){super("gap-controller",e.logger),this.hls=null,this.fragmentTracker=null,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var i;(i=this.media)!=null&&i.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var i;this.ended=((i=this.media)==null?void 0:i.currentTime)||1,this.hls.trigger(A.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(A.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(A.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(aw),this.mediaSource=t.mediaSource;const i=this.media=t.media;fs(i,"playing",this.onMediaPlaying),fs(i,"waiting",this.onMediaWaiting),fs(i,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:i}=this;i&&(ji(i,"playing",this.onMediaPlaying),ji(i,"waiting",this.onMediaWaiting),ji(i,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var i,n;const l=(i=this.hls)==null?void 0:i.config;if(!l)return;const{media:o,stalled:u}=this;if(!o)return;const{seeking:d}=o,f=this.seeking&&!d,m=!this.seeking&&d,g=o.paused&&!d||o.ended||o.playbackRate===0;if(this.seeking=d,e!==t){t&&(this.ended=0),this.moved=!0,d||(this.nudgeRetry=0,l.nudgeOnVideoHole&&!g&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(m||f){f&&this.stallResolved(e);return}if(g){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&o.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(A.MEDIA_ENDED,{stalled:!1}));return}if(!De.getBuffered(o).length){this.nudgeRetry=0;return}const v=De.bufferInfo(o,e,0),E=v.nextStart||0,y=this.fragmentTracker;if(d&&y&&this.hls){const B=sv(this.hls.inFlightFragments,e),N=v.len>Po,F=!E||B||E-e>Po&&!y.getPartialFragment(e);if(N||F)return;this.moved=!1}const S=(n=this.hls)==null?void 0:n.latestLevelDetails;if(!this.moved&&this.stalled!==null&&y){if(!(v.len>0)&&!E)return;const N=Math.max(E,v.start||0)-e,z=!!(S!=null&&S.live)?S.targetduration*2:Po,$=y.getPartialFragment(e);if(N>0&&(N<=z||$)){o.paused||this._trySkipBufferHole($);return}}const T=l.detectStallWithCurrentTimeMs,R=self.performance.now(),D=this.waiting;if(u===null){D>0&&R-D<T?this.stalled=D:this.stalled=R;return}const _=R-u;if(!d&&(_>=T||D)&&this.hls){var O;if(((O=this.mediaSource)==null?void 0:O.readyState)==="ended"&&!(S!=null&&S.live)&&Math.abs(e-((S==null?void 0:S.edge)||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(A.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(v),!this.media||!this.hls)return}const C=De.bufferInfo(o,e,l.maxBufferHole);this._tryFixBufferStall(C,_)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const i=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(i)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(A.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var i;const n=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(i=this.buffered.audio)!=null&&i.length&&n&&n.length>1&&e>n.end(0)){const l=De.bufferedInfo(De.timeRangesToArray(this.buffered.audio),e,0);if(l.len>1&&t>=l.start){const o=De.timeRangesToArray(n),u=De.bufferedInfo(o,t,0).bufferedIndex;if(u>-1&&u<o.length-1){const d=De.bufferedInfo(o,e,0).bufferedIndex,f=o[u].end,m=o[u+1].start;if((d===-1||d>u)&&m-f<1&&e-f<2){const g=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${f} -> ${m} buffered index: ${d}`);this.warn(g.message),this.media.currentTime+=1e-6;const v=this.fragmentTracker.getPartialFragment(e)||void 0,E=De.bufferInfo(this.media,e,0);this.hls.trigger(A.ERROR,{type:pe.MEDIA_ERROR,details:q.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:g,reason:g.message,frag:v,buffer:E.len,bufferInfo:E})}}}}}_tryFixBufferStall(e,t){var i,n;const{fragmentTracker:l,media:o}=this,u=(i=this.hls)==null?void 0:i.config;if(!o||!l||!u)return;const d=o.currentTime,f=(n=this.hls)==null?void 0:n.latestLevelDetails,m=l.getPartialFragment(d);if((m||f!=null&&f.live&&d<f.fragmentStart)&&(this._trySkipBufferHole(m)||!this.media))return;const g=e.buffered;(g&&g.length>1&&e.len>u.maxBufferHole||e.nextStart&&e.nextStart-d<u.maxBufferHole)&&(t>u.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}_reportStall(e){const{hls:t,media:i,stallReported:n,stalled:l}=this;if(!n&&l!==null&&i&&t){this.stallReported=!0;const o=new Error(`Playback stalling at @${i.currentTime} due to low buffer (${et(e)})`);this.warn(o.message),t.trigger(A.ERROR,{type:pe.MEDIA_ERROR,details:q.BUFFER_STALLED_ERROR,fatal:!1,error:o,buffer:e.len,bufferInfo:e,stalled:{start:l}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:i,media:n}=this,l=(t=this.hls)==null?void 0:t.config;if(!n||!i||!l)return 0;const o=n.currentTime,u=De.bufferInfo(n,o,0),d=o<u.start?u.start:u.nextStart;if(d&&this.hls){const m=u.len<=l.maxBufferHole,g=u.len>0&&u.len<1&&n.readyState<3,v=d-o;if(v>0&&(m||g)){if(v>l.maxBufferHole){let y=!1;if(o===0){const S=i.getAppendedFrag(0,ge.MAIN);S&&d<S.end&&(y=!0)}if(!y){const S=e||i.getAppendedFrag(o,ge.MAIN);if(S){var f;if(!((f=this.hls.loadLevelObj)!=null&&f.details)||sv(this.hls.inFlightFragments,d))return 0;let R=!1,D=S.end;for(;D<d;){const _=i.getPartialFragment(D);if(_)D+=_.duration;else{R=!0;break}}if(R)return 0}}}const E=Math.max(d+rw,o+nw);if(this.warn(`skipping hole, adjusting currentTime from ${o} to ${E}`),this.moved=!0,n.currentTime=E,!(e!=null&&e.gap)){const y=new Error(`fragment loaded with buffer holes, seeking from ${o} to ${E}`);this.hls.trigger(A.ERROR,{type:pe.MEDIA_ERROR,details:q.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:y,reason:y.message,frag:e||void 0,buffer:u.len,bufferInfo:u})}return E}}return 0}_tryNudgeBuffer(e){const{hls:t,media:i,nudgeRetry:n}=this,l=t==null?void 0:t.config;if(!i||!l)return 0;const o=i.currentTime;if(this.nudgeRetry++,n<l.nudgeMaxRetry){const u=o+(n+1)*l.nudgeOffset,d=new Error(`Nudging 'currentTime' from ${o} to ${u}`);this.warn(d.message),i.currentTime=u,t.trigger(A.ERROR,{type:pe.MEDIA_ERROR,details:q.BUFFER_NUDGE_ON_STALL,error:d,fatal:!1,buffer:e.len,bufferInfo:e})}else{const u=new Error(`Playhead still not moving while enough data buffered @${o} after ${l.nudgeMaxRetry} nudges`);this.error(u.message),t.trigger(A.ERROR,{type:pe.MEDIA_ERROR,details:q.BUFFER_STALLED_ERROR,error:u,fatal:!0,buffer:e.len,bufferInfo:e})}}}function sv(r,e){const t=nv(r.main);if(t&&t.start<=e)return t;const i=nv(r.audio);return i&&i.start<=e?i:null}function nv(r){if(!r)return null;switch(r.state){case ne.IDLE:case ne.STOPPED:case ne.ENDED:case ne.ERROR:return null}return r.frag}const ow=.25;function Pd(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function rv(r,e,t,i,n){let l=new r(e,t,"");try{l.value=i,n&&(l.type=n)}catch{l=new r(e,t,et(n?$e({type:n},i):i))}return l}const bo=(()=>{const r=Pd();try{r&&new r(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function cw(r){return Uint8Array.from(r.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}class uw{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(A.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e.on(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(A.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(A.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(A.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this)}_unregisterListeners(){const{hls:e}=this;e.off(A.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(A.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(A.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(A.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this)}onMediaAttaching(e,t){var i;this.media=t.media,((i=t.overrides)==null?void 0:i.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){const e=this.hls.latestLevelDetails;e&&this.updateDateRangeCues(e)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&dr(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const i=e[t];if(i.kind==="metadata"&&i.label==="id3")return u1(i,this.media),i}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:i,enableID3MetadataCues:n}}}=this;if(!i&&!n)return;const{samples:l}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const o=Pd();if(o)for(let u=0;u<l.length;u++){const d=l[u].type;if(d===ei.emsg&&!i||!n)continue;const f=Vx(l[u].data);if(f){const m=l[u].pts;let g=m+l[u].duration;g>bo&&(g=bo),g-m<=0&&(g=m+ow);for(let E=0;E<f.length;E++){const y=f[E];if(!zx(y)){this.updateId3CueEnds(m,d);const S=rv(o,m,g,y,d);S&&this.id3Track.addCue(S)}}}}}updateId3CueEnds(e,t){var i;const n=(i=this.id3Track)==null?void 0:i.cues;if(n)for(let l=n.length;l--;){const o=n[l];o.type===t&&o.startTime<e&&o.endTime===bo&&(o.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:i,type:n}){const{id3Track:l,hls:o}=this;if(!o)return;const{config:{enableEmsgMetadataCues:u,enableID3MetadataCues:d}}=o;if(l&&(u||d)){let f;n==="audio"?f=m=>m.type===ei.audioId3&&d:n==="video"?f=m=>m.type===ei.emsg&&u:f=m=>m.type===ei.audioId3&&d||m.type===ei.emsg&&u,Od(l,t,i,f)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.media||!e.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{id3Track:i}=this,{dateRanges:n}=e,l=Object.keys(n);let o=this.dateRangeCuesAppended;if(i&&t){var u;if((u=i.cues)!=null&&u.length){const m=Object.keys(o).filter(g=>!l.includes(g));for(let g=m.length;g--;){const v=m[g],E=o[v].cues;delete o[v],Object.keys(E).forEach(y=>{try{const S=E[y];S.removeEventListener("enter",this.onEventCueEnter),i.removeCue(S)}catch{}})}}else o=this.dateRangeCuesAppended={}}const d=e.fragments[e.fragments.length-1];if(l.length===0||!de(d==null?void 0:d.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const f=Pd();for(let m=0;m<l.length;m++){const g=l[m],v=n[g],E=v.startTime,y=o[g],S=(y==null?void 0:y.cues)||{};let T=(y==null?void 0:y.durationKnown)||!1,R=bo;const{duration:D,endDate:_}=v;if(_&&D!==null)R=E+D,T=!0;else if(v.endOnNext&&!T){const C=l.reduce((B,N)=>{if(N!==v.id){const F=n[N];if(F.class===v.class&&F.startDate>v.startDate&&(!B||v.startDate<B.startDate))return F}return B},null);C&&(R=C.startTime,T=!0)}const O=Object.keys(v.attr);for(let C=0;C<O.length;C++){const B=O[C];if(!$L(B))continue;const N=S[B];if(N)T&&!y.durationKnown?N.endTime=R:Math.abs(N.startTime-E)>.01&&(N.startTime=E,N.endTime=R);else if(f){let F=v.attr[B];GL(B)&&(F=cw(F));const $=rv(f,E,R,{key:B,data:F},ei.dateRange);$&&($.id=g,this.id3Track.addCue($),S[B]=$,this.hls.config.interstitialsController&&(B==="X-ASSET-LIST"||B==="X-ASSET-URL")&&$.addEventListener("enter",this.onEventCueEnter))}}o[g]={cues:S,dateRange:v,durationKnown:T}}}}class fw{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,i=this.levelDetails;if(!t||!i)return;this.currentTime=t.currentTime;const n=this.computeLatency();if(n===null)return;this._latency=n;const{lowLatencyMode:l,maxLiveSyncPlaybackRate:o}=this.config;if(!l||o===1||!i.live)return;const u=this.targetLatency;if(u===null)return;const d=n-u,f=Math.min(this.maxLatency,u+i.targetduration);if(d<f&&d>.05&&this.forwardBufferLength>1){const g=Math.min(2,Math.max(1,o)),v=Math.round(2/(1+Math.exp(-.75*d-this.edgeStalled))*20)/20,E=Math.min(g,Math.max(1,v));this.changeMediaPlaybackRate(t,E)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:i,targetduration:n}=e,{liveSyncDuration:l,liveSyncDurationCount:o,lowLatencyMode:u}=this.config,d=this.hls.userConfig;let f=u&&i||t;(this._targetLatencyUpdated||d.liveSyncDuration||d.liveSyncDurationCount||f===0)&&(f=l!==void 0?l:o*n);const m=n;return f+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,m)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const i=this.levelDetails;if(i===null)return null;const n=i.edge,l=e-t-this.edgeStalled,o=n-i.totalduration,u=n-(this.config.lowLatencyMode&&i.partTarget||i.targetduration);return Math.min(Math.max(o,l),u)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const i=e.buffered.length;return(i?e.buffered.end(i-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(A.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(A.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(A.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(A.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var i;t.details===q.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(i=this.levelDetails)!=null&&i.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var i,n;e.playbackRate!==t&&((i=this.hls)==null||i.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(n=this.targetLatency)==null?void 0:n.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class dw extends fh{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(A.LEVEL_LOADED,this.onLevelLoaded,this),e.on(A.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(A.FRAG_BUFFERED,this.onFragBuffered,this),e.on(A.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(A.LEVEL_LOADED,this.onLevelLoaded,this),e.off(A.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(A.FRAG_BUFFERED,this.onFragBuffered,this),e.off(A.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const i=this.hls.config.preferManagedMediaSource,n=[],l={},o={};let u=!1,d=!1,f=!1;t.levels.forEach(m=>{var g;const v=m.attrs;let{audioCodec:E,videoCodec:y}=m;E&&(m.audioCodec=E=Yo(E,i)||void 0),((g=y)==null?void 0:g.indexOf("avc1"))===0&&(y=m.videoCodec=oL(y));const{width:S,height:T,unknownCodecs:R}=m;let D=R?R.length:0;if(R)for(let ae=D;ae--;){const ce=R[ae];this.isAudioSupported(ce)?(m.audioCodec=E=E?`${E},${ce}`:ce,D--,pr.audio[E.substring(0,4)]=2):this.isVideoSupported(ce)&&(m.videoCodec=y=y?`${y},${ce}`:ce,D--,pr.video[y.substring(0,4)]=2)}if(u||(u=!!(S&&T)),d||(d=!!y),f||(f=!!E),D||E&&!this.isAudioSupported(E)||y&&!this.isVideoSupported(y)){this.log(`Some or all CODECS not supported "${v.CODECS}"`);return}const{CODECS:_,"FRAME-RATE":O,"HDCP-LEVEL":C,"PATHWAY-ID":B,RESOLUTION:N,"VIDEO-RANGE":F}=v,$=`${`${B||"."}-`}${m.bitrate}-${N}-${O}-${_}-${F}-${C}`;if(l[$])if(l[$].uri!==m.url&&!m.attrs["PATHWAY-ID"]){const ae=o[$]+=1;m.attrs["PATHWAY-ID"]=new Array(ae+1).join(".");const ce=this.createLevel(m);l[$]=ce,n.push(ce)}else l[$].addGroupId("audio",v.AUDIO),l[$].addGroupId("text",v.SUBTITLES);else{const ae=this.createLevel(m);l[$]=ae,o[$]=1,n.push(ae)}}),this.filterAndSortMediaOptions(n,t,u,d,f)}createLevel(e){const t=new Ma(e),i=e.supplemental;if(i!=null&&i.videoCodec&&!this.isVideoSupported(i.videoCodec)){const n=new Error(`SUPPLEMENTAL-CODECS not supported "${i.videoCodec}"`);this.log(n.message),t.supportedResult=vx(n,[])}return t}isAudioSupported(e){return Sd(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return Sd(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,i,n,l){let o=[],u=[],d=e;if((i||n)&&l&&(d=d.filter(({videoCodec:T,videoRange:R,width:D,height:_})=>(!!T||!!(D&&_))&&hL(R))),d.length===0){Promise.resolve().then(()=>{if(this.hls){let T="no level with compatible codecs found in manifest",R=T;t.levels.length&&(R=`one or more CODECS in variant not supported: ${et(t.levels.map(_=>_.attrs.CODECS).filter((_,O,C)=>C.indexOf(_)===O))}`,this.warn(R),T+=` (${R})`);const D=new Error(T);this.hls.trigger(A.ERROR,{type:pe.MEDIA_ERROR,details:q.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:D,reason:R})}});return}t.audioTracks&&(o=t.audioTracks.filter(T=>!T.audioCodec||this.isAudioSupported(T.audioCodec)),av(o)),t.subtitles&&(u=t.subtitles,av(u));const f=d.slice(0);d.sort((T,R)=>{if(T.attrs["HDCP-LEVEL"]!==R.attrs["HDCP-LEVEL"])return(T.attrs["HDCP-LEVEL"]||"")>(R.attrs["HDCP-LEVEL"]||"")?1:-1;if(i&&T.height!==R.height)return T.height-R.height;if(T.frameRate!==R.frameRate)return T.frameRate-R.frameRate;if(T.videoRange!==R.videoRange)return qo.indexOf(T.videoRange)-qo.indexOf(R.videoRange);if(T.videoCodec!==R.videoCodec){const D=Jp(T.videoCodec),_=Jp(R.videoCodec);if(D!==_)return _-D}if(T.uri===R.uri&&T.codecSet!==R.codecSet){const D=Ko(T.codecSet),_=Ko(R.codecSet);if(D!==_)return _-D}return T.averageBitrate!==R.averageBitrate?T.averageBitrate-R.averageBitrate:0});let m=f[0];if(this.steering&&(d=this.steering.filterParsedLevels(d),d.length!==f.length)){for(let T=0;T<f.length;T++)if(f[T].pathwayId===d[0].pathwayId){m=f[T];break}}this._levels=d;for(let T=0;T<d.length;T++)if(d[T]===m){var g;this._firstLevel=T;const R=m.bitrate,D=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${d.length} level(s) found, first bitrate: ${R}`),((g=this.hls.userConfig)==null?void 0:g.abrEwmaDefaultEstimate)===void 0){const _=Math.min(R,this.hls.config.abrEwmaDefaultEstimateMax);_>D&&D===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=_)}break}const v=l&&!n,E=this.hls.config,y=!!(E.audioStreamController&&E.audioTrackController),S={levels:d,audioTracks:o,subtitleTracks:u,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:l,video:n,altAudio:y&&!v&&o.some(T=>!!T.url)};this.hls.trigger(A.MANIFEST_PARSED,S)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const m=new Error("invalid level idx"),g=e<0;if(this.hls.trigger(A.ERROR,{type:pe.OTHER_ERROR,details:q.LEVEL_SWITCH_ERROR,level:e,fatal:g,error:m,reason:m.message}),g)return;e=Math.min(e,t.length-1)}const i=this.currentLevelIndex,n=this.currentLevel,l=n?n.attrs["PATHWAY-ID"]:void 0,o=t[e],u=o.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=o,i===e&&n&&l===u)return;this.log(`Switching to level ${e} (${o.height?o.height+"p ":""}${o.videoRange?o.videoRange+" ":""}${o.codecSet?o.codecSet+" ":""}@${o.bitrate})${u?" with Pathway "+u:""} from level ${i}${l?" with Pathway "+l:""}`);const d={level:e,attrs:o.attrs,details:o.details,bitrate:o.bitrate,averageBitrate:o.averageBitrate,maxBitrate:o.maxBitrate,realBitrate:o.realBitrate,width:o.width,height:o.height,codecSet:o.codecSet,audioCodec:o.audioCodec,videoCodec:o.videoCodec,audioGroups:o.audioGroups,subtitleGroups:o.subtitleGroups,loaded:o.loaded,loadError:o.loadError,fragmentError:o.fragmentError,name:o.name,id:o.id,uri:o.uri,url:o.url,urlId:0,audioGroupIds:o.audioGroupIds,textGroupIds:o.textGroupIds};this.hls.trigger(A.LEVEL_SWITCHING,d);const f=o.details;if(!f||f.live){const m=this.switchParams(o.uri,n==null?void 0:n.details,f);this.loadPlaylist(m)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),i=e.filter(n=>t.indexOf(n)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=i}}onError(e,t){t.fatal||!t.context||t.context.type===Ce.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===ge.MAIN){const i=t.elementaryStreams;if(!Object.keys(i).some(l=>!!i[l]))return;const n=this._levels[t.level];n!=null&&n.loadError&&(this.log(`Resetting level error count of ${n.loadError} on frag buffered`),n.loadError=0)}}onLevelLoaded(e,t){var i;const{level:n,details:l}=t,o=t.levelInfo;if(!o){var u;this.warn(`Invalid level index ${n}`),(u=t.deliveryDirectives)!=null&&u.skip&&(l.deltaUpdateFailed=!0);return}if(o===this.currentLevel||t.withoutMultiVariant){o.fragmentError===0&&(o.loadError=0);let d=o.details;d===t.details&&d.advanced&&(d=void 0),this.playlistLoaded(n,t,d)}else(i=t.deliveryDirectives)!=null&&i.skip&&(l.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const i=this.getUrlWithDirectives(e.uri,t),n=this.currentLevelIndex,l=e.attrs["PATHWAY-ID"],o=e.details,u=o==null?void 0:o.age;this.log(`Loading level index ${n}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${l?" Pathway "+l:""}${u&&o.live?" age "+u.toFixed(1)+(o.type&&" "+o.type||""):""} ${i}`),this.hls.trigger(A.LEVEL_LOADING,{url:i,level:n,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const i=this._levels.filter((l,o)=>o!==e?!0:(this.steering&&this.steering.removeLevel(l),l===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,l.details&&l.details.fragments.forEach(u=>u.level=-1)),!1));Nx(i),this._levels=i,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const n=i.length-1;this._firstLevel=Math.min(this._firstLevel,n),this._startLevel&&(this._startLevel=Math.min(this._startLevel,n)),this.hls.trigger(A.LEVELS_UPDATED,{levels:i})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:i}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(A.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:i}))}}function av(r){const e={};r.forEach(t=>{const i=t.groupId||"";t.id=e[i]=e[i]||0,e[i]++})}function b1(){return self.SourceBuffer||self.WebKitSourceBuffer}function A1(){if(!Hs())return!1;const e=b1();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function hw(){if(!A1())return!1;const r=Hs();return typeof(r==null?void 0:r.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>r.isTypeSupported(ka(e,"video")))||["mp4a.40.2","fLaC"].some(e=>r.isTypeSupported(ka(e,"audio"))))}function mw(){var r;const e=b1();return typeof(e==null||(r=e.prototype)==null?void 0:r.changeType)=="function"}const gw=100;class pw extends sh{constructor(e,t,i){super(e,t,i,"stream-controller",ge.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const n=this.media,l=n?n.currentTime:null;if(l===null||!de(l)||(this.log(`Media seeked to ${l.toFixed(3)}`),!this.getBufferedFrag(l)))return;const o=this.getFwdBufferInfoAtPos(n,l,ge.MAIN,0);if(o===null||o.len===0){this.warn(`Main forward buffer length at ${l} on "seeked" event ${o?o.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(A.MANIFEST_PARSED,this.onManifestParsed,this),e.on(A.LEVEL_LOADING,this.onLevelLoading,this),e.on(A.LEVEL_LOADED,this.onLevelLoaded,this),e.on(A.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(A.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(A.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(A.BUFFER_CREATED,this.onBufferCreated,this),e.on(A.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(A.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(A.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(A.MANIFEST_PARSED,this.onManifestParsed,this),e.off(A.LEVEL_LOADED,this.onLevelLoaded,this),e.off(A.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(A.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(A.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(A.BUFFER_CREATED,this.onBufferCreated,this),e.off(A.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(A.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(A.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:i,hls:n}=this;if(this.stopLoad(),this.setInterval(gw),this.level=-1,!this.startFragRequested){let l=n.startLevel;l===-1&&(n.config.testBandwidth&&this.levels.length>1?(l=0,this.bitrateTest=!0):l=n.firstAutoLevel),n.nextLoadLevel=l,this.level=n.loadLevel,this._hasEnoughToStart=!!t}i>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${i.toFixed(3)}`),e=i),this.state=ne.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=ne.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case ne.WAITING_LEVEL:{const{levels:t,level:i}=this,n=t==null?void 0:t[i],l=n==null?void 0:n.details;if(l&&(!l.live||this.levelLastLoaded===n&&!this.waitForLive(n))){if(this.waitForCdnTuneIn(l))break;this.state=ne.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=ne.IDLE;break}break}case ne.FRAG_LOADING_WAITING_RETRY:{var e;const t=self.performance.now(),i=this.retryDate;if(!i||t>=i||(e=this.media)!=null&&e.seeking){const{levels:n,level:l}=this,o=n==null?void 0:n[l];this.resetStartWhenNotLoaded(o||null),this.state=ne.IDLE}}break}this.state===ne.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:i,media:n}=this;if(t===null||!n&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const l=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(i!=null&&i[l]))return;const o=i[l],u=this.getMainFwdBufferInfo();if(u===null)return;const d=this.getLevelDetails();if(d&&this._streamEnded(u,d)){const S={};this.altAudio===2&&(S.type="video"),this.hls.trigger(A.BUFFER_EOS,S),this.state=ne.ENDED;return}if(!this.buffering)return;e.loadLevel!==l&&e.manualLevel===-1&&this.log(`Adapting to level ${l} from level ${this.level}`),this.level=e.nextLoadLevel=l;const f=o.details;if(!f||this.state===ne.WAITING_LEVEL||this.waitForLive(o)){this.level=l,this.state=ne.WAITING_LEVEL,this.startFragRequested=!1;return}const m=u.len,g=this.getMaxBufferLength(o.maxBitrate);if(m>=g)return;this.backtrackFragment&&this.backtrackFragment.start>u.end&&(this.backtrackFragment=null);const v=this.backtrackFragment?this.backtrackFragment.start:u.end;let E=this.getNextFragment(v,f);if(this.couldBacktrack&&!this.fragPrevious&&E&&St(E)&&this.fragmentTracker.getState(E)!==gt.OK){var y;const T=((y=this.backtrackFragment)!=null?y:E).sn-f.startSN,R=f.fragments[T-1];R&&E.cc===R.cc&&(E=R,this.fragmentTracker.removeFragment(R))}else this.backtrackFragment&&u.len&&(this.backtrackFragment=null);if(E&&this.isLoopLoading(E,v)){if(!E.gap){const T=this.audioOnly&&!this.altAudio?ze.AUDIO:ze.VIDEO,R=(T===ze.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;R&&this.afterBufferFlushed(R,T,ge.MAIN)}E=this.getNextFragmentLoopLoading(E,f,u,ge.MAIN,g)}E&&(E.initSegment&&!E.initSegment.data&&!this.bitrateTest&&(E=E.initSegment),this.loadFragment(E,o,v))}loadFragment(e,t,i){const n=this.fragmentTracker.getState(e);n===gt.NOT_LOADED||n===gt.PARTIAL?St(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,i):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,ge.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let i;const n=this.getAppendedFrag(t.currentTime);n&&n.start>1&&this.flushMainBuffer(0,n.start-1);const l=this.getLevelDetails();if(l!=null&&l.live){const u=this.getMainFwdBufferInfo();if(!u||u.len<l.targetduration*2)return}if(!t.paused&&e){const u=this.hls.nextLoadLevel,d=e[u],f=this.fragLastKbps;f&&this.fragCurrent?i=this.fragCurrent.duration*d.maxBitrate/(1e3*f)+1:i=0}else i=0;const o=this.getBufferedFrag(t.currentTime+i);if(o){const u=this.followingBufferedFrag(o);if(u){this.abortCurrentFrag();const d=u.maxStartPTS?u.maxStartPTS:u.start,f=u.duration,m=Math.max(o.end,d+Math.min(Math.max(f-this.config.maxFragLookUpTolerance,f*(this.couldBacktrack?.5:.125)),f*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(m,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case ne.KEY_LOADING:case ne.FRAG_LOADING:case ne.FRAG_LOADING_WAITING_RETRY:case ne.PARSING:case ne.PARSED:this.state=ne.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const i=t.media;fs(i,"playing",this.onMediaPlaying),fs(i,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:i}=this;i&&(ji(i,"playing",this.onMediaPlaying),ji(i,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(A.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let i=!1,n=!1;t.levels.forEach(l=>{const o=l.audioCodec;o&&(i=i||o.indexOf("mp4a.40.2")!==-1,n=n||o.indexOf("mp4a.40.5")!==-1)}),this.audioCodecSwitch=i&&n&&!mw(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:i}=this;if(!i||this.state!==ne.IDLE)return;const n=t.levelInfo;(!n.details||n.details.live&&(this.levelLastLoaded!==n||n.details.expired)||this.waitForCdnTuneIn(n.details))&&(this.state=ne.WAITING_LEVEL)}onLevelLoaded(e,t){var i;const{levels:n,startFragRequested:l}=this,o=t.level,u=t.details,d=u.totalduration;if(!n){this.warn(`Levels were reset while loading level ${o}`);return}this.log(`Level ${o} loaded [${u.startSN},${u.endSN}]${u.lastPartSn?`[part-${u.lastPartSn}-${u.lastPartIndex}]`:""}, cc [${u.startCC}, ${u.endCC}] duration:${d}`);const f=t.levelInfo,m=this.fragCurrent;m&&(this.state===ne.FRAG_LOADING||this.state===ne.FRAG_LOADING_WAITING_RETRY)&&m.level!==t.level&&m.loader&&this.abortCurrentFrag();let g=0;if(u.live||(i=f.details)!=null&&i.live){var v;if(this.checkLiveUpdate(u),u.deltaUpdateFailed)return;g=this.alignPlaylists(u,f.details,(v=this.levelLastLoaded)==null?void 0:v.details)}if(f.details=u,this.levelLastLoaded=f,l||this.setStartPosition(u,g),this.hls.trigger(A.LEVEL_UPDATED,{details:u,level:o}),this.state===ne.WAITING_LEVEL){if(this.waitForCdnTuneIn(u))return;this.state=ne.IDLE}l&&u.live&&this.synchronizeToLiveEdge(u),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:i}=this;if(!i)return;const n=this.hls.liveSyncPosition,l=this.getLoadPosition(),o=e.fragmentStart,u=e.edge,d=l>=o-t.maxFragLookUpTolerance&&l<=u;if(n!==null&&i.duration>n&&(l<n||!d)){const f=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;(!d&&i.readyState<4||l<u-f)&&(this._hasEnoughToStart||(this.nextLoadPosition=n),i.readyState&&(this.warn(`Playback: ${l.toFixed(3)} is located too far from the end of live sliding playlist: ${u}, reset currentTime to : ${n.toFixed(3)}`),i.currentTime=n))}}_handleFragmentLoadProgress(e){var t;const i=e.frag,{part:n,payload:l}=e,{levels:o}=this;if(!o){this.warn(`Levels were reset while fragment load was in progress. Fragment ${i.sn} of level ${i.level} will not be buffered`);return}const u=o[i.level];if(!u){this.warn(`Level ${i.level} not found on progress`);return}const d=u.details;if(!d){this.warn(`Dropping fragment ${i.sn} of level ${i.level} after level details were reset`),this.fragmentTracker.removeFragment(i);return}const f=u.videoCodec,m=d.PTSKnown||!d.live,g=(t=i.initSegment)==null?void 0:t.data,v=this._getAudioCodec(u),E=this.transmuxer=this.transmuxer||new i1(this.hls,ge.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),y=n?n.index:-1,S=y!==-1,T=new eh(i.level,i.sn,i.stats.chunkCount,l.byteLength,y,S),R=this.initPTS[i.cc];E.push(l,g,v,f,i,n,d.totalduration,m,T,R)}onAudioTrackSwitching(e,t){const i=this.hls,n=this.altAudio===2;if(Xo(t.url,i))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const o=this.fragCurrent;o&&(this.log("Switching to main audio track, cancel main fragment load"),o.abortRequests(),this.fragmentTracker.removeFragment(o)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(n){this.fragmentTracker.removeAllFragments(),i.once(A.BUFFER_FLUSHED,()=>{var o;(o=this.hls)==null||o.trigger(A.AUDIO_TRACK_SWITCHED,t)}),i.trigger(A.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}i.trigger(A.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const i=Xo(t.url,this.hls);if(i){const n=this.videoBuffer;n&&this.mediaBuffer!==n&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=n)}this.altAudio=i?2:0,this.tick()}onBufferCreated(e,t){const i=t.tracks;let n,l,o=!1;for(const u in i){const d=i[u];if(d.id==="main"){if(l=u,n=d,u==="video"){const f=i[u];f&&(this.videoBuffer=f.buffer)}}else o=!0}o&&n?(this.log(`Alternate track found, use ${l}.buffered to schedule main fragment loading`),this.mediaBuffer=n.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:i,part:n}=t,l=i.type===ge.MAIN;if(l){if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${n?" p: "+n.index:""} of level ${i.level} finished buffering, but was aborted. state: ${this.state}`),this.state===ne.PARSED&&(this.state=ne.IDLE);return}const u=n?n.stats:i.stats;this.fragLastKbps=Math.round(8*u.total/(u.buffering.end-u.loading.first)),St(i)&&(this.fragPrevious=i),this.fragBufferedComplete(i,n)}const o=this.media;o&&(!this._hasEnoughToStart&&De.getBuffered(o).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),l&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var i;if(t.fatal){this.state=ne.ERROR;return}switch(t.details){case q.FRAG_GAP:case q.FRAG_PARSING_ERROR:case q.FRAG_DECRYPT_ERROR:case q.FRAG_LOAD_ERROR:case q.FRAG_LOAD_TIMEOUT:case q.KEY_LOAD_ERROR:case q.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(ge.MAIN,t);break;case q.LEVEL_LOAD_ERROR:case q.LEVEL_LOAD_TIMEOUT:case q.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===ne.WAITING_LEVEL&&((i=t.context)==null?void 0:i.type)===Ce.LEVEL&&(this.state=ne.IDLE);break;case q.BUFFER_ADD_CODEC_ERROR:case q.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.resetLoadingState();break;case q.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case q.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=ne.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==ze.AUDIO||!this.altAudio){const i=(t===ze.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;i&&(this.afterBufferFlushed(i,t,ge.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let i=this.startPosition;if(i>=0&&t<i){if(e.seeking){this.log(`could not seek to ${i}, already seeking at ${t}`);return}const n=this.timelineOffset;n&&i&&(i+=n);const l=this.getLevelDetails(),o=De.getBuffered(e),u=o.length?o.start(0):0,d=u-i,f=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);d>0&&(d<f||this.loadingParts&&d<2*((l==null?void 0:l.partTarget)||0))&&(this.log(`adjusting start position by ${d} to match buffer start`),i+=d,this.startPosition=i),t<i&&(this.log(`seek to target start position ${i} from current time ${t} buffer start ${u}`),e.currentTime=i)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(i=>{const{hls:n}=this,l=i==null?void 0:i.frag;if(!l||this.fragContextChanged(l))return;t.fragmentError=0,this.state=ne.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const o=l.stats;o.parsing.start=o.parsing.end=o.buffering.start=o.buffering.end=self.performance.now(),n.trigger(A.FRAG_LOADED,i),l.bitrateTest=!1})}_handleTransmuxComplete(e){var t;const i=this.playlistType,{hls:n}=this,{remuxResult:l,chunkMeta:o}=e,u=this.getCurrentContext(o);if(!u){this.resetWhenMissingContext(o);return}const{frag:d,part:f,level:m}=u,{video:g,text:v,id3:E,initSegment:y}=l,{details:S}=m,T=this.altAudio?void 0:l.audio;if(this.fragContextChanged(d)){this.fragmentTracker.removeFragment(d);return}if(this.state=ne.PARSING,y){if(y!=null&&y.tracks){const _=d.initSegment||d;this._bufferInitSegment(m,y.tracks,_,o),n.trigger(A.FRAG_PARSING_INIT_SEGMENT,{frag:_,id:i,tracks:y.tracks})}const R=y.initPTS,D=y.timescale;de(R)&&(this.initPTS[d.cc]={baseTime:R,timescale:D},n.trigger(A.INIT_PTS_FOUND,{frag:d,id:i,initPTS:R,timescale:D}))}if(g&&S){T&&g.type==="audiovideo"&&this.logMuxedErr(d);const R=S.fragments[d.sn-1-S.startSN],D=d.sn===S.startSN,_=!R||d.cc>R.cc;if(l.independent!==!1){const{startPTS:O,endPTS:C,startDTS:B,endDTS:N}=g;if(f)f.elementaryStreams[g.type]={startPTS:O,endPTS:C,startDTS:B,endDTS:N};else if(g.firstKeyFrame&&g.independent&&o.id===1&&!_&&(this.couldBacktrack=!0),g.dropped&&g.independent){const F=this.getMainFwdBufferInfo(),z=(F?F.end:this.getLoadPosition())+this.config.maxBufferHole,$=g.firstKeyFramePTS?g.firstKeyFramePTS:O;if(!D&&z<$-this.config.maxBufferHole&&!_){this.backtrack(d);return}else _&&(d.gap=!0);d.setElementaryStreamInfo(g.type,d.start,C,d.start,N,!0)}else D&&O-(S.appliedTimelineOffset||0)>Po&&(d.gap=!0);d.setElementaryStreamInfo(g.type,O,C,B,N),this.backtrackFragment&&(this.backtrackFragment=d),this.bufferFragmentData(g,d,f,o,D||_)}else if(D||_)d.gap=!0;else{this.backtrack(d);return}}if(T){const{startPTS:R,endPTS:D,startDTS:_,endDTS:O}=T;f&&(f.elementaryStreams[ze.AUDIO]={startPTS:R,endPTS:D,startDTS:_,endDTS:O}),d.setElementaryStreamInfo(ze.AUDIO,R,D,_,O),this.bufferFragmentData(T,d,f,o)}if(S&&E!=null&&(t=E.samples)!=null&&t.length){const R={id:i,frag:d,details:S,samples:E.samples};n.trigger(A.FRAG_PARSING_METADATA,R)}if(S&&v){const R={id:i,frag:d,details:S,samples:v.samples};n.trigger(A.FRAG_PARSING_USERDATA,R)}}logMuxedErr(e){this.warn(`${St(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,i,n){if(this.state!==ne.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(i));const{audio:l,video:o,audiovideo:u}=t;if(l){let f=Io(l.codec,e.audioCodec);f==="mp4a"&&(f="mp4a.40.5");const m=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){f&&(f.indexOf("mp4a.40.5")!==-1?f="mp4a.40.2":f="mp4a.40.5");const g=l.metadata;g&&"channelCount"in g&&(g.channelCount||1)!==1&&m.indexOf("firefox")===-1&&(f="mp4a.40.5")}f&&f.indexOf("mp4a.40.5")!==-1&&m.indexOf("android")!==-1&&l.container!=="audio/mpeg"&&(f="mp4a.40.2",this.log(`Android: force audio codec to ${f}`)),e.audioCodec&&e.audioCodec!==f&&this.log(`Swapping manifest audio codec "${e.audioCodec}" for "${f}"`),l.levelCodec=f,l.id=ge.MAIN,this.log(`Init audio buffer, container:${l.container}, codecs[selected/level/parsed]=[${f||""}/${e.audioCodec||""}/${l.codec}]`),delete t.audiovideo}if(o){o.levelCodec=e.videoCodec,o.id=ge.MAIN;const f=o.codec;if((f==null?void 0:f.length)===4)switch(f){case"hvc1":case"hev1":o.codec="hvc1.1.6.L120.90";break;case"av01":o.codec="av01.0.04M.08";break;case"avc1":o.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${o.container}, codecs[level/parsed]=[${e.videoCodec||""}/${f}]${o.codec!==f?" parsed-corrected="+o.codec:""}${o.supplemental?" supplemental="+o.supplemental:""}`),delete t.audiovideo}u&&(this.log(`Init audiovideo buffer, container:${u.container}, codecs[level/parsed]=[${e.codecs}/${u.codec}]`),delete t.video,delete t.audio);const d=Object.keys(t);if(d.length){if(this.hls.trigger(A.BUFFER_CODECS,t),!this.hls)return;d.forEach(f=>{const g=t[f].initSegment;g!=null&&g.byteLength&&this.hls.trigger(A.BUFFER_APPENDING,{type:f,data:g,frag:i,part:null,chunkMeta:n,parent:i.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,ge.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,i=e==null?void 0:e[t];return i?this.getMaxBufferLength(i.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=ne.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const i=e.currentTime;if(De.isBuffered(e,i)?t=this.getAppendedFrag(i):De.isBuffered(e,i+.1)&&(t=this.getAppendedFrag(i+.1)),t){this.backtrackFragment=null;const n=this.fragPlaying,l=t.level;(!n||t.sn!==n.sn||n.level!==l)&&(this.fragPlaying=t,this.hls.trigger(A.FRAG_CHANGED,{frag:t}),(!n||n.level!==l)&&this.hls.trigger(A.LEVEL_SWITCHED,{level:l}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return de(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(de(t)){const i=this.getLevelDetails(),n=this.currentFrag||(i?En(null,i.fragments,t):null);if(n){const l=n.programDateTime;if(l!==null){const o=l+(t-n.start)*1e3;return new Date(o)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class yw{constructor(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const i in this.keyUriToKeyInfo){const n=this.keyUriToKeyInfo[i].loader;if(n){var t;if(e&&e!==((t=n.context)==null?void 0:t.frag.type))return;n.abort()}}}detach(){for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(e,t=q.KEY_LOAD_ERROR,i,n,l){return new cs({type:pe.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:l,error:i,networkDetails:n})}loadClear(e,t){if(this.emeController&&this.config.emeEnabled){const{sn:i,cc:n}=e;for(let l=0;l<t.length;l++){const o=t[l];if(n<=o.cc&&(i==="initSegment"||o.sn==="initSegment"||i<o.sn)){this.emeController.selectKeySystemFormat(o).then(u=>{o.setKeyFormat(u)});break}}}}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var i,n;t&&e.setKeyFormat(t);const l=e.decryptdata;if(!l){const f=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,q.KEY_LOAD_ERROR,f))}const o=l.uri;if(!o)return Promise.reject(this.createKeyLoadError(e,q.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${o}"`)));let u=this.keyUriToKeyInfo[o];if((i=u)!=null&&i.decryptdata.key)return l.key=u.decryptdata.key,Promise.resolve({frag:e,keyInfo:u});if((n=u)!=null&&n.keyLoadPromise){var d;switch((d=u.mediaKeySessionContext)==null?void 0:d.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return u.keyLoadPromise.then(f=>(l.key=f.keyInfo.decryptdata.key,{frag:e,keyInfo:u}))}}switch(u=this.keyUriToKeyInfo[o]={decryptdata:l,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},l.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return l.keyFormat==="identity"?this.loadKeyHTTP(u,e):this.loadKeyEME(u,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(u,e);default:return Promise.reject(this.createKeyLoadError(e,q.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${l.method}"`)))}}loadKeyEME(e,t){const i={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){const n=this.emeController.loadKey(i);if(n)return(e.keyLoadPromise=n.then(l=>(e.mediaKeySessionContext=l,i))).catch(l=>{throw e.keyLoadPromise=null,l})}return Promise.resolve(i)}loadKeyHTTP(e,t){const i=this.config,n=i.loader,l=new n(i);return t.keyLoader=e.loader=l,e.keyLoadPromise=new Promise((o,u)=>{const d={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},f=i.keyLoadPolicy.default,m={loadPolicy:f,timeout:f.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},g={onSuccess:(v,E,y,S)=>{const{frag:T,keyInfo:R,url:D}=y;if(!T.decryptdata||R!==this.keyUriToKeyInfo[D])return u(this.createKeyLoadError(T,q.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),S));R.decryptdata.key=T.decryptdata.key=new Uint8Array(v.data),T.keyLoader=null,R.loader=null,o({frag:T,keyInfo:R})},onError:(v,E,y,S)=>{this.resetLoader(E),u(this.createKeyLoadError(t,q.KEY_LOAD_ERROR,new Error(`HTTP Error ${v.code} loading key ${v.text}`),y,$e({url:d.url,data:void 0},v)))},onTimeout:(v,E,y)=>{this.resetLoader(E),u(this.createKeyLoadError(t,q.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),y))},onAbort:(v,E,y)=>{this.resetLoader(E),u(this.createKeyLoadError(t,q.INTERNAL_ABORTED,new Error("key loading aborted"),y))}};l.load(d,m,g)})}resetLoader(e){const{frag:t,keyInfo:i,url:n}=e,l=i.loader;t.keyLoader===l&&(t.keyLoader=null,i.loader=null),delete this.keyUriToKeyInfo[n],l&&l.destroy()}}function lv(r){const{type:e}=r;switch(e){case Ce.AUDIO_TRACK:return ge.AUDIO;case Ce.SUBTITLE_TRACK:return ge.SUBTITLE;default:return ge.MAIN}}function rd(r,e){let t=r.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class vw{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(A.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.LEVEL_LOADING,this.onLevelLoading,this),e.on(A.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(A.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(A.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(A.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.LEVEL_LOADING,this.onLevelLoading,this),e.off(A.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(A.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(A.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,i=t.pLoader,n=t.loader,l=i||n,o=new l(t);return this.loaders[e.type]=o,o}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:i}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Ce.MANIFEST,url:i,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:i,level:n,pathwayId:l,url:o,deliveryDirectives:u,levelInfo:d}=t;this.load({id:i,level:n,pathwayId:l,responseType:"text",type:Ce.LEVEL,url:o,deliveryDirectives:u,levelOrTrack:d})}onAudioTrackLoading(e,t){const{id:i,groupId:n,url:l,deliveryDirectives:o,track:u}=t;this.load({id:i,groupId:n,level:null,responseType:"text",type:Ce.AUDIO_TRACK,url:l,deliveryDirectives:o,levelOrTrack:u})}onSubtitleTrackLoading(e,t){const{id:i,groupId:n,url:l,deliveryDirectives:o,track:u}=t;this.load({id:i,groupId:n,level:null,responseType:"text",type:Ce.SUBTITLE_TRACK,url:l,deliveryDirectives:o,levelOrTrack:u})}onLevelsUpdated(e,t){const i=this.loaders[Ce.LEVEL];if(i){const n=i.context;n&&!t.levels.some(l=>l===n.levelOrTrack)&&(i.abort(),delete this.loaders[Ce.LEVEL])}}load(e){var t;const i=this.hls.config;let n=this.getInternalLoader(e);if(n){const f=this.hls.logger,m=n.context;if(m&&m.levelOrTrack===e.levelOrTrack&&(m.url===e.url||m.deliveryDirectives&&!e.deliveryDirectives)){m.url===e.url?f.log(`[playlist-loader]: ignore ${e.url} ongoing request`):f.log(`[playlist-loader]: ignore ${e.url} in favor of ${m.url}`);return}f.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),n.abort()}let l;if(e.type===Ce.MANIFEST?l=i.manifestLoadPolicy.default:l=Ke({},i.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),n=this.createInternalLoader(e),de((t=e.deliveryDirectives)==null?void 0:t.part)){let f;if(e.type===Ce.LEVEL&&e.level!==null?f=this.hls.levels[e.level].details:e.type===Ce.AUDIO_TRACK&&e.id!==null?f=this.hls.audioTracks[e.id].details:e.type===Ce.SUBTITLE_TRACK&&e.id!==null&&(f=this.hls.subtitleTracks[e.id].details),f){const m=f.partTarget,g=f.targetduration;if(m&&g){const v=Math.max(m*3,g*.8)*1e3;l=Ke({},l,{maxTimeToFirstByteMs:Math.min(v,l.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(v,l.maxTimeToFirstByteMs)})}}}const o=l.errorRetry||l.timeoutRetry||{},u={loadPolicy:l,timeout:l.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},d={onSuccess:(f,m,g,v)=>{const E=this.getInternalLoader(g);this.resetInternalLoader(g.type);const y=f.data;if(y.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(f,g,new Error("no EXTM3U delimiter"),v||null,m);return}m.parsing.start=performance.now(),Fi.isMediaPlaylist(y)||g.type!==Ce.MANIFEST?this.handleTrackOrLevelPlaylist(f,m,g,v||null,E):this.handleMasterPlaylist(f,m,g,v)},onError:(f,m,g,v)=>{this.handleNetworkError(m,g,!1,f,v)},onTimeout:(f,m,g)=>{this.handleNetworkError(m,g,!0,void 0,f)}};n.load(e,u,d)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:i}=this.hls;(e||i)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,i,n){const l=this.hls,o=e.data,u=rd(e,i),d=Fi.parseMasterPlaylist(o,u);if(d.playlistParsingError){this.handleManifestParsingError(e,i,d.playlistParsingError,n,t);return}const{contentSteering:f,levels:m,sessionData:g,sessionKeys:v,startTimeOffset:E,variableList:y}=d;this.variableList=y;const{AUDIO:S=[],SUBTITLES:T,"CLOSED-CAPTIONS":R}=Fi.parseMasterPlaylistMedia(o,u,d);S.length&&!S.some(_=>!_.url)&&m[0].audioCodec&&!m[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),S.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new it({}),bitrate:0,url:""})),l.trigger(A.MANIFEST_LOADED,{levels:m,audioTracks:S,subtitles:T,captions:R,contentSteering:f,url:u,stats:t,networkDetails:n,sessionData:g,sessionKeys:v,startTimeOffset:E,variableList:y})}handleTrackOrLevelPlaylist(e,t,i,n,l){const o=this.hls,{id:u,level:d,type:f}=i,m=rd(e,i),g=de(d)?d:de(u)?u:0,v=lv(i),E=Fi.parseLevelPlaylist(e.data,m,g,v,0,this.variableList);if(f===Ce.MANIFEST){const y={attrs:new it({}),bitrate:0,details:E,name:"",url:m};E.requestScheduled=t.loading.start+Ix(E,0),o.trigger(A.MANIFEST_LOADED,{levels:[y],audioTracks:[],url:m,stats:t,networkDetails:n,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),i.levelDetails=E,this.handlePlaylistLoaded(E,e,t,i,n,l)}handleManifestParsingError(e,t,i,n,l){this.hls.trigger(A.ERROR,{type:pe.NETWORK_ERROR,details:q.MANIFEST_PARSING_ERROR,fatal:t.type===Ce.MANIFEST,url:e.url,err:i,error:i,reason:i.message,response:e,context:t,networkDetails:n,stats:l})}handleNetworkError(e,t,i=!1,n,l){let o=`A network ${i?"timeout":"error"+(n?" (status "+n.code+")":"")} occurred while loading ${e.type}`;e.type===Ce.LEVEL?o+=`: ${e.level} id: ${e.id}`:(e.type===Ce.AUDIO_TRACK||e.type===Ce.SUBTITLE_TRACK)&&(o+=` id: ${e.id} group-id: "${e.groupId}"`);const u=new Error(o);this.hls.logger.warn(`[playlist-loader]: ${o}`);let d=q.UNKNOWN,f=!1;const m=this.getInternalLoader(e);switch(e.type){case Ce.MANIFEST:d=i?q.MANIFEST_LOAD_TIMEOUT:q.MANIFEST_LOAD_ERROR,f=!0;break;case Ce.LEVEL:d=i?q.LEVEL_LOAD_TIMEOUT:q.LEVEL_LOAD_ERROR,f=!1;break;case Ce.AUDIO_TRACK:d=i?q.AUDIO_TRACK_LOAD_TIMEOUT:q.AUDIO_TRACK_LOAD_ERROR,f=!1;break;case Ce.SUBTITLE_TRACK:d=i?q.SUBTITLE_TRACK_LOAD_TIMEOUT:q.SUBTITLE_LOAD_ERROR,f=!1;break}m&&this.resetInternalLoader(e.type);const g={type:pe.NETWORK_ERROR,details:d,fatal:f,url:e.url,loader:m,context:e,error:u,networkDetails:t,stats:l};if(n){const v=(t==null?void 0:t.url)||e.url;g.response=$e({url:v,data:void 0},n)}this.hls.trigger(A.ERROR,g)}handlePlaylistLoaded(e,t,i,n,l,o){const u=this.hls,{type:d,level:f,id:m,groupId:g,deliveryDirectives:v}=n,E=rd(t,n),y=lv(n),S=typeof n.level=="number"&&y===ge.MAIN?f:void 0;if(!e.fragments.length){const R=e.playlistParsingError=new Error("No Segments found in Playlist");u.trigger(A.ERROR,{type:pe.NETWORK_ERROR,details:q.LEVEL_EMPTY_ERROR,fatal:!1,url:E,error:R,reason:R.message,response:t,context:n,level:S,parent:y,networkDetails:l,stats:i});return}e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));const T=e.playlistParsingError;if(T){if(this.hls.logger.warn(T),!u.config.ignorePlaylistParsingErrors){u.trigger(A.ERROR,{type:pe.NETWORK_ERROR,details:q.LEVEL_PARSING_ERROR,fatal:!1,url:E,error:T,reason:T.message,response:t,context:n,level:S,parent:y,networkDetails:l,stats:i});return}e.playlistParsingError=null}switch(e.live&&o&&(o.getCacheAge&&(e.ageHeader=o.getCacheAge()||0),(!o.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),d){case Ce.MANIFEST:case Ce.LEVEL:u.trigger(A.LEVEL_LOADED,{details:e,levelInfo:n.levelOrTrack||u.levels[0],level:S||0,id:m||0,stats:i,networkDetails:l,deliveryDirectives:v,withoutMultiVariant:d===Ce.MANIFEST});break;case Ce.AUDIO_TRACK:u.trigger(A.AUDIO_TRACK_LOADED,{details:e,track:n.levelOrTrack,id:m||0,groupId:g||"",stats:i,networkDetails:l,deliveryDirectives:v});break;case Ce.SUBTITLE_TRACK:u.trigger(A.SUBTITLE_TRACK_LOADED,{details:e,track:n.levelOrTrack,id:m||0,groupId:g||"",stats:i,networkDetails:l,deliveryDirectives:v});break}}}class Nt{static get version(){return Ba}static isMSESupported(){return A1()}static isSupported(){return hw()}static getMediaSource(){return Hs()}static get Events(){return A}static get MetadataSchema(){return ei}static get ErrorTypes(){return pe}static get ErrorDetails(){return q}static get DefaultConfig(){return Nt.defaultConfig?Nt.defaultConfig:ew}static set DefaultConfig(e){Nt.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new nh,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=UR(e.debug||!1,"Hls instance",e.assetPlayerId),i=this.config=iw(Nt.DefaultConfig,e,t);this.userConfig=e,i.progressive&&sw(i,t);const{abrController:n,bufferController:l,capLevelController:o,errorController:u,fpsController:d}=i,f=new u(this),m=this.abrController=new n(this),g=new wL(this),v=i.interstitialsController,E=v?this.interstitialsController=new v(this,Nt):null,y=this.bufferController=new l(this,g),S=this.capLevelController=new o(this),T=new d(this),R=new vw(this),D=i.contentSteeringController,_=D?new D(this):null,O=this.levelController=new dw(this,_),C=new uw(this),B=new yw(this.config),N=this.streamController=new pw(this,g,B),F=this.gapController=new lw(this,g);S.setStreamController(N),T.setStreamController(N);const z=[R,O,N];E&&z.splice(1,0,E),_&&z.splice(1,0,_),this.networkControllers=z;const $=[m,y,F,S,T,C,g];this.audioTrackController=this.createController(i.audioTrackController,z);const ae=i.audioStreamController;ae&&z.push(this.audioStreamController=new ae(this,g,B)),this.subtitleTrackController=this.createController(i.subtitleTrackController,z);const ce=i.subtitleStreamController;ce&&z.push(this.subtititleStreamController=new ce(this,g,B)),this.createController(i.timelineController,$),B.emeController=this.emeController=this.createController(i.emeController,$),this.cmcdController=this.createController(i.cmcdController,$),this.latencyController=this.createController(fw,$),this.coreComponents=$,z.push(f);const ve=f.onErrorOut;typeof ve=="function"&&this.on(A.ERROR,ve,f),this.on(A.MANIFEST_LOADED,R.onManifestLoaded,R)}createController(e,t){if(e){const i=new e(this);return t&&t.push(i),i}return null}on(e,t,i=this){this._emitter.on(e,t,i)}once(e,t,i=this){this._emitter.once(e,t,i)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,i=this,n){this._emitter.off(e,t,i,n)}listeners(e){return this._emitter.listeners(e)}emit(e,t,i){return this._emitter.emit(e,t,i)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(i){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+i.message+'". Here is a stacktrace:',i),!this.triggeringException){this.triggeringException=!0;const n=e===A.ERROR;this.trigger(A.ERROR,{type:pe.OTHER_ERROR,details:q.INTERNAL_EXCEPTION,fatal:n,event:e,error:i}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(A.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const l=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(A.ERROR,{type:pe.OTHER_ERROR,details:q.ATTACH_MEDIA_ERROR,fatal:!0,error:l});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,i=t?e.media:e,n=t?e:{media:i};this._media=i,this.trigger(A.MEDIA_ATTACHING,n)}detachMedia(){this.logger.log("detachMedia"),this.trigger(A.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(A.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,i=this._url,n=this._url=qd.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${n}`),t&&i&&(i!==n||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(A.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let i=0;i<this.networkControllers.length&&(this.networkControllers[i].startLoad(e,t),!(!this.started||!this.networkControllers));i++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[ge.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[ge.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[ge.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e==null?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=_2()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){dL(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const i=e.length;for(let n=0;n<i;n++)if(e[n].maxBitrate>=t)return n;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:i}=this;let n;if(t===-1&&e!=null&&e.length?n=e.length-1:n=t,i)for(let l=n;l--;){const o=e[l].attrs["HDCP-LEVEL"];if(o&&o<=i)return l}return n}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const i=Ex(t);return xx(e,i,navigator.mediaCapabilities)}}Nt.defaultConfig=void 0;const xw=({videoUrl:r,posterUrl:e,title:t,className:i="",savedTime:n=0,onTimeUpdate:l,onVideoEnded:o,referer:u,subtitles:d,intro:f,outro:m})=>{const g=U.useRef(null),v=U.useRef(null),E=U.useRef(null),y=U.useRef(!1),S=U.useRef(n||0),[T,R]=U.useState(!1),[D,_]=U.useState(!1),[O,C]=U.useState(!1),[B,N]=U.useState(null),F=U.useRef(0),z=U.useRef(null),$=r==null?void 0:r.includes(".m3u8"),ae=U.useCallback(()=>document.createElement("video").canPlayType("application/vnd.apple.mpegurl")!=="",[]),ce=U.useCallback((w,k)=>{if(w!=null&&w.includes(".m3u8")){const K="https://shrina-proxy-production.up.railway.app/proxy",G=encodeURIComponent(w),oe=k?encodeURIComponent(k):"";return`${K}?url=${G}&referer=${oe}`}return w},[]),ve=U.useCallback(()=>{const w=g.current;if(!w||!l)return;S.current=w.currentTime;const k=Date.now();T&&k-F.current>=1e3&&(F.current=k,l(w.currentTime)),f&&w.currentTime>=f.start&&w.currentTime<f.end?_(!0):_(!1),m&&w.currentTime>=m.start&&w.currentTime<m.end?C(!0):C(!1)},[l,f,m,T]),he=U.useCallback(()=>{o&&o()},[o]),J=U.useCallback(()=>{R(!0)},[]),P=U.useCallback(()=>{R(!1)},[]),W=U.useCallback(()=>{const w=g.current;!w||!f||(w.currentTime=f.end,_(!1))},[f]),se=U.useCallback(()=>{!g.current||!o||o()},[o]),ee=U.useCallback(()=>{const w=g.current;if(!(!w||!d||d.length===0)){for(;w.firstChild;)w.removeChild(w.firstChild);d.forEach((k,K)=>{if(k.lang!=="thumbnails"){const G=document.createElement("track");G.kind="subtitles",G.label=k.lang,G.src=k.url,G.srclang=k.lang.toLowerCase(),K===0&&(G.default=!0),w.appendChild(G)}})}},[d]);return U.useEffect(()=>{const w=g.current;if(w)return w.addEventListener("timeupdate",ve),w.addEventListener("ended",he),w.addEventListener("play",J),w.addEventListener("pause",P),w.addEventListener("webkitbeginfullscreen",()=>{T&&setTimeout(()=>{const k=w.play();k!==void 0&&k.catch(()=>{})},100)}),()=>{w.removeEventListener("timeupdate",ve),w.removeEventListener("ended",he),w.removeEventListener("play",J),w.removeEventListener("pause",P),w.removeEventListener("webkitbeginfullscreen",()=>{}),E.current&&clearTimeout(E.current)}},[ve,he,J,P,T]),U.useEffect(()=>{const w=g.current;if(!w||!r||z.current===r)return;z.current=r,N(null);const k=ce(r,u);if($)if(ae())v.current&&(v.current.destroy(),v.current=null),w.src=k,w.load(),ee(),!y.current&&n>0?setTimeout(()=>{if(w){w.currentTime=n,y.current=!0;const G=w.play();G!==void 0&&G.catch(()=>{})}},300):S.current>0&&setTimeout(()=>{w&&(w.currentTime=S.current)},300);else if(Nt.isSupported()){v.current&&(v.current.destroy(),v.current=null);const G=new Nt({fragLoadingTimeOut:6e4,manifestLoadingTimeOut:6e4,levelLoadingTimeOut:6e4,fragLoadingRetryDelay:1e3,manifestLoadingMaxRetry:4,levelLoadingMaxRetry:4,fragLoadingMaxRetry:6,startFragPrefetch:!0,maxBufferLength:60,maxMaxBufferLength:600,autoStartLoad:!0,startLevel:-1,maxBufferHole:.5,lowLatencyMode:!1});G.on(Nt.Events.ERROR,(oe,fe)=>{if(fe.fatal){if(fe.type===Nt.ErrorTypes.NETWORK_ERROR)N("Network error occurred. The video server might be restricting access.");else if(fe.type===Nt.ErrorTypes.MEDIA_ERROR){G.recoverMediaError();return}else N("An error occurred while playing the video. Please try again later.");G.destroy(),v.current=null}else fe.type===Nt.ErrorTypes.MEDIA_ERROR&&G.recoverMediaError()});try{G.loadSource(k),G.attachMedia(w),ee(),G.on(Nt.Events.MANIFEST_PARSED,()=>{!y.current&&n>0?(w.currentTime=n,y.current=!0):S.current>0&&(w.currentTime=S.current);const oe=w.play();oe!==void 0&&oe.catch(()=>{})}),G.on(Nt.Events.LEVEL_SWITCHED,()=>{S.current>0&&w.currentTime!==S.current&&(w.currentTime=S.current)}),v.current=G}catch{N("Failed to load video. The stream might be restricted or unavailable.")}}else N("Your browser doesn't support HLS streaming and HLS.js is not available.");else{w.src=r,w.load(),ee(),!y.current&&n>0?(w.currentTime=n,y.current=!0):S.current>0&&(w.currentTime=S.current);const K=()=>{N("Failed to load video. Please try a different server.")};w.addEventListener("error",K);const G=w.play();return G!==void 0&&G.catch(()=>{}),()=>{w.removeEventListener("error",K)}}},[r,$,n,u,ce,ae,ee]),U.useEffect(()=>()=>{v.current&&(v.current.destroy(),v.current=null)},[]),b.jsx("div",{className:`video-player-container relative ${i}`,children:B?b.jsxs("div",{className:"w-full h-full bg-black flex flex-col items-center justify-center text-white p-4",children:[b.jsx("div",{className:"text-red-500 text-xl mb-4",children:"⚠️ Error"}),b.jsx("p",{className:"text-center mb-4",children:B}),b.jsx("p",{className:"text-center text-sm text-gray-400 mb-6",children:"This might be due to CORS restrictions or region blocking. Try using a different server or watching a different anime."}),b.jsx("button",{onClick:()=>N(null),className:"bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-md transition-colors",children:"Try Again"})]}):b.jsxs(b.Fragment,{children:[b.jsx("video",{ref:g,className:"w-full h-full",controls:!0,playsInline:!0,"webkit-playsinline":"true",poster:e,title:t,preload:"auto",children:"Your browser does not support the video tag."}),D&&b.jsx("button",{onClick:W,className:"absolute bottom-20 right-4 bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-md transition-colors",children:"Skip Intro"}),O&&b.jsx("button",{onClick:se,className:"absolute bottom-20 right-4 bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-md transition-colors",children:"Next Episode"})]})})},Ew=Si.memo(xw),Sw=()=>{var w;const{animeId:r,seasonId:e,episodeId:t}=vv(),i=zs(),[n,l]=U.useState(null),[o,u]=U.useState(null),[d,f]=U.useState(null),[m,g]=U.useState(!0),[v,E]=U.useState(0),[y,S]=U.useState(null),[T,R]=U.useState("vidcloud"),D=["vidcloud","streamsb","vidstreaming"],[_,O]=U.useState(null),C=30,[B,N]=U.useState(0),[F,z]=U.useState([]),$=k=>Math.floor((k-1)/C),ae=async k=>{try{const K=await kt.getAnimeInfo(k);return K||null}catch{return null}};U.useEffect(()=>{(async()=>{if(r)try{g(!0);const K=await ae(r);if(!K){g(!1);return}l(K);let G;e?G=K.seasons.find(ue=>ue.id===e)||K.seasons[0]:G=K.seasons[0],u(G);let oe;t?oe=G.episodes.find(ue=>ue.id===t)||G.episodes[0]:oe=G.episodes[0],f(oe);const fe=localStorage.getItem(`watchTime-${r}-${G.id}-${oe.id}`);if(fe&&E(parseFloat(fe)),G.episodes.length>0){const ue=Math.max(...G.episodes.map(ct=>ct.number)),ke=Math.ceil(ue/C),Le=Array.from({length:ke},(ct,Vi)=>({start:Vi*C+1,end:Math.min((Vi+1)*C,ue)}));z(Le),N($(oe.number))}g(!1)}catch{g(!1)}})()},[r,e,t]),U.useEffect(()=>{if(!d)return;(async()=>{g(!0);try{const K=d.id,G=await kt.getVideoSources(K,T);G?S(G):O("Failed to load video sources. Please try another server.")}catch{O("Failed to load video sources. Please try another server.")}finally{g(!1)}})()},[d,T]),U.useEffect(()=>{if(d){const k=$(d.number);N(k)}},[d]);const ce=k=>{if(Math.abs(k-v)>1&&E(k),n&&o&&d){localStorage.setItem(`watchTime-${n.id}-${o.id}-${d.id}`,k.toString());const K=Math.min(Math.round(k/d.duration*100),100),G=parseInt(localStorage.getItem(`lastSavedProgress-${n.id}-${o.id}-${d.id}`)||"0");if(Math.abs(K-G)>=5||K===100){localStorage.setItem(`lastSavedProgress-${n.id}-${o.id}-${d.id}`,K.toString());const oe=JSON.parse(localStorage.getItem("watchHistory")||"[]"),fe={animeId:n.id,seasonId:o.id,episodeId:d.id,title:n.title,episodeTitle:d.title,episodeNumber:d.number,seasonNumber:o.number,thumbnail:d.thumbnail,timestamp:k,progress:K,lastWatched:new Date().toISOString()},ue=oe.filter(ke=>!(ke.animeId===fe.animeId&&ke.seasonId===fe.seasonId&&ke.episodeId===fe.episodeId));localStorage.setItem("watchHistory",JSON.stringify([fe,...ue].slice(0,20)))}}},ve=()=>{if(!n||!o||!d)return;const k=o.episodes.findIndex(G=>G.id===d.id);if(k<o.episodes.length-1){const G=o.episodes[k+1];i(`/watch/${n.id}/${o.id}/${G.id}`);return}const K=n.seasons.findIndex(G=>G.id===o.id);if(K<n.seasons.length-1){const G=n.seasons[K+1];if(G.episodes.length>0){i(`/watch/${n.id}/${G.id}/${G.episodes[0].id}`);return}}i(`/anime/${n.id}`)},he=()=>{if(!n||!o||!d)return;const k=o.episodes.findIndex(G=>G.id===d.id);if(k>0){const G=o.episodes[k-1];i(`/watch/${n.id}/${o.id}/${G.id}`);return}const K=n.seasons.findIndex(G=>G.id===o.id);if(K>0){const G=n.seasons[K-1];if(G.episodes.length>0){const oe=G.episodes[G.episodes.length-1];i(`/watch/${n.id}/${G.id}/${oe.id}`);return}}},J=()=>{if(!n||!o||!d)return;const k=o.episodes.findIndex(G=>G.id===d.id);if(k<o.episodes.length-1){const G=o.episodes[k+1];i(`/watch/${n.id}/${o.id}/${G.id}`);return}const K=n.seasons.findIndex(G=>G.id===o.id);if(K<n.seasons.length-1){const G=n.seasons[K+1];if(G.episodes.length>0){i(`/watch/${n.id}/${G.id}/${G.episodes[0].id}`);return}}},P=()=>{if(!y||!y.sources)return"";const k=y.sources;if(k.length===0)return"";if(k.length>1){const K=k.find(oe=>oe.quality==="1080p"||oe.quality==="1080");if(K)return K.url;const G=k.find(oe=>oe.quality==="720p"||oe.quality==="720");if(G)return G.url}return k[0].url},W=()=>{if(!o||F.length===0)return[];const k=F[B];return k?o.episodes.filter(K=>K.number>=k.start&&K.number<=k.end):[]};if(m)return b.jsx(Mt,{children:b.jsx("div",{className:"flex justify-center items-center h-screen",children:b.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})})});if(!n||!o||!d)return b.jsx(Mt,{children:b.jsxs("div",{className:"container mx-auto px-4 py-16 text-center",children:[b.jsx("h1",{className:"text-3xl font-bold text-white mb-4",children:"Episode Not Found"}),b.jsx("p",{className:"text-gray-300 mb-8",children:"The episode you are looking for doesn't exist or has been removed."}),b.jsx("button",{onClick:()=>i(-1),className:"bg-primary-600 hover:bg-primary-700 text-white px-6 py-3 rounded-md font-medium",children:"Go Back"})]})});const se=k=>{const K=Math.floor(k/60),G=Math.floor(k%60);return`${K}:${G.toString().padStart(2,"0")}`},ee=W();return b.jsx(Mt,{children:b.jsxs("div",{className:"container mx-auto px-4 py-8",children:[b.jsxs("div",{className:"bg-gray-900",children:[m?b.jsx("div",{className:"w-full aspect-video flex items-center justify-center bg-slate-800",children:b.jsx("div",{className:"loader"})}):_?b.jsx("div",{className:"w-full aspect-video flex items-center justify-center bg-slate-800 text-white",children:b.jsxs("div",{className:"text-center p-4",children:[b.jsx("h3",{className:"text-xl font-bold mb-2",children:"Error"}),b.jsx("p",{children:_}),b.jsx("button",{onClick:()=>i(-1),className:"mt-4 px-4 py-2 bg-primary-600 hover:bg-primary-700 rounded",children:"Go Back"})]})}):y?b.jsx(Ew,{videoUrl:P(),posterUrl:(d==null?void 0:d.thumbnail)||(n==null?void 0:n.coverImage),title:`${n==null?void 0:n.title} - ${d==null?void 0:d.title}`,className:"w-full aspect-video",savedTime:v,onTimeUpdate:ce,onVideoEnded:ve,referer:(w=y==null?void 0:y.headers)==null?void 0:w.Referer,subtitles:y==null?void 0:y.subtitles,intro:y==null?void 0:y.intro,outro:y==null?void 0:y.outro},`${n==null?void 0:n.id}-${o==null?void 0:o.id}-${d==null?void 0:d.id}`):null,b.jsxs("div",{className:"bg-jet-card p-4",children:[b.jsxs("h1",{className:"text-xl md:text-2xl font-bold text-white mb-1",children:[n==null?void 0:n.title," - ",o==null?void 0:o.title," Episode ",d==null?void 0:d.number]}),b.jsx("h2",{className:"text-lg text-gray-300 mb-4",children:d==null?void 0:d.title}),b.jsxs("div",{className:"flex flex-wrap justify-between items-center",children:[b.jsxs("div",{className:"flex space-x-3",children:[b.jsxs("button",{onClick:he,className:"flex items-center bg-jet-hover hover:bg-gray-600 text-white px-4 py-2 rounded-full transition-colors",disabled:!o||!d||!n||o.episodes.findIndex(k=>k.id===d.id)===0&&n.seasons.findIndex(k=>k.id===o.id)===0,children:[b.jsx(kb,{className:"mr-2"})," Previous"]}),b.jsxs("button",{onClick:J,className:"flex items-center bg-jet-hover hover:bg-gray-600 text-white px-4 py-2 rounded-full transition-colors",disabled:!o||!d||!n||o.episodes.findIndex(k=>k.id===d.id)===o.episodes.length-1&&n.seasons.findIndex(k=>k.id===o.id)===n.seasons.length-1,children:["Next ",b.jsx(Mb,{className:"ml-2"})]})]}),b.jsx("div",{className:"mt-3 md:mt-0",children:b.jsxs(Ae,{to:`/anime/${n==null?void 0:n.id}`,className:"flex items-center bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-full transition-colors",children:[b.jsx(Fb,{className:"mr-2"})," All Episodes"]})})]})]})]}),y&&b.jsx("div",{className:"mt-6 bg-jet-card p-4 rounded-lg",children:b.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[b.jsx("span",{className:"text-white text-sm",children:"Servers:"}),D.map(k=>b.jsx("button",{onClick:()=>R(k),className:`px-3 py-1 text-sm rounded ${T===k?"bg-primary-600 text-white":"bg-jet-card text-white hover:bg-jet-hover"}`,children:k.charAt(0).toUpperCase()+k.slice(1)},k))]})}),b.jsxs("div",{className:"mt-8",children:[b.jsxs("div",{className:"flex justify-between items-center mb-4",children:[b.jsxs("h2",{className:"text-xl font-bold text-white",children:[o==null?void 0:o.title," Episodes"]}),F.length>1&&b.jsxs("div",{className:"relative",children:[b.jsx("select",{value:B,onChange:k=>N(parseInt(k.target.value)),className:"appearance-none bg-jet-hover text-white py-2 px-4 pr-8 rounded-md cursor-pointer",children:F.map((k,K)=>b.jsxs("option",{value:K,children:["Episodes ",k.start,"-",k.end]},K))}),b.jsx(Pb,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-white pointer-events-none"})]})]}),b.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:ee.map(k=>b.jsxs(Ae,{to:`/watch/${n==null?void 0:n.id}/${o==null?void 0:o.id}/${k.id}`,className:`block bg-jet-card rounded-lg overflow-hidden hover:bg-jet-hover transition-colors ${k.id===(d==null?void 0:d.id)?"ring-2 ring-primary-500":""}`,children:[b.jsxs("div",{className:"relative",children:[b.jsx("img",{src:k.thumbnail,alt:k.title,className:"w-full aspect-video object-cover"}),b.jsx("div",{className:"absolute bottom-2 right-2 bg-black/70 text-white text-xs px-2 py-1 rounded",children:se(k.duration)}),n&&o&&localStorage.getItem(`watchTime-${n.id}-${o.id}-${k.id}`)&&b.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-gray-700",children:b.jsx("div",{className:"h-full bg-primary-500",style:{width:`${Math.min(Math.round(parseFloat(localStorage.getItem(`watchTime-${n.id}-${o.id}-${k.id}`)||"0")/k.duration*100),100)}%`}})})]}),b.jsx("div",{className:"p-3",children:b.jsxs("div",{className:"flex justify-between items-start",children:[b.jsxs("div",{className:"flex-1 min-w-0 mr-2",children:[b.jsxs("p",{className:"text-gray-400 text-sm",children:["Episode ",k.number]}),b.jsx("h3",{className:"font-medium text-white line-clamp-1",children:k.title})]}),k.id===(d==null?void 0:d.id)&&b.jsx("span",{className:"bg-primary-600 text-white text-xs px-2 py-1 rounded-full flex-shrink-0 whitespace-nowrap",children:"Now Playing"})]})})]},k.id))}),F.length>2&&b.jsx("div",{className:"mt-6 flex flex-wrap gap-2 justify-center",children:F.map((k,K)=>b.jsxs("button",{onClick:()=>N(K),className:`px-3 py-1 text-sm rounded-full ${B===K?"bg-primary-600 text-white":"bg-jet-card text-white hover:bg-jet-hover"}`,children:[k.start,"-",k.end]},K))})]})]})})},Tw=()=>{const r=zs(),[e,t]=U.useState(""),[i,n]=U.useState(""),[l,o]=U.useState(!1),[u,d]=U.useState(""),[f,m]=U.useState(!1),[g,v]=U.useState(!1),E=async y=>{if(y.preventDefault(),!e.trim()||!i.trim()){d("Please enter both email and password");return}d(""),m(!0);try{await new Promise(S=>setTimeout(S,1e3)),localStorage.setItem("isLoggedIn","true"),l?localStorage.setItem("rememberedEmail",e):localStorage.removeItem("rememberedEmail"),r("/")}catch{d("Invalid email or password. Please try again.")}finally{m(!1)}};return Si.useEffect(()=>{const y=localStorage.getItem("rememberedEmail");y&&(t(y),o(!0))},[]),b.jsx(Mt,{children:b.jsx("div",{className:"flex min-h-[calc(100vh-80px)] items-center justify-center py-12 px-4 sm:px-6 lg:px-8",children:b.jsx("div",{className:"w-full max-w-md",children:b.jsxs("div",{className:"bg-jet-card rounded-xl p-8 shadow-lg border border-jetblack-800",children:[b.jsxs("div",{className:"text-center mb-8",children:[b.jsx("h2",{className:"text-3xl font-bold text-white",children:"Sign in"}),b.jsx("p",{className:"mt-2 text-gray-400",children:"to continue to PixelAnime"})]}),u&&b.jsx("div",{className:"mb-4 p-3 bg-red-900/50 border border-red-800 rounded-md text-red-200 text-sm",children:u}),b.jsxs("form",{className:"space-y-6",onSubmit:E,children:[b.jsxs("div",{children:[b.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-300 mb-1",children:"Email address"}),b.jsxs("div",{className:"relative",children:[b.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:b.jsx(wv,{className:"h-5 w-5 text-gray-500"})}),b.jsx("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,value:e,onChange:y=>t(y.target.value),className:"appearance-none bg-jetblack-900 border border-jetblack-700 text-white rounded-md block w-full pl-10 py-3 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-primary-600 focus:border-transparent",placeholder:"Email address"})]})]}),b.jsxs("div",{children:[b.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-300 mb-1",children:"Password"}),b.jsxs("div",{className:"relative",children:[b.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:b.jsx(dd,{className:"h-5 w-5 text-gray-500"})}),b.jsx("input",{id:"password",name:"password",type:g?"text":"password",autoComplete:"current-password",required:!0,value:i,onChange:y=>n(y.target.value),className:"appearance-none bg-jetblack-900 border border-jetblack-700 text-white rounded-md block w-full pl-10 pr-10 py-3 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-primary-600 focus:border-transparent",placeholder:"Password"}),b.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:b.jsx("button",{type:"button",onClick:()=>v(!g),className:"text-gray-500 hover:text-gray-300 focus:outline-none",children:g?b.jsx(cd,{className:"h-5 w-5"}):b.jsx(ud,{className:"h-5 w-5"})})})]})]}),b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsxs("div",{className:"flex items-center",children:[b.jsx("input",{id:"remember-me",name:"remember-me",type:"checkbox",checked:l,onChange:y=>o(y.target.checked),className:"h-4 w-4 bg-jetblack-900 border-jetblack-700 rounded text-primary-600 focus:ring-primary-500 focus:ring-offset-jetblack-900"}),b.jsx("label",{htmlFor:"remember-me",className:"ml-2 block text-sm text-gray-300",children:"Remember me"})]}),b.jsx("div",{className:"text-sm",children:b.jsx(Ae,{to:"/forgot-password",className:"font-medium text-primary-500 hover:text-primary-400",children:"Forgot your password?"})})]}),b.jsx("div",{children:b.jsxs("button",{type:"submit",disabled:f,className:`w-full flex justify-center items-center py-3 px-4 border border-transparent rounded-full shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors ${f?"opacity-70 cursor-not-allowed":""}`,children:[f?b.jsx("div",{className:"mr-2 h-4 w-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):null,"Sign in"]})})]}),b.jsxs("div",{className:"mt-6 text-center text-sm",children:[b.jsx("span",{className:"text-gray-400",children:"Don't have an account?"})," ",b.jsx(Ae,{to:"/register",className:"font-medium text-primary-500 hover:text-primary-400",children:"Sign up now"})]})]})})})})},bw=()=>{const r=zs(),[e,t]=U.useState(""),[i,n]=U.useState(""),[l,o]=U.useState(""),[u,d]=U.useState(""),[f,m]=U.useState(""),[g,v]=U.useState(!1),[E,y]=U.useState(!1),[S,T]=U.useState(!1),[R,D]=U.useState(!1),_=()=>!e.trim()||!i.trim()||!l||!u?(m("All fields are required"),!1):!i.includes("@")||!i.includes(".")?(m("Please enter a valid email address"),!1):l.length<6?(m("Password must be at least 6 characters long"),!1):l!==u?(m("Passwords do not match"),!1):R?!0:(m("You must agree to the Terms of Service and Privacy Policy"),!1),O=async C=>{if(C.preventDefault(),!!_()){m(""),v(!0);try{await new Promise(B=>setTimeout(B,1e3)),localStorage.setItem("isLoggedIn","true"),localStorage.setItem("username",e),localStorage.setItem("userEmail",i),r("/profile")}catch{m("Registration failed. Please try again.")}finally{v(!1)}}};return b.jsx(Mt,{children:b.jsx("div",{className:"flex min-h-[calc(100vh-80px)] items-center justify-center py-12 px-4 sm:px-6 lg:px-8",children:b.jsx("div",{className:"w-full max-w-md",children:b.jsxs("div",{className:"bg-jet-card rounded-xl p-8 shadow-lg border border-jetblack-800",children:[b.jsxs("div",{className:"text-center mb-8",children:[b.jsx("h2",{className:"text-3xl font-bold text-white",children:"Create Account"}),b.jsx("p",{className:"mt-2 text-gray-400",children:"Join PixelAnime and start streaming"})]}),f&&b.jsx("div",{className:"mb-4 p-3 bg-red-900/50 border border-red-800 rounded-md text-red-200 text-sm",children:f}),b.jsxs("form",{className:"space-y-6",onSubmit:O,children:[b.jsxs("div",{children:[b.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-300 mb-1",children:"Username"}),b.jsxs("div",{className:"relative",children:[b.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:b.jsx(Go,{className:"h-5 w-5 text-gray-500"})}),b.jsx("input",{id:"username",name:"username",type:"text",autoComplete:"username",required:!0,value:e,onChange:C=>t(C.target.value),className:"appearance-none bg-jetblack-900 border border-jetblack-700 text-white rounded-md block w-full pl-10 py-3 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-primary-600 focus:border-transparent",placeholder:"Username"})]})]}),b.jsxs("div",{children:[b.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-300 mb-1",children:"Email address"}),b.jsxs("div",{className:"relative",children:[b.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:b.jsx(wv,{className:"h-5 w-5 text-gray-500"})}),b.jsx("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,value:i,onChange:C=>n(C.target.value),className:"appearance-none bg-jetblack-900 border border-jetblack-700 text-white rounded-md block w-full pl-10 py-3 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-primary-600 focus:border-transparent",placeholder:"Email address"})]})]}),b.jsxs("div",{children:[b.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-300 mb-1",children:"Password"}),b.jsxs("div",{className:"relative",children:[b.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:b.jsx(dd,{className:"h-5 w-5 text-gray-500"})}),b.jsx("input",{id:"password",name:"password",type:E?"text":"password",autoComplete:"new-password",required:!0,value:l,onChange:C=>o(C.target.value),className:"appearance-none bg-jetblack-900 border border-jetblack-700 text-white rounded-md block w-full pl-10 pr-10 py-3 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-primary-600 focus:border-transparent",placeholder:"Password (min. 6 characters)"}),b.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:b.jsx("button",{type:"button",onClick:()=>y(!E),className:"text-gray-500 hover:text-gray-300 focus:outline-none",children:E?b.jsx(cd,{className:"h-5 w-5"}):b.jsx(ud,{className:"h-5 w-5"})})})]})]}),b.jsxs("div",{children:[b.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-300 mb-1",children:"Confirm Password"}),b.jsxs("div",{className:"relative",children:[b.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:b.jsx(dd,{className:"h-5 w-5 text-gray-500"})}),b.jsx("input",{id:"confirmPassword",name:"confirmPassword",type:S?"text":"password",autoComplete:"new-password",required:!0,value:u,onChange:C=>d(C.target.value),className:"appearance-none bg-jetblack-900 border border-jetblack-700 text-white rounded-md block w-full pl-10 pr-10 py-3 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-primary-600 focus:border-transparent",placeholder:"Confirm password"}),b.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:b.jsx("button",{type:"button",onClick:()=>T(!S),className:"text-gray-500 hover:text-gray-300 focus:outline-none",children:S?b.jsx(cd,{className:"h-5 w-5"}):b.jsx(ud,{className:"h-5 w-5"})})})]})]}),b.jsxs("div",{className:"flex items-center",children:[b.jsx("input",{id:"terms",name:"terms",type:"checkbox",checked:R,onChange:C=>D(C.target.checked),className:"h-4 w-4 bg-jetblack-900 border-jetblack-700 rounded text-primary-600 focus:ring-primary-500 focus:ring-offset-jetblack-900"}),b.jsxs("label",{htmlFor:"terms",className:"ml-2 block text-sm text-gray-300",children:["I agree to the"," ",b.jsx(Ae,{to:"/terms",className:"text-primary-500 hover:text-primary-400",children:"Terms of Service"})," ","and"," ",b.jsx(Ae,{to:"/privacy",className:"text-primary-500 hover:text-primary-400",children:"Privacy Policy"})]})]}),b.jsx("div",{children:b.jsxs("button",{type:"submit",disabled:g,className:`w-full flex justify-center items-center py-3 px-4 border border-transparent rounded-full shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors ${g?"opacity-70 cursor-not-allowed":""}`,children:[g?b.jsx("div",{className:"mr-2 h-4 w-4 border-2 border-white border-t-transparent rounded-full animate-spin"}):null,"Create Account"]})})]}),b.jsxs("div",{className:"mt-6 text-center text-sm",children:[b.jsx("span",{className:"text-gray-400",children:"Already have an account?"})," ",b.jsx(Ae,{to:"/login",className:"font-medium text-primary-500 hover:text-primary-400",children:"Sign in"})]})]})})})})},Aw=()=>{const r=zs(),[e,t]=U.useState("history"),[i,n]=U.useState(""),[l,o]=U.useState(""),[u,d]=U.useState([]),[f,m]=U.useState(!1);U.useEffect(()=>{const y=localStorage.getItem("isLoggedIn")==="true";if(m(y),!y){r("/login");return}n(localStorage.getItem("username")||"User"),o(localStorage.getItem("userEmail")||"user@example.com");try{const S=localStorage.getItem("watchHistory");S&&d(JSON.parse(S))}catch(S){console.error("Error loading watch history:",S)}},[r]);const g=()=>{localStorage.removeItem("isLoggedIn"),r("/login")},v=()=>{window.confirm("Are you sure you want to clear your watch history?")&&(localStorage.removeItem("watchHistory"),d([]))},E=y=>new Date(y).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return f?b.jsx(Mt,{children:b.jsx("div",{className:"container mx-auto px-4 py-8",children:b.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-8",children:[b.jsx("div",{className:"lg:col-span-1",children:b.jsx("div",{className:"bg-jet-card rounded-xl p-6 shadow-lg border border-jetblack-800",children:b.jsxs("div",{className:"flex flex-col items-center",children:[b.jsx("div",{className:"h-24 w-24 rounded-full bg-primary-600 flex items-center justify-center text-white text-4xl mb-4",children:b.jsx(Go,{})}),b.jsx("h2",{className:"text-xl font-bold text-white mb-1",children:i}),b.jsx("p",{className:"text-gray-400 text-sm mb-4",children:l}),b.jsxs("div",{className:"w-full mt-4 space-y-2",children:[b.jsxs("button",{onClick:()=>t("history"),className:`w-full flex items-center px-4 py-2 rounded-md ${e==="history"?"bg-primary-600 text-white":"text-gray-300 hover:bg-jet-hover"}`,children:[b.jsx(Dp,{className:"mr-3"})," Watch History"]}),b.jsxs("button",{onClick:()=>t("watchlist"),className:`w-full flex items-center px-4 py-2 rounded-md ${e==="watchlist"?"bg-primary-600 text-white":"text-gray-300 hover:bg-jet-hover"}`,children:[b.jsx(Ap,{className:"mr-3"})," Watchlist"]}),b.jsxs("button",{onClick:()=>t("settings"),className:`w-full flex items-center px-4 py-2 rounded-md ${e==="settings"?"bg-primary-600 text-white":"text-gray-300 hover:bg-jet-hover"}`,children:[b.jsx(Ub,{className:"mr-3"})," Settings"]}),b.jsxs("button",{onClick:g,className:"w-full flex items-center px-4 py-2 rounded-md text-gray-300 hover:bg-red-900/30 hover:text-red-200",children:[b.jsx(jb,{className:"mr-3"})," Sign Out"]})]})]})})}),b.jsx("div",{className:"lg:col-span-3",children:b.jsxs("div",{className:"bg-jet-card rounded-xl p-6 shadow-lg border border-jetblack-800 min-h-[600px]",children:[e==="history"&&b.jsxs("div",{children:[b.jsxs("div",{className:"flex justify-between items-center mb-6",children:[b.jsx("h2",{className:"text-2xl font-bold text-white",children:"Watch History"}),u.length>0&&b.jsx("button",{onClick:v,className:"text-sm text-gray-400 hover:text-red-400",children:"Clear History"})]}),u.length===0?b.jsxs("div",{className:"text-center py-12",children:[b.jsx(Dp,{className:"text-gray-700 w-16 h-16 mx-auto mb-4"}),b.jsx("h3",{className:"text-xl text-gray-400 mb-2",children:"No Watch History"}),b.jsx("p",{className:"text-gray-500 mb-6",children:"You haven't watched any anime yet."}),b.jsx(Ae,{to:"/browse",className:"inline-block bg-primary-600 hover:bg-primary-700 text-white py-2 px-6 rounded-full transition-colors",children:"Browse Anime"})]}):b.jsx("div",{className:"space-y-4",children:u.map((y,S)=>b.jsxs(Ae,{to:`/watch/${y.animeId}/${y.seasonId}/${y.episodeId}`,className:"flex flex-col sm:flex-row p-3 bg-jet-hover rounded-lg hover:bg-jetblack-800 transition-colors",children:[b.jsxs("div",{className:"relative sm:w-48 h-24 flex-shrink-0 mb-3 sm:mb-0",children:[b.jsx("img",{src:y.thumbnail,alt:y.title,className:"w-full h-full object-cover rounded-md"}),b.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-gray-700",children:b.jsx("div",{className:"h-full bg-primary-500",style:{width:`${y.progress}%`}})})]}),b.jsxs("div",{className:"flex-1 sm:ml-4",children:[b.jsx("h3",{className:"text-white font-medium",children:y.title}),b.jsxs("p",{className:"text-gray-400 text-sm",children:["S",y.seasonNumber," E",y.episodeNumber,": ",y.episodeTitle]}),b.jsx("p",{className:"text-gray-500 text-xs mt-1",children:E(y.lastWatched)}),b.jsxs("div",{className:"flex items-center mt-2",children:[b.jsxs("span",{className:"text-primary-500 text-xs",children:[y.progress,"% watched"]}),b.jsx("span",{className:"mx-2 text-gray-600",children:"•"}),b.jsx("span",{className:"text-gray-400 text-xs hover:text-primary-400",children:"Continue watching"})]})]})]},S))})]}),e==="watchlist"&&b.jsxs("div",{children:[b.jsx("h2",{className:"text-2xl font-bold text-white mb-6",children:"My Watchlist"}),b.jsxs("div",{className:"text-center py-12",children:[b.jsx(Ap,{className:"text-gray-700 w-16 h-16 mx-auto mb-4"}),b.jsx("h3",{className:"text-xl text-gray-400 mb-2",children:"Watchlist Coming Soon"}),b.jsx("p",{className:"text-gray-500 mb-6",children:"The ability to save anime to your watchlist will be available soon."}),b.jsx(Ae,{to:"/browse",className:"inline-block bg-primary-600 hover:bg-primary-700 text-white py-2 px-6 rounded-full transition-colors",children:"Browse Anime"})]})]}),e==="settings"&&b.jsxs("div",{children:[b.jsx("h2",{className:"text-2xl font-bold text-white mb-6",children:"Account Settings"}),b.jsxs("div",{className:"space-y-6",children:[b.jsxs("div",{children:[b.jsx("h3",{className:"text-lg font-medium text-white mb-4",children:"Profile Information"}),b.jsxs("div",{className:"space-y-4",children:[b.jsxs("div",{children:[b.jsx("label",{htmlFor:"update-username",className:"block text-sm font-medium text-gray-300 mb-1",children:"Username"}),b.jsx("input",{type:"text",id:"update-username",className:"w-full bg-jetblack-900 border border-jetblack-700 rounded-md px-4 py-2 text-white",value:i,onChange:y=>n(y.target.value)})]}),b.jsxs("div",{children:[b.jsx("label",{htmlFor:"update-email",className:"block text-sm font-medium text-gray-300 mb-1",children:"Email"}),b.jsx("input",{type:"email",id:"update-email",className:"w-full bg-jetblack-900 border border-jetblack-700 rounded-md px-4 py-2 text-white",value:l,onChange:y=>o(y.target.value)})]}),b.jsx("div",{children:b.jsx("button",{className:"bg-primary-600 hover:bg-primary-700 text-white py-2 px-6 rounded-full transition-colors",children:"Save Changes"})})]})]}),b.jsxs("div",{className:"border-t border-jetblack-700 pt-6",children:[b.jsx("h3",{className:"text-lg font-medium text-white mb-4",children:"Password"}),b.jsxs("div",{className:"space-y-4",children:[b.jsxs("div",{children:[b.jsx("label",{htmlFor:"current-password",className:"block text-sm font-medium text-gray-300 mb-1",children:"Current Password"}),b.jsx("input",{type:"password",id:"current-password",className:"w-full bg-jetblack-900 border border-jetblack-700 rounded-md px-4 py-2 text-white"})]}),b.jsxs("div",{children:[b.jsx("label",{htmlFor:"new-password",className:"block text-sm font-medium text-gray-300 mb-1",children:"New Password"}),b.jsx("input",{type:"password",id:"new-password",className:"w-full bg-jetblack-900 border border-jetblack-700 rounded-md px-4 py-2 text-white"})]}),b.jsxs("div",{children:[b.jsx("label",{htmlFor:"confirm-password",className:"block text-sm font-medium text-gray-300 mb-1",children:"Confirm New Password"}),b.jsx("input",{type:"password",id:"confirm-password",className:"w-full bg-jetblack-900 border border-jetblack-700 rounded-md px-4 py-2 text-white"})]}),b.jsx("div",{children:b.jsx("button",{className:"bg-primary-600 hover:bg-primary-700 text-white py-2 px-6 rounded-full transition-colors",children:"Change Password"})})]})]}),b.jsxs("div",{className:"border-t border-jetblack-700 pt-6",children:[b.jsx("h3",{className:"text-lg font-medium text-red-400 mb-4",children:"Danger Zone"}),b.jsx("button",{className:"bg-red-900/30 hover:bg-red-900/50 text-red-200 py-2 px-6 rounded-md transition-colors",children:"Delete Account"})]})]})]})]})})]})})}):null};function Rw(){return b.jsxs(jT,{children:[b.jsx(ki,{path:"/",element:b.jsx(Yp,{})}),b.jsx(ki,{path:"/browse",element:b.jsx(LR,{})}),b.jsx(ki,{path:"/categories",element:b.jsx(_R,{})}),b.jsx(ki,{path:"/anime/:id",element:b.jsx(DR,{})}),b.jsx(ki,{path:"/watch/:animeId/:seasonId/:episodeId",element:b.jsx(Sw,{})}),b.jsx(ki,{path:"/login",element:b.jsx(Tw,{})}),b.jsx(ki,{path:"/register",element:b.jsx(bw,{})}),b.jsx(ki,{path:"/profile",element:b.jsx(Aw,{})}),b.jsx(ki,{path:"*",element:b.jsx(Yp,{})})]})}var Uo={exports:{}};/* NProgress, (c) 2013, 2014 Rico Sta. Cruz - http://ricostacruz.com/nprogress
 * @license MIT */var Lw=Uo.exports,ov;function _w(){return ov||(ov=1,function(r,e){(function(t,i){r.exports=i()})(Lw,function(){var t={};t.version="0.2.0";var i=t.settings={minimum:.08,easing:"ease",positionUsing:"",speed:200,trickle:!0,trickleRate:.02,trickleSpeed:800,showSpinner:!0,barSelector:'[role="bar"]',spinnerSelector:'[role="spinner"]',parent:"body",template:'<div class="bar" role="bar"><div class="peg"></div></div><div class="spinner" role="spinner"><div class="spinner-icon"></div></div>'};t.configure=function(y){var S,T;for(S in y)T=y[S],T!==void 0&&y.hasOwnProperty(S)&&(i[S]=T);return this},t.status=null,t.set=function(y){var S=t.isStarted();y=n(y,i.minimum,1),t.status=y===1?null:y;var T=t.render(!S),R=T.querySelector(i.barSelector),D=i.speed,_=i.easing;return T.offsetWidth,u(function(O){i.positionUsing===""&&(i.positionUsing=t.getPositioningCSS()),d(R,o(y,D,_)),y===1?(d(T,{transition:"none",opacity:1}),T.offsetWidth,setTimeout(function(){d(T,{transition:"all "+D+"ms linear",opacity:0}),setTimeout(function(){t.remove(),O()},D)},D)):setTimeout(O,D)}),this},t.isStarted=function(){return typeof t.status=="number"},t.start=function(){t.status||t.set(0);var y=function(){setTimeout(function(){t.status&&(t.trickle(),y())},i.trickleSpeed)};return i.trickle&&y(),this},t.done=function(y){return!y&&!t.status?this:t.inc(.3+.5*Math.random()).set(1)},t.inc=function(y){var S=t.status;return S?(typeof y!="number"&&(y=(1-S)*n(Math.random()*S,.1,.95)),S=n(S+y,0,.994),t.set(S)):t.start()},t.trickle=function(){return t.inc(Math.random()*i.trickleRate)},function(){var y=0,S=0;t.promise=function(T){return!T||T.state()==="resolved"?this:(S===0&&t.start(),y++,S++,T.always(function(){S--,S===0?(y=0,t.done()):t.set((y-S)/y)}),this)}}(),t.render=function(y){if(t.isRendered())return document.getElementById("nprogress");m(document.documentElement,"nprogress-busy");var S=document.createElement("div");S.id="nprogress",S.innerHTML=i.template;var T=S.querySelector(i.barSelector),R=y?"-100":l(t.status||0),D=document.querySelector(i.parent),_;return d(T,{transition:"all 0 linear",transform:"translate3d("+R+"%,0,0)"}),i.showSpinner||(_=S.querySelector(i.spinnerSelector),_&&E(_)),D!=document.body&&m(D,"nprogress-custom-parent"),D.appendChild(S),S},t.remove=function(){g(document.documentElement,"nprogress-busy"),g(document.querySelector(i.parent),"nprogress-custom-parent");var y=document.getElementById("nprogress");y&&E(y)},t.isRendered=function(){return!!document.getElementById("nprogress")},t.getPositioningCSS=function(){var y=document.body.style,S="WebkitTransform"in y?"Webkit":"MozTransform"in y?"Moz":"msTransform"in y?"ms":"OTransform"in y?"O":"";return S+"Perspective"in y?"translate3d":S+"Transform"in y?"translate":"margin"};function n(y,S,T){return y<S?S:y>T?T:y}function l(y){return(-1+y)*100}function o(y,S,T){var R;return i.positionUsing==="translate3d"?R={transform:"translate3d("+l(y)+"%,0,0)"}:i.positionUsing==="translate"?R={transform:"translate("+l(y)+"%,0)"}:R={"margin-left":l(y)+"%"},R.transition="all "+S+"ms "+T,R}var u=function(){var y=[];function S(){var T=y.shift();T&&T(S)}return function(T){y.push(T),y.length==1&&S()}}(),d=function(){var y=["Webkit","O","Moz","ms"],S={};function T(O){return O.replace(/^-ms-/,"ms-").replace(/-([\da-z])/gi,function(C,B){return B.toUpperCase()})}function R(O){var C=document.body.style;if(O in C)return O;for(var B=y.length,N=O.charAt(0).toUpperCase()+O.slice(1),F;B--;)if(F=y[B]+N,F in C)return F;return O}function D(O){return O=T(O),S[O]||(S[O]=R(O))}function _(O,C,B){C=D(C),O.style[C]=B}return function(O,C){var B=arguments,N,F;if(B.length==2)for(N in C)F=C[N],F!==void 0&&C.hasOwnProperty(N)&&_(O,N,F);else _(O,B[1],B[2])}}();function f(y,S){var T=typeof y=="string"?y:v(y);return T.indexOf(" "+S+" ")>=0}function m(y,S){var T=v(y),R=T+S;f(T,S)||(y.className=R.substring(1))}function g(y,S){var T=v(y),R;f(y,S)&&(R=T.replace(" "+S+" "," "),y.className=R.substring(1,R.length-1))}function v(y){return(" "+(y.className||"")+" ").replace(/\s+/gi," ")}function E(y){y&&y.parentNode&&y.parentNode.removeChild(y)}return t})}(Uo)),Uo.exports}var Dw=_w();const Bo=Ud(Dw);Bo.configure({showSpinner:!1,trickleSpeed:200,easing:"ease",speed:300,minimum:.1});const ww=({children:r})=>{const e=bi();return U.useEffect(()=>{Bo.done(),Bo.start();const t=setTimeout(()=>{Bo.done()},400);return()=>{clearTimeout(t)}},[e.pathname]),b.jsx(b.Fragment,{children:r})},Iw=()=>{const{pathname:r}=bi();return U.useEffect(()=>{window.scrollTo({top:0,left:0,behavior:"instant"})},[r]),null};XS.createRoot(document.getElementById("root")).render(b.jsx(Si.StrictMode,{children:b.jsxs(fb,{children:[b.jsx(Iw,{}),b.jsx(ww,{children:b.jsx(Rw,{})})]})}));
